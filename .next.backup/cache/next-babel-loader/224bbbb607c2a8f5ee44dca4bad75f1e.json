{"ast":null,"code":"var _jsxFileName = \"/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/partials/Approval.tsx\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { Button, Flex } from '@chakra-ui/core';\nimport { Contract } from '@ethersproject/contracts';\nimport { useWeb3React } from '@web3-react/core';\n\nconst getContract = (address, abi, library, account) => {\n  return new Contract(address, abi, library.getSigner(account).connectUnchecked());\n};\n\nexport default function Approval(props) {\n  const {\n    account\n  } = useWeb3React();\n  const {\n    0: approved,\n    1: setApproved\n  } = useState(false);\n  const {\n    0: decimals,\n    1: setDecimals\n  } = useState(null);\n  const {\n    0: spendingContract,\n    1: setSpendingContract\n  } = useState(null);\n  const {\n    0: handlerContract,\n    1: setHandlerContract\n  } = useState(null);\n  useEffect(() => {\n    if (!handlerContract && props.handler && props.library) {\n      createHandlerContract(props.handler, props.library);\n    }\n  });\n  useEffect(() => {\n    if (!spendingContract && props.spending && props.library) {\n      createSpendingContract(props.spending, props.library);\n    }\n  });\n  useEffect(() => {\n    if (spendingContract) {\n      checkApproval(props.handler, props.spending, props.amount);\n    }\n  });\n  return account && !approved ? __jsx(Flex, {\n    w: \"100%\",\n    flexWrap: \"wrap\",\n    mt: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 5\n    }\n  }, __jsx(Button, {\n    onClick: approveCovalFlow,\n    backgroundColor: \"#02b402\",\n    color: \"black !important\",\n    fontWeight: \"bold !important\",\n    width: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }\n  }, props.label)) : null;\n\n  function createSpendingContract(spending, library) {\n    let _contract = getContract(spending.address, spending.abi, library, account);\n\n    setSpendingContract(_contract);\n  }\n\n  function createHandlerContract(handler, library) {\n    let _contract = getContract(handler.address, handler.abi, library, account);\n\n    setHandlerContract(_contract);\n  }\n\n  function checkApproval(handler, spending, amount) {\n    if (amount > 0) {\n      spendingContract.decimals().then(decimals => {\n        setDecimals(decimals);\n        spendingContract.allowance(account, handler.address).then(allowance => {\n          setApproved(allowance >= amount * 10 ** decimals);\n        });\n      });\n    }\n  }\n\n  function approveCovalFlow() {\n    alert('approving coval flow');\n  }\n} // export class Approval extends Component<AttributesProps> {\n//   render() {\n//     let handler = this.props.handler\n//     let spending = this.props.spending\n//     let amount = this.props.amount\n//     let label = this.props.label\n//     let library = this.props.library\n//     let account = this.props.account\n//     let approved = checkApproval(handler, spending, library, account, amount)\n//     return approved? (\n//       <></>\n//     ) : (\n//       <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n//         <Button backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n//           {label}\n//         </Button>\n//       </Flex>\n//     )\n//   }\n// }\n// export default Approval","map":{"version":3,"sources":["/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/partials/Approval.tsx"],"names":["React","useEffect","useState","Button","Flex","Contract","useWeb3React","getContract","address","abi","library","account","getSigner","connectUnchecked","Approval","props","approved","setApproved","decimals","setDecimals","spendingContract","setSpendingContract","handlerContract","setHandlerContract","handler","createHandlerContract","spending","createSpendingContract","checkApproval","amount","approveCovalFlow","label","_contract","then","allowance","alert"],"mappings":"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","sourcesContent":["import React, { Component, useEffect, useState } from 'react'\nimport {\n  Box,\n  Image,\n  Text,\n  Link,\n  useColorMode,\n  Button,\n  Flex,\n  PseudoBox\n} from '@chakra-ui/core'\n\nimport {HStack, VStack, Circle } from '@chakra-ui/react'\nimport { Contract } from '@ethersproject/contracts'\nimport { useWeb3React } from '@web3-react/core'\n\nconst getContract = (address, abi, library, account): any =>{\n  return new Contract(address, abi, library.getSigner(account).connectUnchecked())\n}\n\ntype AttributesProps = {\n  handler: {address: string, abi: any},\n  spending: {address: string, abi: any},\n  amount: number,\n  label: string,\n  library: any,\n  account: any,\n}\nexport default function Approval(props: AttributesProps) {\n  \n  const { account } = useWeb3React()\n  const [approved, setApproved] = useState(false)\n  const [decimals, setDecimals] = useState(null)\n  const [spendingContract, setSpendingContract] = useState(null)\n  const [handlerContract, setHandlerContract] = useState(null)\n\n  useEffect(()=>{\n    if (!handlerContract && props.handler && props.library) {\n      createHandlerContract(props.handler, props.library)\n    }    \n  })\n\n  useEffect(()=>{\n    if (!spendingContract && props.spending && props.library) {\n      createSpendingContract(props.spending, props.library)\n    }    \n  })\n\n  useEffect(()=>{\n    if (spendingContract){\n      checkApproval(props.handler, props.spending, props.amount)\n    }\n  })\n  \n  return account && !approved? (\n    <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n      <Button onClick={approveCovalFlow} backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n        {props.label}\n      </Button>\n    </Flex>\n  ): null\n\n  function createSpendingContract(spending, library){\n    let _contract = getContract(spending.address, spending.abi, library, account)\n      setSpendingContract(_contract)\n  }\n\n  function createHandlerContract(handler, library){\n    let _contract = getContract(handler.address, handler.abi, library, account)\n      setHandlerContract(_contract)\n  }\n\n  function checkApproval(handler: { address: string; abi: any }, spending: { address: string; abi: any }, amount: number) {\n    if (amount > 0) {      \n      spendingContract.decimals().then((decimals: any) => {\n        setDecimals(decimals)\n        spendingContract.allowance(account, handler.address).then((allowance: any) => {\n          setApproved(allowance >= amount * 10 ** decimals)\n        })\n      })\n    }\n  }\n\n  function approveCovalFlow () {\n   alert('approving coval flow')\n  }\n}\n// export class Approval extends Component<AttributesProps> {\n//   render() {\n//     let handler = this.props.handler\n//     let spending = this.props.spending\n//     let amount = this.props.amount\n//     let label = this.props.label\n//     let library = this.props.library\n//     let account = this.props.account\n//     let approved = checkApproval(handler, spending, library, account, amount)\n//     return approved? (\n//       <></>\n//     ) : (\n//       <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n//         <Button backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n//           {label}\n//         </Button>\n//       </Flex>\n//     )\n//   }\n// }\n\n// export default Approval\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}