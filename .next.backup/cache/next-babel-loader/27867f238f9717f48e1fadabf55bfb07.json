{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/SwapChain.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Box, Flex, Text, Image, Stack, Button, Input, Select, Tabs, Tab, TabList, TabPanels, TabPanel } from '@chakra-ui/core';\nimport Loader from 'react-loader';\nimport Refreshing from './Refreshing';\nimport { useRouter } from 'next/router';\nimport { useWeb3React } from '@web3-react/core';\nimport { useEffect, useState } from 'react';\nimport { CHAIN_ID_NAMES } from '../utils';\nimport { useContract } from '../hooks';\nimport { EMBLEM_API, contractAddresses } from '../constants';\nimport { TransactionToast } from './TransactionToast';\nimport { parseUnits } from '@ethersproject/units';\nimport BridgeDeposits from './partials/BridgeDeposits';\nexport default function SwapChain() {\n  _s();\n\n  var _useRouter = useRouter(),\n      query = _useRouter.query;\n\n  var _useWeb3React = useWeb3React(),\n      account = _useWeb3React.account,\n      chainId = _useWeb3React.chainId; // const [vaults, setVaults] = useState([])\n\n\n  var _useState = useState({\n    loaded: false\n  }),\n      state = _useState[0],\n      setState = _useState[1];\n\n  var _useState2 = useState(false),\n      loadingApi = _useState2[0],\n      setLoadingApi = _useState2[1];\n\n  var _useState3 = useState(false),\n      approving = _useState3[0],\n      setApproving = _useState3[1];\n\n  var _useState4 = useState(false),\n      transfering = _useState4[0],\n      setTransfering = _useState4[1];\n\n  var _useState5 = useState(null),\n      balance = _useState5[0],\n      setBalance = _useState5[1];\n\n  var _useState6 = useState(query.address),\n      address = _useState6[0],\n      setAddress = _useState6[1];\n\n  var _useState7 = useState(query.experimental),\n      experimental = _useState7[0],\n      setExperimental = _useState7[1];\n\n  var _useState8 = useState(null),\n      decimals = _useState8[0],\n      setDecimals = _useState8[1];\n\n  var _useState9 = useState(null),\n      allowance = _useState9[0],\n      setAllowance = _useState9[1];\n\n  var _useState10 = useState(137),\n      transferChain = _useState10[0],\n      setTransferChain = _useState10[1];\n\n  var _useState11 = useState(0),\n      covalApprovedFor = _useState11[0],\n      setIsCovalApproved = _useState11[1];\n\n  var _useState12 = useState(null),\n      hash = _useState12[0],\n      setHash = _useState12[1];\n\n  var _useState13 = useState(0),\n      swapAmount = _useState13[0],\n      setSwapAmount = _useState13[1];\n\n  var _useState14 = useState(false),\n      isInvalid = _useState14[0],\n      setIsInvalid = _useState14[1];\n\n  var _useState15 = useState(true),\n      transferChainChanged = _useState15[0],\n      setTransferChainChanged = _useState15[1];\n\n  var handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true);\n  var covalContract = useContract(contractAddresses.coval[chainId], contractAddresses.covalAbi, true);\n\n  var transferToChain = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setTransfering(true);\n              handlerContract.transferToChain(transferChain, swapAmount.toString()).then(function (_ref2) {\n                var hash = _ref2.hash;\n                setHash(hash);\n              })[\"catch\"](function (error) {\n                if ((error === null || error === void 0 ? void 0 : error.code) == 4001) {\n                  setTransfering(false);\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function transferToChain() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getContractStates = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setHash(null);\n              _context2.t0 = setDecimals;\n              _context2.next = 4;\n              return covalContract.decimals();\n\n            case 4:\n              _context2.t1 = _context2.sent;\n              (0, _context2.t0)(_context2.t1);\n              _context2.t2 = setAllowance;\n              _context2.next = 9;\n              return covalContract.allowance(account, contractAddresses.vaultHandler[chainId]).then(function (balance) {\n                return balance.toString();\n              });\n\n            case 9:\n              _context2.t3 = _context2.sent;\n              (0, _context2.t2)(_context2.t3);\n              _context2.t4 = setBalance;\n              _context2.next = 14;\n              return covalContract.balanceOf(account).then(function (balance) {\n                return balance.toString();\n              });\n\n            case 14:\n              _context2.t5 = _context2.sent;\n              (0, _context2.t4)(_context2.t5);\n\n              if (Number(allowance) >= Number(0)) {\n                setIsCovalApproved(allowance);\n              }\n\n              setState({\n                loaded: true\n              });\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getContractStates() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var approveCovalFlow = function approveCovalFlow() {\n    setApproving(true);\n    covalContract.approve(contractAddresses.vaultHandler[chainId], 10000000 * Math.pow(10, +decimals)).then(function (_ref4) {\n      var hash = _ref4.hash;\n      setHash(hash);\n    })[\"catch\"](function (error) {\n      if ((error === null || error === void 0 ? void 0 : error.code) == 4001) {\n        setApproving(false);\n      }\n    });\n  };\n\n  var getTransferLogs = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              console.log(\"getting logs\");\n              fetch(EMBLEM_API + '/transfersOut', {\n                method: 'GET',\n                headers: {\n                  'Content-Type': 'application/json',\n                  service: 'evmetadata',\n                  chainid: chainId.toString()\n                }\n              }).then( /*#__PURE__*/function () {\n                var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response) {\n                  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          console.log(\"doing transfers\");\n                          fetch(EMBLEM_API + '/doTransfers', {\n                            method: 'GET',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              service: 'evmetadata',\n                              chainid: chainId.toString()\n                            }\n                          }).then( /*#__PURE__*/function () {\n                            var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response) {\n                              return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                                while (1) {\n                                  switch (_context3.prev = _context3.next) {\n                                    case 0:\n                                      getContractStates();\n\n                                    case 1:\n                                    case \"end\":\n                                      return _context3.stop();\n                                  }\n                                }\n                              }, _callee3);\n                            }));\n\n                            return function (_x2) {\n                              return _ref7.apply(this, arguments);\n                            };\n                          }());\n\n                        case 2:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function (_x) {\n                  return _ref6.apply(this, arguments);\n                };\n              }());\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function getTransferLogs() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  function SwapText(_ref8) {\n    var children = _ref8.children,\n        rest = _objectWithoutProperties(_ref8, [\"children\"]);\n\n    return __jsx(Text, _extends({\n      fontSize: \"2xl\",\n      lineHeight: 1,\n      py: \"0.3rem\"\n    }, rest, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 7\n      }\n    }), children);\n  }\n\n  var _useState16 = useState(''),\n      acct = _useState16[0],\n      setAcct = _useState16[1];\n\n  useEffect(function () {\n    if (account && acct != account) {\n      setAcct(account);\n      setState({\n        loaded: false\n      });\n      getContractStates();\n    }\n  }, [account, acct]);\n\n  var _useState17 = useState(chainId),\n      chain = _useState17[0],\n      setChain = _useState17[1];\n\n  useEffect(function () {\n    if (chainId && chain != chainId) {\n      setChain(chainId);\n      setState({\n        loaded: false\n      });\n      getContractStates();\n    }\n  }, [chainId, chain]);\n  useEffect(function () {\n    account && chainId ? setState({\n      loaded: true\n    }) : null;\n  }, []);\n  return __jsx(Loader, {\n    loaded: state.loaded,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 5\n    }\n  }, loadingApi ? __jsx(Refreshing, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 21\n    }\n  }) : '', __jsx(Flex, {\n    w: \"100%\",\n    justify: \"center\",\n    mt: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }\n  }, __jsx(Stack, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }\n  }, true ? __jsx(React.Fragment, null, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"1rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  }, __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 17\n    }\n  }, \"I want to transfer \"), __jsx(Input, {\n    variant: \"flushed\",\n    fontSize: \"1xl\",\n    textAlign: \"center\" // universal input options\n    ,\n    inputMode: \"decimal\",\n    title: \"Token Amount\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\" // text-specific options\n    ,\n    type: \"text\",\n    placeholder: \"0\",\n    minLength: 1,\n    maxLength: 79,\n    isInvalid: isInvalid,\n    onChange: function onChange(e) {\n      var calculatedAmount = Number(parseUnits(e.target.value, decimals).toString());\n\n      if (calculatedAmount > Number(balance) || calculatedAmount > Number(allowance)) {\n        setIsInvalid(true);\n      } else {\n        setIsInvalid(false);\n      }\n\n      setSwapAmount(Number(calculatedAmount));\n    },\n    spellCheck: \"false\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 17\n    }\n  }), __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 19\n    }\n  }, \"$Coval\")), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"1rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 15\n    }\n  }, __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 17\n    }\n  }, __jsx(Flex, {\n    width: \"full\",\n    align: \"center\",\n    justifyContent: \"center\",\n    flexWrap: \"wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 19\n    }\n  }, __jsx(Text, {\n    \"float\": 'left',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 21\n    }\n  }, \"from \", chainId == 137 ? \"Matic\" : chainId == 100 ? \"xDai\" : chainId == 56 ? \"Binance Smart Chain\" : chainId == 250 ? \"Fantom\" : \"Ethereum\", \" to\"), __jsx(Image, {\n    \"float\": 'left',\n    margin: 2,\n    w: 3,\n    src: \"./next.png\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 21\n    }\n  }), __jsx(Select, {\n    w: \"45%\",\n    value: transferChain,\n    onChange: function onChange(e) {\n      setTransferChain(Number(e.target.value));\n      setTransferChainChanged(true);\n      console.log(Number(e.target.value));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 21\n    }\n  }, __jsx(\"option\", {\n    value: \"137\",\n    disabled: chainId === 137 ? true : false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 23\n    }\n  }, \"Polygon (Matic)\"), __jsx(\"option\", {\n    value: \"100\",\n    disabled: chainId === 100 ? true : false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 23\n    }\n  }, \"xDai\"), __jsx(\"option\", {\n    value: \"56\",\n    disabled: chainId === 56 ? true : false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 23\n    }\n  }, \"Binance Smart Chain\"), __jsx(\"option\", {\n    value: \"1\",\n    disabled: chainId === 1 ? true : false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 23\n    }\n  }, \"Ethereum Mainnet\"), __jsx(\"option\", {\n    value: \"250\",\n    disabled: chainId === 250 ? true : false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 23\n    }\n  }, \"Fantom\")))), swapAmount > 0 ? __jsx(Button, {\n    isDisabled: isInvalid,\n    onClick: transferToChain,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 19\n    }\n  }, isInvalid ? \"Invalid Transfer Amount\" : \"Transfer Now\") : null)) : null, allowance == 0 && balance > 0 && !approving ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 15\n    }\n  }, __jsx(Button, {\n    onClick: approveCovalFlow,\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  }, \"Approve Transfer\"))) : balance == 0 ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 15\n    }\n  }, \"You have no Coval to transfer\")) : !approving ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 15\n    }\n  }, \"Approved to transfer up to \", allowance * Math.pow(10, -decimals), \" Coval. Note: Swaps between networks can take up to 25 minutes.\")) : null, __jsx(Tabs, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 11\n    }\n  }, __jsx(TabList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 13\n    }\n  }, __jsx(Tab, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 17\n    }\n  }, CHAIN_ID_NAMES[chainId]), __jsx(Tab, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 17\n    }\n  }, CHAIN_ID_NAMES[transferChain])), __jsx(TabPanels, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 13\n    }\n  }, __jsx(TabPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 17\n    }\n  }, __jsx(BridgeDeposits, {\n    chainId: chainId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 19\n    }\n  })), __jsx(TabPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 17\n    }\n  }, transferChain && transferChainChanged ? __jsx(BridgeDeposits, {\n    chainId: transferChain,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 21\n    }\n  }) : null))))), hash ? __jsx(TransactionToast, {\n    hash: hash,\n    onComplete: function onComplete() {\n      if (transfering) {\n        setTransfering(false);\n        getTransferLogs();\n      } else {\n        setApproving(false);\n        getContractStates();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }\n  }) : null);\n}\n\n_s(SwapChain, \"GgjbSkSvOiuD4nY8aSFoT8JbodY=\", false, function () {\n  return [useRouter, useWeb3React, useContract, useContract];\n});\n\n_c = SwapChain;\n\nvar _c;\n\n$RefreshReg$(_c, \"SwapChain\");","map":{"version":3,"sources":["/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/SwapChain.tsx"],"names":["Box","Flex","Text","Image","Stack","Button","Input","Select","Tabs","Tab","TabList","TabPanels","TabPanel","Loader","Refreshing","useRouter","useWeb3React","useEffect","useState","CHAIN_ID_NAMES","useContract","EMBLEM_API","contractAddresses","TransactionToast","parseUnits","BridgeDeposits","SwapChain","query","account","chainId","loaded","state","setState","loadingApi","setLoadingApi","approving","setApproving","transfering","setTransfering","balance","setBalance","address","setAddress","experimental","setExperimental","decimals","setDecimals","allowance","setAllowance","transferChain","setTransferChain","covalApprovedFor","setIsCovalApproved","hash","setHash","swapAmount","setSwapAmount","isInvalid","setIsInvalid","transferChainChanged","setTransferChainChanged","handlerContract","vaultHandler","vaultHandlerAbi","covalContract","coval","covalAbi","transferToChain","toString","then","error","code","getContractStates","balanceOf","Number","approveCovalFlow","approve","Math","pow","getTransferLogs","console","log","fetch","method","headers","service","chainid","response","SwapText","children","rest","acct","setAcct","chain","setChain","e","calculatedAmount","target","value"],"mappings":"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","sourcesContent":["import { Box, Flex, Text, Link, Image, Stack, Button, BoxProps, Input, Select, Tabs, Tab, TabList, TabPanels, TabPanel } from '@chakra-ui/core'\nimport Loader from 'react-loader'\nimport Refreshing from './Refreshing'\nimport { useRouter } from 'next/router'\nimport { useWeb3React } from '@web3-react/core'\nimport { useEffect, useState } from 'react'\nimport { validImage, toContractValue, CHAIN_ID_NAMES } from '../utils'\nimport { useContract } from '../hooks'\nimport { Contract } from '@ethersproject/contracts'\nimport { EMBLEM_API, contractAddresses } from '../constants'\nimport { TransactionToast } from './TransactionToast'\nimport { parseUnits } from '@ethersproject/units'\nimport BridgeDeposits from './partials/BridgeDeposits'\n\nexport default function SwapChain() {\n  const { query } = useRouter()\n  const { account, chainId } = useWeb3React()\n  // const [vaults, setVaults] = useState([])\n  const [state, setState] = useState({ loaded: false })\n  const [loadingApi, setLoadingApi] = useState(false)\n  const [approving, setApproving] = useState(false)\n  const [transfering, setTransfering] = useState(false)\n  const [balance, setBalance] = useState(null)\n  const [address, setAddress] = useState(query.address)\n  const [experimental, setExperimental] = useState(query.experimental)\n  const [decimals, setDecimals] = useState(null)\n  const [allowance, setAllowance] = useState(null)\n  const [transferChain, setTransferChain] = useState(137)\n  const [covalApprovedFor, setIsCovalApproved] = useState(0)\n  const [hash, setHash] = useState(null)\n  const [swapAmount, setSwapAmount] = useState(0)\n  const [isInvalid, setIsInvalid] = useState(false)\n  const [transferChainChanged, setTransferChainChanged] = useState(true)\n  const handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true)\n  const covalContract = useContract(contractAddresses.coval[chainId], contractAddresses.covalAbi, true)\n\n\n  interface ErrorWithCode extends Error {\n    code?: number\n  }\n\n  const transferToChain = async () => {\n    setTransfering(true)\n    ;(handlerContract as Contract)\n    .transferToChain(transferChain, swapAmount.toString())\n    .then(({ hash }: { hash: string }) => {\n      setHash(hash)\n    })\n    .catch((error: ErrorWithCode) => {\n      if (error?.code == 4001) {\n        setTransfering(false)\n      }\n    })\n  }\n\n  const getContractStates = async () => {\n    setHash(null)\n    setDecimals(await covalContract.decimals())\n    setAllowance(\n      await covalContract\n        .allowance(account, contractAddresses.vaultHandler[chainId])\n        .then((balance: { toString: () => string }) => balance.toString())\n    )\n    setBalance(await covalContract.balanceOf(account).then((balance: { toString: () => string }) => balance.toString()))\n    if (Number(allowance) >= Number(0)) {      \n      setIsCovalApproved(allowance)\n    }\n    setState({ loaded: true })\n  }\n\n  const approveCovalFlow = () => {\n    setApproving(true)\n    ;(covalContract as Contract)\n      .approve(contractAddresses.vaultHandler[chainId], 10000000 * Math.pow(10, +decimals) )\n      .then(({ hash }: { hash: string }) => {\n        setHash(hash)\n      })\n      .catch((error: ErrorWithCode) => {\n        if (error?.code == 4001) {\n          setApproving(false)\n        }\n      })\n  }\n\n  const getTransferLogs = async () =>{\n    console.log(\"getting logs\")\n    fetch(EMBLEM_API + '/transfersOut', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        service: 'evmetadata',\n        chainid: chainId.toString()\n      }\n    }).then(async function (response) {\n      console.log(\"doing transfers\")\n      fetch(EMBLEM_API + '/doTransfers', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          service: 'evmetadata',\n          chainid: chainId.toString()\n        }\n      }).then(async function (response) {\n        getContractStates()\n      })\n    })\n  }\n\n  function SwapText({ children, ...rest }: BoxProps): JSX.Element {\n    return (\n      <Text fontSize=\"2xl\" lineHeight={1} py=\"0.3rem\" {...rest}>\n        {children}\n      </Text>\n    )\n  }\n\n  const [acct, setAcct] = useState('')\n  useEffect(() => {\n    if (account && acct != account) {\n      setAcct(account)\n      setState({ loaded: false })\n      getContractStates()\n    }\n  }, [account, acct])\n\n  const [chain, setChain] = useState(chainId)\n  useEffect(() => {\n    if (chainId && chain != chainId) {\n      setChain(chainId)\n      setState({ loaded: false })\n      getContractStates()\n    }\n  }, [chainId, chain])\n\n  useEffect(() => {\n    account && chainId ? setState({ loaded: true }) : null\n  }, [])\n\n  return (\n    <Loader loaded={state.loaded}>\n      {loadingApi ? <Refreshing /> : ''}\n\n      <Flex w=\"100%\" justify=\"center\" mt={10}>\n        <Stack align=\"center\">\n          {true ? (\n            <>\n              {/* <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n                <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"\" >\n                  Transfer up to {allowance > balance ? balance * Math.pow(10, -decimals) : allowance * Math.pow(10, -decimals) } Coval from {chainId == 137 ? \"Matic\" : \"Ethereum\"} Network to {chainId == 137 ? \"Etherum\" : \"Matic\"} Network\n                </Text>              \n              </Box>\n              {balance > allowance ? (                 \n                <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n                  <Button onClick={approveCovalFlow} type=\"submit\">\n                    Increase transfer allowance to { balance * Math.pow(10, -decimals) } Coval\n                  </Button>\n                </Box>\n              ) : null } */}\n              <Stack direction=\"row\" align=\"flex-start\" spacing=\"1rem\" flexWrap=\"wrap\" shouldWrapChildren>\n                <SwapText>I want to transfer </SwapText>\n                <Input variant=\"flushed\"\n                  fontSize=\"1xl\"\n                  textAlign=\"center\"\n                  // universal input options\n                  inputMode=\"decimal\"\n                  title=\"Token Amount\"\n                  autoComplete=\"off\"\n                  autoCorrect=\"off\"\n                  // text-specific options\n                  type=\"text\"\n                  placeholder=\"0\"\n                  minLength={1}\n                  maxLength={79}\n                  isInvalid={isInvalid}\n                  onChange={(e) => {\n                    let calculatedAmount = Number(parseUnits(e.target.value, decimals).toString())\n                    \n                    if (calculatedAmount > Number(balance) || calculatedAmount > Number(allowance)) {\n                      setIsInvalid(true)\n                    } else {                      \n                      setIsInvalid(false)\n                    }\n                    setSwapAmount(Number(calculatedAmount))\n                  }}\n                  spellCheck=\"false\"/>\n                  <SwapText>$Coval</SwapText>                  \n              </Stack>\n              <Stack direction=\"row\" align=\"flex-start\" spacing=\"1rem\" flexWrap=\"wrap\" shouldWrapChildren>\n                <SwapText>\n                  <Flex width=\"full\" align=\"center\" justifyContent=\"center\" flexWrap=\"wrap\">\n                    <Text  float={'left'}>\n                      from {\n                        chainId == 137 ? \"Matic\" : \n                        chainId == 100 ? \"xDai\" : \n                        chainId == 56 ? \"Binance Smart Chain\" : \n                        chainId == 250 ? \"Fantom\" : \n                        \"Ethereum\"\n                      } to\n                    </Text> \n                    <Image float={'left'} margin={2} w={3} src=\"./next.png\" />\n                    <Select w=\"45%\" value={transferChain}\n                      onChange={(e)=>{\n                        setTransferChain(Number(e.target.value))\n                        setTransferChainChanged(true)\n                        \n                        console.log(Number(e.target.value))\n                      }}\n                    >\n                      <option value=\"137\" disabled={chainId === 137 ? true : false} >Polygon (Matic)</option>\n                      <option value=\"100\" disabled={chainId === 100 ? true : false}>xDai</option>\n                      <option value=\"56\" disabled={chainId === 56 ? true : false}>Binance Smart Chain</option>\n                      <option value=\"1\" disabled={chainId === 1 ? true : false}>Ethereum Mainnet</option>\n                      <option value=\"250\" disabled={chainId === 250 ? true : false}>Fantom</option>\n                    </Select> \n                  </Flex>\n                </SwapText>\n                { swapAmount > 0 ? (\n                  <Button isDisabled={isInvalid} onClick={transferToChain}>\n                    { isInvalid ? \"Invalid Transfer Amount\" : \"Transfer Now\"}\n                  </Button>\n                ) : null }\n              </Stack>\n            </>    \n          ) : null }\n          {\n          allowance == 0 && balance > 0 && !approving ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                <Button onClick={approveCovalFlow} type=\"submit\">\n                  Approve Transfer{/* of up {balance * Math.pow(10, -decimals)} Coval*/}\n                </Button>\n              </Text>\n            </Box>\n          ) : balance == 0 ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                You have no Coval to transfer\n              </Text>\n            </Box>\n          ) : !approving ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                Approved to transfer up to {allowance * Math.pow(10, -decimals)} Coval. Note: Swaps between networks can take up to 25 minutes.\n              </Text>\n            </Box>\n          ) : null }\n          {/* { !approving && ((Number(balance) > Number(allowance)) || Number(allowance) * Math.pow(10, -decimals) < 1000000) ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n              <Button onClick={approveCovalFlow} type=\"submit\">\n                  Approve Transfer 1,000,000 Coval\n                </Button>\n              </Text>\n            </Box>\n          ) : null } */}\n          <Tabs>\n            <TabList>\n                <Tab>{CHAIN_ID_NAMES[chainId]}</Tab>\n                <Tab>{CHAIN_ID_NAMES[transferChain]}</Tab>\n            </TabList>\n            <TabPanels>\n                <TabPanel>\n                  <BridgeDeposits chainId={chainId}/>\n                </TabPanel>\n                <TabPanel>\n                  {transferChain && transferChainChanged? (\n                    <BridgeDeposits chainId={transferChain}/>\n                  ) : null}                  \n                </TabPanel>\n            </TabPanels>\n          </Tabs>\n          \n        </Stack>\n      </Flex>\n      {hash ? (\n        <TransactionToast\n          hash={hash}\n          onComplete={() => {\n              if (transfering) {\n                setTransfering(false)\n                getTransferLogs()\n              } else {                \n                setApproving(false)\n                getContractStates()\n              }              \n          }}\n        />\n      ) : null}\n    </Loader>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}