{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { Button, Flex } from '@chakra-ui/core';\nimport { Contract } from '@ethersproject/contracts';\nimport { useWeb3React } from '@web3-react/core';\n\nvar getContract = function getContract(address, abi, library, account) {\n  return new Contract(address, abi, library.getSigner(account).connectUnchecked());\n};\n\nexport default function Approval(props) {\n  var _useWeb3React = useWeb3React(),\n      account = _useWeb3React.account,\n      library = _useWeb3React.library;\n\n  var _useState = useState(false),\n      approved = _useState[0],\n      setApproved = _useState[1];\n\n  var _useState2 = useState(null),\n      decimals = _useState2[0],\n      setDecimals = _useState2[1];\n\n  var _useState3 = useState(null),\n      spendingContract = _useState3[0],\n      setSpendingContract = _useState3[1];\n\n  var _useState4 = useState(null),\n      handlerContract = _useState4[0],\n      setHandlerContract = _useState4[1];\n\n  useEffect(function () {\n    if (!handlerContract && props.handler) {\n      createHandlerContract(props.handler);\n    }\n  });\n  useEffect(function () {\n    if (!spendingContract && props.spending) {\n      createSpendingContract(props.spending);\n    }\n  });\n  useEffect(function () {\n    if (spendingContract) {\n      checkApproval(props.handler, props.spending, props.amount);\n    }\n  });\n  return account && !approved ? __jsx(Flex, {\n    w: \"100%\",\n    flexWrap: \"wrap\",\n    mt: 3\n  }, __jsx(Button, {\n    onClick: chooseApprovalFlow,\n    backgroundColor: \"#02b402\",\n    color: \"black !important\",\n    fontWeight: \"bold !important\",\n    width: \"100%\"\n  }, props.label)) : null;\n\n  function createSpendingContract(spending) {\n    var _contract = getContract(spending.address, spending.abi, library, account);\n\n    setSpendingContract(_contract);\n  }\n\n  function createHandlerContract(handler) {\n    var _contract = getContract(handler.address, handler.abi, library, account);\n\n    setHandlerContract(_contract);\n  }\n\n  function checkApproval(handler, spending, amount) {\n    if (amount > 0) {\n      // IS ERC20 Approval Check\n      spendingContract.decimals().then(function (decimals) {\n        setDecimals(decimals);\n        spendingContract.allowance(account, handler.address).then(function (allowance) {\n          setApproved(allowance >= amount * Math.pow(10, decimals));\n        });\n      });\n    } else {\n      // IS NFT Approval Check\n      spendingContract.isApprovedForAll(account, handler.address).then(function (approved) {\n        setApproved(approved);\n      });\n    }\n  }\n\n  function chooseApprovalFlow() {\n    if (props.amount > 0) {\n      return approveCovalFlow();\n    } else {\n      return approveNFTFlow();\n    }\n  }\n\n  function approveCovalFlow() {\n    spendingContract.approve(props.handler.address, 1000000 * Math.pow(10, decimals)).then(function (tx) {\n      props.watcher(tx.hash, function (receipt) {\n        if (receipt.status === 1) {\n          setApproved(true);\n        }\n      });\n    });\n  }\n\n  function approveNFTFlow() {\n    spendingContract.setApprovalForAll(props.handler.address, true).then(function (tx) {\n      props.watcher(tx.hash, function (receipt) {\n        if (receipt.status === 1) {\n          setApproved(true);\n        }\n      });\n    });\n  }\n} // export class Approval extends Component<AttributesProps> {\n//   render() {\n//     let handler = this.props.handler\n//     let spending = this.props.spending\n//     let amount = this.props.amount\n//     let label = this.props.label\n//     let library = this.props.library\n//     let account = this.props.account\n//     let approved = checkApproval(handler, spending, library, account, amount)\n//     return approved? (\n//       <></>\n//     ) : (\n//       <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n//         <Button backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n//           {label}\n//         </Button>\n//       </Flex>\n//     )\n//   }\n// }\n// export default Approval","map":null,"metadata":{},"sourceType":"module"}