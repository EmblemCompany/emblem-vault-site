{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { FormControl, FormLabel, FormHelperText, FormErrorMessage, Input, Stack, Tabs, TabList, TabPanels, Tab, TabPanel, Box, Flex, RadioGroup, Radio, Textarea, Button, ButtonGroup, Text, Divider, Alert, AlertIcon, Collapse, useDisclosure, Select } from '@chakra-ui/core';\nimport Loader from 'react-loader';\nimport { useWeb3React } from '@web3-react/core';\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { TransactionToast } from './TransactionToast';\nimport { EMBLEM_API, contractAddresses } from '../constants';\nimport { useContract } from '../hooks';\nimport { isETHAddress } from '../utils';\nimport Embed from './Embed'; // react-doka\n\nimport { DokaImageEditorModal } from 'react-doka';\nimport transakSDK from '@transak/transak-sdk'; // doka\n\nimport { // editor\nlocale_en_gb, createDefaultImageReader, createDefaultImageWriter // plugins\n, setPlugins, plugin_crop, plugin_crop_locale_en_gb, plugin_crop_defaults, plugin_finetune, plugin_finetune_locale_en_gb, plugin_finetune_defaults, plugin_filter, plugin_filter_locale_en_gb, plugin_filter_defaults, plugin_annotate, plugin_annotate_locale_en_gb, markup_editor_defaults, markup_editor_locale_en_gb } from 'doka';\nsetPlugins(plugin_crop, plugin_finetune, plugin_filter, plugin_annotate);\n\nvar editorDefaults = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({\n  imageReader: createDefaultImageReader(),\n  imageWriter: createDefaultImageWriter()\n}, plugin_crop_defaults), plugin_finetune_defaults), plugin_filter_defaults), markup_editor_defaults), {}, {\n  locale: _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, locale_en_gb), plugin_crop_locale_en_gb), plugin_finetune_locale_en_gb), plugin_filter_locale_en_gb), plugin_annotate_locale_en_gb), markup_editor_locale_en_gb)\n});\n\nvar tokenId,\n    cipherTextHash,\n    nonce,\n    signature = null;\nvar mintPassword = null;\nexport default function Create(props) {\n  // modal\n  var _useState = useState(false),\n      modalVisible = _useState[0],\n      setModalVisible = _useState[1];\n\n  var _useState2 = useState(''),\n      modalResult = _useState2[0],\n      setModalResult = _useState2[1];\n\n  var _useState3 = useState(true),\n      showEditorButton = _useState3[0],\n      setShowEditorButton = _useState3[1];\n\n  var _useDisclosure = useDisclosure(),\n      isOpen = _useDisclosure.isOpen,\n      onToggle = _useDisclosure.onToggle;\n\n  var _useRouter = useRouter(),\n      query = _useRouter.query;\n\n  var _useState4 = useState(0),\n      tabIndex = _useState4[0],\n      setTabIndex = _useState4[1];\n\n  var _useWeb3React = useWeb3React(),\n      account = _useWeb3React.account,\n      chainId = _useWeb3React.chainId;\n\n  var _useState5 = useState(account || ''),\n      vaultAddress = _useState5[0],\n      setVaultAddress = _useState5[1];\n\n  var _useState6 = useState('Public'),\n      vaultPubPriv = _useState6[0],\n      setVaultPubPriv = _useState6[1];\n\n  var _useState7 = useState(''),\n      vaultName = _useState7[0],\n      setVaultName = _useState7[1];\n\n  var _useState8 = useState(''),\n      vaultDesc = _useState8[0],\n      setVaultDesc = _useState8[1];\n\n  var _useState9 = useState(''),\n      vaultImage = _useState9[0],\n      setVaultImage = _useState9[1];\n\n  var _useState10 = useState(''),\n      ownedImage = _useState10[0],\n      setOwnedImage = _useState10[1];\n\n  var _useState11 = useState(''),\n      password = _useState11[0],\n      setPassword = _useState11[1]; // const [service, setService] = useState('')\n\n\n  var _useState12 = useState(false),\n      isCovalApproved = _useState12[0],\n      setIsCovalApproved = _useState12[1];\n\n  var _useState13 = useState({\n    loaded: true,\n    \"private\": false\n  }),\n      state = _useState13[0],\n      setState = _useState13[1];\n\n  var _useState14 = useState(null),\n      hash = _useState14[0],\n      setHash = _useState14[1]; // const [cipherTextHash, setCipherTextHash] = useState(null)\n  // const [tokenId, setTokenId] = useState(null)\n  // const [mintPassword, setMintPassword] = useState(null)\n  // const [nonce, setNonce] = useState(null)\n  // const [signature, setSignature] = useState(null)\n\n\n  var _useState15 = useState(true),\n      experimental = _useState15[0],\n      setExperimental = _useState15[1];\n\n  var _useState16 = useState(false),\n      showPreVaultMsg = _useState16[0],\n      setShowPreVaultMsg = _useState16[1];\n\n  var _useState17 = useState(false),\n      showMakingVaultMsg = _useState17[0],\n      setShowMakingVaultMsg = _useState17[1];\n\n  var _useState18 = useState(null),\n      decimals = _useState18[0],\n      setDecimals = _useState18[1];\n\n  var _useState19 = useState(null),\n      allowance = _useState19[0],\n      setAllowance = _useState19[1];\n\n  var _useState20 = useState(null),\n      balance = _useState20[0],\n      setBalance = _useState20[1];\n\n  var _useState21 = useState(null),\n      price = _useState21[0],\n      setPrice = _useState21[1];\n\n  var _useState22 = useState(false),\n      creating = _useState22[0],\n      setCreating = _useState22[1];\n\n  var _useState23 = useState(false),\n      approving = _useState23[0],\n      setApproving = _useState23[1];\n\n  var _useState24 = useState(''),\n      vaultKey = _useState24[0],\n      setVaultKey = _useState24[1];\n\n  var _useState25 = useState(''),\n      vaultValue = _useState25[0],\n      setVaultValue = _useState25[1];\n\n  var _useState26 = useState(\"image\"),\n      vaultType = _useState26[0],\n      setVaultType = _useState26[1];\n\n  var _useState27 = useState(false),\n      showEmbed = _useState27[0],\n      setShowEmbed = _useState27[1];\n\n  var handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true);\n  var covalContract = useContract(contractAddresses.coval[chainId], contractAddresses.covalAbi, true);\n  var transak;\n\n  var initializeTransak = function initializeTransak(address, coin) {\n    transak = new transakSDK({\n      apiKey: 'e8bed1bd-6844-4eb1-973a-7a11a48fafab',\n      // Your API Key\n      environment: 'PRODUCTION',\n      // STAGING/PRODUCTION\n      defaultCryptoCurrency: coin || 'ETH',\n      walletAddress: address || '',\n      // Your customer's wallet address\n      themeColor: '000000',\n      // App theme color\n      fiatCurrency: 'USD',\n      // INR/GBP\n      // fiatAmount: 350,\n      email: '',\n      // Your customer's email address\n      redirectURL: '',\n      // paymentMethod: 'neft_bank_transfer',\n      hostURL: window.location.origin,\n      widgetHeight: '550px',\n      widgetWidth: '450px'\n    }); // To get all the events\n\n    transak.on(transak.ALL_EVENTS, function (data) {\n      console.log(data);\n    }); // This will trigger when the user marks payment is made.\n\n    transak.on(transak.EVENTS.TRANSAK_ORDER_SUCCESSFUL, function (orderData) {\n      console.log(orderData);\n      transak.close();\n    });\n    transak.init();\n  };\n\n  var getContractStates = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = setDecimals;\n              _context.next = 3;\n              return covalContract.decimals();\n\n            case 3:\n              _context.t1 = _context.sent;\n              (0, _context.t0)(_context.t1);\n              _context.t2 = setAllowance;\n              _context.next = 8;\n              return covalContract.allowance(account, contractAddresses.vaultHandler[chainId]).then(function (balance) {\n                return balance.toString();\n              });\n\n            case 8:\n              _context.t3 = _context.sent;\n              (0, _context.t2)(_context.t3);\n              _context.t4 = setBalance;\n              _context.next = 13;\n              return covalContract.balanceOf(account).then(function (balance) {\n                return balance.toString();\n              });\n\n            case 13:\n              _context.t5 = _context.sent;\n              (0, _context.t4)(_context.t5);\n              _context.t6 = setPrice;\n              _context.next = 18;\n              return handlerContract.price().then(function (balance) {\n                return balance.toString();\n              });\n\n            case 18:\n              _context.t7 = _context.sent;\n              (0, _context.t6)(_context.t7);\n\n              // console.log(\n              //   'balance',\n              //   balance,\n              //   'allowance',\n              //   allowance,\n              //   'price',\n              //   price,\n              //   Number(allowance) >= Number(price),\n              //   Number(balance) > Number(price)\n              // )\n              if (Number(allowance) >= Number(price)) {\n                setIsCovalApproved(true);\n              } else {\n                setIsCovalApproved(false);\n              }\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getContractStates() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fireMetaMask = function fireMetaMask() {\n    setCreating(true); // console.log(vaultAddress, tokenId, cipherTextHash, nonce, signature)\n\n    if (chainId === 137 || chainId === 1) {\n      ;\n      handlerContract.buyWithSignature(vaultAddress, tokenId, cipherTextHash, nonce, signature).then(function (_ref2) {\n        var hash = _ref2.hash;\n        setTimeout(function () {\n          setHash(hash); // setCreating(false)\n\n          setShowMakingVaultMsg(true);\n        }, 100); // Solving State race condition where transaction watcher wouldn't notice we were creating\n      })[\"catch\"](function (error) {\n        if ((error === null || error === void 0 ? void 0 : error.code) !== 4001) {\n          console.log(\"tx failed.\", error);\n        } else {\n          setCreating(false);\n          setShowPreVaultMsg(false);\n        }\n      });\n    } else {\n      ;\n      handlerContract.buyWithPaymentOnly(vaultAddress, tokenId, mintPassword).then(function (_ref3) {\n        var hash = _ref3.hash;\n        setTimeout(function () {\n          setHash(hash); // setCreating(false)\n\n          setShowMakingVaultMsg(true);\n        }, 100); // Solving State race condition where transaction watcher wouldn't notice we were creating\n      })[\"catch\"](function (error) {\n        if ((error === null || error === void 0 ? void 0 : error.code) !== 4001) {\n          console.log(\"tx failed.\", error);\n        } else {\n          setCreating(false);\n          setShowPreVaultMsg(false);\n        }\n      });\n    }\n  };\n\n  var approveCovalFlow = function approveCovalFlow() {\n    setApproving(true);\n    covalContract.approve(contractAddresses.vaultHandler[chainId], '100000000000000').then(function (_ref4) {\n      var hash = _ref4.hash;\n      setHash(hash);\n    })[\"catch\"](function (error) {\n      if ((error === null || error === void 0 ? void 0 : error.code) == 4001) {\n        setApproving(false);\n      }\n    });\n  };\n\n  var handleSubmit = function handleSubmit(evt) {\n    evt.preventDefault(); // if (service !== 'kms') {\n    //   return alert('incorrect password')\n    // }\n\n    setState({\n      loaded: false,\n      \"private\": state[\"private\"]\n    });\n    var body = {\n      fromAddress: account,\n      toAddress: vaultAddress,\n      description: vaultDesc,\n      name: vaultName,\n      ownedImage: ownedImage,\n      image: vaultImage,\n      chainId: chainId,\n      \"private\": state[\"private\"],\n      password: password || '',\n      values: []\n    };\n\n    if (vaultKey && vaultValue) {\n      body.values.push({\n        \"key\": vaultKey,\n        value: vaultValue\n      });\n    }\n\n    console.log(JSON.stringify(body));\n    var apiSuffix = '/mint3'; //(chainId == 137 || chainId == 1) ? '/mint3' : '/mint'\n\n    fetch(EMBLEM_API + apiSuffix, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        service: 'evmetadata'\n      },\n      // We convert the React state to JSON and send it as the POST body\n      body: JSON.stringify(body)\n    }).then( /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response) {\n        var body;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                setState({\n                  loaded: true,\n                  \"private\": state[\"private\"]\n                });\n                _context2.next = 3;\n                return response.json();\n\n              case 3:\n                body = _context2.sent;\n                tokenId = body.data.tokenId; // console.log(body.data.nonce, body.data.signature, body.data.cipherTextHash)\n\n                if (chainId === 137 || chainId == 1) {\n                  nonce = body.data.nonce;\n                  signature = body.data.signature;\n                  cipherTextHash = body.data.cipherTextHash;\n                  fireMetaMask();\n                  setShowPreVaultMsg(false);\n                } else {\n                  mintPassword = body.password;\n                  setHash(body.data.tx);\n                  setShowPreVaultMsg(true);\n                }\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n  };\n\n  function previewFile() {\n    var preview = document.querySelector('#preview');\n    var inputelement = document.querySelector('input[type=file]'); //.files[0];\n\n    var reader = new FileReader();\n\n    if (inputelement.files[0].size > 5000000) {\n      delete inputelement.files;\n      return alert('File too large');\n    } else {// alert('under')\n    }\n\n    reader.addEventListener('load', function () {\n      var _reader$result;\n\n      // convert image file to base64 string\n      if (preview) preview.src = ((_reader$result = reader.result) === null || _reader$result === void 0 ? void 0 : _reader$result.toString()) || '';\n      if (preview) setVaultImage(preview.src);\n      setShowEditorButton(true);\n      setModalResult('');\n    }, false);\n\n    if (inputelement.files) {\n      reader.readAsDataURL(inputelement.files[0]);\n    }\n  }\n\n  var _useState28 = useState(''),\n      acct = _useState28[0],\n      setAcct = _useState28[1];\n\n  useEffect(function () {\n    if (account && acct != account) {\n      setAcct(account);\n      setVaultAddress(account);\n    }\n  }, [account, acct]);\n  useEffect(function () {\n    account && chainId ? getContractStates() : null;\n  });\n  return __jsx(Loader, {\n    loaded: state.loaded\n  }, __jsx(Flex, {\n    width: \"full\",\n    align: \"center\",\n    justifyContent: \"center\"\n  }, __jsx(Box, {\n    maxW: \"sm\",\n    borderWidth: \"1px\",\n    rounded: \"lg\",\n    overflow: \"hidden\"\n  }, __jsx(Tabs, {\n    defaultIndex: 0,\n    index: tabIndex,\n    onChange: function onChange(index) {\n      return setTabIndex(index);\n    }\n  }, __jsx(TabList, null, __jsx(Tab, null, \"Make\"), __jsx(Tab, null, \"My\"), __jsx(Tab, null, \"Vault\")), __jsx(TabPanels, null, __jsx(TabPanel, null, __jsx(Stack, {\n    direction: \"column\",\n    align: \"center\",\n    spacing: \"2rem\",\n    flexGrow: 1,\n    justifyContent: \"center\",\n    px: \"2rem\",\n    py: \"2rem\",\n    shouldWrapChildren: true\n  }, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, {\n    isRequired: true,\n    isInvalid: vaultAddress && !isETHAddress(vaultAddress)\n  }, __jsx(FormLabel, {\n    htmlFor: \"owner-address\"\n  }, \"Vault Owner Address\"), __jsx(Input, {\n    type: \"text\",\n    id: \"owner-address\",\n    \"aria-describedby\": \"owner-helper-text\",\n    placeholder: \"0xdeadbeef\",\n    maxLength: 42,\n    value: vaultAddress,\n    onChange: function onChange(e) {\n      return setVaultAddress(e.target.value);\n    }\n  }), __jsx(FormHelperText, {\n    id: \"owner-helper-text\"\n  }, \"What is the address of the first owner of this vault? Pro tip: When you connect a web3 wallet, this will populate automagically with your address.\"), __jsx(FormErrorMessage, null, \"Address is not a valid ETH address\"))), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, {\n    as: \"fieldset\",\n    isRequired: true\n  }, __jsx(FormLabel, null, \"Public or Private?\"), __jsx(RadioGroup, {\n    id: \"pubpriv\",\n    defaultValue: \"Public\",\n    onChange: function onChange(e) {\n      setVaultPubPriv(e.target.value);\n      setState({\n        loaded: state.loaded,\n        \"private\": e.target.value === 'Private'\n      });\n    }\n  }, __jsx(Radio, {\n    value: \"Public\"\n  }, \"Public\"), __jsx(Radio, {\n    value: \"Private\"\n  }, \"Private\")), __jsx(FormHelperText, {\n    id: \"email-helper-text\"\n  }, \"Do you want the contents and addresses to be password protected?\")), state[\"private\"] ? __jsx(FormControl, {\n    isRequired: true\n  }, __jsx(FormLabel, null, \"Password\"), __jsx(Input, {\n    type: \"password\",\n    id: \"vault-password\",\n    onChange: function onChange(e) {\n      return setPassword(e.target.value);\n    },\n    \"aria-describedby\": \"password-helper-text\",\n    autoComplete: \"off\"\n  }), __jsx(FormHelperText, {\n    id: \"password-helper-text\"\n  }, \"Used to encrypt/decrypt\")) : ''), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(Button, {\n    onClick: function onClick() {\n      return setTabIndex(1);\n    }\n  }, \"Next\")))), __jsx(TabPanel, null, __jsx(Stack, {\n    direction: \"column\",\n    align: \"center\",\n    spacing: \"2rem\",\n    flexGrow: 1,\n    justifyContent: \"center\",\n    px: \"2rem\",\n    py: \"2rem\",\n    shouldWrapChildren: true\n  }, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, {\n    isRequired: true,\n    isInvalid: vaultName && vaultName.length < 3 && vaultName.length > 200\n  }, __jsx(FormLabel, {\n    htmlFor: \"vault-name\"\n  }, \"Vault Name\"), __jsx(Input, {\n    type: \"text\",\n    id: \"vault-name\",\n    \"aria-describedby\": \"vault-name-text\",\n    minLength: 3,\n    maxLength: 200,\n    value: vaultName,\n    onChange: function onChange(e) {\n      return setVaultName(e.target.value);\n    },\n    autoComplete: \"off\"\n  }), __jsx(FormHelperText, {\n    id: \"vault-name-text\"\n  }, \"Give it some love so you can find it later.\"), __jsx(FormErrorMessage, null, \"Name needs at least 3 characters. 200 is max.\"))), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, {\n    isRequired: true,\n    isInvalid: vaultDesc && vaultDesc.length < 3 && vaultDesc.length > 1024\n  }, __jsx(FormLabel, {\n    htmlFor: \"vault-desc\"\n  }, \"Vault Description\"), __jsx(Textarea, {\n    id: \"vault-desc\",\n    size: \"lg\",\n    \"aria-describedby\": \"vault-desc-text\",\n    minLength: 3,\n    maxLength: 1024,\n    value: vaultDesc,\n    onChange: function onChange(e) {\n      return setVaultDesc(e.target.value);\n    },\n    autoComplete: \"off\"\n  }), __jsx(FormHelperText, {\n    id: \"vault-desc-text\"\n  }, \"Add some fluffy text to tell people what the point is!\"), __jsx(FormErrorMessage, null, \"Description needs to be at least 3 characters. 1024 is max.\"))), __jsx(Button, {\n    onClick: onToggle\n  }, \"Include Encrypted Text In Vault\"), __jsx(Collapse, {\n    isOpen: isOpen\n  }, experimental ? __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, null, __jsx(FormLabel, {\n    htmlFor: \"vault-key\"\n  }, \"Key\"), __jsx(Input, {\n    type: \"text\",\n    id: \"vault-key\",\n    \"aria-describedby\": \"vault-key-text\",\n    maxLength: 200,\n    value: vaultKey,\n    onChange: function onChange(e) {\n      return setVaultKey(e.target.value);\n    },\n    autoComplete: \"off\"\n  }), __jsx(FormHelperText, {\n    id: \"vault-key-text\"\n  }, \"Key Name (Public)\"), __jsx(FormErrorMessage, null, \"---Some Error\")), __jsx(FormControl, null, __jsx(FormLabel, {\n    htmlFor: \"vault-value\"\n  }, \"Value\"), __jsx(Input, {\n    type: \"password\",\n    id: \"vault-value\",\n    \"aria-describedby\": \"vault-value-text\",\n    maxLength: 200,\n    value: vaultValue,\n    onChange: function onChange(e) {\n      return setVaultValue(e.target.value);\n    },\n    autoComplete: \"off\"\n  }), __jsx(FormHelperText, {\n    id: \"vault-value-text\"\n  }, \"Key Value (Encrypted)\"), __jsx(FormErrorMessage, null, \"---Some Error\"))) : null), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(ButtonGroup, {\n    spacing: 4\n  }, __jsx(Button, {\n    onClick: function onClick() {\n      return setTabIndex(0);\n    }\n  }, \"Back\"), __jsx(Button, {\n    onClick: function onClick() {\n      return setTabIndex(2);\n    }\n  }, \"Next\"))))), __jsx(TabPanel, null, __jsx(Stack, {\n    direction: \"column\",\n    align: \"center\",\n    spacing: \"2rem\",\n    flexGrow: 1,\n    justifyContent: \"center\",\n    px: \"2rem\",\n    py: \"2rem\",\n    shouldWrapChildren: true\n  }, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(FormControl, null, __jsx(Box, {\n    p: 1,\n    rounded: \"lg\",\n    overflow: \"hidden\"\n  }, __jsx(Stack, {\n    align: \"center\",\n    p: 1\n  }, vaultType !== \"upload\" ? __jsx(React.Fragment, null, __jsx(FormLabel, {\n    htmlFor: \"vault-image-url\"\n  }, \"Embed Display URL\"), __jsx(Input, {\n    type: \"text\",\n    id: \"vault-image-url\",\n    \"aria-describedby\": \"vault-image-url-text\",\n    minLength: 3,\n    maxLength: 200,\n    value: vaultImage,\n    defaultValue: \"http://\",\n    onChange: function onChange(e) {\n      setVaultImage(e.target.value);\n      setShowEmbed(true);\n      console.log(\"showEmbed\", showEmbed);\n    },\n    autoComplete: \"off\",\n    w: 300\n  }), __jsx(\"hr\", null), __jsx(FormLabel, {\n    mt: 3,\n    htmlFor: \"owned-url\"\n  }, \"Optional URL For Vault Owner *\"), __jsx(Input, {\n    type: \"text\",\n    id: \"owned-url\",\n    \"aria-describedby\": \"owned-url-text\",\n    minLength: 3,\n    maxLength: 200,\n    value: ownedImage,\n    defaultValue: \"http://\",\n    onChange: function onChange(e) {\n      setOwnedImage(e.target.value);\n    },\n    autoComplete: \"off\",\n    w: 300\n  })) : __jsx(React.Fragment, null, __jsx(FormLabel, {\n    htmlFor: \"vault-img\"\n  }, \"Vault Image\"), __jsx(\"input\", {\n    type: \"file\",\n    onChange: function onChange() {\n      return previewFile();\n    }\n  }), __jsx(Divider, null)), __jsx(Divider, null), __jsx(FormLabel, {\n    htmlFor: \"type-selector\"\n  }, \"Display Type\"), __jsx(Select, {\n    id: \"type-selector\",\n    w: \"45%\",\n    value: vaultType,\n    onChange: function onChange(e) {\n      setVaultType(e.target.value);\n      console.log(\"type\", vaultType);\n    }\n  }, __jsx(\"option\", {\n    value: \"embed\"\n  }, \"Embed (url)\"), __jsx(\"option\", {\n    value: \"upload\"\n  }, \"Image (upload)\")), vaultType == \"upload\" ? __jsx(React.Fragment, null, __jsx(\"img\", {\n    id: \"preview\",\n    src: modalResult,\n    width: \"250\",\n    \"margin-top\": \"6\"\n  }), modalVisible && __jsx(DokaImageEditorModal, _extends({}, editorDefaults, {\n    className: \"doka\",\n    src: vaultImage,\n    onLoad: function onLoad(res) {\n      return console.log('load modal image', res);\n    },\n    onHide: function onHide() {\n      return setModalVisible(false);\n    },\n    onProcess: function onProcess(_ref6) {\n      var dest = _ref6.dest;\n      var reader = new FileReader();\n      reader.readAsDataURL(dest);\n\n      reader.onloadend = function () {\n        var _reader$result2;\n\n        var base64data = (_reader$result2 = reader.result) === null || _reader$result2 === void 0 ? void 0 : _reader$result2.toString();\n        setVaultImage(base64data);\n        setModalResult(URL.createObjectURL(dest));\n        setShowEditorButton(false);\n      };\n    }\n  })), showEditorButton && vaultImage ? __jsx(Button, {\n    mt: 2,\n    onClick: function onClick() {\n      return setModalVisible(true);\n    }\n  }, \"Edit Image\") : null) : showEmbed == true ? __jsx(React.Fragment, null, __jsx(Embed, {\n    url: vaultImage\n  })) : null)))), isCovalApproved ? __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(Box, {\n    maxW: \"sm\",\n    borderWidth: \"1px\",\n    p: 1,\n    rounded: \"lg\",\n    overflow: \"hidden\"\n  }, __jsx(Text, null, \"Creating a vault spends \", price * Math.pow(10, -decimals), \" Coval from your wallet\"))) : null, Number(balance) < Number(price) ? __jsx(Box, {\n    d: \"flex\",\n    alignItems: \"baseline\",\n    justifyContent: \"space-between\",\n    mt: \"2\"\n  }, __jsx(Button, {\n    width: \"100%\" // as=\"a\"\n    // {...{\n    //   href:\n    //     location.origin +\n    //     '/buy?chain=' +\n    //     chainId +\n    //     '&output=0x3D658390460295FB963f54dC0899cfb1c30776Df&input=0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    //   target: '_blank',\n    //   rel: 'noopener noreferrer',\n    // }}\n    ,\n    onClick: function onClick() {\n      initializeTransak(vaultAddress, 'COVAL');\n    }\n  }, \"Buy $Coval\")) : null, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"0rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(ButtonGroup, {\n    spacing: 4\n  }, __jsx(Button, {\n    onClick: function onClick() {\n      return setTabIndex(1);\n    }\n  }, \"Back\"), !account ? __jsx(Button, {\n    isDisabled: true,\n    type: \"submit\"\n  }, \"No Wallet Connected!\") : !vaultAddress || !isETHAddress(vaultAddress) || !vaultName || vaultName.length < 3 || !vaultDesc || vaultDesc.length < 3 || !vaultImage ? __jsx(Button, {\n    isDisabled: true,\n    type: \"submit\"\n  }, \"Check Fields!\") // ) : !service ? (\n  //   <Button isDisabled type=\"submit\">\n  //     Creation Password?\n  //   </Button>\n  : !isCovalApproved && !approving ? __jsx(Button, {\n    onClick: approveCovalFlow,\n    type: \"submit\"\n  }, \"Approve Coval\") : !isCovalApproved && approving ? __jsx(Button, {\n    isDisabled: true,\n    type: \"submit\"\n  }, \"Approving ...\") : Number(balance) < Number(price) ? __jsx(Button, {\n    isDisabled: true,\n    type: \"submit\"\n  }, \"Insufficient Balance\") : hash || creating || showPreVaultMsg || showMakingVaultMsg ? __jsx(Button, {\n    isDisabled: true,\n    type: \"submit\"\n  }, \"Making Vault ...\") : __jsx(Button, {\n    onClick: handleSubmit,\n    type: \"submit\"\n  }, \"DO IT!\")))), showPreVaultMsg ? __jsx(Alert, {\n    status: \"info\"\n  }, __jsx(AlertIcon, null), \"Talking to contract ...\") : null, showMakingVaultMsg ? __jsx(Alert, {\n    status: \"info\"\n  }, __jsx(AlertIcon, null), \"Making vault ... one moment\") : null, approving ? __jsx(Alert, {\n    status: \"info\"\n  }, __jsx(AlertIcon, null), \"Handling approval flow ...\") : null))))), hash ? __jsx(TransactionToast, {\n    hash: hash,\n    onComplete: function onComplete() {\n      setHash(null);\n\n      if (!creating) {\n        if (!approving) {\n          fireMetaMask();\n          setShowPreVaultMsg(false);\n        } else {\n          setApproving(false);\n        }\n      } else {\n        setTimeout(function () {\n          setShowMakingVaultMsg(false);\n          location.href = location.origin + '/nft?id=' + tokenId;\n        }, 500);\n      }\n    }\n  }) : null);\n}","map":null,"metadata":{},"sourceType":"module"}