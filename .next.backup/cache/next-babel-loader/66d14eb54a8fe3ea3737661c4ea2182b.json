{"ast":null,"code":"import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _toArray from\"@babel/runtime/helpers/esm/toArray\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";import _wrapNativeSuper from\"@babel/runtime/helpers/esm/wrapNativeSuper\";import _toConsumableArray from\"@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _DirectionRectMap,_DirectionInversionTa,_DirectionCoordinateT;function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*!\n * Doka Image Editor 7.8.0\n * (c) 2018-2021 PQINA Inc. - All Rights Reserved\n * License: https://pqina.nl/doka/license/\n */ /* eslint-disable */var backup='__doka_webapi__';var getNativeAPIRef=function getNativeAPIRef(API){return window[backup]?window[backup][API]:window[API];};var createProgressEvent=function createProgressEvent(loaded){var lengthComputable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;// assigning 0 to 1 somehow doesn't work\nvar type='progress';var data={loaded:loaded*100,total:100,lengthComputable:lengthComputable};try{return new(getNativeAPIRef('ProgressEvent'))(type,data);}catch(err){// IE11\nreturn _objectSpread({type:type},data);}};var noop=function noop(){};var FileReaderDataFormat={ArrayBuffer:'readAsArrayBuffer'};var readFile=function readFile(file){var onprogress=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(resolve,reject){var _options$dataFormat=options.dataFormat,dataFormat=_options$dataFormat===void 0?FileReaderDataFormat.ArrayBuffer:_options$dataFormat;var reader=new(getNativeAPIRef('FileReader'))();reader.onload=function(){return resolve(reader.result);};reader.onerror=reject;reader.onprogress=onprogress;reader[dataFormat](file);});};var readExifOrientation=function readExifOrientation(view,offset){// Missing 0x45786966 Marker? No Exif Header, stop here\nif(view.getUint32(offset+=2,false)!==0x45786966)return-1;// First 2bytes defines byte align of TIFF data.\n// If it is 0x4949=\"I I\", it means \"Intel\" type byte align\nvar intelByteAligned=view.getUint16(offset+=6,false)===0x4949;offset+=view.getUint32(offset+4,intelByteAligned);var tags=view.getUint16(offset,intelByteAligned);offset+=2;// find Orientation tag\nfor(var i=0;i<tags;i++){if(view.getUint16(offset+i*12,intelByteAligned)===0x0112)return view.getUint16(offset+i*12+8,intelByteAligned);}};var readData=function readData(data){var view=new DataView(data);// Every JPEG file starts from binary value '0xFFD8', so if it's not present, exit here\nif(view.getUint16(0,false)!=0xffd8)return null;var length=view.byteLength;var offset=2;var marker;while(offset<length){if(view.getUint16(offset+2,false)<=8)return-1;marker=view.getUint16(offset,false);offset+=2;// Exif Marker found\nif(marker===0xffe1)return readExifOrientation(view,offset);// Invalid marker, exit here\nelse if((marker&0xff00)!==0xff00)return null;// Next!\nelse offset+=view.getUint16(offset,false);}};var getImageOrientationFromFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){var onprogress,result,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:onprogress=_args.length>1&&_args[1]!==undefined?_args[1]:noop;onprogress(createProgressEvent(0));_context.next=4;return readFile(file.slice(0,256*1024));case 4:result=_context.sent;return _context.abrupt(\"return\",readData(result)||1);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getImageOrientationFromFile(_x){return _ref.apply(this,arguments);};}();var result=null;var isBrowser=function isBrowser(){if(result===null)result=true&&typeof window.document!=='undefined';return result;};var result$1=null;var canOrientImages=function canOrientImages(){return new Promise(function(resolve){if(result$1===null){// 2x1 pixel image 90CW rotated with orientation EXIF header\nvar testSrc='data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';var testImage=isBrowser()?new Image():{};testImage.onload=function(){// should correct orientation if is presented in landscape,\n// in which case the browser doesn't autocorrect\nresult$1=testImage.naturalWidth===1;testImage=undefined;resolve(result$1);};testImage.src=testSrc;return;}return resolve(result$1);});};var canvasToImageData=function canvasToImageData(canvas){var imageData=canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);return imageData;};var h=function h(name,attributes){var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var el=document.createElement(name);// @ts-ignore\nvar descriptors=Object.getOwnPropertyDescriptors(el.__proto__);for(var key in attributes){if(key==='style'){el.style.cssText=attributes[key];}else if(descriptors[key]&&descriptors[key].set||/textContent|innerHTML/.test(key)||typeof attributes[key]==='function'){el[key]=attributes[key];}else{el.setAttribute(key,attributes[key]);}}children.forEach(function(child){return el.appendChild(child);});return el;};var MATRICES={1:function _(){return[1,0,0,1,0,0];},2:function _(width){return[-1,0,0,1,width,0];},3:function _(width,height){return[-1,0,0,-1,width,height];},4:function _(width,height){return[1,0,0,-1,0,height];},5:function _(){return[0,1,1,0,0,0];},6:function _(width,height){return[0,1,-1,0,height,0];},7:function _(width,height){return[0,-1,-1,0,height,width];},8:function _(width){return[0,-1,1,0,0,width];}};var getImageOrientationMatrix=function getImageOrientationMatrix(width,height){var orientation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;if(orientation===-1)orientation=1;return MATRICES[orientation](width,height);};var releaseCanvas=function releaseCanvas(canvas){canvas.width=1;canvas.height=1;var ctx=canvas.getContext('2d');ctx&&ctx.clearRect(0,0,1,1);};var isImageData=function isImageData(obj){return'data'in obj;};var imageDataToCanvas=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(imageData){var orientation,_ref3,_ref4,width,height,canvas,ctx,inMemoryCanvas,_ctx,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:orientation=_args2.length>1&&_args2[1]!==undefined?_args2[1]:1;_context2.next=3;return canOrientImages();case 3:_context2.t0=_context2.sent;if(_context2.t0){_context2.next=6;break;}_context2.t0=orientation<5;case 6:if(!_context2.t0){_context2.next=10;break;}_context2.t1=[imageData.width,imageData.height];_context2.next=11;break;case 10:_context2.t1=[imageData.height,imageData.width];case 11:_ref3=_context2.t1;_ref4=_slicedToArray(_ref3,2);width=_ref4[0];height=_ref4[1];canvas=h('canvas',{width:width,height:height});ctx=canvas.getContext('2d');// transform image data ojects into in memory canvas elements so we can transform them (putImageData isn't affect by transforms)\n_context2.t3=isImageData(imageData);if(!_context2.t3){_context2.next=22;break;}_context2.next=21;return canOrientImages();case 21:_context2.t3=!_context2.sent;case 22:_context2.t2=_context2.t3;if(!_context2.t2){_context2.next=25;break;}_context2.t2=orientation>1;case 25:if(!_context2.t2){_context2.next=30;break;}inMemoryCanvas=h('canvas',imageData);_ctx=inMemoryCanvas.getContext('2d');_ctx.putImageData(imageData,0,0);imageData=inMemoryCanvas;case 30:_context2.next=32;return canOrientImages();case 32:_context2.t4=!_context2.sent;if(!_context2.t4){_context2.next=35;break;}_context2.t4=orientation>1;case 35:if(!_context2.t4){_context2.next=37;break;}ctx.transform.apply(ctx,getImageOrientationMatrix(imageData.width,imageData.height,orientation));case 37:// can't test for instanceof ImageBitmap as Safari doesn't support it\n// if still imageData object by this point, we'll use put\nif(isImageData(imageData)){ctx.putImageData(imageData,0,0);}else{ctx.drawImage(imageData,0,0);}// if image data is of type canvas, clean it up\nif(imageData instanceof HTMLCanvasElement)releaseCanvas(imageData);return _context2.abrupt(\"return\",canvas);case 40:case\"end\":return _context2.stop();}}},_callee2);}));return function imageDataToCanvas(_x2){return _ref2.apply(this,arguments);};}();var orientImageData=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(imageData){var orientation,_args3=arguments;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:orientation=_args3.length>1&&_args3[1]!==undefined?_args3[1]:1;if(!(orientation===1)){_context3.next=3;break;}return _context3.abrupt(\"return\",imageData);case 3:_context3.next=5;return canOrientImages();case 5:if(_context3.sent){_context3.next=11;break;}_context3.t0=canvasToImageData;_context3.next=9;return imageDataToCanvas(imageData,orientation);case 9:_context3.t1=_context3.sent;return _context3.abrupt(\"return\",(0,_context3.t0)(_context3.t1));case 11:return _context3.abrupt(\"return\",imageData);case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function orientImageData(_x3){return _ref5.apply(this,arguments);};}();var imageToCanvas=function imageToCanvas(image,canvasMemoryLimit){// if these are 0 it's possible that we're trying to convert an SVG that doesn't have width or height attributes\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1328124\nvar canvasWidth=image.naturalWidth;var canvasHeight=image.naturalHeight;// determine if requires more memory than limit, if so limit target size\nvar requiredCanvasMemory=canvasWidth*canvasHeight;if(canvasMemoryLimit&&requiredCanvasMemory>canvasMemoryLimit){var canvasScalar=Math.sqrt(canvasMemoryLimit)/Math.sqrt(requiredCanvasMemory);canvasWidth=Math.floor(canvasWidth*canvasScalar);canvasHeight=Math.floor(canvasHeight*canvasScalar);}// create new canvas element\nvar canvas=h('canvas');canvas.width=canvasWidth;canvas.height=canvasHeight;var ctx=canvas.getContext('2d');ctx.drawImage(image,0,0,canvasWidth,canvasHeight);return canvas;};// turns image into canvas only after it's fully loaded\nvar imageToCanvasSafe=function imageToCanvasSafe(image,canvasMemoryLimit){return new Promise(function(resolve,reject){var ready=function ready(){return resolve(imageToCanvas(image,canvasMemoryLimit));};if(image.complete&&image.width){// need to test for image.width, on ie11 it will be 0 for object urls\nready();}else{image.onload=ready;image.onerror=reject;}});};var blobToCanvas=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(imageBlob,canvasMemoryLimit){var imageElement,canvas;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:imageElement=h('img',{src:URL.createObjectURL(imageBlob)});_context4.next=3;return imageToCanvasSafe(imageElement,canvasMemoryLimit);case 3:canvas=_context4.sent;URL.revokeObjectURL(imageElement.src);return _context4.abrupt(\"return\",canvas);case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function blobToCanvas(_x4,_x5){return _ref6.apply(this,arguments);};}();var canCreateImageBitmap=function canCreateImageBitmap(){return'createImageBitmap'in window;};var canCreateOffscreenCanvas=function canCreateOffscreenCanvas(){return'OffscreenCanvas'in window;};var isSVGFile=function isSVGFile(blob){return /svg/.test(blob.type);};var getUniqueId=function getUniqueId(){return Math.random().toString(36).substr(2,9);};var functionToBlob=function functionToBlob(fn){return new Blob(['(',typeof fn==='function'?fn.toString():fn,')()'],{type:'application/javascript'});};var wrapFunction=function wrapFunction(fn){return\"function () {self.onmessage = function (message) {(\".concat(fn.toString(),\").apply(null, message.data.content.concat([function (err, response) {\\n    response = response || {};\\n    const transfer = 'data' in response ? [response.data.buffer] : 'width' in response ? [response] : [];\\n    return self.postMessage({ id: message.data.id, content: response, error: err }, transfer);\\n}]))}}\");};var workerPool=new Map();var thread=function thread(fn,args,transferList){return new Promise(function(resolve,reject){var workerKey=fn.toString();var pooledWorker=workerPool.get(workerKey);if(!pooledWorker){// create worker for this function\nvar workerFn=wrapFunction(fn);// create a new web worker\nvar url=URL.createObjectURL(functionToBlob(workerFn));var messages=new Map();var worker=new Worker(url);// create a pooled worker, this object will contain the worker and active messages\npooledWorker={url:url,worker:worker,messages:messages,terminate:function terminate(){pooledWorker.worker.terminate();URL.revokeObjectURL(url);}};// handle received messages\nworker.onmessage=function(e){// should receive message id and message\nvar _e$data=e.data,id=_e$data.id,content=_e$data.content,error=_e$data.error;// message route no longer valid\nif(!messages.has(id))return;// get related thread and resolve with returned content\nvar message=messages.get(id);// remove thread from threads cache\nmessages[\"delete\"](id);// resolve or reject message based on response from worker\nerror!=null?message.reject(error):message.resolve(content);};// pool this worker\nworkerPool.set(workerKey,pooledWorker);}// we need a way to remember this message so we generate a unique id and use that as a key for this request, that way we can link the response back to request in the pooledWorker.onmessage handler\nvar messageId=getUniqueId();pooledWorker.messages.set(messageId,{resolve:resolve,reject:reject});// use pooled worker and await response\npooledWorker.worker.postMessage({id:messageId,content:args},transferList);});};var blobToImageData=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(imageBlob,canvasMemoryLimit){var imageData,canvas;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(canCreateImageBitmap()&&!isSVGFile(imageBlob)&&canCreateOffscreenCanvas())){_context5.next=9;break;}_context5.prev=1;_context5.next=4;return thread(function(file,canvasMemoryLimit,done){createImageBitmap(file).then(function(bitmap){var canvasWidth=bitmap.width;var canvasHeight=bitmap.height;// determine if requires more memory than limit, if so limit target size\n// determine if requires more memory than limit, if so limit target size\nvar requiredCanvasMemory=canvasWidth*canvasHeight;if(canvasMemoryLimit&&requiredCanvasMemory>canvasMemoryLimit){var canvasScalar=Math.sqrt(canvasMemoryLimit)/Math.sqrt(requiredCanvasMemory);canvasWidth=Math.floor(canvasWidth*canvasScalar);canvasHeight=Math.floor(canvasHeight*canvasScalar);}var canvas=new OffscreenCanvas(canvasWidth,canvasHeight);var ctx=canvas.getContext('2d');ctx.drawImage(bitmap,0,0);var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);done(null,imageData);})[\"catch\"](function(err){// fail silently\ndone(err);});},[imageBlob,canvasMemoryLimit]);case 4:imageData=_context5.sent;_context5.next=9;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](1);case 9:if(!(!imageData||!imageData.width)){_context5.next=15;break;}_context5.next=12;return blobToCanvas(imageBlob,canvasMemoryLimit);case 12:canvas=_context5.sent;imageData=canvasToImageData(canvas);releaseCanvas(canvas);case 15:return _context5.abrupt(\"return\",imageData);case 16:case\"end\":return _context5.stop();}}},_callee5,null,[[1,7]]);}));return function blobToImageData(_x6,_x7){return _ref7.apply(this,arguments);};}();var canvasToBlob=function canvasToBlob(canvas){var mimeType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;var quality=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;return new Promise(function(resolve,reject){try{canvas.toBlob(function(blob){resolve(blob);},mimeType,quality);}catch(err){reject(err);}});};var imageDataToBlob=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(imageData,mimeType,quality){var canvas,blob;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return imageDataToCanvas(imageData);case 3:canvas=_context6.sent;_context6.next=6;return canvasToBlob(canvas,mimeType,quality);case 6:blob=_context6.sent;releaseCanvas(canvas);return _context6.abrupt(\"return\",blob);case 11:_context6.prev=11;_context6.t0=_context6[\"catch\"](0);throw _context6.t0;case 14:case\"end\":return _context6.stop();}}},_callee6,null,[[0,11]]);}));return function imageDataToBlob(_x8,_x9,_x10){return _ref8.apply(this,arguments);};}();var blobReadSection=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(blob){var slice,onprogress,_args7=arguments;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:slice=_args7.length>1&&_args7[1]!==undefined?_args7[1]:[0,blob.size];onprogress=_args7.length>2?_args7[2]:undefined;_context7.next=4;return readFile(blob.slice.apply(blob,_toConsumableArray(slice)),onprogress);case 4:return _context7.abrupt(\"return\",_context7.sent);case 5:case\"end\":return _context7.stop();}}},_callee7);}));return function blobReadSection(_x11){return _ref9.apply(this,arguments);};}();var blobWriteSection=function blobWriteSection(blob,section){var slice=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[0,blob.size];if(!section)return blob;return new Blob([section,blob.slice.apply(blob,_toConsumableArray(slice))],{type:blob.type});};var getExtensionFromMimeType=function getExtensionFromMimeType(mimeType){return mimeType.match(/\\/([a-z]+)/)[1];};var getFilenameWithoutExtension=function getFilenameWithoutExtension(name){return name.substr(0,name.lastIndexOf('.'))||name;};var getExtensionFromFilename=function getExtensionFromFilename(filename){return filename.split('.').pop();};var ImageExtensionsRegex=/avif|bmp|gif|jpg|jpeg|jpe|jif|jfif|png|svg|tiff|webp/;/*\nSupport image mime types\n- image/webp\n- image/gif\n- image/avif\n- image/jpeg\n- image/png\n- image/bmp\n- image/svg+xml\n*/var getMimeTypeFromExtension=function getMimeTypeFromExtension(ext){// empty string returned if extension not found\nif(!ImageExtensionsRegex.test(ext))return'';// return MimeType for this extension\nreturn'image/'+(/jfif|jif|jpe|jpg/.test(ext)?'jpeg':ext==='svg'?'svg+xml':ext);};var getMimeTypeFromFilename=function getMimeTypeFromFilename(name){return name&&getMimeTypeFromExtension(getExtensionFromFilename(name).toLowerCase());};var matchFilenameToMimeType=function matchFilenameToMimeType(filename,mimeType){// get the mime type that matches this extension\nvar fileMimeType=getMimeTypeFromFilename(filename);// test if type already matches current mime type, no need to change name\nif(fileMimeType===mimeType)return filename;// get the extension for this mimetype (gets all characters after the \"image/\" part)\nvar targetMimeTypeExtension=getExtensionFromMimeType(mimeType);return\"\".concat(getFilenameWithoutExtension(filename),\".\").concat(targetMimeTypeExtension);};var blobToFile=function blobToFile(blob,filename,mimetype){var lastModified=new Date().getTime();var blobHasMimeType=blob.type.length&&blob.type!=='null';var blobMimeType=blobHasMimeType?blob.type:mimetype;var name=matchFilenameToMimeType(filename,blobMimeType);try{return new(getNativeAPIRef('File'))([blob],name,{lastModified:lastModified,type:blobHasMimeType?blob.type:blobMimeType});}catch(err){var file=blobHasMimeType?blob.slice():blob.slice(0,blob.size,blobMimeType);file.lastModified=lastModified;file.name=name;return file;}};var getAspectRatio=function getAspectRatio(w,h){return w/h;};var passthrough=function passthrough(v){return v;};var PI=Math.PI;var HALF_PI=Math.PI/2;var QUART_PI=HALF_PI/2;var isRotatedSideways=function isRotatedSideways(a){var rotationLimited=Math.abs(a)%Math.PI;return rotationLimited>QUART_PI&&rotationLimited<Math.PI-QUART_PI;};//\n// generic\n//\nvar scale=function scale(value,scalar,pivot){return pivot+(value-pivot)*scalar;};var ellipseCreateFromRect=function ellipseCreateFromRect(rect){return{x:rect.x+rect.width*0.5,y:rect.y+rect.height*0.5,rx:rect.width*0.5,ry:rect.height*0.5};};//\n// vector\n//\nvar vectorCreateEmpty=function vectorCreateEmpty(){return vectorCreate(0,0);};var vectorCreate=function vectorCreate(x,y){return{x:x,y:y};};var vectorCreateFromSize=function vectorCreateFromSize(size){return vectorCreate(size.width,size.height);};var vectorCreateFromPointerEvent=function vectorCreateFromPointerEvent(e){return vectorCreate(e.pageX,e.pageY);};var vectorCreateFromPointerEventOffset=function vectorCreateFromPointerEventOffset(e){return vectorCreate(e.offsetX,e.offsetY);};var vectorClone=function vectorClone(v){return vectorCreate(v.x,v.y);};var vectorInvert=function vectorInvert(v){v.x=-v.x;v.y=-v.y;return v;};var vectorPerpendicular=function vectorPerpendicular(v){var x=v.x;v.x=-v.y;v.y=x;return v;};var vectorRotate=function vectorRotate(v,radians){var pivot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();var cos=Math.cos(radians);var sin=Math.sin(radians);var tx=v.x-pivot.x;var ty=v.y-pivot.y;v.x=pivot.x+cos*tx-sin*ty;v.y=pivot.y+sin*tx+cos*ty;return v;};var vectorLength=function vectorLength(v){return Math.sqrt(v.x*v.x+v.y*v.y);};var vectorNormalize=function vectorNormalize(v){var length=Math.sqrt(v.x*v.x+v.y*v.y);if(length===0)return vectorCreateEmpty();v.x/=length;v.y/=length;return v;};var vectorAngle=function vectorAngle(v){return Math.atan2(v.y,v.x);};var vectorAngleBetween=function vectorAngleBetween(a,b){return Math.atan2(b.y-a.y,b.x-a.x);};var vectorEqual=function vectorEqual(a,b){return a.x===b.x&&a.y===b.y;};var vectorApply=function vectorApply(v,fn){v.x=fn(v.x);v.y=fn(v.y);return v;};var vectorAdd=function vectorAdd(a,b){a.x+=b.x;a.y+=b.y;return a;};var vectorSubtract=function vectorSubtract(a,b){a.x-=b.x;a.y-=b.y;return a;};var vectorMultiply=function vectorMultiply(v,f){v.x*=f;v.y*=f;return v;};var vectorDot=function vectorDot(a,b){return a.x*b.x+a.y*b.y;};var vectorDistanceSquared=function vectorDistanceSquared(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:vectorCreateEmpty();var x=a.x-b.x;var y=a.y-b.y;return x*x+y*y;};var vectorDistance=function vectorDistance(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:vectorCreateEmpty();return Math.sqrt(vectorDistanceSquared(a,b));};var vectorCenter=function vectorCenter(v){var x=0;var y=0;v.forEach(function(v){x+=v.x;y+=v.y;});return vectorCreate(x/v.length,y/v.length);};var vectorsFlip=function vectorsFlip(points,flipX,flipY,cx,cy){points.forEach(function(point){point.x=flipX?cx-(point.x-cx):point.x;point.y=flipY?cy-(point.y-cy):point.y;});return points;};var vectorsRotate=function vectorsRotate(points,angle,cx,cy){var s=Math.sin(angle);var c=Math.cos(angle);points.forEach(function(p){p.x-=cx;p.y-=cy;var rx=p.x*c-p.y*s;var ry=p.x*s+p.y*c;p.x=cx+rx;p.y=cy+ry;});return points;};//\n// size\n//\nvar toSize=function toSize(width,height){return{width:width,height:height};};var sizeClone=function sizeClone(size){return toSize(size.width,size.height);};var sizeCreateFromAny=function sizeCreateFromAny(obj){return toSize(obj.width,obj.height);};var sizeCreateFromRect=function sizeCreateFromRect(r){return toSize(r.width,r.height);};var sizeCreateFromArray=function sizeCreateFromArray(a){return toSize(a[0],a[1]);};var sizeCreate=function sizeCreate(width,height){return toSize(width,height);};var sizeEqual=function sizeEqual(a,b){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:passthrough;return format(a.width)===format(b.width)&&format(a.height)===format(b.height);};var sizeScale=function sizeScale(size,scalar){size.width*=scalar;size.height*=scalar;return size;};var sizeCenter=function sizeCenter(size){return vectorCreate(size.width*0.5,size.height*0.5);};var sizeRotate=function sizeRotate(size,radians){var cos=Math.cos(radians);var sin=Math.sin(radians);var w=cos*size.width+sin*size.height;var h=sin*size.width+cos*size.height;size.width=w;size.height=h;return size;};var sizeTurn=function sizeTurn(size,radians){var w=size.width;var h=size.height;if(isRotatedSideways(radians)){size.width=h;size.height=w;}return size;};var sizeContains=function sizeContains(a,b){return a.width>=b.width&&a.height>=b.height;};var sizeApply=function sizeApply(size,fn){size.width=fn(size.width);size.height=fn(size.height);return size;};var sizeHypotenuse=function sizeHypotenuse(size){return Math.sqrt(size.width*size.width+size.height*size.height);};var sizeMin=function sizeMin(a,b){return sizeCreate(Math.min(a.width,b.width),Math.min(a.height,b.height));};//\n// line\n//\nvar lineCreate=function lineCreate(start,end){return{start:start,end:end};};var lineClone=function lineClone(line){return lineCreate(vectorClone(line.start),vectorClone(line.end));};var lineExtend=function lineExtend(line,amount){var v=vectorCreate(line.start.x-line.end.x,line.start.y-line.end.y);var vn=vectorNormalize(v);var vm=vectorMultiply(vn,amount);line.start.x+=vm.x;line.start.y+=vm.y;line.end.x-=vm.x;line.end.y-=vm.y;return line;};var lineMultiply=function lineMultiply(line,amount){var v=vectorCreate(line.start.x-line.end.x,line.start.y-line.end.y);var vn=vectorNormalize(v);var vm=vectorMultiply(vn,amount);line.end.x+=vm.x;line.end.y+=vm.y;return line;};//\n// rect\n//\nvar CornerSigns=[vectorCreate(-1,-1),vectorCreate(-1,1),vectorCreate(1,1),vectorCreate(1,-1)];var toRect=function toRect(x,y,width,height){return{x:x,y:y,width:width,height:height};};var rectClone=function rectClone(rect){return toRect(rect.x,rect.y,rect.width,rect.height);};var rectCreateEmpty=function rectCreateEmpty(){return toRect(0,0,0,0);};var rectCreateFromDimensions=function rectCreateFromDimensions(width,height){return toRect(0,0,width,height);};var rectCreateFromSize=function rectCreateFromSize(size){return toRect(0,0,size.width,size.height);};var rectCreateFromAny=function rectCreateFromAny(obj){return toRect(obj.x||0,obj.y||0,obj.width||0,obj.height||0);};var rectCreateFromPoints=function rectCreateFromPoints(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var pts=Array.isArray(args[0])?args[0]:args;var xMin=pts[0].x;var xMax=pts[0].x;var yMin=pts[0].y;var yMax=pts[0].y;pts.forEach(function(point){xMin=Math.min(xMin,point.x);xMax=Math.max(xMax,point.x);yMin=Math.min(yMin,point.y);yMax=Math.max(yMax,point.y);});return toRect(xMin,yMin,xMax-xMin,yMax-yMin);};var rectCreateFromEllipse=function rectCreateFromEllipse(ellipse){return rectCreate(ellipse.x-ellipse.rx,ellipse.y-ellipse.ry,ellipse.rx*2,ellipse.ry*2);};var rectCreateWithCenter=function rectCreateWithCenter(center,size){return toRect(center.x-size.width*0.5,center.y-size.height*0.5,size.width,size.height);};var rectCreate=function rectCreate(x,y,width,height){return toRect(x,y,width,height);};var rectCenter=function rectCenter(rect){return vectorCreate(rect.x+rect.width*0.5,rect.y+rect.height*0.5);};var rectTranslate=function rectTranslate(rect,t){rect.x+=t.x;rect.y+=t.y;return rect;};var rectScale=function rectScale(rect,scalar,pivot){pivot=pivot||rectCenter(rect);rect.x=scalar*(rect.x-pivot.x)+pivot.x;rect.y=scalar*(rect.y-pivot.y)+pivot.y;rect.width=scalar*rect.width;rect.height=scalar*rect.height;return rect;};var rectMultiply=function rectMultiply(rect,factor){rect.x*=factor;rect.y*=factor;rect.width*=factor;rect.height*=factor;return rect;};var rectDivide=function rectDivide(rect,factor){rect.x/=factor;rect.y/=factor;rect.width/=factor;rect.height/=factor;return rect;};var rectSubtract=function rectSubtract(a,b){a.x-=b.x;a.y-=b.y;a.width-=b.width;a.height-=b.height;return a;};var rectAdd=function rectAdd(a,b){a.x+=b.x;a.y+=b.y;a.width+=b.width;a.height+=b.height;return a;};var rectEqual=function rectEqual(a,b){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:passthrough;return format(a.x)===format(b.x)&&format(a.y)===format(b.y)&&format(a.width)===format(b.width)&&format(a.height)===format(b.height);};var rectAspectRatio=function rectAspectRatio(rect){return getAspectRatio(rect.width,rect.height);};var rectUpdate=function rectUpdate(rect,x,y,width,height){rect.x=x;rect.y=y;rect.width=width;rect.height=height;return rect;};var rectUpdateWithRect=function rectUpdateWithRect(a,b){a.x=b.x;a.y=b.y;a.width=b.width;a.height=b.height;return a;};var rectRotate=function rectRotate(rect,radians,pivot){if(!pivot)pivot=rectCenter(rect);return rectGetCorners(rect).map(function(vertex){return vectorRotate(vertex,radians,pivot);});};var rectCenterRect=function rectCenterRect(a,b){return toRect(a.width*0.5-b.width*0.5,a.height*0.5-b.height*0.5,b.width,b.height);};var rectContainsPoint=function rectContainsPoint(rect,point){if(point.x<rect.x)return false;if(point.y<rect.y)return false;if(point.x>rect.x+rect.width)return false;if(point.y>rect.y+rect.height)return false;return true;};var rectCoverRect=function rectCoverRect(rect,aspectRatio){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();if(rect.width===0||rect.height===0)return rectCreateEmpty();var inputAspectRatio=rectAspectRatio(rect);if(!aspectRatio)aspectRatio=inputAspectRatio;var width=rect.width;var height=rect.height;if(aspectRatio>inputAspectRatio){// height remains the same, width is expanded\nwidth=height*aspectRatio;}else{// width remains the same, height is expanded\nheight=width/aspectRatio;}return toRect(offset.x+(rect.width-width)*0.5,offset.y+(rect.height-height)*0.5,width,height);};var rectContainRect=function rectContainRect(rect){var aspectRatio=arguments.length>1&&arguments[1]!==undefined?arguments[1]:rectAspectRatio(rect);var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();if(rect.width===0||rect.height===0)return rectCreateEmpty();var width=rect.width;var height=width/aspectRatio;if(height>rect.height){height=rect.height;width=height*aspectRatio;}return toRect(offset.x+(rect.width-width)*0.5,offset.y+(rect.height-height)*0.5,width,height);};var rectToBounds=function rectToBounds(rect){return[Math.min(rect.y,rect.y+rect.height),Math.max(rect.x,rect.x+rect.width),Math.max(rect.y,rect.y+rect.height),Math.min(rect.x,rect.x+rect.width)];};var rectGetCorners=function rectGetCorners(rect){return[vectorCreate(rect.x,rect.y),vectorCreate(rect.x+rect.width,rect.y),vectorCreate(rect.x+rect.width,rect.y+rect.height),vectorCreate(rect.x,rect.y+rect.height)];};var rectApply=function rectApply(rect,fn){if(!rect)return;rect.x=fn(rect.x);rect.y=fn(rect.y);rect.width=fn(rect.width);rect.height=fn(rect.height);return rect;};var rectApplyPerspective=function rectApplyPerspective(rect,perspective){var pivot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:rectCenter(rect);return rectGetCorners(rect).map(function(corner,index){var sign=CornerSigns[index];return vectorCreate(scale(corner.x,1.0+sign.x*perspective.x,pivot.x),scale(corner.y,1.0+sign.y*perspective.y,pivot.y));});};var rectNormalizeOffset=function rectNormalizeOffset(rect){rect.x=0;rect.y=0;return rect;};// https://stackoverflow.com/questions/9692448/how-can-you-find-the-centroid-of-a-concave-irregular-polygon-in-javascript\nvar quadCentroid=function quadCentroid(points){var pts=points.map(vectorClone);var first=pts[0];var last=pts[pts.length-1];if(first.x!=last.x||first.y!=last.y){pts.push(first);}var twicearea=0;var x=0;var y=0;var nPts=pts.length;var p1;var p2;var f;for(var i=0,j=nPts-1;i<nPts;j=i++){p1=pts[i];p2=pts[j];f=(p1.y-first.y)*(p2.x-first.x)-(p2.y-first.y)*(p1.x-first.x);twicearea+=f;x+=(p1.x+p2.x-2*first.x)*f;y+=(p1.y+p2.y-2*first.y)*f;}f=twicearea*3;return vectorCreate(x/f+first.x,y/f+first.y);};var lineLineIntersection=function lineLineIntersection(a,b){return _lineLineIntersection(a.start,a.end,b.start,b.end);};var _lineLineIntersection=function _lineLineIntersection(a,b,c,d){var uA=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));var uB=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(uA>=0&&uA<=1&&uB>=0&&uB<=1){return vectorCreate(a.x+uA*(b.x-a.x),a.y+uA*(b.y-a.y));}return undefined;};var linePointsIntersection=function linePointsIntersection(line,points){var vertices=[].concat(_toConsumableArray(points),[points[0]]);var l=vertices.length;var intersections=[];for(var i=0;i<l-1;i++){var intersection=_lineLineIntersection(line.start,line.end,vectorCreate(vertices[i].x,vertices[i].y),vectorCreate(vertices[i+1].x,vertices[i+1].y));if(!intersection)continue;intersections.push(intersection);}return intersections.length?intersections:undefined;};// First translate the polygon so that `point` is the origin. Then, for each\n// edge, get the angle between two vectors: 1) the edge vector and 2) the\n// vector of the first vertex of the edge. If all of the angles are the same\n// sign (which is negative since they will be counter-clockwise) then the\n// point is inside the polygon; otherwise, the point is outside.\nvar polyPointIntersectionConvex=function polyPointIntersectionConvex(point,vertices){var i,a,b,ax,ay,bx,by,edgex,edgey,x;var l=vertices.length;for(i=0;i<l;i++){a=vertices[i];b=vertices[i+1>l-1?0:i+1];ax=a.x-point.x;ay=a.y-point.y;bx=b.x-point.x;by=b.y-point.y;edgex=ax-bx;edgey=ay-by;x=edgex*ay-edgey*ax;// 0 is ON the edge, but we check for -0.00001 to fix floating point errors\nif(x<-0.00001)return false;}return true;};var quadLines=function quadLines(vertices){var arr=[];for(var i=0;i<vertices.length;i++){var next=i+1;if(next===vertices.length)next=0;arr.push(lineCreate(vectorClone(vertices[i]),vectorClone(vertices[next])));}return arr;};var getImageTransformedRect=function getImageTransformedRect(imageSize,imageRotation){var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedVertices=rectRotate(imageRect,imageRotation,imageCenter);return rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices));};var isElement=function isElement(v,name){return v instanceof HTMLElement&&(name?new RegExp(\"^\".concat(name,\"$\"),'i').test(v.nodeName):true);};var isFile=function isFile(v){return v instanceof File;};var isString=function isString(v){return typeof v==='string';};var canvasToFile=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(canvas,mimeType,quality){var blob;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return canvasToBlob(canvas,mimeType,quality);case 2:blob=_context8.sent;return _context8.abrupt(\"return\",blobToFile(blob,'canvas'));case 4:case\"end\":return _context8.stop();}}},_callee8);}));return function canvasToFile(_x12,_x13,_x14){return _ref10.apply(this,arguments);};}();var getFilenameFromURL=function getFilenameFromURL(url){return url.split('/').pop().split(/\\?|\\#/).shift();};var isSafari=null;var isSafari$1=function isSafari$1(){if(isSafari===null)isSafari=isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return isSafari;};var getImageElementSize=function getImageElementSize(imageElement){return new Promise(function(resolve,reject){var shouldAutoRemove=false;// test if image is attached to DOM, if not attached, attach so measurement is correct on Safari\nif(!imageElement.parentNode&&isSafari$1()){shouldAutoRemove=true;// has width 0 and height 0 to prevent rendering very big SVGs (without width and height) that will for one frame overflow the window and show a scrollbar\nimageElement.style.cssText=\"position:absolute;visibility:hidden;pointer-events:none;left:0;top:0;width:0;height:0;\";document.body.appendChild(imageElement);}// start testing size\nvar measure=function measure(){var width=imageElement.naturalWidth;var height=imageElement.naturalHeight;var hasSize=width&&height;if(!hasSize)return;// clean up image if was attached for measuring\nif(shouldAutoRemove)imageElement.parentNode.removeChild(imageElement);clearInterval(intervalId);resolve({width:width,height:height});};imageElement.onerror=function(err){clearInterval(intervalId);reject(err);};var intervalId=setInterval(measure,1);measure();});};var getImageSize=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(image){var imageElement,size;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:// the image element we'll use to load the image\nimageElement=image;// if is not an image element, it must be a valid image source\nif(!imageElement.src){imageElement=new Image();imageElement.src=isString(image)?image:URL.createObjectURL(image);}_context9.prev=2;_context9.next=5;return getImageElementSize(imageElement);case 5:size=_context9.sent;_context9.next=11;break;case 8:_context9.prev=8;_context9.t0=_context9[\"catch\"](2);throw _context9.t0;case 11:_context9.prev=11;isFile(image)&&URL.revokeObjectURL(imageElement.src);return _context9.finish(11);case 14:return _context9.abrupt(\"return\",size);case 15:case\"end\":return _context9.stop();}}},_callee9,null,[[2,8,11,14]]);}));return function getImageSize(_x15){return _ref11.apply(this,arguments);};}();var awaitComplete=function awaitComplete(image){return new Promise(function(resolve,reject){if(image.complete)return resolve(image);image.onload=function(){return resolve(image);};image.onerror=reject;});};var imageToFile=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(imageElement){var size,image,canvas,ctx,blob;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.prev=0;_context10.next=3;return getImageSize(imageElement);case 3:size=_context10.sent;_context10.next=6;return awaitComplete(imageElement);case 6:image=_context10.sent;canvas=document.createElement('canvas');canvas.width=size.width;canvas.height=size.height;ctx=canvas.getContext('2d');ctx.drawImage(image,0,0);_context10.next=14;return canvasToBlob(canvas);case 14:blob=_context10.sent;return _context10.abrupt(\"return\",blobToFile(blob,getFilenameFromURL(image.src)));case 18:_context10.prev=18;_context10.t0=_context10[\"catch\"](0);throw _context10.t0;case 21:case\"end\":return _context10.stop();}}},_callee10,null,[[0,18]]);}));return function imageToFile(_x16){return _ref12.apply(this,arguments);};}();var isDataURI=function isDataURI(str){return /^data:/.test(str);};var isUserAgent=function isUserAgent(test){return isBrowser()?RegExp(test).test(window.navigator.userAgent):undefined;};var result$2=null;var isInternetExplorer=function isInternetExplorer(){if(result$2===null)result$2=isUserAgent(/MSIE|Trident/);return result$2;};// IE11 does not support getting blobs with fetch, so we use this fallback method\nvar dataURIToBlob=function dataURIToBlob(dataURI){var parts=dataURI.split(',');var type=parts[0].substr(4);var byteString=atob(parts[1]);var l=byteString.length;var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<l;i++){ia[i]=byteString.charCodeAt(i);}return new Blob([ab],{type:type});};var dataURIToFile=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(dataURI){var filename,onprogress,blob,res,file,_args11=arguments;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:filename=_args11.length>1&&_args11[1]!==undefined?_args11[1]:'data-uri';onprogress=_args11.length>2&&_args11[2]!==undefined?_args11[2]:noop;// basic loader, no size info\nonprogress(createProgressEvent(0));if(!isInternetExplorer()){_context11.next=8;break;}blob=dataURIToBlob(dataURI);onprogress(createProgressEvent(0.5));_context11.next=16;break;case 8:_context11.next=10;return fetch(dataURI);case 10:res=_context11.sent;onprogress(createProgressEvent(0.33));_context11.next=14;return res.blob();case 14:blob=_context11.sent;onprogress(createProgressEvent(0.66));case 16:file=blobToFile(blob,filename);onprogress(createProgressEvent(1));return _context11.abrupt(\"return\",file);case 19:case\"end\":return _context11.stop();}}},_callee11);}));return function dataURIToFile(_x17){return _ref13.apply(this,arguments);};}();var getResponseHeader=function getResponseHeader(xhr,header){var parse=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(header){return header;};return xhr.getAllResponseHeaders().indexOf(header)>=0?parse(xhr.getResponseHeader(header)):undefined;};var getFilenameFromContentDisposition=function getFilenameFromContentDisposition(header){if(!header)return null;var matches=header.split(/filename=|filename\\*=.+''/).splice(1).map(function(name){return name.trim().replace(/^[\"']|[;\"']{0,2}$/g,'');}).filter(function(name){return name.length;});return matches.length?decodeURI(matches[matches.length-1]):null;};var DokaErrorCode={URL_REQUEST:'URL_REQUEST',DOCTYPE_MISSING:'DOCTYPE_MISSING'};var DokaError=/*#__PURE__*/function(_Error){_inherits(DokaError,_Error);var _super=_createSuper(DokaError);function DokaError(message,code,metadata){var _this;_classCallCheck(this,DokaError);_this=_super.call(this,message);_this.name='DokaError';_this.code=code;_this.metadata=metadata;return _this;}return DokaError;}(/*#__PURE__*/_wrapNativeSuper(Error));var fetchFile=function fetchFile(url,onprogress){return new Promise(function(resolve,reject){var handleError=function handleError(){return reject(new DokaError('Error fetching image',DokaErrorCode.URL_REQUEST,xhr));};var xhr=new XMLHttpRequest();xhr.onprogress=onprogress;xhr.onerror=handleError,xhr.onload=function(){if(!xhr.response||xhr.status>=300||xhr.status<200)return handleError();// we store the response mime type so we can add it to the blob later on, if it's missing (happens on Safari 10)\nvar mimetype=getResponseHeader(xhr,'Content-Type');// try to get filename and any file instructions as well\nvar filename=getResponseHeader(xhr,'Content-Disposition',getFilenameFromContentDisposition)||getFilenameFromURL(url);// convert to actual file if possible\nresolve(blobToFile(xhr.response,filename,mimetype||getMimeTypeFromFilename(filename)));};xhr.open('GET',url);xhr.responseType='blob';xhr.send();});};var urlToFile=function urlToFile(url,onprogress){// use fetch to create blob from data uri\nif(isDataURI(url))return dataURIToFile(url,undefined,onprogress);// load file from url\nreturn fetchFile(url,onprogress);};var isBlob=function isBlob(v){return v instanceof Blob&&!(v instanceof File);};var srcToFile=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(src,onprogress){return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:if(!(isFile(src)||isBlob(src))){_context12.next=4;break;}return _context12.abrupt(\"return\",src);case 4:if(!isString(src)){_context12.next=10;break;}_context12.next=7;return urlToFile(src,onprogress);case 7:return _context12.abrupt(\"return\",_context12.sent);case 10:if(!isElement(src,'canvas')){_context12.next=16;break;}_context12.next=13;return canvasToFile(src);case 13:return _context12.abrupt(\"return\",_context12.sent);case 16:if(!isElement(src,'img')){_context12.next=22;break;}_context12.next=19;return imageToFile(src);case 19:return _context12.abrupt(\"return\",_context12.sent);case 22:throw new DokaError('Invalid image source','invalid-image-source');case 23:case\"end\":return _context12.stop();}}},_callee12);}));return function srcToFile(_x18,_x19){return _ref14.apply(this,arguments);};}();var orientImageSize=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(size){var orientation,_args13=arguments;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:orientation=_args13.length>1&&_args13[1]!==undefined?_args13[1]:1;_context13.next=3;return canOrientImages();case 3:if(!_context13.sent){_context13.next=5;break;}return _context13.abrupt(\"return\",size);case 5:if(!(orientation<5)){_context13.next=7;break;}return _context13.abrupt(\"return\",size);case 7:return _context13.abrupt(\"return\",sizeCreate(size.height,size.width));case 8:case\"end\":return _context13.stop();}}},_callee13);}));return function orientImageSize(_x20){return _ref15.apply(this,arguments);};}();var arrayBufferReadImageHead=function arrayBufferReadImageHead(data){var view=new DataView(data);// Every JPEG file starts from binary value '0xFFD8', so if it's not present, exit here\nif(view.getUint16(0)!==0xffd8)return null;var offset=2;// Start at 2 as we skipped two bytes (FFD8)\nvar marker;var markerLength;while(offset<view.byteLength){marker=view.getUint16(offset,false);markerLength=view.getUint16(offset+2,false)+2;// Test if is APP and COM markers\nvar isData=marker>=0xffe0&&marker<=0xffef||marker===0xfffe;if(!isData)break;if(offset+markerLength>view.byteLength)break;offset+=markerLength;}return data.slice(0,offset);};var readExifOrientation$1=function readExifOrientation$1(view,offset){// Missing 0x45786966 Marker? No Exif Header, stop here\nif(view.getUint32(offset+=2,false)!==0x45786966)return-1;// First 2bytes defines byte align of TIFF data.\n// If it is 0x4949=\"I I\", it means \"Intel\" type byte align\nvar intelByteAligned=view.getUint16(offset+=6,false)===0x4949;offset+=view.getUint32(offset+4,intelByteAligned);var tags=view.getUint16(offset,intelByteAligned);offset+=2;// find Orientation tag\nfor(var i=0;i<tags;i++){if(view.getUint16(offset+i*12,intelByteAligned)===0x0112)return view.getUint16(offset+i*12+8,intelByteAligned);}};var arrayBufferReadExifOrientationTag=function arrayBufferReadExifOrientationTag(data){if(!data)return;var view=new DataView(data);// Every JPEG file starts from binary value '0xFFD8', so if it's not present, exit here\nif(view.getUint16(0,false)!=0xffd8)return;var length=view.byteLength;var offset=2;var marker;while(offset<length){if(view.getUint16(offset+2,false)<=8)return;marker=view.getUint16(offset,false);offset+=2;// Exif Marker found\nif(marker===0xffe1)return readExifOrientation$1(view,offset);// Invalid marker, exit here\nelse if((marker&0xff00)!==0xff00)return;// Next!\nelse offset+=view.getUint16(offset,false);}};var arrayBufferWriteExifOrientationTag=function arrayBufferWriteExifOrientationTag(data){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(!data)return false;var view=new DataView(data);// Every JPEG file starts from binary value '0xFFD8', so if it's not present, exit here\nif(view.getUint16(0)!==0xffd8)return false;var offset=2;// Start at 2 as we skipped two bytes (FFD8)\nvar marker;var markerLength;var orientationCorrected=false;while(offset<view.byteLength){marker=view.getUint16(offset,false);markerLength=view.getUint16(offset+2,false)+2;// Test if is APP and COM markers\nvar isData=marker>=0xffe0&&marker<=0xffef||marker===0xfffe;if(!isData)break;if(!orientationCorrected)orientationCorrected=writeExifOrientation(view,offset,value);if(offset+markerLength>view.byteLength)break;offset+=markerLength;}return orientationCorrected;};var writeExifOrientation=function writeExifOrientation(view,offset,orientation){// Missing 0x45786966 Marker? No Exif Header, stop here\nif(view.getUint32(offset+4,false)!==0x45786966)return;// next byte!\noffset+=4;// First 2bytes defines byte align of TIFF data.\n// If it is 0x4949=\"I I\", it means \"Intel\" type byte align\nvar intelByteAligned=view.getUint16(offset+=6,false)===0x4949;offset+=view.getUint32(offset+4,intelByteAligned);var tags=view.getUint16(offset,intelByteAligned);offset+=2;// find Orientation tag and overwrite with orientation value\nfor(var i=0;i<tags;i++){if(view.getUint16(offset+i*12,intelByteAligned)===0x0112){view.setUint16(offset+i*12+8,orientation,intelByteAligned);return true;}}return false;};var isJPEG=function isJPEG(file){return /jpeg/.test(file.type);};var isPlainObject=function isPlainObject(obj){return typeof obj=='object'&&obj.constructor==Object;};var stringify=function stringify(value){return!isPlainObject(value)?value:JSON.stringify(value);};var post=function post(url,dataset,options){return new Promise(function(resolve,reject){var _options$token=options.token,token=_options$token===void 0?{}:_options$token,_options$beforeSend=options.beforeSend,beforeSend=_options$beforeSend===void 0?noop:_options$beforeSend,_options$onprogress=options.onprogress,onprogress=_options$onprogress===void 0?noop:_options$onprogress;token.cancel=function(){return request.abort();};var request=new XMLHttpRequest();request.upload.onprogress=onprogress;request.onload=function(){return request.status>=200&&request.status<300?resolve(request):reject(request);};request.onerror=function(){return reject(request);};request.ontimeout=function(){return reject(request);};request.open('POST',encodeURI(url));beforeSend(request);request.send(dataset.reduce(function(formData,args){// @ts-ignore\nformData.append.apply(formData,_toConsumableArray(args.map(stringify)));return formData;},new FormData()));});};var ctxRotate=function ctxRotate(ctx){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var pivot=arguments.length>2?arguments[2]:undefined;if(rotation===0)return ctx;ctx.translate(pivot.x,pivot.y);ctx.rotate(rotation);ctx.translate(-pivot.x,-pivot.y);return ctx;};var ctxTranslate=function ctxTranslate(ctx,x,y){ctx.translate(x,y);return ctx;};var ctxScale=function ctxScale(ctx,x,y){ctx.scale(x,y);return ctx;};var cropImageData=/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(imageData){var options,flipX,flipY,rotation,crop,imageSize,shouldFlip,shouldRotate,cropDefined,cropCoversImage,shouldCrop,imageDataOut,image,_ctx2,outputSize,_ctx3,_ctx4,ctx,_args14=arguments;return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:options=_args14.length>1&&_args14[1]!==undefined?_args14[1]:{};flipX=options.flipX,flipY=options.flipY,rotation=options.rotation,crop=options.crop;imageSize=sizeCreateFromAny(imageData);shouldFlip=flipX||flipY;shouldRotate=!!rotation;cropDefined=crop&&(crop.x||crop.y||crop.width||crop.height);cropCoversImage=cropDefined&&rectEqual(crop,rectCreateFromSize(imageSize));shouldCrop=cropDefined&&!cropCoversImage;// skip!\nif(!(!shouldFlip&&!shouldRotate&&!shouldCrop)){_context14.next=10;break;}return _context14.abrupt(\"return\",imageData);case 10:image=h('canvas',{width:imageData.width,height:imageData.height});image.getContext('2d').putImageData(imageData,0,0);// flip image data\nif(shouldFlip){_ctx2=h('canvas',{width:image.width,height:image.height}).getContext('2d');ctxScale(_ctx2,flipX?-1:1,flipY?-1:1);_ctx2.drawImage(image,flipX?-image.width:0,flipY?-image.height:0);_ctx2.restore();releaseCanvas(image);image=_ctx2.canvas;}// rotate image data\nif(!shouldRotate){_context14.next=24;break;}// if shouldRotate is true we also receive a crop rect\noutputSize=sizeApply(sizeCreateFromRect(rectCreateFromPoints(rectRotate(rectCreateFromAny(image),rotation))),Math.floor);_ctx3=h('canvas',{width:crop.width,height:crop.height}).getContext('2d');ctxTranslate(_ctx3,-crop.x,-crop.y);ctxRotate(_ctx3,rotation,sizeCenter(outputSize));_ctx3.drawImage(image,(outputSize.width-image.width)*0.5,(outputSize.height-image.height)*0.5);_ctx3.restore();releaseCanvas(image);image=_ctx3.canvas;_context14.next=29;break;case 24:if(!shouldCrop){_context14.next=29;break;}_ctx4=image.getContext('2d');imageDataOut=_ctx4.getImageData(crop.x,crop.y,crop.width,crop.height);releaseCanvas(image);return _context14.abrupt(\"return\",imageDataOut);case 29:// done, return resulting image data\nctx=image.getContext('2d');imageDataOut=ctx.getImageData(0,0,image.width,image.height);releaseCanvas(image);return _context14.abrupt(\"return\",imageDataOut);case 33:case\"end\":return _context14.stop();}}},_callee14);}));return function cropImageData(_x21){return _ref16.apply(this,arguments);};}();var resizeTransform=function resizeTransform(options,done){var imageData=options.imageData,width=options.width,height=options.height;var originWidth=imageData.width;var originHeight=imageData.height;var targetWidth=Math.round(width);var targetHeight=Math.round(height);var inputData=imageData.data;var outputData=new Uint8ClampedArray(targetWidth*targetHeight*4);var ratioWidth=originWidth/targetWidth;var ratioHeight=originHeight/targetHeight;var ratioWidthHalf=Math.ceil(ratioWidth*0.5);var ratioHeightHalf=Math.ceil(ratioHeight*0.5);for(var j=0;j<targetHeight;j++){for(var i=0;i<targetWidth;i++){var x2=(i+j*targetWidth)*4;var weight=0;var weights=0;var weightsAlpha=0;var _r=0;var g=0;var b=0;var a=0;var centerY=(j+0.5)*ratioHeight;for(var yy=Math.floor(j*ratioHeight);yy<(j+1)*ratioHeight;yy++){var dy=Math.abs(centerY-(yy+0.5))/ratioHeightHalf;var centerX=(i+0.5)*ratioWidth;var w0=dy*dy;for(var xx=Math.floor(i*ratioWidth);xx<(i+1)*ratioWidth;xx++){var dx=Math.abs(centerX-(xx+0.5))/ratioWidthHalf;var w=Math.sqrt(w0+dx*dx);if(w>=-1&&w<=1){weight=2*w*w*w-3*w*w+1;if(weight>0){dx=4*(xx+yy*originWidth);var ref=inputData[dx+3];a+=weight*ref;weightsAlpha+=weight;if(ref<255){weight=weight*ref/250;}_r+=weight*inputData[dx];g+=weight*inputData[dx+1];b+=weight*inputData[dx+2];weights+=weight;}}}}outputData[x2]=_r/weights;outputData[x2+1]=g/weights;outputData[x2+2]=b/weights;outputData[x2+3]=a/weightsAlpha;}}done(null,{data:outputData,width:targetWidth,height:targetHeight});};var imageDataObjectToImageData=function imageDataObjectToImageData(obj){if(obj instanceof ImageData){return obj;}var imageData;try{imageData=new ImageData(obj.width,obj.height);}catch(err){// IE + Old EDGE (tested on 12)\nvar canvas=h('canvas');imageData=canvas.getContext('2d').createImageData(obj.width,obj.height);}imageData.data.set(obj.data);return imageData;};var resizeImageData=/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(imageData){var options,width,height,fit,upscale,targetWidth,targetHeight,scalarWidth,scalarHeight,_scalar,_args15=arguments;return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:options=_args15.length>1&&_args15[1]!==undefined?_args15[1]:{};width=options.width,height=options.height,fit=options.fit,upscale=options.upscale;// no need to rescale\nif(!(!width&&!height)){_context15.next=4;break;}return _context15.abrupt(\"return\",imageData);case 4:targetWidth=width;targetHeight=height;if(!width){targetWidth=height;}else if(!height){targetHeight=width;}if(!(fit!=='force')){_context15.next=16;break;}scalarWidth=targetWidth/imageData.width;scalarHeight=targetHeight/imageData.height;_scalar=1;if(fit==='cover'){_scalar=Math.max(scalarWidth,scalarHeight);}else if(fit==='contain'){_scalar=Math.min(scalarWidth,scalarHeight);}// if image is too small, exit here with original image\nif(!(_scalar>1&&upscale===false)){_context15.next=14;break;}return _context15.abrupt(\"return\",imageData);case 14:targetWidth=Math.round(imageData.width*_scalar);targetHeight=Math.round(imageData.height*_scalar);case 16:if(!(imageData.width===targetWidth&&imageData.height===targetHeight)){_context15.next=18;break;}return _context15.abrupt(\"return\",imageData);case 18:_context15.next=20;return thread(resizeTransform,[{imageData:imageData,width:targetWidth,height:targetHeight}],[imageData.data.buffer]);case 20:imageData=_context15.sent;return _context15.abrupt(\"return\",imageDataObjectToImageData(imageData));case 22:case\"end\":return _context15.stop();}}},_callee15);}));return function resizeImageData(_x22){return _ref17.apply(this,arguments);};}();var colorEffect=function colorEffect(options,done){var imageData=options.imageData,matrix=options.matrix;if(!matrix)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var m11=matrix[0];var m12=matrix[1];var m13=matrix[2];var m14=matrix[3];var m15=matrix[4];var m21=matrix[5];var m22=matrix[6];var m23=matrix[7];var m24=matrix[8];var m25=matrix[9];var m31=matrix[10];var m32=matrix[11];var m33=matrix[12];var m34=matrix[13];var m35=matrix[14];var m41=matrix[15];var m42=matrix[16];var m43=matrix[17];var m44=matrix[18];var m45=matrix[19];var index=0;var r=0.0;var g=0.0;var b=0.0;var a=0.0;var mr=0.0;var mg=0.0;var mb=0.0;var ma=0.0;var or=0.0;var og=0.0;var ob=0.0;for(;index<l;index+=4){r=data[index]/255;g=data[index+1]/255;b=data[index+2]/255;a=data[index+3]/255;mr=r*m11+g*m12+b*m13+a*m14+m15;mg=r*m21+g*m22+b*m23+a*m24+m25;mb=r*m31+g*m32+b*m33+a*m34+m35;ma=r*m41+g*m42+b*m43+a*m44+m45;or=Math.max(0,mr*ma)+(1.0-ma);og=Math.max(0,mg*ma)+(1.0-ma);ob=Math.max(0,mb*ma)+(1.0-ma);outputData[index]=Math.max(0.0,Math.min(1.0,or))*255;outputData[index+1]=Math.max(0.0,Math.min(1.0,og))*255;outputData[index+2]=Math.max(0.0,Math.min(1.0,ob))*255;outputData[index+3]=a*255;}done(null,{data:outputData,width:imageData.width,height:imageData.height});};var convolutionEffect=function convolutionEffect(options,done){var imageData=options.imageData,matrix=options.matrix;if(!matrix)return done(null,imageData);// calculate kernel weight\nvar kernelWeight=matrix.reduce(function(prev,curr){return prev+curr;});// input info\nvar inputWidth=imageData.width;var inputHeight=imageData.height;var inputData=imageData.data;var i=0;var x=0;var y=0;var side=Math.round(Math.sqrt(matrix.length));var sideHalf=Math.floor(side/2);var r=0,g=0,b=0,a=0,cx=0,cy=0,scy=0,scx=0,srcOff=0,weight=0;var outputData=new Uint8ClampedArray(inputWidth*inputHeight*4);for(y=0;y<inputHeight;y++){for(x=0;x<inputWidth;x++){// calculate the weighed sum of the source image pixels that\n// fall under the convolution matrix\nr=0;g=0;b=0;a=0;for(cy=0;cy<side;cy++){for(cx=0;cx<side;cx++){scy=y+cy-sideHalf;scx=x+cx-sideHalf;if(scy<0||scy>=inputHeight||scx<0||scx>=inputWidth)continue;srcOff=(scy*inputWidth+scx)*4;weight=matrix[cy*side+cx];r+=inputData[srcOff]*weight;g+=inputData[srcOff+1]*weight;b+=inputData[srcOff+2]*weight;a+=inputData[srcOff+3]*weight;}}outputData[i]=r/kernelWeight;outputData[i+1]=g/kernelWeight;outputData[i+2]=b/kernelWeight;outputData[i+3]=a/kernelWeight;i+=4;}}done(null,{data:outputData,width:inputWidth,height:inputHeight});};var vignetteEffect=function vignetteEffect(options,done){var imageData=options.imageData,strength=options.strength;if(!strength)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var inputWidth=imageData.width;var inputHeight=imageData.height;var data=imageData.data;var dist=function dist(x,y){dx=x-cx;dy=y-cy;return Math.sqrt(dx*dx+dy*dy);};var index=0;var x=0;var y=0;var cx=inputWidth*0.5;var cy=inputHeight*0.5;var dx;var dy;var f;var dm=dist(0,0);for(y=0;y<inputHeight;y++){for(x=0;x<inputWidth;x++){index=(x+y*inputWidth)*4;f=dist(x,y)*strength/dm;if(strength>0){outputData[index]=data[index]*(1-f);outputData[index+1]=data[index+1]*(1-f);outputData[index+2]=data[index+2]*(1-f);}else{outputData[index]=data[index]+f*-(255-data[index]);outputData[index+1]=data[index+1]+f*-(255-data[index+1]);outputData[index+2]=data[index+2]+f*-(255-data[index+2]);}outputData[index+3]=data[index+3];}}done(null,{data:outputData,width:imageData.width,height:imageData.height});};var noiseEffect=function noiseEffect(options,done){var imageData=options.imageData,level=options.level,_options$monochrome=options.monochrome,monochrome=_options$monochrome===void 0?false:_options$monochrome;if(!level)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var index=0;var r;var g;var b;var average;var rand=function rand(){return(-1+Math.random()*2)*255*level;};for(;index<l;index+=4){if(monochrome){average=rand();r=average;g=average;b=average;}else{r=rand();g=rand();b=rand();}outputData[index]=data[index]+r;outputData[index+1]=data[index+1]+g;outputData[index+2]=data[index+2]+b;outputData[index+3]=data[index+3];}done(null,{data:outputData,width:imageData.width,height:imageData.height});};var gammaEffect=function gammaEffect(options,done){var imageData=options.imageData,level=options.level;if(!level)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var index=0;var r;var g;var b;for(;index<l;index+=4){r=data[index]/255;g=data[index+1]/255;b=data[index+2]/255;outputData[index]=Math.pow(r,level)*255;outputData[index+1]=Math.pow(g,level)*255;outputData[index+2]=Math.pow(b,level)*255;outputData[index+3]=data[index+3];}done(null,{data:outputData,width:imageData.width,height:imageData.height});};var isIdentityMatrix=function isIdentityMatrix(matrix){/*\n    [\n        1, 0, 0, 0, 0\n        0, 1, 0, 0, 0\n        0, 0, 1, 0, 0\n        0, 0, 0, 1, 0\n    ]\n    */var l=matrix.length;var v;var s=l>=20?6:l>=16?5:3;for(var i=0;i<l;i++){v=matrix[i];if(v===1&&i%s!==0)return false;else if(v!==0&&v!==1)return false;}return true;};var filterImageData=/*#__PURE__*/function(){var _ref18=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(imageData){var options,colorMatrix,convolutionMatrix,gammaLevel,noiseLevel,vignetteStrength,filters,chain,filterChain,_args16=arguments;return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:options=_args16.length>1&&_args16[1]!==undefined?_args16[1]:{};colorMatrix=options.colorMatrix,convolutionMatrix=options.convolutionMatrix,gammaLevel=options.gamma,noiseLevel=options.noise,vignetteStrength=options.vignette;// filters\nfilters=[];// apply convolution matrix\nif(convolutionMatrix){filters.push([convolutionEffect,{matrix:convolutionMatrix.clarity}]);}// apply noise\nif(gammaLevel>0){filters.push([gammaEffect,{level:1.0/gammaLevel}]);}// apply color matrix\nif(colorMatrix&&!isIdentityMatrix(colorMatrix)){filters.push([colorEffect,{matrix:colorMatrix}]);}// apply noise\nif(noiseLevel>0||noiseLevel<0){filters.push([noiseEffect,{level:noiseLevel}]);}// apply vignette\nif(vignetteStrength>0||vignetteStrength<0){filters.push([vignetteEffect,{strength:vignetteStrength}]);}// no changes\nif(filters.length){_context16.next=10;break;}return _context16.abrupt(\"return\",imageData);case 10:// builds effect chain\nchain=function chain(transforms,i){return\"(err, imageData) => {\\n            (\".concat(transforms[i][0].toString(),\")(Object.assign({ imageData: imageData }, filterInstructions[\").concat(i,\"]), \\n                \").concat(transforms[i+1]?chain(transforms,i+1):'done',\")\\n        }\");};filterChain=\"function (options, done) {\\n        const filterInstructions = options.filterInstructions;\\n        const imageData = options.imageData;\\n        (\".concat(chain(filters,0),\")(null, imageData)\\n    }\");_context16.next=14;return thread(filterChain,[{imageData:imageData,filterInstructions:filters.map(function(t){return t[1];})}],[imageData.data.buffer]);case 14:imageData=_context16.sent;return _context16.abrupt(\"return\",imageDataObjectToImageData(imageData));case 16:case\"end\":return _context16.stop();}}},_callee16);}));return function filterImageData(_x23){return _ref18.apply(this,arguments);};}();var isNumber=function isNumber(v){return typeof v==='number';};var isEmoji=function isEmoji(str){return isString(str)&&str.match(/(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\u0023-\\u0039]\\ufe0f?\\u20e3|\\u3299|\\u3297|\\u303d|\\u3030|\\u24c2|\\ud83c[\\udd70-\\udd71]|\\ud83c[\\udd7e-\\udd7f]|\\ud83c\\udd8e|\\ud83c[\\udd91-\\udd9a]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\ude01-\\ude02]|\\ud83c\\ude1a|\\ud83c\\ude2f|\\ud83c[\\ude32-\\ude3a]|\\ud83c[\\ude50-\\ude51]|\\u203c|\\u2049|[\\u25aa-\\u25ab]|\\u25b6|\\u25c0|[\\u25fb-\\u25fe]|\\u00a9|\\u00ae|\\u2122|\\u2139|\\ud83c\\udc04|[\\u2600-\\u26FF]|\\u2b05|\\u2b06|\\u2b07|\\u2b1b|\\u2b1c|\\u2b50|\\u2b55|\\u231a|\\u231b|\\u2328|\\u23cf|[\\u23e9-\\u23f3]|[\\u23f8-\\u23fa]|\\ud83c\\udccf|\\u2934|\\u2935|[\\u2190-\\u21ff])/g)!==null;};var hasProp=function hasProp(obj,key){return obj.hasOwnProperty(key);};var isObject=function isObject(v){return typeof v==='object';};var copy=function copy(val){return isObject(val)?deepCopy(val):val;};var deepCopy=function deepCopy(src){var dst;if(Array.isArray(src)){dst=[];src.forEach(function(val,i){dst[i]=copy(val);});}else{dst={};Object.keys(src).forEach(function(key){var val=src[key];dst[key]=copy(val);});}return dst;};var isFunction=function isFunction(v){return typeof v==='function';};var isArray=function isArray(arr){return Array.isArray(arr);};var result$3=null;var isMac=function isMac(){if(result$3===null)result$3=isBrowser()&&/^mac/i.test(navigator.platform);return result$3;};var result$4=null;var isIOS=function isIOS(){if(result$4===null)// first part is for iPhones and iPads iOS 12 and below second part is for iPads with iOS 13 and up\nresult$4=isBrowser()&&(isUserAgent(/iPhone|iPad|iPod/)||isMac()&&navigator.maxTouchPoints>=1);return result$4;};var isApple=function isApple(){return isIOS()||isMac();};var isWindows=function isWindows(){return /^win/i.test(navigator.platform);};// macos:   font-size: 123, x: 63.5, y: 110\n// windows: font-size: 112, x: 64, y: 103\n// android: font-size: 112, x: 64, y: 102\nvar x=64;var y=102;var fontSize=112;var hasSetValues=false;var getEmojiSVG=function getEmojiSVG(emoji,alt){if(!hasSetValues&&isBrowser()){if(isWindows())y=103;if(isApple()){x=63.5;y=110;fontSize=123;}hasSetValues=true;}return\"<svg\".concat(alt?\" aria-label=\\\"\".concat(alt,\"\\\"\"):'',\" width=\\\"128\\\" height=\\\"128\\\" viewBox=\\\"0 0 128 128\\\" preserveAspectRatio=\\\"xMinYMin meet\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><text x=\\\"\").concat(x,\"\\\" y=\\\"\").concat(y,\"\\\" alignment-baseline=\\\"text-top\\\" dominant-baseline=\\\"text-top\\\" text-anchor=\\\"middle\\\" font-size=\\\"\").concat(fontSize,\"px\\\">\").concat(emoji,\"</text></svg>\");};var SVGToDataURL=function SVGToDataURL(svg){return\"data:image/svg+xml,\".concat(svg.replace('<','%3C').replace('>','%3E'));};var isBinary=function isBinary(v){return v instanceof Blob;};var toPercentage=function toPercentage(value,total){return\"\".concat(value/total*100,\"%\");};var loadImage=function loadImage(image){var onsize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;return new Promise(function(resolve,reject){// the image element we'll use to load the image\nvar imageElement=image;var sizeCalculated=false;var reportSize=function reportSize(){if(sizeCalculated)return;sizeCalculated=true;isFunction(onsize)&&/* Use Promise.resolve to make async but place before resolve of parent promise */Promise.resolve().then(function(){return onsize(sizeCreate(imageElement.naturalWidth,imageElement.naturalHeight));});};// if is not an image element, it must be a valid image source\nif(!imageElement.src){imageElement=new Image();imageElement.src=isString(image)?image:URL.createObjectURL(image);}if(imageElement.complete){reportSize();return resolve(imageElement);}// try to calculate size faster\nif(isFunction(onsize))getImageElementSize(imageElement).then(reportSize)[\"catch\"](reject);imageElement.onload=function(){reportSize();resolve(imageElement);};imageElement.onerror=reject;});};var colorArrayToRGBA=function colorArrayToRGBA(color){return\"rgba(\".concat(Math.round(color[0]*255),\", \").concat(Math.round(color[1]*255),\", \").concat(Math.round(color[2]*255),\", \").concat(isNumber(color[3])?color[3]:1,\")\");};var textPadding=20;// font offset\n// font size 16 -> 2, 4\n// font size 32 -> 4, 6\n// font size 64 -> 8, 12\n// font size 128 -> 16, 24\n// font size 256 -> 32, 48\nvar fontOffsetBrowser=undefined;var getBrowserFontOffset=function getBrowserFontOffset(fontSize){if(!fontOffsetBrowser){// size\nvar size=32;// let's calculate it\nvar ctx=createSimpleContext(size,size);updateTextContext(ctx,{fontSize:100,color:'#fff'});ctx.fillText('F',0,0);// get pixel data so we can find the white pixels\nvar data=ctx.getImageData(0,0,size,size).data;// find x offset\nvar p=0;var step=4;var to=data.length;var from=to-size*4;for(p=from;p<to;p+=step){if(data[p])break;}var _x24=(p-from)/step;// find y offset\nfrom=(size-1)*4;step=size*4;for(p=from;p<to;p+=step){if(data[p])break;}var _y=(p-from)/step;fontOffsetBrowser=vectorCreate(_x24,_y);// done with canvas\nreleaseCanvas(ctx.canvas);}return vectorCreate(-fontOffsetBrowser.x*fontSize*0.01,-fontOffsetBrowser.y*fontSize*0.01);};var createSimpleContext=function createSimpleContext(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var canvas=h('canvas');var ctx=canvas.getContext('2d');ctx.canvas.width=width;ctx.canvas.height=height;return ctx;};var updateTextContext=function updateTextContext(ctx,options){var _options$fontSize=options.fontSize,fontSize=_options$fontSize===void 0?16:_options$fontSize,_options$fontFamily=options.fontFamily,fontFamily=_options$fontFamily===void 0?'sans-serif':_options$fontFamily,_options$fontWeight=options.fontWeight,fontWeight=_options$fontWeight===void 0?'normal':_options$fontWeight,_options$fontVariant=options.fontVariant,fontVariant=_options$fontVariant===void 0?'normal':_options$fontVariant,_options$fontStyle=options.fontStyle,fontStyle=_options$fontStyle===void 0?'normal':_options$fontStyle,_options$textAlign=options.textAlign,textAlign=_options$textAlign===void 0?'left':_options$textAlign,_options$color=options.color,color=_options$color===void 0?'#000':_options$color;ctx.font=\"\".concat(fontStyle,\" \").concat(fontVariant,\" \").concat(fontWeight,\" \").concat(fontSize,\"px \").concat(fontFamily);ctx.textBaseline='top';ctx.textAlign=textAlign;ctx.fillStyle=Array.isArray(color)?colorArrayToRGBA(color):color;};var createSimpleTextContext=function createSimpleTextContext(options){var ctx=createSimpleContext();updateTextContext(ctx,options);return ctx;};var computeLineHeight=function computeLineHeight(fontSize,lineHeight){return isFunction(lineHeight)?lineHeight(fontSize):lineHeight;};var getMeasureVisibleWidth=function getMeasureVisibleWidth(measure){return Math.abs(measure.actualBoundingBoxLeft)+Math.abs(measure.actualBoundingBoxRight);};var resizeContextToFitText=function resizeContextToFitText(ctx,text,options){var _measureTextContext=measureTextContext(ctx,text,computeLineHeight(options.fontSize,options.lineHeight)),width=_measureTextContext.width,height=_measureTextContext.height;ctx.canvas.width=Math.ceil(width);ctx.canvas.height=Math.ceil(height);return ctx;};var measureTextContext=function measureTextContext(ctx,text,computedLineHeight){var storedTextAlign=ctx.textAlign;ctx.textAlign='left';// calculate width\nvar lines=text.split('\\n');var width=lines.reduce(function(prev,curr){var lineWidth=getMeasureVisibleWidth(ctx.measureText(curr));if(lineWidth>prev){prev=lineWidth;}return prev;},1);ctx.textAlign=storedTextAlign;// calculate height\nvar height=computedLineHeight*lines.length;return sizeCreate(Math.ceil(width),Math.ceil(height));};var TextSizeCache=new Map();var createTextSizeHash=function createTextSizeHash(text,_ref19){var fontSize=_ref19.fontSize,fontFamily=_ref19.fontFamily,lineHeight=_ref19.lineHeight,fontWeight=_ref19.fontWeight,fontStyle=_ref19.fontStyle,fontVariant=_ref19.fontVariant;return\"\".concat([text,fontSize,fontWeight,fontStyle,fontVariant,fontFamily].join('_'),\"_\").concat(isFunction(lineHeight)?lineHeight(fontSize):lineHeight);};var textSize=function textSize(text,options){var ctx=createSimpleTextContext(options);if(options.width)text=wrapText(ctx,text,options.width);var hash=createTextSizeHash(text,options);var size=TextSizeCache.get(hash);if(size)return _objectSpread({},size);size=measureTextContext(ctx,text,computeLineHeight(options.fontSize,options.lineHeight));TextSizeCache.set(hash,size);return _objectSpread({},size);};var wrapText=function wrapText(ctx,text,lineWidth){// exit if no text\nif(text.length===0)return'';var res=[];var lineBuffer='';var lineIndex=0;var measureWidth;var paragraphs=text.split('\\n\\n');// draw the current line\nvar pushLine=function pushLine(){if(!lineBuffer.length)return;if(!res[lineIndex]){res[lineIndex]=[];}res[lineIndex].push(lineBuffer);// clear buffer\nlineBuffer='';};var fitChar=function fitChar(_char){var testLine=lineBuffer+_char;// measure width of entire line if adding these chars\nmeasureWidth=ctx.measureText(testLine).width;// fits on line?\nif(measureWidth<lineWidth){lineBuffer=testLine;}else{// doesn't fit but line buffer is empty, just print the character and move to next line\nif(!lineBuffer.length){lineBuffer=testLine;pushLine();}// fits, lets print current line and move char to next line\nelse{pushLine();lineBuffer=_char;}lineIndex++;}};var fitWord=function fitWord(word){var testLine=lineBuffer.length?lineBuffer+' '+word:word;// measure width of entire line if adding these chars\nmeasureWidth=ctx.measureText(testLine).width;// fits on line?\nif(measureWidth<lineWidth){lineBuffer=testLine;}// wrap to next line\nelse{// if line buffer is empty, whole word doesn't fit, need to cut it up\nif(!lineBuffer.length){word.split('').forEach(fitChar);}// there are words in the buffer that do fit, let's draw the line and move this word to the next line\nelse{// draw current buffer\npushLine();lineIndex++;// retry to fit this word\nfitWord(word);}}};paragraphs.forEach(function(p){var lines=p.split('\\n');lines.forEach(function(l){l.split(' ').forEach(fitWord);// end of line reached, if we have words in our buffer\n// at this point we need to draw them and then move to the next line\nif(lineBuffer.length)pushLine();// forced new line\nlineIndex++;});// forced new line\nlineIndex++;});return res.map(function(line){return line.join(' ');}).join('\\n');};var drawText=function drawText(ctx){var text=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// exit if no text\nif(text.length===0)return ctx;var _options$x=options.x,x=_options$x===void 0?0:_options$x,_options$y=options.y,y=_options$y===void 0?0:_options$y,_options$lineWidth=options.lineWidth,lineWidth=_options$lineWidth===void 0?0:_options$lineWidth,textAlign=options.textAlign,fontSize=options.fontSize,lineHeight=options.lineHeight;// determine where the browser will render the font and correct for browser differences\nvar browserFontOffset=vectorAdd(getBrowserFontOffset(fontSize),vectorCreate(fontSize/12,fontSize/3.75));var fontOffsetX=x+browserFontOffset.x;var fontOffsetY=y+browserFontOffset.y;var lineHeightComputed=isFunction(lineHeight)?lineHeight(fontSize):lineHeight;var offset=textAlign==='right'?lineWidth:textAlign==='center'?lineWidth*0.5:0;text.split('\\n').forEach(function(line,i){ctx.fillText(line,fontOffsetX+offset,fontOffsetY+i*lineHeightComputed);});return ctx;};//#region shape generic\nvar shapeContain=function shapeContain(shape,parentRect){var shapeAspectRatio=shape.width/shape.height;var containedShape=rectContainRect(parentRect,shapeAspectRatio);if(shape.width>containedShape.width||shape.height>containedShape.height){shape.width=containedShape.width;shape.height=containedShape.height;}return shape;};var shapeCenter=function shapeCenter(shape,position){shape.x=position.x-shape.width*0.5;shape.y=position.y-shape.height*0.5;return shape;};var shapeDeepCopy=function shapeDeepCopy(shape){// don't attempt to clone background image element\n// TODO: MOVE IMAGE ELEMENT TO SOME INTERNAL CACHE\nvar shapeShallowCopy=_objectSpread({},shape);shapeShallowCopy.backgroundImageElement=undefined;var shapeDeepCopy=deepCopy(shapeShallowCopy);// we don't want a million image elements so we'll reference the original one\nif(shape.backgroundImageElement)shapeDeepCopy.backgroundImageElement=shape.backgroundImageElement;return shapeDeepCopy;};var getContextSize=function getContextSize(context){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var contextAspectRatio=rectAspectRatio(context);var width;var height;if(size.width&&size.height)return sizeClone(size);if(size.width||size.height){width=parseFloat(size.width||Number.MAX_SAFE_INTEGER);height=parseFloat(size.height||Number.MAX_SAFE_INTEGER);var min=Math.min(width,height);if(isString(size.width)||isString(size.height)){width=\"\".concat(min,\"%\");height=\"\".concat(min*contextAspectRatio,\"%\");}else{width=min;height=min;}}else{var _min=10;width=\"\".concat(_min,\"%\");height=\"\".concat(_min*contextAspectRatio,\"%\");}return{width:width,height:height};};var shapeCreateFromEmoji=function shapeCreateFromEmoji(emoji){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return _objectSpread(_objectSpread({width:undefined,height:undefined},props),{},{aspectRatio:1,backgroundImage:SVGToDataURL(getEmojiSVG(emoji))});};var shapeCreateFromImage=function shapeCreateFromImage(src,oncomplete){var props=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var shape=_objectSpread(_objectSpread({// required/default image shape props\nwidth:undefined,height:undefined,aspectRatio:undefined,backgroundColor:[0,0,0,0]},props),{},{// set image\nbackgroundImage:isString(src)?src:URL.createObjectURL(src)});return shapeLoadResources(shape,oncomplete);};var shapeLoadResources=function shapeLoadResources(shape){var oncomplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;if(shape.backgroundImage){// done loading\nif(shape.isComplete){oncomplete(shape.isError,shape);return shape;}// is still loading\nif(shape.isLoading)return shape;// default state before loading\nshape.isComplete=false;shape.isError=false;shape.isLoading=true;// updates the size of the shape relative to the image\nvar updateShapeSize=function updateShapeSize(imageSize){// if background size is not set the shape is not locked to the image aspect ratio\nif(shape.backgroundSize)return;// always locked to aspect ratio\nvar aspectRatio=imageSize.width/imageSize.height;// check if width has been defined, if so, we update height to match aspect ratio\nvar width=shape.width||imageSize.width;var height=width/aspectRatio;// set final dimensions\nshape.width=width;shape.height=height;shape.aspectRatio=imageSize.width/imageSize.height;};// now loading\nloadImage(shape.backgroundImage,updateShapeSize).then(function(image){shape.backgroundImageElement=image;})[\"catch\"](function(error){shape.isError=error;})[\"finally\"](function(){shape.isLoading=false;shape.isComplete=true;oncomplete(shape.isError,shape);});}return shape;};var shapeCreateFromPreset=function shapeCreateFromPreset(preset,parentRect,oncomplete){var shape;if(isString(preset)||isBinary(preset)){// if is emoji, create default markup,\nif(isEmoji(preset)){// create markup\nshape=shapeCreateFromEmoji(preset,getContextSize(parentRect));setTimeout(function(){return oncomplete(undefined,shape);},0);}// is URL, create default markup for image\nelse{shape=shapeCreateFromImage(preset,oncomplete,_objectSpread({},getContextSize(parentRect)));}}else{// is using src shortcut\nif(preset.src){// shape options\nvar shapeOptions=_objectSpread(_objectSpread({},preset.shape),getContextSize(parentRect,preset.shape||preset));// emoji markup\nif(isEmoji(preset.src)){shape=shapeCreateFromEmoji(preset.src,shapeOptions);setTimeout(function(){return oncomplete(undefined,shape);},0);}// is url\nelse if(isString(preset.src)){shape=shapeCreateFromImage(preset.src,oncomplete,shapeOptions);}}// should have markup defined\nelse if(preset.shape){shape=shapeDeepCopy(preset.shape);}}if(hasProp(shape,'backgroundImage')){// set transparent background if no background color defined\nif(!hasProp(shape,'backgroundColor')){shape.backgroundColor=[0,0,0,0];}// for image presets, disable styles by default\nif(!hasProp(shape,'disableStyle')){shape.disableStyle=true;}// by default don't allow flipping\nif(!hasProp(shape,'disableFlip')){shape.disableFlip=true;}}return parentRect?shapeComputeDisplay(shape,parentRect):shape;};var shapeLineGetStartPoint=function shapeLineGetStartPoint(line){return vectorCreate(line.x1,line.y1);};var shapeLineGetEndPoint=function shapeLineGetEndPoint(line){return vectorCreate(line.x2,line.y2);};var shapeTextUID=function shapeTextUID(_ref20){var text=_ref20.text,textAlign=_ref20.textAlign,fontSize=_ref20.fontSize,fontFamily=_ref20.fontFamily,lineHeight=_ref20.lineHeight,fontWeight=_ref20.fontWeight,fontStyle=_ref20.fontStyle,fontVariant=_ref20.fontVariant;return\"\".concat([text,textAlign,fontSize,fontWeight,fontStyle,fontVariant,fontFamily].join('_'),\"_\").concat(isFunction(lineHeight)?lineHeight(fontSize):lineHeight);};//#endregion\n//#region shape testing\n// shape types\nvar shapeIsText=function shapeIsText(shape){return hasProp(shape,'text');};var shapeIsTextLine=function shapeIsTextLine(shape){return shapeIsText(shape)&&!(shapeHasRelativeSize(shape)||hasProp(shape,'width'));};var shapeIsTextBox=function shapeIsTextBox(shape){return shapeIsText(shape)&&(shapeHasRelativeSize(shape)||hasProp(shape,'width'));};var shapeIsRect=function shapeIsRect(shape){return!shapeIsText(shape)&&shapeHasComputedSize(shape);};var shapeIsEllipse=function shapeIsEllipse(shape){return hasProp(shape,'rx');};var shapeIsLine=function shapeIsLine(shape){return hasProp(shape,'x1')&&!shapeIsTriangle(shape);};var shapeIsTriangle=function shapeIsTriangle(shape){return hasProp(shape,'x3');};var shapeIsPath=function shapeIsPath(shape){return hasProp(shape,'points');};// shape state\nvar shapeIsTextEmpty=function shapeIsTextEmpty(shape){return shapeIsText(shape)&&!shape.text.length;};var shapeIsTextEditing=function shapeIsTextEditing(shape){return shapeIsText(shape)&&shape.isEditing;};var shapeIsVisible=function shapeIsVisible(shape){return hasProp(shape,'opacity')?shape.opacity>0:true;};var shapeIsSelected=function shapeIsSelected(shape){return shape.isSelected;};var shapeIsDraft=function shapeIsDraft(shape){return shape.isDraft;};var shapeHasSize=function shapeHasSize(shape){return hasProp(shape,'width')&&hasProp(shape,'height');};var shapeHasNumericStroke=function shapeHasNumericStroke(shape){return isNumber(shape.strokeWidth)&&shape.strokeWidth>0;};// only relevant if is bigger than 0\nvar shapeHasRelativePosition=function shapeHasRelativePosition(shape){var hasRight=hasProp(shape,'right');var hasBottom=hasProp(shape,'bottom');return hasRight||hasBottom;};var shapeHasTexture=function shapeHasTexture(shape){return hasProp(shape,'backgroundImage')||hasProp(shape,'text');};var shapeHasRelativeSize=function shapeHasRelativeSize(shape){return(hasProp(shape,'x')||hasProp(shape,'left'))&&hasProp(shape,'right')||(hasProp(shape,'y')||hasProp(shape,'top'))&&hasProp(shape,'bottom');};var shapeHasComputedSize=function shapeHasComputedSize(shape){return shapeHasSize(shape)||shapeHasRelativeSize(shape);};// actions\nvar shapeSelect=function shapeSelect(shape){shape.isSelected=true;return shape;};var shapeMakeDraft=function shapeMakeDraft(shape){shape.isDraft=true;return shape;};// rights\nvar shapeCanStyle=function shapeCanStyle(shape,style){if(shape.disableStyle===true)return false;if(isArray(shape.disableStyle)){return!shape.disableStyle.includes(style);}return true;};var shapeCanErase=function shapeCanErase(shape){return shape.disableErase!==true;};var shapeCanSelect=function shapeCanSelect(shape){return shape.disableSelect!==true&&!shapeIsPath(shape)&&!shapeIsTriangle(shape);};var shapeCanRemove=function shapeCanRemove(shape){return shape.disableRemove!==true;};var shapeCanDuplicate=function shapeCanDuplicate(shape){return shape.disableDuplicate!==true&&shapeCanMove(shape);};var shapeCanReorder=function shapeCanReorder(shape){return shape.disableReorder!==true;};var shapeCanFlip=function shapeCanFlip(shape){if(shape.disableFlip)return false;if(shapeIsDraft(shape)||shapeHasRelativePosition(shape))return false;return shapeHasTexture(shape);};var shapeCanInput=function shapeCanInput(shape,input){if(!shapeIsText(shape))return false;if(shape.disableInput===true)return false;if(isFunction(shape.disableInput))return shape.disableInput(input!=null?input:shape.text);return input||true;};var shapeCanMove=function shapeCanMove(shape){return shape.disableMove!==true&&!shapeIsDraft(shape)&&!shapeIsPath(shape)&&!shapeHasRelativePosition(shape);};var shapeCanResize=function shapeCanResize(shape){return shape.disableResize!==true&&!shapeIsDraft(shape)&&(shapeHasSize(shape)||shapeIsTextBox(shape)||shapeIsEllipse(shape)||shapeIsLine(shape))&&!shapeHasRelativePosition(shape)&&shapeCanMove(shape);};var shapeCanRotate=function shapeCanRotate(shape){return shape.disableRotate!==true&&!shapeIsDraft(shape)&&(shapeHasSize(shape)||hasProp(shape,'text')||shapeIsEllipse(shape))&&!shapeHasRelativePosition(shape);};//#endregion\n//#region shape formatting\nvar shapeDeleteRelativeProps=function shapeDeleteRelativeProps(shape){delete shape.left;delete shape.right;delete shape.top;delete shape.bottom;return shape;};var shapeDeleteTransformProps=function shapeDeleteTransformProps(shape){delete shape.rotation;return shape;};var shapeFormatStroke=function shapeFormatStroke(shape){shape.strokeWidth=shape.strokeWidth||1;shape.strokeColor=shape.strokeColor||[0,0,0];return shape;};var shapeFormatFill=function shapeFormatFill(shape){shape.backgroundColor=shape.backgroundColor?shape.backgroundColor:shape.strokeWidth||shape.backgroundImage?undefined:[0,0,0];return shape;};var autoLineHeight=function autoLineHeight(fontSize){return fontSize*1.2;};var shapeFormatText=function shapeFormatText(shape){shape.fontSize=shape.fontSize||16;shape.fontFamily=shape.fontFamily||'sans-serif';shape.fontWeight=shape.fontWeight||'normal';shape.fontStyle=shape.fontStyle||'normal';shape.fontVariant=shape.fontVariant||'normal';shape.lineHeight=isNumber(shape.lineHeight)?shape.lineHeight:autoLineHeight;shape.color=shape.color||[0,0,0];return shapeIsTextLine(shape)?shapeFormatTextLine(shape):shapeFormatTextBox(shape);};var shapeFormatTextLine=function shapeFormatTextLine(shape){delete shape.textAlign;return shapeDeleteRelativeProps(shape);};var shapeFormatTextBox=function shapeFormatTextBox(shape){shape.textAlign=shape.textAlign||'left';return shape;};var shapeFormatRect=function shapeFormatRect(shape){shape.cornerRadius=shape.cornerRadius||0;shape.strokeWidth=shape.strokeWidth||0;shape.strokeColor=shape.strokeColor||[0,0,0];return shapeFormatFill(shape);};var shapeFormatTriangle=function shapeFormatTriangle(shape){shape.strokeWidth=shape.strokeWidth||0;shape.strokeColor=shape.strokeColor||[0,0,0];shapeFormatFill(shape);return shapeDeleteRelativeProps(shape);};var shapeFormatEllipse=function shapeFormatEllipse(shape){shape.strokeWidth=shape.strokeWidth||0;shape.strokeColor=shape.strokeColor||[0,0,0];return shapeFormatFill(shape);};var shapeFormatPath=function shapeFormatPath(shape){shapeFormatStroke(shape);shapeDeleteTransformProps(shape);return shapeDeleteRelativeProps(shape);};var shapeFormatLine=function shapeFormatLine(shape){shapeFormatStroke(shape);shape.lineStart=shape.lineStart||undefined;shape.lineEnd=shape.lineEnd||undefined;shapeDeleteTransformProps(shape);return shapeDeleteRelativeProps(shape);};var shapeFormatDefaults=function shapeFormatDefaults(shape){if(!isString(shape.id))shape.id=getUniqueId();if(!hasProp(shape,'rotation'))shape.rotation=0;if(!hasProp(shape,'opacity'))shape.opacity=1;if(!hasProp(shape,'disableErase'))shape.disableErase=true;};var shapeFormat=function shapeFormat(shape){shapeFormatDefaults(shape);if(shapeIsText(shape)){shapeFormatText(shape);}else if(shapeIsRect(shape)){shapeFormatRect(shape);}else if(shapeIsPath(shape)){shapeFormatPath(shape);}else if(shapeIsLine(shape)){shapeFormatLine(shape);}else if(shapeIsEllipse(shape)){shapeFormatEllipse(shape);}else if(shapeIsTriangle(shape)){shapeFormatTriangle(shape);}shapeLoadResources(shape);return shape;};var shapeGetDescription=function shapeGetDescription(shape){if(shapeIsText(shape)){return'text';}else if(shapeIsRect(shape)){return'rectangle';}else if(shapeIsPath(shape)){return'path';}else if(shapeIsLine(shape)){return'line';}else if(shapeIsEllipse(shape)){return'ellipse';}else if(shapeIsTriangle(shape)){return'triangle';}return;};//#endregion\nvar toPixelValue=function toPixelValue(percentage,total){return parseFloat(percentage)/100*total;};//#region shape transforming\nvar shapeComputeValue=function shapeComputeValue(shape,prop,_ref21){var width=_ref21.width,height=_ref21.height;if(!hasProp(shape,prop))return;var value=shape[prop];if(/points/.test(prop)){var arr=shape[prop];if(!isString(arr[0].x))return;shape[prop]=arr.map(function(p){return vectorCreate(toPixelValue(p.x,width),toPixelValue(p.y,height));});}else if(isString(value)){var f=parseFloat(value)/100;if(/^x|left|width|rx|fontSize|cornerRadius|strokeWidth/.test(prop))shape[prop]=width*f;else if(/^right/.test(prop))shape[prop]=width-width*f;else if(/^y|top|height|ry/.test(prop))shape[prop]=height*f;else if(/^bottom/.test(prop))shape[prop]=height-height*f;}};var displayProps=['width','height','left','top','right','bottom','x','y','rx','ry','points','fontSize','strokeWidth','lineHeight','x1','y1','x2','y2','x3','y3'];var shapeComputeDisplay=function shapeComputeDisplay(shape,parentRect){displayProps.forEach(function(prop){return shapeComputeValue(shape,prop,parentRect);});shapeComputeRect(shape,parentRect);return shape;};var shapeGetPropPixelTotal=function shapeGetPropPixelTotal(prop,parentRect){var total;if(/^x|width|rx|fontSize|strokeWidth|cornerRadius/.test(prop)){total=parentRect.width;}else if(/^y|height|ry/.test(prop)){total=parentRect.height;}return total;};var shapeUpdateProp=function shapeUpdateProp(shape,prop,value,parentRect){if(!isString(shape[prop]))return shape[prop]=value;var total=shapeGetPropPixelTotal(prop,parentRect);shape[prop]=toPercentage(value,total);return shape;};var shapeGetPropPixelValue=function shapeGetPropPixelValue(shape,prop,parentRect){if(!isString(shape[prop]))return shape[prop];return toPixelValue(shape[prop],shapeGetPropPixelTotal(prop,parentRect));};var shapeGetPropsPixelValues=function shapeGetPropsPixelValues(shape,props,parentRect){return props.reduce(function(prev,prop){var value=shapeGetPropPixelValue(shape,prop,parentRect);prev[prop]=value;return prev;},{});};var shapeUpdateProps=function shapeUpdateProps(shape,props,parentRect){Object.keys(props).forEach(function(key){return shapeUpdateProp(shape,key,props[key],parentRect);});return shape;};var shapeComputeRect=function shapeComputeRect(shape,parentRect){if(hasProp(shape,'left'))shape.x=shape.left;if(hasProp(shape,'right')){var _r2=parentRect.width-shape.right;if(hasProp(shape,'left')){shape.x=shape.left;shape.width=Math.max(0,_r2-shape.left);}else if(hasProp(shape,'width')){shape.x=_r2-shape.width;}}if(hasProp(shape,'top'))shape.y=shape.top;if(hasProp(shape,'bottom')){var b=parentRect.height-shape.bottom;if(hasProp(shape,'top')){shape.y=shape.top;shape.height=Math.max(0,b-shape.top);}else if(hasProp(shape,'height')){shape.y=b-shape.height;}}return shape;};var shapeComputeTransform=function shapeComputeTransform(shape,translate,scale){if(shapeIsPath(shape)){shape.points.filter(function(point){return isNumber(point.x);}).forEach(function(point){point.x*=scale;point.y*=scale;point.x+=translate.x;point.y+=translate.y;});}if(shapeIsTriangle(shape)&&isNumber(shape.x1)){shape.x1*=scale;shape.y1*=scale;shape.x2*=scale;shape.y2*=scale;shape.x3*=scale;shape.y3*=scale;shape.x1+=translate.x;shape.y1+=translate.y;shape.x2+=translate.x;shape.y2+=translate.y;shape.x3+=translate.x;shape.y3+=translate.y;}if(shapeIsLine(shape)&&isNumber(shape.x1)){shape.x1*=scale;shape.y1*=scale;shape.x2*=scale;shape.y2*=scale;shape.x1+=translate.x;shape.y1+=translate.y;shape.x2+=translate.x;shape.y2+=translate.y;}if(isNumber(shape.x)&&isNumber(shape.y)){shape.x*=scale;shape.y*=scale;shape.x+=translate.x;shape.y+=translate.y;}if(isNumber(shape.width)&&isNumber(shape.height)){shape.width*=scale;shape.height*=scale;}if(isNumber(shape.rx)&&isNumber(shape.ry)){shape.rx*=scale;shape.ry*=scale;}if(shapeHasNumericStroke(shape)){shape.strokeWidth*=scale;}if(shapeIsText(shape)&&isNumber(shape.fontSize)){shape.fontSize*=scale;if(isNumber(shape.width))shape.width*=scale;}if(hasProp(shape,'cornerRadius')&&isNumber(shape.cornerRadius)){shape.cornerRadius*=scale;}return shape;};var shapeGetCenter=function shapeGetCenter(shape){if(shapeIsRect(shape)){return vectorCreate(shape.x+shape.width*0.5,shape.y+shape.height*0.5);}if(shapeIsEllipse(shape)){return vectorCreate(shape.x,shape.y);}if(shapeIsTextBox(shape)){var height=shape.height||textSize(shape.text,shape).height;return vectorCreate(shape.x+shape.width*0.5,shape.y+height*0.5);}if(shapeIsTextLine(shape)){var size=textSize(shape.text,shape);return vectorCreate(shape.x+size.width*0.5,shape.y+size.height*0.5);}if(shapeIsPath(shape)){return vectorCenter(shape.points);}if(shapeIsLine(shape)){return vectorCenter([shapeLineGetStartPoint(shape),shapeLineGetEndPoint(shape)]);}return undefined;};var shapeComputeLineEnd=function shapeComputeLineEnd(position,strokeWidth,color,style,direction){var shape={};var isSolid=/solid/.test(style);var scaledSize=5*strokeWidth;var s=isSolid?scaledSize:scaledSize-1;var sh=isSolid?s*0.5:Math.ceil(s*0.5);var normal=vectorNormalize(direction);var offset=vectorMultiply(vectorClone(normal),sh);var anchor=vectorClone(position);var positionUpdated=vectorClone(position);if(/arrow/.test(style)){var _x25=position.x;var _y2=position.y;var tipOffset=vectorMultiply(vectorClone(normal),scaledSize);var inset=vectorCreate(_x25+tipOffset.x,_y2+tipOffset.y);vectorMultiply(tipOffset,0.55);if(isSolid){var arrowOffset=vectorMultiply(vectorClone(normal),sh*0.5);_x25-=arrowOffset.x;_y2-=arrowOffset.y;shape={points:[vectorCreate(_x25,_y2),vectorCreate(inset.x-tipOffset.y,inset.y+tipOffset.x),vectorCreate(inset.x+tipOffset.y,inset.y-tipOffset.x)],backgroundColor:color};// move back so arrow triangle overlaps with end of line (otherwise line sticks out of triangle tip)\npositionUpdated.x+=offset.x;positionUpdated.y+=offset.y;}else{// this prevents trouble with sharp line rendering in webgl\nvar p=vectorMultiply(vectorPerpendicular(vectorClone(normal)),0.5);var tipLeft=vectorCreate(_x25-p.x,_y2-p.y);var tipRight=vectorCreate(_x25+p.x,_y2+p.y);shape={points:[vectorCreate(inset.x+tipOffset.y,inset.y-tipOffset.x),tipLeft,vectorCreate(_x25,_y2),tipRight,vectorCreate(inset.x-tipOffset.y,inset.y+tipOffset.x)],strokeWidth:strokeWidth,strokeColor:color};}}else if(/circle/.test(style)){// adjust line point offset\npositionUpdated.x+=offset.x;positionUpdated.y+=offset.y;// add line cap\nshape={x:anchor.x,y:anchor.y,rx:sh,ry:sh,backgroundColor:isSolid?color:undefined,strokeWidth:isSolid?undefined:strokeWidth,strokeColor:isSolid?undefined:color};}else if(/square/.test(style)){// adjust line point offset\npositionUpdated.x+=offset.x;positionUpdated.y+=offset.y;shape={x:anchor.x-sh,y:anchor.y-sh,width:sh*2,height:sh*2,rotation:vectorAngle(normal),backgroundColor:isSolid?color:undefined,strokeWidth:isSolid?undefined:strokeWidth,strokeColor:isSolid?undefined:color};}else if(style==='bar'){shape={points:[vectorCreate(anchor.x-offset.y,anchor.y+offset.x),vectorCreate(anchor.x+offset.y,anchor.y-offset.x)],strokeWidth:strokeWidth,strokeColor:color};}return{position:positionUpdated,shape:shape};};//#endregion\nvar ctxRoundRect=function ctxRoundRect(ctx,x,y,width,height,radius){if(width<2*radius)radius=width/2;if(height<2*radius)radius=height/2;ctx.beginPath();ctx.moveTo(x+radius,y);ctx.arcTo(x+width,y,x+width,y+height,radius);ctx.arcTo(x+width,y+height,x,y+height,radius);ctx.arcTo(x,y+height,x,y,radius);ctx.arcTo(x,y,x+width,y,radius);ctx.closePath();return ctx;};var defineRectShape=function defineRectShape(ctx,shape){shape.cornerRadius>0?ctxRoundRect(ctx,shape.x,shape.y,shape.width,shape.height,shape.cornerRadius):ctx.rect(shape.x,shape.y,shape.width,shape.height);return ctx;};var fillRectShape=function fillRectShape(ctx,shape){shape.backgroundColor&&ctx.fill();return ctx;};var strokeRectShape=function strokeRectShape(ctx,shape){shape.strokeWidth&&ctx.stroke();return ctx;};var drawRect=/*#__PURE__*/function(){var _ref22=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee17(ctx,shape){return _regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:return _context17.abrupt(\"return\",new Promise(function(resolve,reject){ctx.lineWidth=shape.strokeWidth?shape.strokeWidth:1;// 1 is default value for lineWidth prop\n// 1 is default value for lineWidth prop\nctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;if(shape.backgroundImage){shapeLoadResources(shape,function(error,shape){if(error)return reject(error);var sX=0;var sY=0;var sWidth=shape.backgroundImageElement.naturalWidth;var sHeight=shape.backgroundImageElement.naturalHeight;var dX=shape.x;var dY=shape.y;var dWidth=shape.width;var dHeight=shape.height;if(shape.backgroundSize==='contain'){var rect=rectContainRect(shape,sWidth/sHeight);dWidth=rect.width;dHeight=rect.height;dX+=rect.x;dY+=rect.y;}else if(shape.backgroundSize==='cover'){var _rect=rectContainRect(rectCreate(0,0,sWidth,sHeight),dWidth/dHeight);sWidth=_rect.width;sHeight=_rect.height;sX=_rect.x;sY=_rect.y;}defineRectShape(ctx,shape);fillRectShape(ctx,shape);ctx.save();ctx.clip();ctx.drawImage(shape.backgroundImageElement,sX,sY,sWidth,sHeight,dX,dY,dWidth,dHeight);ctx.restore();strokeRectShape(ctx,shape);resolve([]);});}else{defineRectShape(ctx,shape);fillRectShape(ctx,shape);strokeRectShape(ctx,shape);resolve([]);}}));case 1:case\"end\":return _context17.stop();}}},_callee17);}));return function drawRect(_x26,_x27){return _ref22.apply(this,arguments);};}();var drawEllipse=/*#__PURE__*/function(){var _ref23=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee18(ctx,shape){return _regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:return _context18.abrupt(\"return\",new Promise(function(resolve,reject){ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop\n// 1 is default value for lineWidth prop\nctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;ctx.ellipse(shape.x,shape.y,shape.rx,shape.ry,0,0,Math.PI*2);shape.backgroundColor&&ctx.fill();if(shape.backgroundImage){shapeLoadResources(shape,function(error,image){if(error)return reject(error);ctx.drawImage(image.backgroundImageElement,shape.x,shape.y,shape.width,shape.height);shape.strokeWidth&&ctx.stroke();resolve([]);});}else{shape.strokeWidth&&ctx.stroke();}resolve([]);}));case 1:case\"end\":return _context18.stop();}}},_callee18);}));return function drawEllipse(_x28,_x29){return _ref23.apply(this,arguments);};}();var drawText$1=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee19(ctx,shape){var size,rect,tx;return _regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:size=shape.width&&shape.height?sizeCreateFromAny(shape):textSize(shape.text,shape);rect={x:shape.x,y:shape.y,width:shape.width||size.width,height:size.height};drawRect(ctx,_objectSpread(_objectSpread({},shape),rect));updateTextContext(ctx,shape);tx=0;if(shape.textAlign=='center'){tx=-textPadding*0.5;}else if(shape.textAlign==='right'){tx=-textPadding;}ctx.rect(shape.x+tx,shape.y,shape.width+textPadding*2,shape.height);ctx.save();ctx.clip();drawText(ctx,shape.width?wrapText(ctx,shape.text,shape.width):shape.text,{x:shape.x,y:shape.y,fontSize:shape.fontSize,textAlign:shape.textAlign,lineHeight:shape.lineHeight,lineWidth:shape.width});ctx.restore();return _context19.abrupt(\"return\",[]);case 12:case\"end\":return _context19.stop();}}},_callee19);}));return function drawText$1(_x30,_x31){return _ref24.apply(this,arguments);};}();var drawLine=/*#__PURE__*/function(){var _ref25=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee21(ctx,shape){return _regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:return _context21.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref26=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee20(resolve,reject){var lineStartPosition,lineEndPosition,lineStartDescription,lineEndDescription;return _regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop\n// 1 is default value for lineWidth prop\nctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.globalAlpha=shape.opacity;lineStartPosition=shapeLineGetStartPoint(shape);lineEndPosition=shapeLineGetEndPoint(shape);lineStartDescription=shape.lineStart&&shapeComputeLineEnd(lineStartPosition,shape.strokeWidth,shape.strokeColor,shape.lineStart,vectorCreate(lineEndPosition.x-lineStartPosition.x,lineEndPosition.y-lineStartPosition.y));lineEndDescription=shape.lineEnd&&shapeComputeLineEnd(lineEndPosition,shape.strokeWidth,shape.strokeColor,shape.lineEnd,vectorCreate(lineStartPosition.x-lineEndPosition.x,lineStartPosition.y-lineEndPosition.y));// update start and end position of line if required to draw caps\n// update start and end position of line if required to draw caps\nlineStartPosition=lineStartDescription?lineStartDescription.position:lineStartPosition;lineEndPosition=lineEndDescription?lineEndDescription.position:lineEndPosition;// draw line\n// draw line\nctx.moveTo(lineStartPosition.x,lineStartPosition.y);ctx.lineTo(lineEndPosition.x,lineEndPosition.y);shape.strokeWidth&&ctx.stroke();// draw other shapes\n// draw other shapes\nresolve([lineStartDescription&&lineStartDescription.shape,lineEndDescription&&lineEndDescription.shape].filter(Boolean));case 13:case\"end\":return _context20.stop();}}},_callee20);}));return function(_x34,_x35){return _ref26.apply(this,arguments);};}()));case 1:case\"end\":return _context21.stop();}}},_callee21);}));return function drawLine(_x32,_x33){return _ref25.apply(this,arguments);};}();var drawPath=/*#__PURE__*/function(){var _ref27=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee22(ctx,shape){return _regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:return _context22.abrupt(\"return\",new Promise(function(resolve,reject){ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop\n// 1 is default value for lineWidth prop\nctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;// draw line\n// draw line\nvar points=shape.points;ctx.moveTo(points[0].x,points[0].y);var l=points.length;for(var i=1;i<l;i++){ctx.lineTo(points[i].x,points[i].y);}shape.strokeWidth&&ctx.stroke();shape.backgroundColor&&ctx.fill();resolve([]);}));case 1:case\"end\":return _context22.stop();}}},_callee22);}));return function drawPath(_x36,_x37){return _ref27.apply(this,arguments);};}();var ctxFlip=function ctxFlip(ctx,flipX,flipY,pivot){if(!flipX&&!flipY)return ctx;ctx.translate(pivot.x,pivot.y);ctx.scale(flipX?-1:1,flipY?-1:1);ctx.translate(-pivot.x,-pivot.y);return ctx;};var drawShape=/*#__PURE__*/function(){var _ref28=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee23(ctx,shape){var center,fn;return _regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:// center, needed for transforms\ncenter=shapeGetCenter(shape);// rotate context\nctxRotate(ctx,shape.rotation,center);// flip context\nctxFlip(ctx,shape.flipX,shape.flipY,center);if(shapeIsRect(shape)){fn=drawRect;}else if(shapeIsEllipse(shape)){fn=drawEllipse;}else if(shapeIsLine(shape)){fn=drawLine;}else if(shapeIsPath(shape)){fn=drawPath;}else if(shapeIsText(shape)){fn=drawText$1;}// get shapes\n_context23.t0=[shape];_context23.t1=_toConsumableArray;_context23.t2=drawShapes;_context23.t3=ctx;_context23.next=10;return fn(ctx,shape);case 10:_context23.t4=_context23.sent;_context23.next=13;return(0,_context23.t2)(_context23.t3,_context23.t4);case 13:_context23.t5=_context23.sent;_context23.t6=(0,_context23.t1)(_context23.t5);return _context23.abrupt(\"return\",_context23.t0.concat.call(_context23.t0,_context23.t6));case 16:case\"end\":return _context23.stop();}}},_callee23);}));return function drawShape(_x38,_x39){return _ref28.apply(this,arguments);};}();var drawShapes=/*#__PURE__*/function(){var _ref29=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee24(ctx,shapes){var drawnShapes,_iterator,_step,shape;return _regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:drawnShapes=[];_iterator=_createForOfIteratorHelper(shapes);_context24.prev=2;_iterator.s();case 4:if((_step=_iterator.n()).done){_context24.next=19;break;}shape=_step.value;ctx.save();// clears previous shape's path\nctx.beginPath();// wait for shape to draw before drawing next shape\n_context24.t0=[];_context24.t1=_toConsumableArray(drawnShapes);_context24.t2=_toConsumableArray;_context24.next=13;return drawShape(ctx,shape);case 13:_context24.t3=_context24.sent;_context24.t4=(0,_context24.t2)(_context24.t3);drawnShapes=_context24.t0.concat.call(_context24.t0,_context24.t1,_context24.t4);ctx.restore();case 17:_context24.next=4;break;case 19:_context24.next=24;break;case 21:_context24.prev=21;_context24.t5=_context24[\"catch\"](2);_iterator.e(_context24.t5);case 24:_context24.prev=24;_iterator.f();return _context24.finish(24);case 27:return _context24.abrupt(\"return\",drawnShapes);case 28:case\"end\":return _context24.stop();}}},_callee24,null,[[2,21,24,27]]);}));return function drawShapes(_x40,_x41){return _ref29.apply(this,arguments);};}();var drawImageData=/*#__PURE__*/function(){var _ref30=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee25(imageData){var options,_options$shapes,shapes,_options$context,context,_options$transform,transform,imageDataOut,canvas,ctx,computedShapes,_args25=arguments;return _regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:options=_args25.length>1&&_args25[1]!==undefined?_args25[1]:{};_options$shapes=options.shapes,shapes=_options$shapes===void 0?[]:_options$shapes,_options$context=options.context,context=_options$context===void 0?imageData:_options$context,_options$transform=options.transform,transform=_options$transform===void 0?noop:_options$transform;// no shapes to draw\nif(shapes.length){_context25.next=4;break;}return _context25.abrupt(\"return\",imageData);case 4:// create drawing context\ncanvas=h('canvas');canvas.width=imageData.width;canvas.height=imageData.height;ctx=canvas.getContext('2d');ctx.putImageData(imageData,0,0);// compute the position of all shapes\ncomputedShapes=shapes.map(shapeDeepCopy).map(function(shape){return shapeComputeDisplay(shape,{x:0,y:0,width:context.width,height:context.height});});// compute transforms for all shapes\ntransform(ctx);// draw shapes to canvas\n_context25.next=13;return drawShapes(ctx,computedShapes);case 13:imageDataOut=ctx.getImageData(0,0,canvas.width,canvas.height);releaseCanvas(canvas);return _context25.abrupt(\"return\",imageDataOut);case 16:case\"end\":return _context25.stop();}}},_callee25);}));return function drawImageData(_x42){return _ref30.apply(this,arguments);};}();var fillImageData=/*#__PURE__*/function(){var _ref31=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee26(imageData){var options,backgroundColor,imageDataOut,image,ctx,_args26=arguments;return _regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:options=_args26.length>1&&_args26[1]!==undefined?_args26[1]:{};backgroundColor=options.backgroundColor;// no background color set or is fully transparent background color\nif(!(!backgroundColor||backgroundColor&&backgroundColor[3]===0)){_context26.next=4;break;}return _context26.abrupt(\"return\",imageData);case 4:image=h('canvas');image.width=imageData.width;image.height=imageData.height;ctx=image.getContext('2d');ctx.putImageData(imageData,0,0);// fill behind image\nctx.globalCompositeOperation='destination-over';ctx.fillStyle=colorArrayToRGBA(backgroundColor);ctx.fillRect(0,0,image.width,image.height);imageDataOut=ctx.getImageData(0,0,image.width,image.height);releaseCanvas(image);return _context26.abrupt(\"return\",imageDataOut);case 15:case\"end\":return _context26.stop();}}},_callee26);}));return function fillImageData(_x43){return _ref31.apply(this,arguments);};}();var dotColorMatrix=function dotColorMatrix(a,b){var res=new Array(20);// R\nres[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];res[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];res[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];res[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];res[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];// G\nres[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];res[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];res[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];res[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];res[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];// B\nres[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];res[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];res[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];res[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];res[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];// A\nres[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];res[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];res[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];res[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];res[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return res;};var getColorMatrixFromColorMatrices=function getColorMatrixFromColorMatrices(colorMatrices){return colorMatrices.length?colorMatrices.reduce(function(previous,current){return dotColorMatrix(_toConsumableArray(previous),current);},colorMatrices.shift()):[];};// connect function in process chain\nvar connect=function connect(fn){var getter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return args;};var setter=arguments.length>2?arguments[2]:undefined;return/*#__PURE__*/function(){var _ref32=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee27(state,options,onprogress){var res,progressUpdated;return _regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:// will hold function result\n// at this point we don't know if the length of this task can be computed\nonprogress(createProgressEvent(0,false));// try to run the function\nprogressUpdated=false;_context27.prev=2;_context27.next=5;return fn.apply(void 0,_toConsumableArray(getter(state,options,function(event){progressUpdated=true;onprogress(event);})));case 5:res=_context27.sent;_context27.next=11;break;case 8:_context27.prev=8;_context27.t0=_context27[\"catch\"](2);throw _context27.t0;case 11:// a setter isn't required\nsetter&&setter(state,res);// if progress was updated, we expect the connected function to fire the 1/1 event, else we fire it here\nif(!progressUpdated)onprogress(createProgressEvent(1,false));return _context27.abrupt(\"return\",state);case 14:case\"end\":return _context27.stop();}}},_callee27,null,[[2,8]]);}));return function(_x44,_x45,_x46){return _ref32.apply(this,arguments);};}();};//\n// Reader/Writer Presets\n//\nvar AnyToFile=function AnyToFile(){var _ref33=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref33$srcProp=_ref33.srcProp,srcProp=_ref33$srcProp===void 0?'src':_ref33$srcProp,_ref33$destProp=_ref33.destProp,destProp=_ref33$destProp===void 0?'dest':_ref33$destProp;return[connect(srcToFile,function(state,options,onprogress){return[state[srcProp],onprogress];},function(state,file){return state[destProp]=file;}),'any-to-file'];};var BlobReadImageSize=function BlobReadImageSize(){var _ref34=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref34$srcProp=_ref34.srcProp,srcProp=_ref34$srcProp===void 0?'src':_ref34$srcProp,_ref34$destProp=_ref34.destProp,destProp=_ref34$destProp===void 0?'size':_ref34$destProp;return[connect(getImageSize,function(state,options){return[state[srcProp]];},function(state,size){return state[destProp]=size;}),'read-image-size'];};var ImageSizeMatchOrientation=function ImageSizeMatchOrientation(){var _ref35=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref35$srcSize=_ref35.srcSize,srcSize=_ref35$srcSize===void 0?'size':_ref35$srcSize,_ref35$srcOrientation=_ref35.srcOrientation,srcOrientation=_ref35$srcOrientation===void 0?'orientation':_ref35$srcOrientation,_ref35$destSize=_ref35.destSize,destSize=_ref35$destSize===void 0?'size':_ref35$destSize;return[connect(orientImageSize,function(state){return[state[srcSize],state[srcOrientation]];},function(state,size){return state[destSize]=size;}),'image-size-match-orientation'];};var BlobReadImageHead=function BlobReadImageHead(){var _ref36=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref36$srcProp=_ref36.srcProp,srcProp=_ref36$srcProp===void 0?'src':_ref36$srcProp,_ref36$destProp=_ref36.destProp,destProp=_ref36$destProp===void 0?'head':_ref36$destProp;return[connect(function(blob,slice){return isJPEG(blob)?blobReadSection(blob,slice):undefined;},// 64 * 1024 should be enough bytes to find orientation header in next step\n// Exif metadata are restricted in size to 64 kB in JPEG images because according to the specification this information must be contained within a single JPEG APP1 segment.\nfunction(state){return[state[srcProp],[0,64*1024],onprogress];},function(state,head){return state[destProp]=head;}),'read-image-head'];};var ImageHeadReadExifOrientationTag=function ImageHeadReadExifOrientationTag(){var _ref37=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref37$srcProp=_ref37.srcProp,srcProp=_ref37$srcProp===void 0?'head':_ref37$srcProp,_ref37$destProp=_ref37.destProp,destProp=_ref37$destProp===void 0?'orientation':_ref37$destProp;return[connect(arrayBufferReadExifOrientationTag,function(state){return[state[srcProp]];},function(state,orientation){return state[destProp]=orientation;}),'read-exif-orientation-tag'];};var ImageHeadClearExifOrientationTag=function ImageHeadClearExifOrientationTag(){var _ref38=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref38$srcProp=_ref38.srcProp,srcProp=_ref38$srcProp===void 0?'head':_ref38$srcProp;return[connect(arrayBufferWriteExifOrientationTag,function(state){return[state[srcProp],1];}),'clear-exif-orientation-tag'];};var ApplyCanvasScalar=function ApplyCanvasScalar(){var _ref39=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref39$srcImageSize=_ref39.srcImageSize,srcImageSize=_ref39$srcImageSize===void 0?'size':_ref39$srcImageSize,_ref39$srcCanvasSize=_ref39.srcCanvasSize,srcCanvasSize=_ref39$srcCanvasSize===void 0?'imageData':_ref39$srcCanvasSize,_ref39$srcImageState=_ref39.srcImageState,srcImageState=_ref39$srcImageState===void 0?'imageState':_ref39$srcImageState,_ref39$destImageSize=_ref39.destImageSize,destImageSize=_ref39$destImageSize===void 0?'size':_ref39$destImageSize,_ref39$destScalar=_ref39.destScalar,destScalar=_ref39$destScalar===void 0?'scalar':_ref39$destScalar;return[connect(function(naturalSize,canvasSize,imageState){// calculate canvas scalar\nvar scalar=Math.min(canvasSize.width/naturalSize.width,canvasSize.height/naturalSize.height);// done because not scaling\nif(scalar!==1){var crop=imageState.crop,annotation=imageState.annotation,decoration=imageState.decoration;// origin to scale to\nvar origin=vectorCreateEmpty();// scale select.crop\nif(crop)imageState.crop=rectScale(crop,scalar,origin);// scale annotation\nvar translate=vectorCreateEmpty();imageState.annotation=annotation.map(function(shape){return shapeComputeTransform(shape,translate,scalar);});// scale decoration\nimageState.decoration=decoration.map(function(shape){return shapeComputeTransform(shape,translate,scalar);});}return[scalar,sizeCreateFromAny(canvasSize)];},function(state){return[state[srcImageSize],state[srcCanvasSize],state[srcImageState]];},function(state,_ref40){var _ref41=_slicedToArray(_ref40,2),scalar=_ref41[0],imageSize=_ref41[1];state[destScalar]=scalar;state[destImageSize]=imageSize;}),'calculate-canvas-scalar'];};var BlobToImageData=function BlobToImageData(_ref42){var _ref42$srcProp=_ref42.srcProp,srcProp=_ref42$srcProp===void 0?'src':_ref42$srcProp,_ref42$destProp=_ref42.destProp,destProp=_ref42$destProp===void 0?'imageData':_ref42$destProp,_ref42$canvasMemoryLi=_ref42.canvasMemoryLimit,canvasMemoryLimit=_ref42$canvasMemoryLi===void 0?undefined:_ref42$canvasMemoryLi;return[connect(blobToImageData,function(state){return[state[srcProp],canvasMemoryLimit];},function(state,imageData){return state[destProp]=imageData;}),'blob-to-image-data'];};var ImageDataMatchOrientation=function ImageDataMatchOrientation(){var _ref43=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref43$srcImageData=_ref43.srcImageData,srcImageData=_ref43$srcImageData===void 0?'imageData':_ref43$srcImageData,_ref43$srcOrientation=_ref43.srcOrientation,srcOrientation=_ref43$srcOrientation===void 0?'orientation':_ref43$srcOrientation;return[connect(orientImageData,function(state){return[state[srcImageData],state[srcOrientation]];},function(state,imageData){return state.imageData=imageData;}),'image-data-match-orientation'];};var ImageDataFill=function ImageDataFill(){var _ref44=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref44$srcImageData=_ref44.srcImageData,srcImageData=_ref44$srcImageData===void 0?'imageData':_ref44$srcImageData,_ref44$srcImageState=_ref44.srcImageState,srcImageState=_ref44$srcImageState===void 0?'imageState':_ref44$srcImageState;return[connect(fillImageData,function(state){return[state[srcImageData],{backgroundColor:state[srcImageState].backgroundColor}];},function(state,imageData){return state.imageData=imageData;}),'image-data-fill'];};var ImageDataCrop=function ImageDataCrop(){var _ref45=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref45$srcImageData=_ref45.srcImageData,srcImageData=_ref45$srcImageData===void 0?'imageData':_ref45$srcImageData,_ref45$srcImageState=_ref45.srcImageState,srcImageState=_ref45$srcImageState===void 0?'imageState':_ref45$srcImageState;return[connect(cropImageData,function(state){return[state[srcImageData],{crop:state[srcImageState].crop,rotation:state[srcImageState].rotation,flipX:state[srcImageState].flipX,flipY:state[srcImageState].flipY}];},function(state,imageData){return state.imageData=imageData;}),'image-data-crop'];};var ImageDataResize=function ImageDataResize(_ref46){var _ref46$resize=_ref46.resize,resize=_ref46$resize===void 0?{width:undefined,height:undefined,fit:undefined,upscale:undefined}:_ref46$resize,_ref46$srcProp=_ref46.srcProp,srcProp=_ref46$srcProp===void 0?'imageData':_ref46$srcProp,_ref46$srcImageState=_ref46.srcImageState,srcImageState=_ref46$srcImageState===void 0?'imageState':_ref46$srcImageState,_ref46$destImageScale=_ref46.destImageScaledSize,destImageScaledSize=_ref46$destImageScale===void 0?'imageScaledSize':_ref46$destImageScale;return[connect(resizeImageData,function(state){return[state[srcProp],{width:Math.min(resize.width||Number.MAX_SAFE_INTEGER,state[srcImageState].targetSize&&state[srcImageState].targetSize.width||Number.MAX_SAFE_INTEGER),height:Math.min(resize.height||Number.MAX_SAFE_INTEGER,state[srcImageState].targetSize&&state[srcImageState].targetSize.height||Number.MAX_SAFE_INTEGER),fit:resize.fit||'contain',upscale:resize.upscale||false}];},function(state,imageData){if(!sizeEqual(state.imageData,imageData))state[destImageScaledSize]=sizeCreateFromAny(imageData);state.imageData=imageData;}),'image-data-resize'];};var ImageDataFilter=function ImageDataFilter(){var _ref47=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref47$srcImageData=_ref47.srcImageData,srcImageData=_ref47$srcImageData===void 0?'imageData':_ref47$srcImageData,_ref47$srcImageState=_ref47.srcImageState,srcImageState=_ref47$srcImageState===void 0?'imageState':_ref47$srcImageState,_ref47$destImageData=_ref47.destImageData,destImageData=_ref47$destImageData===void 0?'imageData':_ref47$destImageData;return[connect(filterImageData,function(state){var colorMatrix=state[srcImageState].colorMatrix;var colorMatrices=colorMatrix&&Object.keys(colorMatrix).map(function(name){return colorMatrix[name];}).filter(Boolean);return[state[srcImageData],{colorMatrix:colorMatrices&&getColorMatrixFromColorMatrices(colorMatrices),convolutionMatrix:state[srcImageState].convolutionMatrix,gamma:state[srcImageState].gamma,noise:state[srcImageState].noise,vignette:state[srcImageState].vignette}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-filter'];};var ImageDataAnnotate=function ImageDataAnnotate(){var _ref48=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref48$srcImageData=_ref48.srcImageData,srcImageData=_ref48$srcImageData===void 0?'imageData':_ref48$srcImageData,_ref48$srcSize=_ref48.srcSize,srcSize=_ref48$srcSize===void 0?'size':_ref48$srcSize,_ref48$srcImageState=_ref48.srcImageState,srcImageState=_ref48$srcImageState===void 0?'imageState':_ref48$srcImageState,_ref48$destImageData=_ref48.destImageData,destImageData=_ref48$destImageData===void 0?'imageData':_ref48$destImageData,_ref48$destImageScale=_ref48.destImageScaledSize,destImageScaledSize=_ref48$destImageScale===void 0?'imageScaledSize':_ref48$destImageScale;return[connect(drawImageData,function(state){return[state[srcImageData],{shapes:state[srcImageState].annotation,context:state[srcSize],transform:function transform(ctx){var imageSize=state[srcSize];var _state$srcImageState=state[srcImageState],_state$srcImageState$=_state$srcImageState.crop,crop=_state$srcImageState$===void 0?rectCreateFromSize(imageSize):_state$srcImageState$,_state$srcImageState$2=_state$srcImageState.rotation,rotation=_state$srcImageState$2===void 0?0:_state$srcImageState$2,flipX=_state$srcImageState.flipX,flipY=_state$srcImageState.flipY;var rotatedRect=getImageTransformedRect(imageSize,rotation);var rotatedSize={width:rotatedRect.width,height:rotatedRect.height};// calculate image scalar so we can scale annotations accordingly\nvar scaledSize=state[destImageScaledSize];var scalar=scaledSize?Math.min(scaledSize.width/crop.width,scaledSize.height/crop.height):1;// calculate center\nvar dx=imageSize.width*0.5-rotatedSize.width*0.5;var dy=imageSize.height*0.5-rotatedSize.height*0.5;var center=sizeCenter(imageSize);// image scalar\nctx.scale(scalar,scalar);// offset\nctx.translate(-dx,-dy);ctx.translate(-crop.x,-crop.y);// rotation\nctx.translate(center.x,center.y);ctx.rotate(rotation);ctx.translate(-center.x,-center.y);// flipping\nctx.scale(flipX?-1:1,flipY?-1:1);ctx.translate(flipX?-imageSize.width:0,flipY?-imageSize.height:0);// annotations are clipped clip to image\nctx.rect(0,0,imageSize.width,imageSize.height);ctx.clip();}}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-annotate'];};var ImageDataDecorate=function ImageDataDecorate(){var _ref49=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref49$srcImageData=_ref49.srcImageData,srcImageData=_ref49$srcImageData===void 0?'imageData':_ref49$srcImageData,_ref49$srcImageState=_ref49.srcImageState,srcImageState=_ref49$srcImageState===void 0?'imageState':_ref49$srcImageState,_ref49$destImageData=_ref49.destImageData,destImageData=_ref49$destImageData===void 0?'imageData':_ref49$destImageData,_ref49$destImageScale=_ref49.destImageScaledSize,destImageScaledSize=_ref49$destImageScale===void 0?'imageScaledSize':_ref49$destImageScale;return[connect(drawImageData,function(state){return[state[srcImageData],{shapes:state[srcImageState].decoration,context:state[srcImageState].crop,transform:function transform(ctx){// calculate image scalar so we can scale decoration accordingly\nvar crop=state.imageState.crop;var scaledSize=state[destImageScaledSize];var scalar=scaledSize?Math.min(scaledSize.width/crop.width,scaledSize.height/crop.height):1;ctx.scale(scalar,scalar);}}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-decorate'];};var ImageDataToBlob=function ImageDataToBlob(){var _ref50=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref50$mimeType=_ref50.mimeType,mimeType=_ref50$mimeType===void 0?undefined:_ref50$mimeType,_ref50$quality=_ref50.quality,quality=_ref50$quality===void 0?undefined:_ref50$quality,_ref50$srcImageData=_ref50.srcImageData,srcImageData=_ref50$srcImageData===void 0?'imageData':_ref50$srcImageData,_ref50$srcFile=_ref50.srcFile,srcFile=_ref50$srcFile===void 0?'src':_ref50$srcFile,_ref50$destBlob=_ref50.destBlob,destBlob=_ref50$destBlob===void 0?'blob':_ref50$destBlob;return[connect(imageDataToBlob,function(state){return[state[srcImageData],mimeType||getMimeTypeFromFilename(state[srcFile].name)||state[srcFile].type,quality];},function(state,blob){return state[destBlob]=blob;}),'image-data-to-blob'];};var BlobWriteImageHead=function BlobWriteImageHead(){var srcBlob=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'blob';var srcHead=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'head';var destBlob=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'blob';return[connect(function(blob,head){return isJPEG(blob)&&head?blobWriteSection(blob,arrayBufferReadImageHead(head),// location and size of the JPEG header\n[20]):blob;},function(state){return[state[srcBlob],state[srcHead]];},function(state,blob){return state[destBlob]=blob;}),'blob-write-image-head'];};var BlobToFile=function BlobToFile(){var _ref51=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref51$renameFile=_ref51.renameFile,renameFile=_ref51$renameFile===void 0?undefined:_ref51$renameFile,_ref51$srcBlob=_ref51.srcBlob,srcBlob=_ref51$srcBlob===void 0?'blob':_ref51$srcBlob,_ref51$srcFile=_ref51.srcFile,srcFile=_ref51$srcFile===void 0?'src':_ref51$srcFile,_ref51$destFile=_ref51.destFile,destFile=_ref51$destFile===void 0?'dest':_ref51$destFile,_ref51$defaultFilenam=_ref51.defaultFilename,defaultFilename=_ref51$defaultFilenam===void 0?undefined:_ref51$defaultFilenam;return[connect(blobToFile,function(state){return[state[srcBlob],renameFile?renameFile(state[srcFile]):state[srcFile].name||\"\".concat(defaultFilename,\".\").concat(getExtensionFromMimeType(state[srcBlob].type))];},function(state,file){return state[destFile]=file;}),'blob-to-file'];};var Store=function Store(_ref52){var _ref52$url=_ref52.url,url=_ref52$url===void 0?'./':_ref52$url,_ref52$dataset=_ref52.dataset,dataset=_ref52$dataset===void 0?function(state){return[['dest',state.dest,state.dest.name],['imageState',state.imageState]];}:_ref52$dataset,_ref52$destStore=_ref52.destStore,destStore=_ref52$destStore===void 0?'store':_ref52$destStore;return[connect(/*#__PURE__*/ // upload function\nfunction(){var _ref53=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee28(dataset,onprogress){return _regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:_context28.prev=0;_context28.next=3;return post(url,dataset,{onprogress:onprogress});case 3:return _context28.abrupt(\"return\",_context28.sent);case 6:_context28.prev=6;_context28.t0=_context28[\"catch\"](0);throw _context28.t0;case 9:case\"end\":return _context28.stop();}}},_callee28,null,[[0,6]]);}));return function(_x47,_x48){return _ref53.apply(this,arguments);};}(),// get state values\nfunction(state,options,onprogress){return[dataset(state),onprogress];},// set state values\nfunction(state,xhr){return state[destStore]=xhr;}// logs XHR request returned by `post`\n),'store'];};var PropFilter=function PropFilter(allowlist){return[connect(function(state){// if no allowlist suppleid or is empty array we don't filter\nif(!allowlist||!allowlist.length)return state;// else we only allow the props defined in the list and delete non matching props\nObject.keys(state).forEach(function(key){if(allowlist.includes(key))return;delete state[key];});return state;}),'prop-filter'];};// Generic image reader, suitable for most use cases\nvar createDefaultImageReader=function createDefaultImageReader(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$orientImage=options.orientImage,orientImage=_options$orientImage===void 0?true:_options$orientImage,_options$outputProps=options.outputProps,outputProps=_options$outputProps===void 0?['src','dest','size']:_options$outputProps,preprocessImageFile=options.preprocessImageFile;return[// can read most source files and turn them into blobs\nAnyToFile(),// TODO: test if supported mime/type\n// called when file created, can be used to read unrecognized files\npreprocessImageFile&&[connect(preprocessImageFile,function(state,options,onprogress){return[state.dest,options,onprogress];},function(state,file){return state.dest=file;}),'preprocess-image-file'],// quickly read size (only reads first part of image)\nBlobReadImageSize({srcProp:'dest'}),// fix image orientation\norientImage&&BlobReadImageHead({srcProp:'dest'}),orientImage&&ImageHeadReadExifOrientationTag(),orientImage&&ImageSizeMatchOrientation(),// remove unwanted props\nPropFilter(outputProps)].filter(Boolean);};// Generic image writer, suitable for most use cases\nvar createDefaultImageWriter=function createDefaultImageWriter(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$canvasMemory=options.canvasMemoryLimit,canvasMemoryLimit=_options$canvasMemory===void 0?isIOS()?4096*4096:Infinity:_options$canvasMemory,_options$orientImage2=options.orientImage,orientImage=_options$orientImage2===void 0?true:_options$orientImage2,_options$copyImageHea=options.copyImageHead,copyImageHead=_options$copyImageHea===void 0?true:_options$copyImageHea,_options$mimeType=options.mimeType,mimeType=_options$mimeType===void 0?undefined:_options$mimeType,_options$quality=options.quality,quality=_options$quality===void 0?undefined:_options$quality,_options$renameFile=options.renameFile,renameFile=_options$renameFile===void 0?undefined:_options$renameFile,_options$targetSize=options.targetSize,targetSize=_options$targetSize===void 0?undefined:_options$targetSize,_options$store=options.store,store=_options$store===void 0?undefined:_options$store,_options$outputProps2=options.outputProps,outputProps=_options$outputProps2===void 0?['src','dest','imageState','store']:_options$outputProps2,preprocessImageState=options.preprocessImageState,postprocessImageData=options.postprocessImageData;return[// get orientation info (if is jpeg)\n(orientImage||copyImageHead)&&BlobReadImageHead(),orientImage&&ImageHeadReadExifOrientationTag(),// get image size\nBlobReadImageSize(),// allow preproccesing of image state for example to replace placeholders\npreprocessImageState&&[connect(preprocessImageState,function(state,options,onprogress){return[state.imageState,options,onprogress];},function(state,imageState){return state.imageState=imageState;}),'preprocess-image-state'],// get image data\nBlobToImageData({canvasMemoryLimit:canvasMemoryLimit}),// get canvas scalar for when scaled down\nApplyCanvasScalar(),// fix image orientation\norientImage&&ImageSizeMatchOrientation(),orientImage&&ImageDataMatchOrientation(),// apply image state\nImageDataCrop(),ImageDataResize({resize:targetSize}),ImageDataFilter(),ImageDataFill(),ImageDataAnnotate(),ImageDataDecorate(),// run post processing on image data, for example to apply circular crop\npostprocessImageData&&[connect(postprocessImageData,function(state,options,onprogress){return[state.imageData,options,onprogress];},function(state,imageData){return state.imageData=imageData;}),'postprocess-image-data'],// convert to file\nImageDataToBlob({mimeType:mimeType,quality:quality}),// we overwite the exif orientation tag so the image is oriented correctly\norientImage&&ImageHeadClearExifOrientationTag(),// we write the new image head to the target blob\ncopyImageHead&&BlobWriteImageHead(),// turn the image blob into a file, will also rename the file\nBlobToFile({defaultFilename:'image',renameFile:renameFile}),// upload or process data\nstore&&(isString(store)?// a basic store to post to\nStore({url:store}):// see if is fully custom or store config\nisFunction(store)?// fully custom store function\n[store,'store']:// a store configuration object\nStore(store)),// remove unwanted props\nPropFilter(outputProps)].filter(Boolean);};function noop$1(){}var identity=function identity(x){return x;};function assign(tar,src){// @ts-ignore\nfor(var k in src){tar[k]=src[k];}return tar;}function run(fn){return fn();}function blank_object(){return Object.create(null);}function run_all(fns){fns.forEach(run);}function is_function(thing){return typeof thing==='function';}function safe_not_equal(a,b){return a!=a?b==b:a!==b||a&&typeof a==='object'||typeof a==='function';}function is_empty(obj){return Object.keys(obj).length===0;}function subscribe(store){if(store==null){return noop$1;}for(var _len3=arguments.length,callbacks=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){callbacks[_key3-1]=arguments[_key3];}var unsub=store.subscribe.apply(store,callbacks);return unsub.unsubscribe?function(){return unsub.unsubscribe();}:unsub;}function get_store_value(store){var value;subscribe(store,function(_){return value=_;})();return value;}function component_subscribe(component,store,callback){component.$$.on_destroy.push(subscribe(store,callback));}function create_slot(definition,ctx,$$scope,fn){if(definition){var slot_ctx=get_slot_context(definition,ctx,$$scope,fn);return definition[0](slot_ctx);}}function get_slot_context(definition,ctx,$$scope,fn){return definition[1]&&fn?assign($$scope.ctx.slice(),definition[1](fn(ctx))):$$scope.ctx;}function get_slot_changes(definition,$$scope,dirty,fn){if(definition[2]&&fn){var lets=definition[2](fn(dirty));if($$scope.dirty===undefined){return lets;}if(typeof lets==='object'){var merged=[];var len=Math.max($$scope.dirty.length,lets.length);for(var i=0;i<len;i+=1){merged[i]=$$scope.dirty[i]|lets[i];}return merged;}return $$scope.dirty|lets;}return $$scope.dirty;}function update_slot(slot,slot_definition,ctx,$$scope,dirty,get_slot_changes_fn,get_slot_context_fn){var slot_changes=get_slot_changes(slot_definition,$$scope,dirty,get_slot_changes_fn);if(slot_changes){var slot_context=get_slot_context(slot_definition,ctx,$$scope,get_slot_context_fn);slot.p(slot_context,slot_changes);}}function exclude_internal_props(props){var result={};for(var k in props){if(k[0]!=='$')result[k]=props[k];}return result;}function set_store_value(store,ret){var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ret;store.set(value);return ret;}function action_destroyer(action_result){return action_result&&is_function(action_result.destroy)?action_result.destroy:noop$1;}var is_client=true;var now=is_client?function(){return window.performance.now();}:function(){return Date.now();};var raf=is_client?function(cb){return requestAnimationFrame(cb);}:noop$1;var tasks=new Set();function run_tasks(now){tasks.forEach(function(task){if(!task.c(now)){tasks[\"delete\"](task);task.f();}});if(tasks.size!==0)raf(run_tasks);}/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n */function loop(callback){var task;if(tasks.size===0)raf(run_tasks);return{promise:new Promise(function(fulfill){tasks.add(task={c:callback,f:fulfill});}),abort:function abort(){tasks[\"delete\"](task);}};}function append(target,node){target.appendChild(node);}function insert(target,node,anchor){target.insertBefore(node,anchor||null);}function detach(node){node.parentNode.removeChild(node);}function element(name){return document.createElement(name);}function svg_element(name){return document.createElementNS('http://www.w3.org/2000/svg',name);}function text(data){return document.createTextNode(data);}function space(){return text(' ');}function empty(){return text('');}function listen(node,event,handler,options){node.addEventListener(event,handler,options);return function(){return node.removeEventListener(event,handler,options);};}function prevent_default(fn){return function(event){event.preventDefault();// @ts-ignore\nreturn fn.call(this,event);};}function stop_propagation(fn){return function(event){event.stopPropagation();// @ts-ignore\nreturn fn.call(this,event);};}function attr(node,attribute,value){if(value==null)node.removeAttribute(attribute);else if(node.getAttribute(attribute)!==value)node.setAttribute(attribute,value);}function set_attributes(node,attributes){// @ts-ignore\nvar descriptors=Object.getOwnPropertyDescriptors(node.__proto__);for(var key in attributes){if(attributes[key]==null){node.removeAttribute(key);}else if(key==='style'){node.style.cssText=attributes[key];}else if(key==='__value'){node.value=node[key]=attributes[key];}else if(descriptors[key]&&descriptors[key].set){node[key]=attributes[key];}else{attr(node,key,attributes[key]);}}}function children(element){return Array.from(element.childNodes);}function set_data(text,data){data=''+data;if(text.wholeText!==data)text.data=data;}function set_input_value(input,value){input.value=value==null?'':value;}function set_style(node,key,value,important){node.style.setProperty(key,value,important?'important':'');}function custom_event(type,detail){var e=document.createEvent('CustomEvent');e.initCustomEvent(type,false,false,detail);return e;}var active_docs=new Set();var active=0;// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str){var hash=5381;var i=str.length;while(i--){hash=(hash<<5)-hash^str.charCodeAt(i);}return hash>>>0;}function create_rule(node,a,b,duration,delay,ease,fn){var uid=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var step=16.666/duration;var keyframes='{\\n';for(var p=0;p<=1;p+=step){var t=a+(b-a)*ease(p);keyframes+=p*100+\"%{\".concat(fn(t,1-t),\"}\\n\");}var rule=keyframes+\"100% {\".concat(fn(b,1-b),\"}\\n}\");var name=\"__svelte_\".concat(hash(rule),\"_\").concat(uid);var doc=node.ownerDocument;active_docs.add(doc);var stylesheet=doc.__svelte_stylesheet||(doc.__svelte_stylesheet=doc.head.appendChild(element('style')).sheet);var current_rules=doc.__svelte_rules||(doc.__svelte_rules={});if(!current_rules[name]){current_rules[name]=true;stylesheet.insertRule(\"@keyframes \".concat(name,\" \").concat(rule),stylesheet.cssRules.length);}var animation=node.style.animation||'';node.style.animation=\"\".concat(animation?\"\".concat(animation,\", \"):'').concat(name,\" \").concat(duration,\"ms linear \").concat(delay,\"ms 1 both\");active+=1;return name;}function delete_rule(node,name){var previous=(node.style.animation||'').split(', ');var next=previous.filter(name?function(anim){return anim.indexOf(name)<0;}// remove specific animation\n:function(anim){return anim.indexOf('__svelte')===-1;}// remove all Svelte animations\n);var deleted=previous.length-next.length;if(deleted){node.style.animation=next.join(', ');active-=deleted;if(!active)clear_rules();}}function clear_rules(){raf(function(){if(active)return;active_docs.forEach(function(doc){var stylesheet=doc.__svelte_stylesheet;var i=stylesheet.cssRules.length;while(i--){stylesheet.deleteRule(i);}doc.__svelte_rules={};});active_docs.clear();});}var current_component;function set_current_component(component){current_component=component;}function get_current_component(){if(!current_component)throw new Error('Function called outside component initialization');return current_component;}function onMount(fn){get_current_component().$$.on_mount.push(fn);}function afterUpdate(fn){get_current_component().$$.after_update.push(fn);}function onDestroy(fn){get_current_component().$$.on_destroy.push(fn);}function createEventDispatcher(){var component=get_current_component();return function(type,detail){var callbacks=component.$$.callbacks[type];if(callbacks){// TODO are there situations where events could be dispatched\n// in a server (non-DOM) environment?\nvar event=custom_event(type,detail);callbacks.slice().forEach(function(fn){fn.call(component,event);});}};}function setContext(key,context){get_current_component().$$.context.set(key,context);}function getContext(key){return get_current_component().$$.context.get(key);}// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component,event){var callbacks=component.$$.callbacks[event.type];if(callbacks){callbacks.slice().forEach(function(fn){return fn(event);});}}var dirty_components=[];var binding_callbacks=[];var render_callbacks=[];var flush_callbacks=[];var resolved_promise=Promise.resolve();var update_scheduled=false;function schedule_update(){if(!update_scheduled){update_scheduled=true;resolved_promise.then(flush);}}function add_render_callback(fn){render_callbacks.push(fn);}function add_flush_callback(fn){flush_callbacks.push(fn);}var flushing=false;var seen_callbacks=new Set();function flush(){if(flushing)return;flushing=true;do{// first, call beforeUpdate functions\n// and update components\nfor(var i=0;i<dirty_components.length;i+=1){var component=dirty_components[i];set_current_component(component);update(component.$$);}set_current_component(null);dirty_components.length=0;while(binding_callbacks.length){binding_callbacks.pop()();}// then, once components are updated, call\n// afterUpdate functions. This may cause\n// subsequent updates...\nfor(var _i=0;_i<render_callbacks.length;_i+=1){var callback=render_callbacks[_i];if(!seen_callbacks.has(callback)){// ...so guard against infinite loops\nseen_callbacks.add(callback);callback();}}render_callbacks.length=0;}while(dirty_components.length);while(flush_callbacks.length){flush_callbacks.pop()();}update_scheduled=false;flushing=false;seen_callbacks.clear();}function update($$){if($$.fragment!==null){$$.update();run_all($$.before_update);var dirty=$$.dirty;$$.dirty=[-1];$$.fragment&&$$.fragment.p($$.ctx,dirty);$$.after_update.forEach(add_render_callback);}}var promise;function wait(){if(!promise){promise=Promise.resolve();promise.then(function(){promise=null;});}return promise;}function dispatch(node,direction,kind){node.dispatchEvent(custom_event(\"\".concat(direction?'intro':'outro').concat(kind)));}var outroing=new Set();var outros;function group_outros(){outros={r:0,c:[],p:outros// parent group\n};}function check_outros(){if(!outros.r){run_all(outros.c);}outros=outros.p;}function transition_in(block,local){if(block&&block.i){outroing[\"delete\"](block);block.i(local);}}function transition_out(block,local,detach,callback){if(block&&block.o){if(outroing.has(block))return;outroing.add(block);outros.c.push(function(){outroing[\"delete\"](block);if(callback){if(detach)block.d(1);callback();}});block.o(local);}}var null_transition={duration:0};function create_bidirectional_transition(node,fn,params,intro){var config=fn(node,params);var t=intro?0:1;var running_program=null;var pending_program=null;var animation_name=null;function clear_animation(){if(animation_name)delete_rule(node,animation_name);}function init(program,duration){var d=program.b-t;duration*=Math.abs(d);return{a:t,b:program.b,d:d,duration:duration,start:program.start,end:program.start+duration,group:program.group};}function go(b){var _ref54=config||null_transition,_ref54$delay=_ref54.delay,delay=_ref54$delay===void 0?0:_ref54$delay,_ref54$duration=_ref54.duration,duration=_ref54$duration===void 0?300:_ref54$duration,_ref54$easing=_ref54.easing,easing=_ref54$easing===void 0?identity:_ref54$easing,_ref54$tick=_ref54.tick,tick=_ref54$tick===void 0?noop$1:_ref54$tick,css=_ref54.css;var program={start:now()+delay,b:b};if(!b){// @ts-ignore todo: improve typings\nprogram.group=outros;outros.r+=1;}if(running_program||pending_program){pending_program=program;}else{// if this is an intro, and there's a delay, we need to do\n// an initial tick and/or apply CSS animation immediately\nif(css){clear_animation();animation_name=create_rule(node,t,b,duration,delay,easing,css);}if(b)tick(0,1);running_program=init(program,duration);add_render_callback(function(){return dispatch(node,b,'start');});loop(function(now){if(pending_program&&now>pending_program.start){running_program=init(pending_program,duration);pending_program=null;dispatch(node,running_program.b,'start');if(css){clear_animation();animation_name=create_rule(node,t,running_program.b,running_program.duration,0,easing,config.css);}}if(running_program){if(now>=running_program.end){tick(t=running_program.b,1-t);dispatch(node,running_program.b,'end');if(!pending_program){// we're done\nif(running_program.b){// intro — we can tidy up immediately\nclear_animation();}else{// outro — needs to be coordinated\nif(! --running_program.group.r)run_all(running_program.group.c);}}running_program=null;}else if(now>=running_program.start){var p=now-running_program.start;t=running_program.a+running_program.d*easing(p/running_program.duration);tick(t,1-t);}}return!!(running_program||pending_program);});}}return{run:function run(b){if(is_function(config)){wait().then(function(){// @ts-ignore\nconfig=config();go(b);});}else{go(b);}},end:function end(){clear_animation();running_program=pending_program=null;}};}var globals=true?window:typeof globalThis!=='undefined'?globalThis:global;function destroy_block(block,lookup){block.d(1);lookup[\"delete\"](block.key);}function outro_and_destroy_block(block,lookup){transition_out(block,1,1,function(){lookup[\"delete\"](block.key);});}function update_keyed_each(old_blocks,dirty,get_key,dynamic,ctx,list,lookup,node,destroy,create_each_block,next,get_context){var o=old_blocks.length;var n=list.length;var i=o;var old_indexes={};while(i--){old_indexes[old_blocks[i].key]=i;}var new_blocks=[];var new_lookup=new Map();var deltas=new Map();i=n;while(i--){var child_ctx=get_context(ctx,list,i);var key=get_key(child_ctx);var block=lookup.get(key);if(!block){block=create_each_block(key,child_ctx);block.c();}else if(dynamic){block.p(child_ctx,dirty);}new_lookup.set(key,new_blocks[i]=block);if(key in old_indexes)deltas.set(key,Math.abs(i-old_indexes[key]));}var will_move=new Set();var did_move=new Set();function insert(block){transition_in(block,1);block.m(node,next);lookup.set(block.key,block);next=block.first;n--;}while(o&&n){var new_block=new_blocks[n-1];var old_block=old_blocks[o-1];var new_key=new_block.key;var old_key=old_block.key;if(new_block===old_block){// do nothing\nnext=new_block.first;o--;n--;}else if(!new_lookup.has(old_key)){// remove old block\ndestroy(old_block,lookup);o--;}else if(!lookup.has(new_key)||will_move.has(new_key)){insert(new_block);}else if(did_move.has(old_key)){o--;}else if(deltas.get(new_key)>deltas.get(old_key)){did_move.add(new_key);insert(new_block);}else{will_move.add(old_key);o--;}}while(o--){var _old_block=old_blocks[o];if(!new_lookup.has(_old_block.key))destroy(_old_block,lookup);}while(n){insert(new_blocks[n-1]);}return new_blocks;}function get_spread_update(levels,updates){var update={};var to_null_out={};var accounted_for={$$scope:1};var i=levels.length;while(i--){var o=levels[i];var n=updates[i];if(n){for(var key in o){if(!(key in n))to_null_out[key]=1;}for(var _key4 in n){if(!accounted_for[_key4]){update[_key4]=n[_key4];accounted_for[_key4]=1;}}levels[i]=n;}else{for(var _key5 in o){accounted_for[_key5]=1;}}}for(var _key6 in to_null_out){if(!(_key6 in update))update[_key6]=undefined;}return update;}function get_spread_object(spread_props){return typeof spread_props==='object'&&spread_props!==null?spread_props:{};}function bind(component,name,callback){var index=component.$$.props[name];if(index!==undefined){component.$$.bound[index]=callback;callback(component.$$.ctx[index]);}}function create_component(block){block&&block.c();}function mount_component(component,target,anchor){var _component$$$=component.$$,fragment=_component$$$.fragment,on_mount=_component$$$.on_mount,on_destroy=_component$$$.on_destroy,after_update=_component$$$.after_update;fragment&&fragment.m(target,anchor);// onMount happens before the initial afterUpdate\nadd_render_callback(function(){var new_on_destroy=on_mount.map(run).filter(is_function);if(on_destroy){on_destroy.push.apply(on_destroy,_toConsumableArray(new_on_destroy));}else{// Edge case - component was destroyed immediately,\n// most likely as a result of a binding initialising\nrun_all(new_on_destroy);}component.$$.on_mount=[];});after_update.forEach(add_render_callback);}function destroy_component(component,detaching){var $$=component.$$;if($$.fragment!==null){run_all($$.on_destroy);$$.fragment&&$$.fragment.d(detaching);// TODO null out other refs, including component.$$ (but need to\n// preserve final state?)\n$$.on_destroy=$$.fragment=null;$$.ctx=[];}}function make_dirty(component,i){if(component.$$.dirty[0]===-1){dirty_components.push(component);schedule_update();component.$$.dirty.fill(0);}component.$$.dirty[i/31|0]|=1<<i%31;}function init(component,options,instance,create_fragment,not_equal,props){var dirty=arguments.length>6&&arguments[6]!==undefined?arguments[6]:[-1];var parent_component=current_component;set_current_component(component);var prop_values=options.props||{};var $$=component.$$={fragment:null,ctx:null,// state\nprops:props,update:noop$1,not_equal:not_equal,bound:blank_object(),// lifecycle\non_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(parent_component?parent_component.$$.context:[]),// everything else\ncallbacks:blank_object(),dirty:dirty,skip_bound:false};var ready=false;$$.ctx=instance?instance(component,prop_values,function(i,ret){var value=(arguments.length<=2?0:arguments.length-2)?arguments.length<=2?undefined:arguments[2]:ret;if($$.ctx&&not_equal($$.ctx[i],$$.ctx[i]=value)){if(!$$.skip_bound&&$$.bound[i])$$.bound[i](value);if(ready)make_dirty(component,i);}return ret;}):[];$$.update();ready=true;run_all($$.before_update);// `false` as a special case of no DOM component\n$$.fragment=create_fragment?create_fragment($$.ctx):false;if(options.target){if(options.hydrate){var nodes=children(options.target);// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n$$.fragment&&$$.fragment.l(nodes);nodes.forEach(detach);}else{// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n$$.fragment&&$$.fragment.c();}if(options.intro)transition_in(component.$$.fragment);mount_component(component,options.target,options.anchor);flush();}set_current_component(parent_component);}var SvelteComponent=/*#__PURE__*/function(){function SvelteComponent(){_classCallCheck(this,SvelteComponent);}_createClass(SvelteComponent,[{key:\"$destroy\",value:function $destroy(){destroy_component(this,1);this.$destroy=noop$1;}},{key:\"$on\",value:function $on(type,callback){var callbacks=this.$$.callbacks[type]||(this.$$.callbacks[type]=[]);callbacks.push(callback);return function(){var index=callbacks.indexOf(callback);if(index!==-1)callbacks.splice(index,1);};}},{key:\"$set\",value:function $set($$props){if(this.$$set&&!is_empty($$props)){this.$$.skip_bound=true;this.$$set($$props);this.$$.skip_bound=false;}}}]);return SvelteComponent;}();var subscriber_queue=[];/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */function readable(value,start){return{subscribe:writable(value,start).subscribe};}/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */function writable(value){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop$1;var stop;var subscribers=[];function set(new_value){if(safe_not_equal(value,new_value)){value=new_value;if(stop){// store is ready\nvar run_queue=!subscriber_queue.length;for(var i=0;i<subscribers.length;i+=1){var s=subscribers[i];s[1]();subscriber_queue.push(s,value);}if(run_queue){for(var _i2=0;_i2<subscriber_queue.length;_i2+=2){subscriber_queue[_i2][0](subscriber_queue[_i2+1]);}subscriber_queue.length=0;}}}}function update(fn){set(fn(value));}function subscribe(run){var invalidate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop$1;var subscriber=[run,invalidate];subscribers.push(subscriber);if(subscribers.length===1){stop=start(set)||noop$1;}run(value);return function(){var index=subscribers.indexOf(subscriber);if(index!==-1){subscribers.splice(index,1);}if(subscribers.length===0){stop();stop=null;}};}return{set:set,update:update,subscribe:subscribe};}function derived(stores,fn,initial_value){var single=!Array.isArray(stores);var stores_array=single?[stores]:stores;var auto=fn.length<2;return readable(initial_value,function(set){var inited=false;var values=[];var pending=0;var cleanup=noop$1;var sync=function sync(){if(pending){return;}cleanup();var result=fn(single?values[0]:values,set);if(auto){set(result);}else{cleanup=is_function(result)?result:noop$1;}};var unsubscribers=stores_array.map(function(store,i){return subscribe(store,function(value){values[i]=value;pending&=~(1<<i);if(inited){sync();}},function(){pending|=1<<i;});});inited=true;sync();return function stop(){run_all(unsubscribers);cleanup();};});}var mergeObjects=function mergeObjects(objects){return objects.reduce(function(prev,curr){return Object.assign(prev,curr);},{});};// @ts-ignore\nvar UPDATE_VALUE=function UPDATE_VALUE(updateValue){return{updateValue:updateValue};};var DEFAULT_VALUE=function DEFAULT_VALUE(defaultValue){return{defaultValue:defaultValue};};var CUSTOM_STORE=function CUSTOM_STORE(fn){return{store:fn};};// @ts-ignore\nvar DERIVED_STORE=function DERIVED_STORE(fn){return{store:function store(defaultValue,stores){return derived.apply(void 0,_toConsumableArray(fn(stores)));}};};var UNIQUE_DERIVED_STORE=function UNIQUE_DERIVED_STORE(fn){return{store:function store(defaultValue,stores){var _fn=fn(stores),_fn2=_slicedToArray(_fn,3),selectedStores=_fn2[0],update=_fn2[1],_fn2$=_fn2[2],isEqual=_fn2$===void 0?function(){return false;}:_fn2$;var isFirst=true;var currentValue;return derived(selectedStores,function(storeValues,set){update(storeValues,function(value){if(!isFirst&&isEqual(currentValue,value))return;currentValue=value;isFirst=false;set(value);});});}};};var MAP_STORE=function MAP_STORE(fn){return{store:function store(defaultValue,stores){var _fn3=fn(stores),_fn4=_slicedToArray(_fn3,2),valueMapper=_fn4[0],_fn4$=_fn4[1],paramStores=_fn4$===void 0?{}:_fn4$;var storedItems=[];var $paramStores={};var mapValue=function mapValue(item){return valueMapper(item,$paramStores);};// set default properties for each shape\nvar setValue=function setValue(items){// was empty, still empty\nif(!storedItems.length&&!items.length)return;// update value\nstoredItems=items;updateValue();};var updateValue=function updateValue(){var mappedItems=storedItems.map(mapValue);storedItems=mappedItems;set(mappedItems);};Object.keys(paramStores).forEach(function(name){var store=paramStores[name];store.subscribe(function(value){$paramStores[name]=value;if(!value)return;updateValue();});});var _writable=writable(defaultValue),subscribe=_writable.subscribe,set=_writable.set;return{set:setValue,update:function update(fn){return setValue(fn(null));},subscribe:subscribe};}};};var createStore=function createStore(accessors,stores,options){var _options$store2=options.store,store=_options$store2===void 0?function(defaultValue){return writable(defaultValue);}:_options$store2,_options$defaultValue=options.defaultValue,defaultValue=_options$defaultValue===void 0?noop:_options$defaultValue,_options$updateValue=options.updateValue,updateValue=_options$updateValue===void 0?undefined:_options$updateValue;// create our private store\nvar storeInstance=store(defaultValue(),stores,accessors);var subscribe=storeInstance.subscribe,_storeInstance$update=storeInstance.update,update=_storeInstance$update===void 0?noop:_storeInstance$update;// update = noop because not all stores can be updated\n// on update private store\nvar unsub;var onUpdate=function onUpdate(cb){var ignoreFirstCallback=true;if(unsub)unsub();unsub=subscribe(function(value){// need to ignore first callback because that returns current value\nif(ignoreFirstCallback)return ignoreFirstCallback=false;// now we have the newly assigned value\ncb(value);unsub();unsub=undefined;});};// create the value updater function, needs access to stores so can read all store values\nvar updateStoreValue=updateValue?updateValue(accessors):passthrough;// set and validate value\nstoreInstance.set=function(nextValue){return update(function(previousValue){return updateStoreValue(nextValue,previousValue,onUpdate);});};// set default value for external reference\nstoreInstance.defaultValue=defaultValue;// expose store api\nreturn storeInstance;};var createStores=function createStores(props){var stores={};var accessors={};props.forEach(function(_ref55){var _ref56=_toArray(_ref55),name=_ref56[0],options=_ref56.slice(1);var opts=mergeObjects(options);var store=stores[name]=createStore(accessors,stores,opts);var property={get:function get(){return get_store_value(store);},set:store.set};Object.defineProperty(accessors,name,property);});return{stores:stores,accessors:accessors};};var props=[// io\n['src'],['imageReader'],['imageWriter'],// current images\n['images',DEFAULT_VALUE(function(){return[];})]];var pubsub=function pubsub(){var subs=[];return{sub:function sub(event,callback){subs.push({event:event,callback:callback});return function(){return subs=subs.filter(function(subscriber){return subscriber.event!==event||subscriber.callback!==callback;});};},pub:function pub(event,value){subs.filter(function(sub){return sub.event===event;}).forEach(function(sub){return sub.callback(value);});}};};var capitalizeFirstLetter=function capitalizeFirstLetter(str){return str.charAt(0).toUpperCase()+str.slice(1);};var defineMethods=function defineMethods(object,api){Object.keys(api).forEach(function(name){var descriptor=isFunction(api[name])?{value:api[name],writable:false}:api[name];Object.defineProperty(object,name,descriptor);});};var fixPrecision=function fixPrecision(value){var precision=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;return parseFloat(value.toFixed(precision));};var scalar=10000;var offsetRectToFitPolygon=function offsetRectToFitPolygon(rect,poly){var polyLines=quadLines(poly);var offset=vectorCreateEmpty();var rectVertexes=rectGetCorners(rect);// we can fit it\nrectVertexes.forEach(function(vertex){// we update each corner by adding the current offset\nvectorAdd(vertex,offset);// test if point lies in polygon, if so, all is fine and we can exit\nif(polyPointIntersectionConvex(vertex,poly))return;polyLines.forEach(function(line){// get angle of edge and draw a ray from the corner perpendicular to the edge\nvar a=Math.atan2(line.start.y-line.end.y,line.start.x-line.end.x);var x=Math.sin(Math.PI-a)*scalar;var y=Math.cos(Math.PI-a)*scalar;var ray=vectorCreate(vertex.x+x,vertex.y+y);// extend the poly line so even if we overshoot the polygon we hit it\nvar lineExtended=lineExtend(lineClone(line),scalar);// get the resulting intersection (there's always an intersection)\nvar intersection=lineLineIntersection(lineCreate(vertex,ray),lineExtended);// no intersection, no need to do anything\nif(!intersection)return;// update offset to move towards image\nvectorAdd(offset,vectorSubtract(vectorClone(intersection),vertex));});});// test if any vertexes still fall outside of poly, if so, we can't fit the rect\nvar rectOffset=rectClone(rect);vectorAdd(rectOffset,offset);var rectOffsetVertices=rectGetCorners(rectOffset);var fits=rectOffsetVertices.every(function(vertex){return polyPointIntersectionConvex(vertex,poly);});if(fits){rectUpdateWithRect(rect,rectOffset);return true;}return false;};var limitCropRectToImage=function limitCropRectToImage(rect,poly){// get crop rect polygon vertexes\nvar rectVertexes=rectGetCorners(rect);// if we end up here it doesn't fit, we might need to adjust\nvar polyLines=quadLines(poly)// extend the poly lines a tiny bit so we\n// don't shoot rays between line gaps at corners\n// this caused one intersection to be missing resulting\n// in error while manipulating crop edges\n// (rotate image 90degrees -> drag bottom edge) (2021-04-09)\n.map(function(line){return lineExtend(line,5);});var rectCenterPosition=rectCenter(rect);var intersections=[];rectVertexes.forEach(function(rectVertex){var ray=lineMultiply(lineCreate(vectorClone(rectCenterPosition),vectorClone(rectVertex)),1000000);var intersectionFound=false;polyLines.map(lineClone).forEach(function(line){var intersection=lineLineIntersection(ray,line);if(!intersection||intersectionFound)return;intersections.push(intersection);intersectionFound=true;});});// top left -> bottom right\nvar tlbr=vectorDistance(intersections[0],intersections[2]);// top right -> bottom left\nvar trbl=vectorDistance(intersections[1],intersections[3]);// calculate smallest rectangle we can make, use that\nvar rectLimitedVertices=tlbr<trbl?[intersections[0],intersections[2]]:[intersections[1],intersections[3]];var rectLimitedToImage=rectCreateFromPoints(rectLimitedVertices);// only use our fitted crop rectangle if it's smaller than our current rectangle,\n// this would mean that our current rectangle couldn't be moved to make it fit\nif(rectLimitedToImage.width<rect.width){// need to center on previous rect\nrectUpdateWithRect(rect,rectLimitedToImage);return true;}return false;};var getImagePolygon=function getImagePolygon(image,imageRotation){var imagePerspective=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{x:0,y:0};var imageRect=rectCreateFromSize(image);var imageCenter=rectCenter(imageRect);var imagePoly=rectApplyPerspective(imageRect,imagePerspective,imageCenter).map(function(imageVertex){return vectorRotate(imageVertex,imageRotation,imageCenter);});// get image poly bounds, we need this to offset the poly vertices from 0,0\nvar imagePolyBounds=rectCreateFromPoints(imagePoly);// get image polygon vertexes\nreturn imagePoly.map(function(imageVertex){return vectorSubtract(imageVertex,imagePolyBounds);});};var getMaxSizeInRect=function getMaxSizeInRect(size){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var aspectRatio=arguments.length>2&&arguments[2]!==undefined?arguments[2]:rectAspectRatio(size);var width;var height;if(rotation!==0){var innerAngle=Math.atan2(1,aspectRatio);var rotationSigned=Math.sign(rotation)*rotation;var rotationSignedMod=rotationSigned%Math.PI;var rotationSignedModHalf=rotationSigned%HALF_PI;// determine if is turned on side\nvar hyp;var _r3;if(rotationSignedMod>QUART_PI&&rotationSignedMod<HALF_PI+QUART_PI){_r3=rotationSignedModHalf>QUART_PI?rotationSigned:HALF_PI-rotationSignedModHalf;}else{_r3=rotationSignedModHalf>QUART_PI?HALF_PI-rotationSignedModHalf:rotationSigned;}hyp=Math.min(Math.abs(size.height/Math.sin(innerAngle+_r3)),Math.abs(size.width/Math.cos(innerAngle-_r3)));width=Math.cos(innerAngle)*hyp;height=width/aspectRatio;}else{width=size.width;height=width/aspectRatio;if(height>size.height){height=size.height;width=height*aspectRatio;}}return sizeCreate(width,height);};var limitRectToImage=function limitRectToImage(rect,imageSize){var imageRotation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var imagePerspective=arguments.length>3&&arguments[3]!==undefined?arguments[3]:vectorCreateEmpty();var minSize=arguments.length>4?arguments[4]:undefined;// rotation and/or perspective, let's use the \"advanced\" collision detection method\nif(isNumber(imageRotation)&&imageRotation!==0||imagePerspective.x||imagePerspective.y){var inputAspectRatio=rectAspectRatio(rect);// test if crop can fit image, if it can, offset the crop so it fits\nvar imagePolygon=getImagePolygon(imageSize,imageRotation,imagePerspective);var maxSizeInRect=getMaxSizeInRect(imageSize,imageRotation,inputAspectRatio);var canFit=rect.width<maxSizeInRect.width&&rect.height<maxSizeInRect.height;if(!canFit){var dx=rect.width*0.5-maxSizeInRect.width*0.5;var dy=rect.height*0.5-maxSizeInRect.height*0.5;// adjust crop rect to max size\nif(rect.width>maxSizeInRect.width){rect.width=maxSizeInRect.width;rect.x+=dx;}if(rect.height>maxSizeInRect.height){rect.height=maxSizeInRect.height;rect.y+=dy;}// test if has exceeded min size, if so we need to limit the size and recalculate the other edge\n/*\n                        -\\\n                       /  ---\\\n                      h2      ---\\\n                     /            ---\\\n                    +--------w---------+\\\n                   /|                  | ---\\\n                  / |                  |     ---\\\n                 /  |                  |         ---\\\n                /   |                  |             --\n               h1   |                  |             /\n              /     |                  |            /\n             /      |                  |           /\n            -\\      |                  |          /\n              ---\\  |                  |         /\n                  --+------------------+        /\n                      ---\\                     /\n                          --\\                 /\n                             ---\\            /\n                                 ---\\       /\n                                     ---\\  /\n                                         --\n            */}offsetRectToFitPolygon(rect,imagePolygon);var wasLimited=limitCropRectToImage(rect,imagePolygon);// this makes sure that after limiting the size, the crop rect is moved to a position that is inside the image\nif(wasLimited)offsetRectToFitPolygon(rect,imagePolygon);}// no rotation, no perspective, use simple bounds method\nelse{// remember intended aspect ratio so we can try and recreate it\nvar intendedAspectRatio=rectAspectRatio(rect);// limit to image size first, can never exceed that\nrect.width=Math.min(rect.width,imageSize.width);rect.height=Math.min(rect.height,imageSize.height);// reposition rect so it's always inside image bounds\nrect.x=Math.max(rect.x,0);if(rect.x+rect.width>imageSize.width){rect.x-=rect.x+rect.width-imageSize.width;}rect.y=Math.max(rect.y,0);if(rect.y+rect.height>imageSize.height){rect.y-=rect.y+rect.height-imageSize.height;}// we get the center of the current rect so we can center the contained rect to it\nvar intendedCenter=rectCenter(rect);// make sure still adheres to aspect ratio\nvar containedRect=rectContainRect(rect,intendedAspectRatio);containedRect.width=Math.max(minSize.width,containedRect.width);containedRect.height=Math.max(minSize.height,containedRect.height);containedRect.x=intendedCenter.x-containedRect.width*0.5;containedRect.y=intendedCenter.y-containedRect.height*0.5;rectUpdateWithRect(rect,containedRect);}};var applyCropRectAction=function applyCropRectAction(cropRectPrevious,cropRectNext,imageSize,imageRotation,imagePerspective,cropLimitToImageBounds,cropMinSize,cropMaxSize){// clone\nvar minSize=sizeClone(cropMinSize);// set upper bounds to crop max size\nvar maxSize=sizeClone(cropMaxSize);// limit max size (more important that min size is respected so first limit max size)\nvar maxScalar=fixPrecision(Math.max(cropRectNext.width/maxSize.width,cropRectNext.height/maxSize.height));var minScalar=fixPrecision(Math.min(cropRectNext.width/minSize.width,cropRectNext.height/minSize.height));// clone for resulting crop rect\nvar cropRectOut=rectClone(cropRectNext);//\n// if exceeds min or max scale correct next crop rectangle to conform to bounds\n//\nif(minScalar<1||maxScalar>1){// center of both previous and next crop rects\nvar previousCropRectCenter=rectCenter(cropRectPrevious);var nextCropRectCenter=rectCenter(cropRectNext);// calculate scales\nvar _scalar2=minScalar<1?minScalar:maxScalar;var cx=(nextCropRectCenter.x+previousCropRectCenter.x)/2;var cy=(nextCropRectCenter.y+previousCropRectCenter.y)/2;var cw=cropRectOut.width/_scalar2;var ch=cropRectOut.height/_scalar2;rectUpdate(cropRectOut,cx-cw*0.5,cy-ch*0.5,cw,ch);}// no need to limit to bounds, let's go!\nif(!cropLimitToImageBounds)return{crop:cropRectOut};//\n// make sure the crop is made inside the bounds of the image\n//\nlimitRectToImage(cropRectOut,imageSize,imageRotation,imagePerspective,minSize);return{crop:cropRectOut};};var getBaseCropRect=function getBaseCropRect(imageSize,transformedCropRect,imageRotation){var imagePerspective=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{x:0,y:0};var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedVertices=rectRotate(imageRect,imageRotation,imageCenter);// get the rotated image bounds center (offset isn't relevant as crop is relative to top left image position)\nvar imageRotatedBoundsCenter=rectCenter(rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices)));// get the center of the crop inside the rotated image\nvar cropCenterInTransformedImage=rectCenter(transformedCropRect);// invert the rotation of the crop center around the rotated image center\nvar deRotatedCropCenter=vectorRotate(cropCenterInTransformedImage,-imageRotation,imageRotatedBoundsCenter);// calculate crop distance from rotated image center\nvar cropFromCenterOfTransformedImage=vectorSubtract(deRotatedCropCenter,imageRotatedBoundsCenter);// calculate original crop offset (from untransformed image)\nvar originalCropCenterOffset=vectorApply(vectorAdd(imageCenter,cropFromCenterOfTransformedImage),fixPrecision);return rectCreate(originalCropCenterOffset.x-transformedCropRect.width*0.5,originalCropCenterOffset.y-transformedCropRect.height*0.5,transformedCropRect.width,transformedCropRect.height);};var clamp=function clamp(value,min,max){return Math.max(min,Math.min(value,max));};var applyRotationAction=function applyRotationAction(imageRotationPrevious,imageRotation,imageRotationRange,cropRect,imageSize,imagePerspective,cropLimitToImageBounds,cropRectOrigin,cropMinSize,cropMaxSize){// clone\nvar minSize=sizeClone(cropMinSize);// set upper bounds to crop max size if image is bigger than max size,\n// else if should limit to image bounds use image size as limit\nvar maxSize=sizeClone(cropMaxSize);if(cropLimitToImageBounds){maxSize.width=Math.min(cropMaxSize.width,imageSize.width);maxSize.height=Math.min(cropMaxSize.height,imageSize.height);}var didAttemptDoubleTurn=false;var rotate=function rotate(rotationPrevious,rotation){// get the base crop rect (position of crop rect in untransformed image)\n// if we have the base crop rect we can apply the new rotation to it\nvar cropRectBase=getBaseCropRect(imageSize,cropRect,rotationPrevious,null);// calculate transforms based on new rotation and base crop rect\nvar imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedCorners=rectApplyPerspective(imageRect,imagePerspective,imageCenter);// need this to correct for perspective centroid displacement\nvar perspectiveOffset=vectorSubtract(vectorClone(imageCenter),quadCentroid(imageTransformedCorners));// rotate around center of image\nvar cropCenter=vectorRotate(rectCenter(cropRectBase),rotation,imageCenter);var rotateCropOffset=vectorSubtract(vectorClone(imageCenter),cropCenter);// get center of image bounds and move to correct position\nimageTransformedCorners.forEach(function(imageVertex){return vectorRotate(imageVertex,rotation,imageCenter);});var imageBoundsRect=rectCreateFromPoints(imageTransformedCorners);var imageCentroid=quadCentroid(imageTransformedCorners);var cropOffset=vectorAdd(vectorSubtract(vectorSubtract(imageCentroid,rotateCropOffset),imageBoundsRect),perspectiveOffset);// create output cropRect\nvar cropRectOut=rectCreate(cropOffset.x-cropRectBase.width*0.5,cropOffset.y-cropRectBase.height*0.5,cropRectBase.width,cropRectBase.height);// if has size target, scale croprect to target size\nif(cropRectOrigin){rectScale(cropRectOut,cropRectOrigin.width/cropRectOut.width);}// if should limit to image bounds\nif(cropLimitToImageBounds){var imagePoly=getImagePolygon(imageSize,rotation,imagePerspective);// offsetRectToFitPolygon(cropRectOut, imagePoly);\n// commenting this fixes poly sliding problem when adjusting rotation\nlimitCropRectToImage(cropRectOut,imagePoly);}//#region if exceeds min or max adjust rotation to conform to bounds\nvar minScalar=fixPrecision(Math.min(cropRectOut.width/minSize.width,cropRectOut.height/minSize.height),8);var maxScalar=fixPrecision(Math.max(cropRectOut.width/maxSize.width,cropRectOut.height/maxSize.height),8);if(minScalar<1||maxScalar>1){// determine if is full image turn\nvar isTurn=fixPrecision(Math.abs(rotation-rotationPrevious))===fixPrecision(Math.PI/2);// try another turn if is turning image\nif(isTurn&&!didAttemptDoubleTurn){didAttemptDoubleTurn=true;return rotate(imageRotationPrevious,imageRotationPrevious+Math.sign(rotation-rotationPrevious)*Math.PI);}}//#endregion\nreturn{rotation:rotation,crop:rectApply(cropRectOut,function(v){return fixPrecision(v,8);})};};// amount of turns applied, we need this to correctly determine the allowed rotation range\nvar imageTurns=Math.sign(imageRotation)*Math.round(Math.abs(imageRotation)/HALF_PI)*HALF_PI;var imageRotationClamped=clamp(imageRotation,imageTurns+imageRotationRange[0],imageTurns+imageRotationRange[1]);// set new crop position\nreturn rotate(imageRotationPrevious,imageRotationClamped);};var ORDERED_STATE_PROPS=[// requirements\n'cropLimitToImage','cropMinSize','cropMaxSize','cropAspectRatio',// selection -> flip -> rotate -> perspective -> crop\n'flipX','flipY','rotation','crop',// 'perspectiveX',\n// 'perspectiveY',\n// effects\n'colorMatrix','convolutionMatrix','gamma','vignette',// 'noise',\n// shapes\n'annotation','decoration',// other\n'backgroundColor','targetSize'];var clone=function clone(value){if(isArray(value)){return value.map(clone);}else if(isObject(value)){return _objectSpread({},value);}return value;};/* TODO: keep this state outside of the shape array? */var excludedShapeProps=['isDraft','isFormatted','isComplete','isError','isLoading','isEditing','isSelected'];/* note this method doesn't actually test if the value is fully serializable it simlpy excludes known prop values that can't be serialized */var isSerializeAble=function isSerializeAble(value){// isFunction(value) ||\nreturn!isElement(value);};var filterShapeState=function filterShapeState(shapes){return shapes.map(function(shape){return Object.keys(shape).reduce(function(copy,prop){if(excludedShapeProps.includes(prop)||!isSerializeAble(shape[prop]))return copy;copy[prop]=shape[prop];return copy;},{});});};var stateStore=function stateStore(defaultValue,stores,accessors){var observedStores=ORDERED_STATE_PROPS.map(function(key){return stores[key];});// can only subscribe, setting is done directly through store accessors\n// @ts-ignore\nvar _derived=derived(observedStores,function(values,set){var state=ORDERED_STATE_PROPS.reduce(function(prev,curr,i){prev[curr]=clone(values[i]);return prev;},{});// round crop if defined\n// round crop if defined\nstate.crop&&rectApply(state.crop,Math.round);// remove state props from decoration and annotation\n// remove state props from decoration and annotation\nstate.annotation=state.annotation&&filterShapeState(state.annotation);state.decoration=state.decoration&&filterShapeState(state.decoration);set(state);}),subscribe=_derived.subscribe;var setState=function setState(state){// requires at least some state to be supplied\nif(!state)return;// make sure crop origin is reset\naccessors.cropOrigin=undefined;// apply new values\nORDERED_STATE_PROPS// remove keys that weren't set\n.filter(function(key){return state.hasOwnProperty(key);})// apply each key in order\n.forEach(function(key){accessors[key]=clone(state[key]);});};return{set:setState,update:function update(fn){return setState(fn(null));},subscribe:subscribe};};var toNumericAspectRatio=function toNumericAspectRatio(v){if(!v)return undefined;if(/:/.test(v)){var _v$split=v.split(':'),_v$split2=_slicedToArray(_v$split,2),w=_v$split2[0],_h=_v$split2[1];return w/_h;}return parseFloat(v);};var arrayEqual=function arrayEqual(a,b){if(a.length!==b.length)return false;for(var i=0;i<a.length;i++){if(a[i]!==b[i])return false;}return true;};var result$5=null;var isAndroid=function isAndroid(){if(result$5===null)result$5=isUserAgent(/Android/);return result$5;};var result$6=null;var isFirefox=function isFirefox(){if(result$6===null)result$6=isUserAgent(/Firefox/);return result$6;};var result$7=null;var isEdge=function isEdge(){if(result$7===null)result$7=isUserAgent(/Edge/);return result$7;};var vendor;var getBrowserVendor=function getBrowserVendor(){if(vendor)return vendor;vendor=isIOS()?'ios':isAndroid()?'android':isFirefox()?'firefox':isInternetExplorer()?'ie':isEdge()?'edge':'chrome';return vendor;};// https://github.com/jhildenbiddle/canvas-size#test-results\nvar maxCanvasSze;var getMaxCanvasSize=function getMaxCanvasSize(){if(!maxCanvasSze){var sizes={android:[32767,32767,10836],ios:[4194303,8388607,16777216],chrome:[32767,32767,268435456],firefox:[32767,32767,124992400],edge:[16384,16384,268435456],ie:[16384,16384,67108864]};maxCanvasSze=sizes[getBrowserVendor()]||sizes['chrome'];}var _maxCanvasSze=maxCanvasSze,_maxCanvasSze2=_slicedToArray(_maxCanvasSze,3),width=_maxCanvasSze2[0],height=_maxCanvasSze2[1],density=_maxCanvasSze2[2];return{width:width,height:height,density:density};};var padColorArray=function padColorArray(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[0,0,0,0];var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1.0;return color.length===4?color:[].concat(_toConsumableArray(color),[opacity]);};//\n// constants\n//\nvar MIN_ROTATION=-QUART_PI;var MAX_ROTATION=QUART_PI;//\n// helper methods\n//\nvar isCropCentered=function isCropCentered(crop,imageSize,imageRotation){var cropCenter=vectorApply(rectCenter(crop),function(v){return fixPrecision(v,8);});var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageRotatedVertices=rectRotate(imageRect,imageRotation,imageCenter);var imageBoundsCenter=vectorApply(sizeCenter(rectCreateFromPoints(imageRotatedVertices)),function(v){return fixPrecision(v,8);});var dx=Math.abs(imageBoundsCenter.x-cropCenter.x);var dy=Math.abs(imageBoundsCenter.y-cropCenter.y);return dx<1&&dy<1;};var isCropMaxSize=function isCropMaxSize(cropRect,imageSize,rotation){var maxSize=getMaxSizeInRect(imageSize,rotation,rectAspectRatio(cropRect));return sizeEqual(sizeApply(maxSize,Math.round),sizeApply(sizeClone(cropRect),Math.round));};//\n// updater methods\n//\nvar updateCropRect=function updateCropRect(props){return function(cropNext){var cropPrevious=arguments.length>1&&arguments[1]!==undefined?arguments[1]:cropNext;// wait for image to load\nvar loadState=props.loadState,size=props.size,cropMinSize=props.cropMinSize,cropMaxSize=props.cropMaxSize,cropLimitToImage=props.cropLimitToImage,rotation=props.rotation,perspective=props.perspective;// image hasn't loaded yet, use supplied crop rect\nif(!cropNext||!loadState||!loadState.beforeComplete)return cropNext;// apply the action\nvar res=applyCropRectAction(cropPrevious,cropNext,size,rotation,perspective,cropLimitToImage,cropMinSize,cropMaxSize);var cropOut=rectApply(res.crop,function(v){return fixPrecision(v,8);});return cropOut;};};var updateCropAspectRatio=function updateCropAspectRatio(props){return function(aspectRatioNext){var loadState=props.loadState,crop=props.crop,size=props.size,rotation=props.rotation;var aspectRatio=toNumericAspectRatio(aspectRatioNext);// no aspect ratio means custom aspect ratio so set to undefined\nif(!aspectRatio)return undefined;// can't update crop if not defined yet\nif(!loadState||!loadState.beforeComplete)return aspectRatio;// if crop centered scale up\nif(isCropCentered(crop,size,rotation)){var imageSize=sizeTurn(sizeClone(size),rotation);props.crop=rectApply(rectContainRect(rectCreateFromSize(imageSize),aspectRatioNext),fixPrecision);}else{var cropSize={width:crop.height*aspectRatio,height:crop.height};var tx=(crop.width-cropSize.width)*0.5;var ty=(crop.height-cropSize.height)*0.5;props.crop=rectApply(rectCreate(crop.x+tx,crop.y+ty,cropSize.width,cropSize.height),fixPrecision);}return aspectRatio;};};var updateCropLimitToImage=function updateCropLimitToImage(props){return function(limitToImageNext,limitToImagePrevious,onUpdate){// if was not limiting previously and now set limiting make sure crop fits bounds\nif(!limitToImagePrevious&&limitToImageNext){onUpdate(function(){return props.crop=rectClone(props.crop);});}return limitToImageNext;};};var updateRotation=function updateRotation(props){return function(rotationNext,rotationPrevious,onUpdate){// when image rotation is updated we need to adjust the\n// cropRect offset so rotation happens from cropRect center\n// no change\nif(rotationNext===rotationPrevious)return rotationNext;// get relevant data from store state\nvar loadState=props.loadState,size=props.size,rotationRange=props.rotationRange,cropMinSize=props.cropMinSize,cropMaxSize=props.cropMaxSize,crop=props.crop,perspective=props.perspective,cropLimitToImage=props.cropLimitToImage,cropOrigin=props.cropOrigin;// image not ready, exit!\nif(!loadState||!loadState.beforeComplete)return rotationNext;// remember if current crop was at max size and centered, if so, resulting crop should also be at max size\nvar cropWasAtMaxSize=isCropMaxSize(crop,size,rotationPrevious);var cropWasCentered=isCropCentered(crop,size,rotationPrevious);// get new state\nvar res=applyRotationAction(rotationPrevious,rotationNext,rotationRange,crop,size,perspective,cropLimitToImage,cropOrigin,cropMinSize,cropMaxSize);// if is centered, and initial crop was at max size expand crop to max size\nif(cropWasAtMaxSize&&cropWasCentered){var rect=getMaxSizeInRect(size,rotationNext,rectAspectRatio(res.crop));// move top left corner\nres.crop.x+=res.crop.width*0.5;res.crop.y+=res.crop.height*0.5;res.crop.x-=rect.width*0.5;res.crop.y-=rect.height*0.5;// update size to max size\nres.crop.width=rect.width;res.crop.height=rect.height;}// return validated rotation value, then, after we assign that value, we update the crop rect\n// we may only call onUpdate if a change was made\nonUpdate(function(){props.crop=rectApply(res.crop,function(v){return fixPrecision(v,8);});});// return result rotation (might have been rotated twice to fit crop rectangle)\nreturn res.rotation;};};// updates the range of valid rotation input\nvar updateRotationRange=function updateRotationRange(imageSize,imageIsRotatedSideways,cropMinSize,cropSize){/*\n    - 'a' is angle between diagonal and image height\n    - 'b' is angle between diagonal and crop height\n    - 'c' is angle between diagonal and image width\n    - resulting range is then a - b\n    +----------/\\------------------------+\n    |         / \\ \\                      |\n    |        /   \\  \\                    |\n    |       /     \\   \\                  |\n    |       \\      \\    \\                |\n    |         \\     \\     \\              |\n    |           \\    \\      \\            |\n    |             \\   \\       /          |\n    |               \\  \\     /           |\n    |                 \\ \\   /            |\n    |                   \\\\a/b            |\n    +---------------------\\--------------+\n    */var scalar=Math.max(cropMinSize.width/cropSize.width,cropMinSize.height/cropSize.height);var minSize=sizeCreate(cropSize.width*scalar,cropSize.height*scalar);// the hypotenus is the length of the diagonal of the min crop size\nvar requiredSpace=sizeHypotenuse(minSize);// minimum space available in horizontal / vertical direction\nvar availableSpace=Math.min(imageSize.width,imageSize.height);// if there's enough space available, we can return the max range\nif(requiredSpace<availableSpace)return[MIN_ROTATION,MAX_ROTATION];// if the image is turned we need to swap the width and height\nvar imageWidth=imageIsRotatedSideways?imageSize.height:imageSize.width;var imageHeight=imageIsRotatedSideways?imageSize.width:imageSize.height;// subtracting the angle between the hypotenuse and the crop itself\nvar a=Math.acos(minSize.height/requiredSpace);var b=Math.acos(imageHeight/requiredSpace);var c=Math.asin(imageWidth/requiredSpace);var rangeHorizontal=a-b;var rangeVertical=c-a;// range is not a number, it means we can rotate as much as we want\nif(Number.isNaN(rangeHorizontal)&&Number.isNaN(rangeVertical))return[MIN_ROTATION,MAX_ROTATION];// get minimum range\nvar range=Number.isNaN(rangeHorizontal)?rangeVertical:Number.isNaN(rangeVertical)?rangeHorizontal:Math.min(rangeHorizontal,rangeVertical);// if not, limit range to min and max rotation\nvar rangeMin=Math.max(-range,MIN_ROTATION);var rangeMax=Math.min(range,MAX_ROTATION);return[rangeMin,rangeMax];};// updates the range of valid crop rectangle input\nvar updateCropRange=function updateCropRange(imageSize,rotation,cropAspectRatio,cropMinSize,cropMaxSize,cropLimitToImage){// ! rotation doesn't affect min size, only max size\n// set lower bounds to crop min size\nvar minSize=sizeClone(cropMinSize);// set upper bounds to crop max size\nvar maxSize=sizeClone(cropMaxSize);// now we got basic bounds, let's see if we should limit to the image bounds, else we done\nif(!cropLimitToImage)return[minSize,maxSize];return[minSize,sizeApply(getMaxSizeInRect(imageSize,rotation,cropAspectRatio),Math.round)];};var prepareShape=function prepareShape(shape,options){// only auto-format once\nif(!shape.isFormatted){shape=shapeFormat(shape);shape.isFormatted=true;}// we need to make sure shape is still correctly positioned relative to parent\n// draft cannot be relative\n// if context changed\n// if has left top right or bottom\nif(!shape.isDraft&&shapeHasRelativeSize(shape)&&(!shape.context||!rectEqual(options.context,shape.context))){shape=shapeComputeRect(shape,options.context);shape.context=_objectSpread({},options.context);}return shape;};var imageProps=[// image info received from read\n['file'],['size'],// loading and processing state\n['loadState'],['processState'],// derived info\n['aspectRatio',DERIVED_STORE(function(_ref57){var size=_ref57.size;return[size,function($size){return $size?rectAspectRatio($size):undefined;}];})],// image modifications\n['perspectiveX',DEFAULT_VALUE(function(){return 0;})],['perspectiveY',DEFAULT_VALUE(function(){return 0;})],['perspective',DERIVED_STORE(function(_ref58){var perspectiveX=_ref58.perspectiveX,perspectiveY=_ref58.perspectiveY;return[[perspectiveX,perspectiveY],function(_ref59){var _ref60=_slicedToArray(_ref59,2),x=_ref60[0],y=_ref60[1];return{x:x,y:y};}];})],['rotation',DEFAULT_VALUE(function(){return 0;}),UPDATE_VALUE(updateRotation)],['flipX',DEFAULT_VALUE(function(){return false;})],['flipY',DEFAULT_VALUE(function(){return false;})],['flip',DERIVED_STORE(function(_ref61){var flipX=_ref61.flipX,flipY=_ref61.flipY;return[[flipX,flipY],function(_ref62){var _ref63=_slicedToArray(_ref62,2),x=_ref63[0],y=_ref63[1];return{x:x,y:y};}];})],['isRotatedSideways',UNIQUE_DERIVED_STORE(function(_ref64){var rotation=_ref64.rotation;return[[rotation],function(_ref65,set){var _ref66=_slicedToArray(_ref65,1),$rotation=_ref66[0];return set(isRotatedSideways($rotation));},function(prevValue,nextValue){return prevValue!==nextValue;}];})],['crop',UPDATE_VALUE(updateCropRect)],['cropAspectRatio',UPDATE_VALUE(updateCropAspectRatio)],['cropOrigin'],['cropMinSize',DEFAULT_VALUE(function(){return{width:1,height:1};})],['cropMaxSize',DEFAULT_VALUE(function(){return sizeClone(getMaxCanvasSize());})],['cropLimitToImage',DEFAULT_VALUE(function(){return true;}),UPDATE_VALUE(updateCropLimitToImage)],['cropSize',UNIQUE_DERIVED_STORE(function(_ref67){var crop=_ref67.crop;return[[crop],function(_ref68,set){var _ref69=_slicedToArray(_ref68,1),$crop=_ref69[0];if(!$crop)return;set(sizeCreate($crop.width,$crop.height));},// if is same as previous size, don't trigger update (happens when updating only the crop offset)\nfunction(prevValue,nextValue){return sizeEqual(prevValue,nextValue);}];})],['cropRectAspectRatio',DERIVED_STORE(function(_ref70){var cropSize=_ref70.cropSize;return[[cropSize],function(_ref71,set){var _ref72=_slicedToArray(_ref71,1),$cropSize=_ref72[0];if(!$cropSize)return;set(fixPrecision(rectAspectRatio($cropSize),5));}];})],['cropRange',UNIQUE_DERIVED_STORE(function(_ref73){var size=_ref73.size,rotation=_ref73.rotation,cropRectAspectRatio=_ref73.cropRectAspectRatio,cropMinSize=_ref73.cropMinSize,cropMaxSize=_ref73.cropMaxSize,cropLimitToImage=_ref73.cropLimitToImage;return[[size,rotation,cropRectAspectRatio,cropMinSize,cropMaxSize,cropLimitToImage],function(_ref74,set){var _ref75=_slicedToArray(_ref74,6),$size=_ref75[0],$rotation=_ref75[1],$cropRectAspectRatio=_ref75[2],$cropMinSize=_ref75[3],$cropMaxSize=_ref75[4],$cropLimitToImage=_ref75[5];// wait for image size\nif(!$size)return;var range=updateCropRange($size,$rotation,$cropRectAspectRatio,$cropMinSize,$cropMaxSize,$cropLimitToImage);set(range);},// if is same range as previous range, don't trigger update\nfunction(prevRange,nextRange){return arrayEqual(prevRange,nextRange);}];})],['rotationRange',UNIQUE_DERIVED_STORE(function(_ref76){var size=_ref76.size,isRotatedSideways=_ref76.isRotatedSideways,cropMinSize=_ref76.cropMinSize,cropSize=_ref76.cropSize;return[[size,isRotatedSideways,cropMinSize,cropSize],function(_ref77,set){var _ref78=_slicedToArray(_ref77,4),$size=_ref78[0],$isRotatedSideways=_ref78[1],$cropMinSize=_ref78[2],$cropSize=_ref78[3];// wait for image size\nif(!$size||!$cropSize)return;var range=updateRotationRange($size,$isRotatedSideways,$cropMinSize,$cropSize);set(range);},// if is same range as previous range, don't trigger update\nfunction(prevRange,nextRange){return arrayEqual(prevRange,nextRange);}];})],// canvas\n['backgroundColor',UPDATE_VALUE(function(){return function(color){return padColorArray(color);};})],// size\n['targetSize'],// effects\n['colorMatrix'],['convolutionMatrix'],['gamma'],['noise'],['vignette'],// annotations live in image space\n['annotation',MAP_STORE(function(_ref79){var size=_ref79.size;return[prepareShape,{context:size}];}),DEFAULT_VALUE(function(){return[];})],// decorations live in crop space\n['decoration',MAP_STORE(function(_ref80){var crop=_ref80.crop;return[prepareShape,{context:crop}];}),DEFAULT_VALUE(function(){return[];})],// state of image, used to restore a previous state or request the current state\n['state',CUSTOM_STORE(stateStore)]];var process=/*#__PURE__*/function(){var _ref81=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee29(value,chainTasks){var chainOptions,processOptions,ontaskstart,ontaskprogress,ontaskend,token,cancelled,_iterator2,_step2,_loop,_ret,_args30=arguments;return _regeneratorRuntime.wrap(function _callee29$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:chainOptions=_args30.length>2&&_args30[2]!==undefined?_args30[2]:{};processOptions=_args30.length>3?_args30[3]:undefined;// options relevant to the process method itself\nontaskstart=processOptions.ontaskstart,ontaskprogress=processOptions.ontaskprogress,ontaskend=processOptions.ontaskend,token=processOptions.token;// has been cancelled\ncancelled=false;// set cancel handler method\ntoken.cancel=function(){// cancel called from outside of the process method\ncancelled=true;};// step through chain\n_iterator2=_createForOfIteratorHelper(chainTasks.entries());_context30.prev=6;_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(){var _step2$value,index,task,_task,fn,id;return _regeneratorRuntime.wrap(function _loop$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:_step2$value=_slicedToArray(_step2.value,2),index=_step2$value[0],task=_step2$value[1];if(!cancelled){_context29.next=3;break;}return _context29.abrupt(\"return\",{v:void 0});case 3:// get the task function and the id so we can notify the callee of the task that is being started\n_task=_slicedToArray(task,2),fn=_task[0],id=_task[1];// start task\nontaskstart(index,id);_context29.prev=5;_context29.next=8;return fn(value,_objectSpread({},chainOptions),function(event){return ontaskprogress(index,id,event);});case 8:value=_context29.sent;_context29.next=15;break;case 11:_context29.prev=11;_context29.t0=_context29[\"catch\"](5);// stop processing more items in the chain\ncancelled=true;// pass error back to parent\nthrow _context29.t0;case 15:ontaskend(index,id);case 16:case\"end\":return _context29.stop();}}},_loop,null,[[5,11]]);});_iterator2.s();case 9:if((_step2=_iterator2.n()).done){_context30.next=16;break;}return _context30.delegateYield(_loop(),\"t0\",11);case 11:_ret=_context30.t0;if(!(typeof _ret===\"object\")){_context30.next=14;break;}return _context30.abrupt(\"return\",_ret.v);case 14:_context30.next=9;break;case 16:_context30.next=21;break;case 18:_context30.prev=18;_context30.t1=_context30[\"catch\"](6);_iterator2.e(_context30.t1);case 21:_context30.prev=21;_iterator2.f();return _context30.finish(21);case 24:return _context30.abrupt(\"return\",value);case 25:case\"end\":return _context30.stop();}}},_callee29,null,[[6,18,21,24]]);}));return function process(_x49,_x50){return _ref81.apply(this,arguments);};}();// TODO: find better location for minSize / file load validation\nvar createImage=function createImage(){var _ref82=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref82$minSize=_ref82.minSize,minSize=_ref82$minSize===void 0?{width:1,height:1}:_ref82$minSize;// create default store\nvar _createStores=createStores(imageProps),stores=_createStores.stores,accessors=_createStores.accessors;// pub/sub\nvar _pubsub=pubsub(),pub=_pubsub.pub,sub=_pubsub.sub;// processing handler\nvar createProcessingHandler=function createProcessingHandler(stateProp,eventKey){var getStore=function getStore(){return accessors[stateProp]||{};};var setStore=function setStore(obj){return accessors[stateProp]=_objectSpread(_objectSpread(_objectSpread({},getStore()),obj),{},{timeStamp:Date.now()});};var hasError=function hasError(){return getStore().error;};var handleError=function handleError(error){if(hasError())return;setStore({error:error});pub(\"\".concat(eventKey,\"error\"),_objectSpread({},getStore()));};return{start:function start(){pub(\"\".concat(eventKey,\"start\"));},onabort:function onabort(){pub(\"\".concat(eventKey,\"abort\"));},ontaskstart:function ontaskstart(index,id){if(hasError())return;setStore({index:index,task:id,taskProgress:undefined,taskLengthComputable:undefined});pub(\"\".concat(eventKey,\"taskstart\"),_objectSpread({},getStore()));},ontaskprogress:function ontaskprogress(index,id,event){if(hasError())return;setStore({index:index,task:id,taskProgress:event.loaded/event.total,taskLengthComputable:event.lengthComputable});pub(\"\".concat(eventKey,\"taskprogress\"),_objectSpread({},getStore()));pub(\"\".concat(eventKey,\"progress\"),_objectSpread({},getStore()));},ontaskend:function ontaskend(index,id){if(hasError())return;setStore({index:index,task:id});pub(\"\".concat(eventKey,\"taskend\"),_objectSpread({},getStore()));},ontaskerror:function ontaskerror(error){handleError(error);},error:function error(_error){handleError(_error);},beforeComplete:function beforeComplete(data){if(hasError())return;setStore({beforeComplete:true});pub(\"before\".concat(eventKey),data);},complete:function complete(data){if(hasError())return;setStore({complete:true});pub(eventKey,data);}};};//#region read image\nvar read=function read(src,_ref83){var reader=_ref83.reader;// exit if no reader supplied\nif(!reader)return;// reset file data to undefined as we're loading a new image\nObject.assign(accessors,{file:undefined,size:undefined,loadState:undefined});// our cancel token so we can abort load if needed, cancel will be set by process\nvar imageReadToken={cancel:noop};var imageReadCancelled=false;var imageReadHandler=createProcessingHandler('loadState','load');var processOptions=_objectSpread({token:imageReadToken},imageReadHandler);var readerState={src:src,size:undefined,dest:undefined};var readerOptions={};// start reading image\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee30(){var output,_ref85,size,dest;return _regeneratorRuntime.wrap(function _callee30$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:_context31.prev=0;imageReadHandler.start();_context31.next=4;return process(readerState,reader,readerOptions,processOptions);case 4:output=_context31.sent;if(!imageReadCancelled){_context31.next=7;break;}return _context31.abrupt(\"return\",imageReadHandler.onabort());case 7:// get shortcuts for validation\n_ref85=output||{},size=_ref85.size,dest=_ref85.dest;// if we don't have a size\nif(!(!size||!size.width||!size.height)){_context31.next=10;break;}throw new DokaError('Image size missing','IMAGE_SIZE_MISSING',output);case 10:if(!(size.width<minSize.width||size.height<minSize.height)){_context31.next=12;break;}throw new DokaError('Image too small','IMAGE_TOO_SMALL',_objectSpread(_objectSpread({},output),{},{minWidth:minSize.width,minHeight:minSize.height}));case 12:// update internal data\nObject.assign(accessors,{size:size,file:dest});// set base crop rect if not already has crop defined\nif(!accessors.crop){accessors.crop=rectContainRect(rectCreateFromSize(size),accessors.cropAspectRatio);}// apply current image state in correct order,\n// there's a difference between the actions `rotate -> crop` and `crop -> rotate`\n// this makes sure the initial state is always `rotate -> crop`\naccessors.state=accessors.state;// before load complete\nimageReadHandler.beforeComplete(output);// done loading image\nimageReadHandler.complete(output);_context31.next=22;break;case 19:_context31.prev=19;_context31.t0=_context31[\"catch\"](0);imageReadHandler.error(_context31.t0);case 22:_context31.prev=22;imageReadToken=undefined;return _context31.finish(22);case 25:case\"end\":return _context31.stop();}}},_callee30,null,[[0,19,22,25]]);}))();// call to abort load\nreturn function(){imageReadCancelled=true;imageReadToken&&imageReadToken.cancel();};};//#endregion\n//#region write image\nvar write=function write(writer){// not ready to start processing\nif(!accessors.loadState.complete)return;// reset process state to undefined\naccessors.processState=undefined;var imageWriteHandler=createProcessingHandler('processState','process');var writerState={src:accessors.file,imageState:accessors.state,dest:undefined};// willProcessImageState\nif(!writer){imageWriteHandler.start();imageWriteHandler.complete(writerState);return;}// we need this token to be a blet to cancel the processing operation\nvar imageWriteToken={cancel:noop};var writerOptions={};var processOptions=_objectSpread({token:imageWriteToken},imageWriteHandler);// start writing image\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee31(){var output;return _regeneratorRuntime.wrap(function _callee31$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:imageWriteHandler.start();_context32.prev=1;_context32.next=4;return process(writerState,writer,writerOptions,processOptions);case 4:output=_context32.sent;imageWriteHandler.complete(output);_context32.next=11;break;case 8:_context32.prev=8;_context32.t0=_context32[\"catch\"](1);imageWriteHandler.error(_context32.t0);case 11:_context32.prev=11;imageWriteToken=undefined;return _context32.finish(11);case 14:case\"end\":return _context32.stop();}}},_callee31,null,[[1,8,11,14]]);}))();// call to abort processing\nreturn function(){return imageWriteToken&&imageWriteToken.cancel();};};//#endregion\n//#region api\ndefineMethods(accessors,{read:read,write:write,on:sub});//#endregion\n// expose store API\nreturn{accessors:accessors,stores:stores};};// @ts-ignore\nvar editorEventsToBubble=['loadstart','loadabort','loaderror','loadprogress','load','processstart','processabort','processerror','processprogress','process'];var imagePrivateProps=['flip','cropOrigin','isRotatedSideways','perspective','perspectiveX','perspectiveY','cropRange'];var editorPrivateProps=['images'];var getImagePropGroupedName=function getImagePropGroupedName(prop){return\"image\".concat(capitalizeFirstLetter(prop));};var getEditorProps=function getEditorProps(){var imageProperties=getImagePublicPropNames(imageProps).map(getImagePropGroupedName);var editorProperties=props.map(function(_ref87){var _ref88=_slicedToArray(_ref87,1),prop=_ref88[0];return prop;}).filter(function(prop){return!editorPrivateProps.includes(prop);});return imageProperties.concat(editorProperties);};var getImagePublicPropNames=function getImagePublicPropNames(imageProps){return imageProps.map(function(_ref89){var _ref90=_slicedToArray(_ref89,1),prop=_ref90[0];return prop;}).filter(function(prop){return!imagePrivateProps.includes(prop);});};var createImageEditor=function createImageEditor(){// create default stores\nvar _createStores2=createStores(props),stores=_createStores2.stores,accessors=_createStores2.accessors;// set up pub/sub for the app layer\nvar _pubsub2=pubsub(),sub=_pubsub2.sub,pub=_pubsub2.pub;var bubble=function bubble(name){return function(value){return pub(name,value);};};// helper method\nvar getImageObjSafe=function getImageObjSafe(){return accessors.images?accessors.images[0]:{};};// create shortcuts to image props : `crop` -> `imageCrop`\nvar initialImageProps={};getImagePublicPropNames(imageProps).forEach(function(prop){Object.defineProperty(accessors,getImagePropGroupedName(prop),{get:function get(){var image=getImageObjSafe();if(!image)return;return image.accessors[prop];},set:function set(value){var image=getImageObjSafe();if(!image){initialImageProps[prop]=value;return;}image.accessors[prop]=value;}});});// handling loading an image if a src is set\nvar unsubSrc=stores.src.subscribe(function(src){// no image set, means clear active image\nif(!src)return accessors.images=[];// exit here if we don't have an imageReader we'll wait for an imageReader to be defined\nif(!accessors.imageReader)return;// this is the first image so let's use `loadSrc` so we can also apply initial props\nif(!accessors.images.length)return loadSrc(src);loadImage(src)[\"catch\"](function(){// fail silently, is handled with 'loaderror' event\n});});var unsubReader=stores.imageReader.subscribe(function(reader){// can't do anything without an image reader\nif(!reader)return;// an image has already been loaded no need to load images that were set earlier\nif(accessors.images.length)return;// no image to load, we'll wait for images to be set to the `src` prop\nif(!accessors.src)return;// src is waiting to be loaded so let's pick it up,\n// push it back a tick so we know initialImageProps are set\nloadSrc(accessors.src)[\"catch\"](function(){// fail silently, is handled with 'loaderror' event\n});});// loads the initial source, differs from loadImage as this method picks up any set image props\nvar loadSrc=function loadSrc(src){return Promise.resolve().then(function(){return loadImage(src,initialImageProps);});};// internal helper method to get active image\nvar getImage=function getImage(){return accessors.images&&accessors.images[0];};//#endregion\n//#region public method (note that these are also called from UI, name of method is name of dispatched event in UI)\n// load image, resolve when image is loaded\nvar imageLoadAbort;var loadImage=function loadImage(src){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve,reject){// get current image\nvar image=getImage();// determine min defined image size (is crop min size)\nvar minImageSize=options.cropMinSize||image&&image.accessors.cropMinSize;// if already has image, remove existing image\nif(image)removeImage();// access image props and stores\nimage=createImage({minSize:minImageSize});editorEventsToBubble.map(function(event){return image.accessors.on(event,bubble(event));});// done, clean up listeners\nvar done=function done(){initialImageProps={};unsubReject();unsubResolve();};var unsubReject=image.accessors.on('loaderror',function(error){done();reject(error);});image.accessors.on('beforeload',function(){// normalize all prefixed options (from imageRotation -> rotation)\nvar normalizedOptions=getImagePublicPropNames(imageProps).reduce(function(prev,prop){// test if already has image prop (rotation)\nif(prop in options){prev[prop]=options[prop];return prev;}// test if has prefixed image prop (imageRotation)\nelse{var groupedPropName=getImagePropGroupedName(prop);if(groupedPropName in options){prev[prop]=options[groupedPropName];}}return prev;},{});// if set as initial props we apply in most logical order\n['cropLimitToImage','crop','cropAspectRatio','rotation'].forEach(function(prop){if(!(prop in normalizedOptions))return;// asign to `image`\nimage.accessors[prop]=normalizedOptions[prop];// remove from normalizedOptions\ndelete normalizedOptions[prop];});// assign remaining options to `image`\nObject.assign(image.accessors,normalizedOptions);});var unsubResolve=image.accessors.on('load',function(output){imageLoadAbort=undefined;done();resolve(output);});// set new image\naccessors.images=[image];// assign passed options to editor accessors, we ignore 'src'\nif(options.imageReader)accessors.imageReader=options.imageReader;if(options.imageWriter)accessors.imageWriter=options.imageWriter;// start reading image\nimageLoadAbort=image.accessors.read(src,{reader:accessors.imageReader});});};// start processing a loaded image, resolve when image is processed\nvar imageProcessAbort;var processImage=function processImage(src,options){return new Promise(/*#__PURE__*/function(){var _ref91=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee32(resolve,reject){var image,done,unsubReject,unsubResolve;return _regeneratorRuntime.wrap(function _callee32$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:_context33.t0=src;if(!_context33.t0){_context33.next=4;break;}_context33.next=4;return loadImage(src,options);case 4:// get current active image\nimage=getImage();// needs image for processing\nif(image){_context33.next=7;break;}return _context33.abrupt(\"return\",reject('no image'));case 7:// done, clean up listeners\ndone=function done(){imageProcessAbort=undefined;unsubReject();unsubResolve();};unsubReject=image.accessors.on('processerror',function(error){done();reject(error);});unsubResolve=image.accessors.on('process',function(output){done();resolve(output);});imageProcessAbort=image.accessors.write(accessors.imageWriter);case 11:case\"end\":return _context33.stop();}}},_callee32);}));return function(_x51,_x52){return _ref91.apply(this,arguments);};}());};var abortProcessImage=function abortProcessImage(){var image=getImage();if(!image)return;if(imageProcessAbort)imageProcessAbort();image.accessors.processState=undefined;};// used internally (triggered by 'x' button when error loading image in UI)\nvar abortLoadImage=function abortLoadImage(){accessors.images=[];};// edit image, loads an image and resolve when image is processed\nvar editImage=function editImage(src,options){return new Promise(function(resolve,reject){loadImage(src,options).then(function(){// access image props and stores\nvar images=accessors.images;var image=images[0];// done, clean up listeners\nvar done=function done(){unsubReject();unsubResolve();};var unsubReject=image.accessors.on('processerror',function(error){done();reject(error);});var unsubResolve=image.accessors.on('process',function(output){done();resolve(output);});})[\"catch\"](reject);});};var removeImage=function removeImage(){// no images, nothing to remove\nvar image=getImage();if(!image)return;// try to abort image load\nif(imageLoadAbort)imageLoadAbort();image.accessors.loadState=undefined;// clear images\naccessors.images=[];};//#endregion\nObject.defineProperty(accessors,'stores',{get:function get(){return stores;}});//#region API\ndefineMethods(accessors,{on:sub,loadImage:loadImage,abortLoadImage:abortLoadImage,editImage:editImage,removeImage:removeImage,processImage:processImage,abortProcessImage:abortProcessImage,destroy:function destroy(){unsubSrc();unsubReader();}});return accessors;//#endregion\n};var getComponentExportedProps=function getComponentExportedProps(Component){var descriptors=Object.getOwnPropertyDescriptors(Component.prototype);return Object.keys(descriptors).filter(function(key){return!!descriptors[key]['get'];});};function circOut(t){return Math.sqrt(1- --t*t);}function is_date(obj){return Object.prototype.toString.call(obj)==='[object Date]';}function get_interpolator(a,b){if(a===b||a!==a)return function(){return a;};var type=typeof a;if(type!==typeof b||Array.isArray(a)!==Array.isArray(b)){throw new Error('Cannot interpolate values of different type');}if(Array.isArray(a)){var arr=b.map(function(bi,i){return get_interpolator(a[i],bi);});return function(t){return arr.map(function(fn){return fn(t);});};}if(type==='object'){if(!a||!b)throw new Error('Object cannot be null');if(is_date(a)&&is_date(b)){a=a.getTime();b=b.getTime();var delta=b-a;return function(t){return new Date(a+t*delta);};}var keys=Object.keys(b);var interpolators={};keys.forEach(function(key){interpolators[key]=get_interpolator(a[key],b[key]);});return function(t){var result={};keys.forEach(function(key){result[key]=interpolators[key](t);});return result;};}if(type==='number'){var _delta=b-a;return function(t){return a+t*_delta;};}throw new Error(\"Cannot interpolate \".concat(type,\" values\"));}function tweened(value){var defaults=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var store=writable(value);var task;var target_value=value;function set(new_value,opts){if(value==null){store.set(value=new_value);return Promise.resolve();}target_value=new_value;var previous_task=task;var started=false;var _assign=assign(assign({},defaults),opts),_assign$delay=_assign.delay,delay=_assign$delay===void 0?0:_assign$delay,_assign$duration=_assign.duration,duration=_assign$duration===void 0?400:_assign$duration,_assign$easing=_assign.easing,easing=_assign$easing===void 0?identity:_assign$easing,_assign$interpolate=_assign.interpolate,interpolate=_assign$interpolate===void 0?get_interpolator:_assign$interpolate;if(duration===0){if(previous_task){previous_task.abort();previous_task=null;}store.set(value=target_value);return Promise.resolve();}var start=now()+delay;var fn;task=loop(function(now){if(now<start)return true;if(!started){fn=interpolate(value,new_value);if(typeof duration==='function')duration=duration(value,new_value);started=true;}if(previous_task){previous_task.abort();previous_task=null;}var elapsed=now-start;if(elapsed>duration){store.set(value=new_value);return false;}// @ts-ignore\nstore.set(value=fn(easing(elapsed/duration)));return true;});return task.promise;}return{set:set,update:function update(fn,opts){return set(fn(target_value,value),opts);},subscribe:store.subscribe};}function tick_spring(ctx,last_value,current_value,target_value){if(typeof current_value==='number'){// @ts-ignore\nvar delta=target_value-current_value;// @ts-ignore\nvar velocity=(current_value-last_value)/(ctx.dt||1/60);// guard div by 0\nvar _spring=ctx.opts.stiffness*delta;var damper=ctx.opts.damping*velocity;var acceleration=(_spring-damper)*ctx.inv_mass;var d=(velocity+acceleration)*ctx.dt;if(Math.abs(d)<ctx.opts.precision&&Math.abs(delta)<ctx.opts.precision){return target_value;// settled\n}else{ctx.settled=false;// signal loop to keep ticking\n// @ts-ignore\nreturn current_value+d;}}else if(isArray(current_value)){// @ts-ignore\nreturn current_value.map(function(_,i){return tick_spring(ctx,last_value[i],current_value[i],target_value[i]);});}else if(typeof current_value==='object'){var next_value={};// @ts-ignore\nfor(var k in current_value){// @ts-ignore\nnext_value[k]=tick_spring(ctx,last_value[k],current_value[k],target_value[k]);}// @ts-ignore\nreturn next_value;}else{throw new Error(\"Cannot spring \".concat(typeof current_value,\" values\"));}}function spring(value){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var store=writable(value);var _opts$stiffness=opts.stiffness,stiffness=_opts$stiffness===void 0?0.15:_opts$stiffness,_opts$damping=opts.damping,damping=_opts$damping===void 0?0.8:_opts$damping,_opts$precision=opts.precision,precision=_opts$precision===void 0?0.01:_opts$precision;var last_time;var task;var current_token;var last_value=value;var target_value=value;var inv_mass=1;var inv_mass_recovery_rate=0;var cancel_task=false;function set(new_value){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};target_value=new_value;var token=current_token={};if(value==null||opts.hard||spring.stiffness>=1&&spring.damping>=1){cancel_task=true;// cancel any running animation\nlast_time=null;last_value=new_value;store.set(value=target_value);return Promise.resolve();}else if(opts.soft){var rate=opts.soft===true?0.5:+opts.soft;inv_mass_recovery_rate=1/(rate*60);inv_mass=0;// infinite mass, unaffected by spring forces\n}if(!task){last_time=null;cancel_task=false;var ctx={inv_mass:undefined,opts:spring,settled:true,dt:undefined};task=loop(function(now){if(last_time===null)last_time=now;if(cancel_task){cancel_task=false;task=null;return false;}inv_mass=Math.min(inv_mass+inv_mass_recovery_rate,1);// altered so doesn't create a new object\nctx.inv_mass=inv_mass;ctx.opts=spring;ctx.settled=true;// tick_spring may signal false\nctx.dt=(now-last_time)*60/1000;var next_value=tick_spring(ctx,last_value,value,target_value);last_time=now;last_value=value;store.set(value=next_value);if(ctx.settled)task=null;return!ctx.settled;});}return new Promise(function(fulfil){task.promise.then(function(){if(token===current_token)fulfil();});});}var spring={set:set,update:function update(fn,opts){return set(fn(target_value,value),opts);},subscribe:store.subscribe,stiffness:stiffness,damping:damping,precision:precision};return spring;}var prefersReducedMotion=readable(false,function(set){var mql=window.matchMedia('(prefers-reduced-motion:reduce)');set(mql.matches);mql.onchange=function(){return set(mql.matches);};});var hasResizeObserver=function hasResizeObserver(){return'ResizeObserver'in window;};//\nvar rectNext=rectCreateEmpty();var updateNodeRect=function updateNodeRect(node,x,y,width,height){if(!node.rect)node.rect=rectCreateEmpty();var rect=node.rect;rectUpdate(rectNext,x,y,width,height);if(rectEqual(rect,rectNext))return;rectUpdateWithRect(rect,rectNext);node.dispatchEvent(new CustomEvent('measure',{detail:rect}));};// measures the element\nvar r=Math.round;var measureViewRect=function measureViewRect(node){var clientRect=node.getBoundingClientRect();updateNodeRect(node,r(clientRect.x),r(clientRect.y),r(clientRect.width),r(clientRect.height));};var measureOffset=function measureOffset(node){return updateNodeRect(node,node.offsetLeft,node.offsetTop,node.offsetWidth,node.offsetHeight);};// holds all the elements to measure using requestAnimationFrame\nvar elements=[];// draw loop\nvar frame=null;function tick(){if(!elements.length){frame=null;return;}elements.forEach(function(node){return node.measure(node);});frame=requestAnimationFrame(tick);}var observer;// ResizeObserver API not known by TypeScript\nvar measurable=function measurable(node){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$observePosit=options.observePosition,observePosition=_options$observePosit===void 0?false:_options$observePosit,_options$observeViewR=options.observeViewRect,observeViewRect=_options$observeViewR===void 0?false:_options$observeViewR,_options$once=options.once,once=_options$once===void 0?false:_options$once,_options$disabled=options.disabled,disabled=_options$disabled===void 0?false:_options$disabled;// exit\nif(disabled)return;// use resize observe if available\nif(hasResizeObserver()&&!observePosition&&!observeViewRect){// we only create one observer, it will observe all registered elements\nif(!observer){// @ts-ignore: [2020-02-20] ResizeObserver API not known by TypeScript\nobserver=new ResizeObserver(function(entries){entries.forEach(function(entry){return measureOffset(entry.target);});});}// start observing this node\nobserver.observe(node);// measure our node for the first time\nmeasureOffset(node);// if should only measure once, remove now\nif(once)observer.unobserve(node);// and we done, need to return a clean up method for when our node is destroyed\nreturn{destroy:function destroy(){// already unobserved this node\nif(once)return;observer.unobserve(node);// TODO: test if all nodes have been removed, if so, remove observer\n}};}// set measure function\nnode.measure=observeViewRect?measureViewRect:measureOffset;// add so the element is measured\nelements.push(node);// start measuring on next frame, we set up a single measure loop,\n// the loop will check if there's still elements that need to be measured,\n// else it will stop running\nif(!frame)frame=requestAnimationFrame(tick);// measure this element now\nnode.measure(node);// remove method\nreturn{destroy:function destroy(){var index=elements.indexOf(node);elements.splice(index,1);}};};var focusvisible=function focusvisible(element){var isKeyboardInteraction=false;var handlePointerdown=function handlePointerdown(){isKeyboardInteraction=false;};var handleKeydown=function handleKeydown(){isKeyboardInteraction=true;};var handleKeyup=function handleKeyup(){isKeyboardInteraction=false;};var handleFocus=function handleFocus(e){if(!isKeyboardInteraction)return;e.target.dataset.focusVisible='';};var handleBlur=function handleBlur(e){delete e.target.dataset.focusVisible;};var map={pointerdown:handlePointerdown,keydown:handleKeydown,keyup:handleKeyup,focus:handleFocus,blur:handleBlur};Object.keys(map).forEach(function(event){return element.addEventListener(event,map[event],true);});return{destroy:function destroy(){Object.keys(map).forEach(function(event){return element.removeEventListener(event,map[event],true);});}};};var isImage=function isImage(file){return /^image/.test(file.type);};var getFilesFromEvent=function getFilesFromEvent(e){var _e$dataTransfer=e.dataTransfer,items=_e$dataTransfer.items,files=_e$dataTransfer.files;if(items){return Array.from(items).filter(function(item){return item.kind==='file';}).map(function(item){return item.getAsFile();});}return Array.from(files)||[];};var dropable=function dropable(node){var handleDragOver=function handleDragOver(e){// need to be prevent default to allow drop\ne.preventDefault();};var handleDrop=function handleDrop(e){e.preventDefault();e.stopPropagation();// prevents parents from catching this drop\nnode.dispatchEvent(new CustomEvent('dropfiles',{detail:{event:e,files:getFilesFromEvent(e).filter(function(file){return isImage(file);})}}));};node.addEventListener('drop',handleDrop);node.addEventListener('dragover',handleDragOver);// remove method\nreturn{destroy:function destroy(){node.removeEventListener('drop',handleDrop);node.removeEventListener('dragover',handleDragOver);}};};var result$8=null;var supportsWebGL2=function supportsWebGL2(){if(result$8===null){if('WebGL2RenderingContext'in window){var canvas;try{canvas=h('canvas');result$8=!!canvas.getContext('webgl2');}catch(err){result$8=false;}canvas&&releaseCanvas(canvas);}else{result$8=false;}}return result$8;};var isPowerOf2=function isPowerOf2(value){return(value&value-1)===0;};var stringReplace=function stringReplace(str){var entries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var prefix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var postfix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';return Object.keys(entries).filter(function(key){return!isObject(entries[key]);}).reduce(function(prev,curr){return prev.replace(new RegExp(prefix+curr+postfix),entries[curr]);},str);};var SHADER_FRAG_HEAD=\"#version 300 es\\nprecision highp float;\\n\\nout vec4 fragColor;\";// eslint-disable-line\nvar SHADER_FRAG_INIT=\"\\nfloat a=1.0;vec4 fillColor=uColor;vec4 textureColor=texture(uTexture,vTexCoord);textureColor*=(1.0-step(1.0,vTexCoord.y))*step(0.0,vTexCoord.y)*(1.0-step(1.0,vTexCoord.x))*step(0.0,vTexCoord.x);\";// eslint-disable-line\nvar SHADER_FRAG_MASK=\"\\nuniform float uMaskFeather[8];uniform float uMaskBounds[4];uniform float uMaskOpacity;float mask(float x,float y,float bounds[4],float opacity){return 1.0-(1.0-(smoothstep(bounds[3],bounds[3]+1.0,x)*(1.0-smoothstep(bounds[1]-1.0,bounds[1],x))*(1.0-step(bounds[0],y))*step(bounds[2],y)))*(1.0-opacity);}\";// eslint-disable-line\nvar SHADER_FRAG_MASK_APPLY=\"\\nfloat m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);\";// eslint-disable-line\nvar SHADER_FRAG_MASK_FEATHER_APPLY=\"\\nfloat leftFeatherOpacity=step(uMaskFeather[1],gl_FragCoord.x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],gl_FragCoord.x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],gl_FragCoord.x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],gl_FragCoord.x));a*=leftFeatherOpacity*rightFeatherOpacity;\";// eslint-disable-line\nvar SHADER_FRAG_RECT_AA=\"\\nvec2 scaledPoint=vec2(vRectCoord.x*uSize.x,vRectCoord.y*uSize.y);a*=smoothstep(0.0,1.0,uSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);\";// eslint-disable-line\nvar SHADER_FRAG_CORNER_RADIUS=\"\\nvec2 s=(uSize-2.0)*.5;vec2 r=(vRectCoord*uSize);vec2 p=r-(uSize*.5);float cornerRadius=uCornerRadius[0];bool left=r.x<s.x;bool top=r.y<s.x;if(!left&&top){cornerRadius=uCornerRadius[1];}if(!left&&!top){cornerRadius=uCornerRadius[3];}if(left&&!top){cornerRadius=uCornerRadius[2];}a*=1.0-clamp(length(max(abs(p)-(s-cornerRadius),0.0))-cornerRadius,0.0,1.0);\";// eslint-disable-line\nvar SHADER_FRAG_SHAPE_BLEND_COLOR=\"\\nfillColor.a*=a;fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);textureColor*=uTextureOpacity;textureColor.a*=a;textureColor.rgb*=m*a;textureColor.rgb+=(1.0-m)*(uCanvasColor.rgb*textureColor.a);fragColor=textureColor+(fillColor*(1.0-textureColor.a));\";// eslint-disable-line\nvar SHADER_FRAG_TEXTURE_COLORIZE=\"\\nif(uTextureColor.a!=0.0&&textureColor.a>0.0){vec3 colorFlattened=textureColor.rgb/textureColor.a;if(colorFlattened.r>.999999&&colorFlattened.g==0.0&&colorFlattened.b>.999999){textureColor.rgb=uTextureColor.rgb*textureColor.a;}textureColor*=uTextureColor.a;}\";// eslint-disable-line\nvar SHADER_VERT_HEAD=\"#version 300 es\\n\\nin vec4 aPosition;uniform mat4 uMatrix;\";// eslint-disable-line\nvar SHADER_VERT_MULTIPLY_MATRUX=\"\\ngl_Position=uMatrix*vec4(aPosition.x,aPosition.y,0,1);\";// eslint-disable-line\nvar SHADER_VERT_TEXTURE=\"\\nin vec2 aTexCoord;out vec2 vTexCoord;\";// eslint-disable-line\nvar SHADER_VERT_SNIPPETS={head:SHADER_VERT_HEAD,text:SHADER_VERT_TEXTURE,matrix:SHADER_VERT_MULTIPLY_MATRUX};var SHADER_FRAG_SNIPPETS={head:SHADER_FRAG_HEAD,mask:SHADER_FRAG_MASK,init:SHADER_FRAG_INIT,colorize:SHADER_FRAG_TEXTURE_COLORIZE,maskapply:SHADER_FRAG_MASK_APPLY,maskfeatherapply:SHADER_FRAG_MASK_FEATHER_APPLY,edgeaa:SHADER_FRAG_RECT_AA,cornerradius:SHADER_FRAG_CORNER_RADIUS,fragcolor:SHADER_FRAG_SHAPE_BLEND_COLOR};var transpileShader=function transpileShader(gl,src,type){src=stringReplace(src,type===gl.VERTEX_SHADER?SHADER_VERT_SNIPPETS:SHADER_FRAG_SNIPPETS,'##').trim();// ready if supports webgl\nif(supportsWebGL2())return src;src=src.replace(/#version.+/gm,'').trim();src=src.replace(/^\\/\\/\\#/gm,'#');if(type===gl.VERTEX_SHADER){src=src.replace(/in /gm,'attribute ').replace(/out /g,'varying ');}if(type===gl.FRAGMENT_SHADER){src=src.replace(/in /gm,'varying ').replace(/out.*?;/gm,'').replace(/texture\\(/g,'texture2D(').replace(/fragColor/g,'gl_FragColor');}return\"\".concat(src);};var compileShader=function compileShader(gl,src,type){var shader=gl.createShader(type);var transpiledSrc=transpileShader(gl,src,type);gl.shaderSource(shader,transpiledSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.error(gl.getShaderInfoLog(shader));}return shader;};var createShader=function createShader(gl,vertexShader,fragmentShader,attribs,uniforms){var program=gl.createProgram();gl.attachShader(program,compileShader(gl,vertexShader,gl.VERTEX_SHADER));gl.attachShader(program,compileShader(gl,fragmentShader,gl.FRAGMENT_SHADER));gl.linkProgram(program);var locations={};attribs.forEach(function(name){locations[name]=gl.getAttribLocation(program,name);});uniforms.forEach(function(name){locations[name]=gl.getUniformLocation(program,name);});return{program:program,locations:locations};};var canMipMap=function canMipMap(source){if(supportsWebGL2())return true;return isPowerOf2(source.width)&&isPowerOf2(source.height);};var applyTextureProperties=function applyTextureProperties(gl,source){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,canMipMap(source)?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(canMipMap(source)){gl.generateMipmap(gl.TEXTURE_2D);}};var createTexture=function createTexture(gl,source){var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,source);applyTextureProperties(gl,source);gl.bindTexture(gl.TEXTURE_2D,null);return texture;};var applyOpacity=function applyOpacity(color){var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return color?[color[0],color[1],color[2],isNumber(color[3])?opacity*color[3]:opacity]:[0,0,0,0];};var mat4Create=function mat4Create(){var mat=new Float32Array(16);mat[0]=1;mat[5]=1;mat[10]=1;mat[15]=1;return mat;};var mat4Perspective=function mat4Perspective(mat,fovy,aspect,near,far){var f=1.0/Math.tan(fovy/2);var nf=1/(near-far);mat[0]=f/aspect;mat[1]=0;mat[2]=0;mat[3]=0;mat[4]=0;mat[5]=f;mat[6]=0;mat[7]=0;mat[8]=0;mat[9]=0;mat[10]=(far+near)*nf;mat[11]=-1;mat[12]=0;mat[13]=0;mat[14]=2*far*near*nf;mat[15]=0;};var mat4Ortho=function mat4Ortho(mat,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);mat[0]=-2*lr;mat[1]=0;mat[2]=0;mat[3]=0;mat[4]=0;mat[5]=-2*bt;mat[6]=0;mat[7]=0;mat[8]=0;mat[9]=0;mat[10]=2*nf;mat[11]=0;mat[12]=(left+right)*lr;mat[13]=(top+bottom)*bt;mat[14]=(far+near)*nf;mat[15]=1;};var mat4Translate=function mat4Translate(mat,x,y,z){mat[12]=mat[0]*x+mat[4]*y+mat[8]*z+mat[12];mat[13]=mat[1]*x+mat[5]*y+mat[9]*z+mat[13];mat[14]=mat[2]*x+mat[6]*y+mat[10]*z+mat[14];mat[15]=mat[3]*x+mat[7]*y+mat[11]*z+mat[15];};var mat4Scale=function mat4Scale(mat,s){mat[0]=mat[0]*s;mat[1]=mat[1]*s;mat[2]=mat[2]*s;mat[3]=mat[3]*s;mat[4]=mat[4]*s;mat[5]=mat[5]*s;mat[6]=mat[6]*s;mat[7]=mat[7]*s;mat[8]=mat[8]*s;mat[9]=mat[9]*s;mat[10]=mat[10]*s;mat[11]=mat[11]*s;};var mat4ScaleX=function mat4ScaleX(mat,s){mat[0]=mat[0]*s;mat[1]=mat[1]*s;mat[2]=mat[2]*s;mat[3]=mat[3]*s;};var mat4ScaleY=function mat4ScaleY(mat,s){mat[4]=mat[4]*s;mat[5]=mat[5]*s;mat[6]=mat[6]*s;mat[7]=mat[7]*s;};var mat4RotateX=function mat4RotateX(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a10=mat[4];var a11=mat[5];var a12=mat[6];var a13=mat[7];var a20=mat[8];var a21=mat[9];var a22=mat[10];var a23=mat[11];mat[4]=a10*c+a20*s;mat[5]=a11*c+a21*s;mat[6]=a12*c+a22*s;mat[7]=a13*c+a23*s;mat[8]=a20*c-a10*s;mat[9]=a21*c-a11*s;mat[10]=a22*c-a12*s;mat[11]=a23*c-a13*s;};var mat4RotateY=function mat4RotateY(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=mat[0];var a01=mat[1];var a02=mat[2];var a03=mat[3];var a20=mat[8];var a21=mat[9];var a22=mat[10];var a23=mat[11];mat[0]=a00*c-a20*s;mat[1]=a01*c-a21*s;mat[2]=a02*c-a22*s;mat[3]=a03*c-a23*s;mat[8]=a00*s+a20*c;mat[9]=a01*s+a21*c;mat[10]=a02*s+a22*c;mat[11]=a03*s+a23*c;};var mat4RotateZ=function mat4RotateZ(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=mat[0];var a01=mat[1];var a02=mat[2];var a03=mat[3];var a10=mat[4];var a11=mat[5];var a12=mat[6];var a13=mat[7];mat[0]=a00*c+a10*s;mat[1]=a01*c+a11*s;mat[2]=a02*c+a12*s;mat[3]=a03*c+a13*s;mat[4]=a10*c-a00*s;mat[5]=a11*c-a01*s;mat[6]=a12*c-a02*s;mat[7]=a13*c-a03*s;};var degToRad=function degToRad(degrees){return degrees*Math.PI/180;};var previewFragmentShader=\"\\n##head\\nin vec2 vTexCoord;uniform sampler2D uTexture;uniform sampler2D uTextureMarkup;uniform vec2 uTextureSize;uniform float uOpacity;uniform vec4 uFillColor;uniform vec4 uOverlayColor;uniform mat4 uColorMatrix;uniform vec4 uColorOffset;uniform float uClarityKernel[9];uniform float uClarityKernelWeight;uniform float uColorGamma;uniform float uColorVignette;uniform float uMaskClip;uniform float uMaskOpacity;uniform float uMaskBounds[4];uniform float uMaskCornerRadius[4];uniform float uMaskFeather[8];vec4 applyGamma(vec4 c,float g){c.r=pow(c.r,g);c.g=pow(c.g,g);c.b=pow(c.b,g);return c;}vec4 applyColorMatrix(vec4 c,mat4 m,vec4 o){vec4 cM=(c*m)+o;cM*=cM.a;return cM;}vec4 applyConvolutionMatrix(vec4 c,float k0,float k1,float k2,float k3,float k4,float k5,float k6,float k7,float k8,float w){if(w<=0.0)return c;vec2 pixel=vec2(1)/uTextureSize;vec4 colorSum=texture(uTexture,vTexCoord+pixel*vec2(-1.0,-1.0))*k0+texture(uTexture,vTexCoord+pixel*vec2(0.0,-1.0))*k1+texture(uTexture,vTexCoord+pixel*vec2(1.0,-1.0))*k2+texture(uTexture,vTexCoord+pixel*vec2(-1.0,0.0))*k3+texture(uTexture,vTexCoord+pixel*vec2(0.0,0.0))*k4+texture(uTexture,vTexCoord+pixel*vec2(1.0,0.0))*k5+texture(uTexture,vTexCoord+pixel*vec2(-1.0,1.0))*k6+texture(uTexture,vTexCoord+pixel*vec2(0.0,1.0))*k7+texture(uTexture,vTexCoord+pixel*vec2(1.0,1.0))*k8;vec4 color=vec4((colorSum/w).rgb,c.a);color.rgb=clamp(color.rgb,0.0,1.0);return color;}vec4 applyVignette(vec4 c,vec2 pos,vec2 center,float v){float d=distance(pos,center)/length(center);float f=1.0-(d*abs(v));if(v>0.0){c.rgb*=f;}else if(v<0.0){c.rgb+=(1.0-f)*(1.0-c.rgb);}return c;}vec4 blendPremultipliedAlpha(vec4 back,vec4 front){return front+(back*(1.0-front.a));}void main(){float x=gl_FragCoord.x;float y=gl_FragCoord.y;float a=1.0;float maskTop=uMaskBounds[0];float maskRight=uMaskBounds[1];float maskBottom=uMaskBounds[2];float maskLeft=uMaskBounds[3];float leftFeatherOpacity=step(uMaskFeather[1],x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],x));a*=leftFeatherOpacity*rightFeatherOpacity;float overlayColorAlpha=(smoothstep(maskLeft,maskLeft+1.0,x)*(1.0-smoothstep(maskRight-1.0,maskRight,x))*(1.0-step(maskTop,y))*step(maskBottom,y));if(uOverlayColor.a==0.0){a*=overlayColorAlpha;}vec2 offset=vec2(maskLeft,maskBottom);vec2 size=vec2(maskRight-maskLeft,maskTop-maskBottom)*.5;vec2 center=offset.xy+size.xy;int pixelX=int(step(center.x,x));int pixelY=int(step(y,center.y));float cornerRadius=0.0;if(pixelX==0&&pixelY==0)cornerRadius=uMaskCornerRadius[0];if(pixelX==1&&pixelY==0)cornerRadius=uMaskCornerRadius[1];if(pixelX==0&&pixelY==1)cornerRadius=uMaskCornerRadius[2];if(pixelX==1&&pixelY==1)cornerRadius=uMaskCornerRadius[3];float cornerOffset=sign(cornerRadius)*length(max(abs(gl_FragCoord.xy-size-offset)-size+cornerRadius,0.0))-cornerRadius;float cornerOpacity=1.0-smoothstep(0.0,1.0,cornerOffset);a*=cornerOpacity;vec2 scaledPoint=vec2(vTexCoord.x*uTextureSize.x,vTexCoord.y*uTextureSize.y);a*=smoothstep(0.0,1.0,uTextureSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uTextureSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);vec4 color=texture(uTexture,vTexCoord);color=applyConvolutionMatrix(color,uClarityKernel[0],uClarityKernel[1],uClarityKernel[2],uClarityKernel[3],uClarityKernel[4],uClarityKernel[5],uClarityKernel[6],uClarityKernel[7],uClarityKernel[8],uClarityKernelWeight);color=applyGamma(color,uColorGamma);color=applyColorMatrix(color,uColorMatrix,uColorOffset);color=blendPremultipliedAlpha(uFillColor,color);color*=a;color=blendPremultipliedAlpha(color,texture(uTextureMarkup,vTexCoord));if(uColorVignette!=0.0){vec2 pos=gl_FragCoord.xy-offset;color=applyVignette(color,pos,center-offset,uColorVignette);}vec4 overlayColor=uOverlayColor*(1.0-overlayColorAlpha);overlayColor.rgb*=overlayColor.a;color=blendPremultipliedAlpha(color,overlayColor);if(uOverlayColor.a>0.0&&color.a<1.0&&uFillColor.a>0.0){color=blendPremultipliedAlpha(uFillColor,overlayColor);}color*=uOpacity;fragColor=color;}\";// eslint-disable-line\nvar previewVertexShader=\"\\n##head\\n##text\\nvoid main(){vTexCoord=aTexCoord;gl_Position=uMatrix*aPosition;}\";// eslint-disable-line\nvar pathVertexShader=\"#version 300 es\\n\\nin vec4 aPosition;in vec2 aNormal;in float aMiter;out vec2 vNormal;out float vMiter;uniform float uWidth;uniform mat4 uMatrix;void main(){vMiter=aMiter;vNormal=aNormal;float w=uWidth;gl_Position=uMatrix*vec4(aPosition.x+(aNormal.x*w*.5*aMiter),aPosition.y+(aNormal.y*w*.5*aMiter),0,1);}\";// eslint-disable-line\nvar pathFragmentShader=\"\\n##head\\n##mask\\nin vec2 vNormal;in float vMiter;uniform float uWidth;uniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;float w=(uWidth-1.0)*.5;float d=1.0-abs(vMiter);float m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);fillColor.a*=clamp(smoothstep(0.25,1.0,d*w),0.0,1.0);fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}\";// eslint-disable-line\nvar rectVertexShader=\"\\n##head\\n##text\\nin vec2 aRectCoord;out vec2 vRectCoord;void main(){vTexCoord=aTexCoord;vRectCoord=aRectCoord;\\n##matrix\\n}\";// eslint-disable-line\nvar rectFragmentShader=\"\\n##head\\n##mask\\nin vec2 vTexCoord;in vec2 vRectCoord;uniform sampler2D uTexture;uniform vec4 uTextureColor;uniform float uTextureOpacity;uniform vec4 uColor;uniform float uCornerRadius[4];uniform vec2 uSize;uniform vec2 uPosition;uniform vec4 uCanvasColor;void main(){\\n##init\\n##colorize\\n##edgeaa\\n##cornerradius\\n##maskfeatherapply\\n##maskapply\\n##fragcolor\\n}\";// eslint-disable-line\nvar ellipseVertexShader=\"\\n##head\\n##text\\nvoid main(){vTexCoord=vec2(aTexCoord.x*2.0-1.0,aTexCoord.y*2.0-1.0);\\n##matrix\\n}\";// eslint-disable-line\nvar ellipseFragmentShader=\"\\n##head\\n##mask\\nin vec2 vTexCoord;uniform sampler2D uTexture;uniform float uTextureOpacity;uniform vec2 uRadius;uniform vec4 uColor;uniform int uInverted;uniform vec4 uCanvasColor;void main(){\\n##init\\nfloat ar=uRadius.x/uRadius.y;vec2 rAA=vec2(uRadius.x-1.0,uRadius.y-(1.0/ar));vec2 scaledPointSq=vec2((vTexCoord.x*uRadius.x)*(vTexCoord.x*uRadius.x),(vTexCoord.y*uRadius.y)*(vTexCoord.y*uRadius.y));float p=(scaledPointSq.x/(uRadius.x*uRadius.x))+(scaledPointSq.y/(uRadius.y*uRadius.y));float pAA=(scaledPointSq.x/(rAA.x*rAA.x))+(scaledPointSq.y/(rAA.y*rAA.y));a=smoothstep(1.0,p/pAA,p);if(uInverted==1)a=1.0-a;\\n##maskapply\\n##fragcolor\\n}\";// eslint-disable-line\nvar triangleVertexShader=\"\\n##head\\nvoid main(){\\n##matrix\\n}\";// eslint-disable-line\nvar triangleFragmentShader=\"\\n##head\\n##mask\\nuniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;\\n##maskapply\\nfillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}\";// eslint-disable-line\nvar createPathSegment=function createPathSegment(vertices,index,a,b,c){var ab;var bc;ab=vectorNormalize(vectorCreate(b.x-a.x,b.y-a.y));bc=vectorNormalize(vectorCreate(c.x-b.x,c.y-b.y));var tangent=vectorNormalize(vectorCreate(ab.x+bc.x,ab.y+bc.y));var miter=vectorCreate(-tangent.y,tangent.x);var normal=vectorCreate(-ab.y,ab.x);// TODO: The Math.min is a \"dirty\" hack to prevent miter spikes, should bevel line edges\n// const dist = Math.min(1, 1 / vectorDot(miter, normal));\nvar miterLength=1/vectorDot(miter,normal);vertices[index]=b.x;vertices[index+1]=b.y;vertices[index+2]=miter.x;vertices[index+3]=miter.y;vertices[index+4]=-miterLength;vertices[index+5]=b.x;vertices[index+6]=b.y;vertices[index+7]=miter.x;vertices[index+8]=miter.y;vertices[index+9]=miterLength;};var createPathVertices=function createPathVertices(points,close){var a,b,c,i=0;var l=points.length;var stride=10;var vertices=new Float32Array((close?l+1:l)*stride);var first=points[0];var last=points[l-1];for(i=0;i<l;i++){a=points[i-1];b=points[i];c=points[i+1];// if previous point not available use inverse vector to next point\nif(!a)a=close?last:vectorCreate(b.x+(b.x-c.x),b.y+(b.y-c.y));// if next point not available use inverse vector from previous point\nif(!c)c=close?first:vectorCreate(b.x+(b.x-a.x),b.y+(b.y-a.y));createPathSegment(vertices,i*stride,a,b,c);}if(close)createPathSegment(vertices,l*stride,last,first,points[1]);return vertices;};var rectPointsToVertices=function rectPointsToVertices(points){// [tl, tr, br, bl]\n// B   D\n// | \\ |\n// A  C\nvar vertices=new Float32Array(8);vertices[0]=points[3].x;vertices[1]=points[3].y;vertices[2]=points[0].x;vertices[3]=points[0].y;vertices[4]=points[2].x;vertices[5]=points[2].y;vertices[6]=points[1].x;vertices[7]=points[1].y;return vertices;};var trianglePointToVertices=function trianglePointToVertices(points){var vertices=new Float32Array(6);vertices[0]=points[0].x;vertices[1]=points[0].y;vertices[2]=points[1].x;vertices[3]=points[1].y;vertices[4]=points[2].x;vertices[5]=points[2].y;return vertices;};var createRectPoints=function createRectPoints(rect){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2?arguments[2]:undefined;var flipY=arguments.length>3?arguments[3]:undefined;var corners=rectGetCorners(rect);var cx=rect.x+rect.width*0.5;var cy=rect.y+rect.height*0.5;if(flipX||flipY)vectorsFlip(corners,flipX,flipY,cx,cy);if(rotation!==0)vectorsRotate(corners,rotation,cx,cy);return corners;};var createEllipseOutline=function createEllipseOutline(x,y,width,height,rotation,flipX,flipY){var points=[];// decide how much points we need to describe the circle\nvar size=Math.abs(width)+Math.abs(height);var precision=Math.max(20,Math.round(size/6));var w=width*0.5;var h=height*0.5;var cx=x+w;var cy=y+h;for(var i=0;i<precision;i++){points.push(vectorCreate(cx+w*Math.cos(i*(Math.PI*2)/precision),cy+h*Math.sin(i*(Math.PI*2)/precision)));}if(flipX||flipY)vectorsFlip(points,flipX,flipY,cx,cy);if(rotation)vectorsRotate(points,rotation,cx,cy);return points;};var createRectOutline=function createRectOutline(x,y,width,height,rotation,cornerRadius,flipX,flipY){var points=[];if(cornerRadius.every(function(v){return v===0;})){points.push(vectorCreate(x,y),// top left corner\nvectorCreate(x+width,y),// top right corner\nvectorCreate(x+width,y+height),// bottom right corner\nvectorCreate(x,y+height)// bottom left corner\n);}else{var _cornerRadius=_slicedToArray(cornerRadius,4),tl=_cornerRadius[0],tr=_cornerRadius[1],bl=_cornerRadius[2],br=_cornerRadius[3];var l=x;var _r4=x+width;var t=y;var b=y+height;// start at end of top left corner\npoints.push(vectorCreate(l+tl,t));pushRectCornerPoints(points,_r4-tr,t+tr,tr,-1);// move to bottom right corner\npoints.push(vectorCreate(_r4,t+tr));pushRectCornerPoints(points,_r4-br,b-br,br,0);// move to bottom left corner\npoints.push(vectorCreate(_r4-br,b));pushRectCornerPoints(points,l+bl,b-bl,bl,1);// move to top left corner\npoints.push(vectorCreate(l,b-bl));pushRectCornerPoints(points,l+tl,t+tl,tl,2);}if(flipX||flipY)vectorsFlip(points,flipX,flipY,x+width*0.5,y+height*0.5);if(rotation)vectorsRotate(points,rotation,x+width*0.5,y+height*0.5);return points;};var pushRectCornerPoints=function pushRectCornerPoints(points,x,y,radius,offset){var precision=Math.min(20,Math.max(4,Math.round(radius/2)));var p=0;var s=0;var rx=0;var ry=0;var i=0;for(;i<precision;i++){p=i/precision;s=offset*HALF_PI+p*HALF_PI;rx=radius*Math.cos(s);ry=radius*Math.sin(s);points.push(vectorCreate(x+rx,y+ry));}};var getWebGLContext=function getWebGLContext(canvas,attrs){return canvas.getContext('webgl2',attrs)||canvas.getContext('webgl',attrs)||canvas.getContext('experimental-webgl',attrs);};// prettier-ignore\n// B   D\n// | \\ |\n// A  C\nvar rectUV=new Float32Array([0.0,1.0,0.0,0.0,1.0,1.0,1.0,0.0]);var createGLImageDrawer=function createGLImageDrawer(canvas,imageData,imageSize,pixelDensity){var viewSize={width:0,height:0};var viewSizeVisual={width:0,height:0};var viewAspectRatio;var viewPixelDensity;var viewZ;var markupMatrixCanvas;var markupMatrixFrameBuffer;var markupMatrix;var imagePositions;var maskTop;var maskRight;var maskBottom;var maskLeft;var maskOpacity;var maskBounds;var canvasColor=[0,0,0];//#region texture handling\n// offset +   0 : white\n// offset +   1 : transparent\n// offset +   2 : preview markup\n// offset +   3 : preview\n// offset + >=4 : markup\nvar TEXTURE_WHITE_INDEX=0;var TEXTURE_TRANSPARENT_INDEX=1;var TEXTURE_PREVIEW_MARKUP_INDEX=2;var TEXTURE_PREVIEW_INDEX=3;var TEXTURE_OFFSET=4;var textures=[];var setTextureObject=function setTextureObject(index,texture){var source=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;var storedTexture=textures[index];if(storedTexture)gl.deleteTexture(storedTexture.texture);textures[index]={texture:texture,source:source,textureAspectRatio:source?getAspectRatio(source.width,source.height):undefined};return index;};var getTextureSize=function getTextureSize(index){var source=textures[index].source;return source&&{width:source.width,height:source.height};};var getAvailableTextureIndex=function getAvailableTextureIndex(){var index=textures.findIndex(function(value){return value===undefined;});return index<TEXTURE_OFFSET?textures.length:index;};var addTextureObject=function addTextureObject(texture){var source=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;return setTextureObject(getAvailableTextureIndex(),texture,source);};var addTexture=function addTexture(source){return addTextureObject(createTexture(gl,source),source);};var setTexture=function setTexture(index,source){setTextureObject(index,createTexture(gl,source),source);};var reserveTexture=function reserveTexture(index){textures[index]={};};var removeTexture=function removeTexture(index){var item=textures[index];gl.deleteTexture(item.texture);if(item.source instanceof HTMLCanvasElement)releaseCanvas(item.source);textures[index]=undefined;};//#endregion\n// resize view\nvar resize=function resize(width,height,pixelDensity){// density\nviewPixelDensity=pixelDensity;// visual size\nviewSizeVisual.width=width;viewSizeVisual.height=height;// size\nviewSize.width=width*pixelDensity;viewSize.height=height*pixelDensity;// calculate the aspect ratio, we use this to determine quad size\nviewAspectRatio=getAspectRatio(viewSize.width,viewSize.height);// sync dimensions with image data\ncanvas.width=viewSize.width;canvas.height=viewSize.height;// redefine matrices\nmarkupMatrixCanvas=mat4Create();mat4Ortho(markupMatrixCanvas,0,viewSize.width,viewSize.height,0,-1,1);markupMatrixFrameBuffer=mat4Create();var w=imageData.width*pixelDensity;var h=imageData.height*pixelDensity;mat4Ortho(markupMatrixFrameBuffer,0,w,h,0,-1,1);mat4Translate(markupMatrixFrameBuffer,0,h,0);mat4ScaleX(markupMatrixFrameBuffer,1);mat4ScaleY(markupMatrixFrameBuffer,-1);// update preview markup texture\ngl.bindTexture(gl.TEXTURE_2D,textures[TEXTURE_PREVIEW_MARKUP_INDEX].texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,imageData.width,imageData.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);// set the filtering, we don't need mips\ngl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindFramebuffer(gl.FRAMEBUFFER,fb);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,textures[TEXTURE_PREVIEW_MARKUP_INDEX].texture,0);// update image texture\nvar imageWidth=imageSize.width*pixelDensity;var imageHeight=imageSize.height*pixelDensity;var l=imageWidth*-0.5;var t=imageHeight*0.5;var r=imageWidth*0.5;var b=imageHeight*-0.5;// prettier-ignore\n// B   D\n// | \\ |\n// A  C\nimagePositions=new Float32Array([l,b,0,l,t,0,r,b,0,r,t,0]);gl.bindBuffer(gl.ARRAY_BUFFER,imagePositionsBuffer);gl.bufferData(gl.ARRAY_BUFFER,imagePositions,gl.STATIC_DRAW);// move image backwards so it's presented in actual pixel size\nviewZ=// 1. we calculate the z offset required to have the\n//    image height match the view height\n/*        /|\n                     / |\n                    /  | height / 2\n                   /   |\n            f / 2 /__z_|\n                  \\    |\n                   \\   |\n                    \\  |\n                     \\ |\n                      \\|\n            */imageSize.height/2/FOV_TAN_HALF*(// 2. we want to render the image at the actual height, viewsize / height gets us results in a 1:1 presentation\nviewSize.height/imageSize.height)*// 3. z has to be negative, therefor multiply by -1\n-1;};// fov is fixed\nvar FOV=degToRad(30);var FOV_TAN_HALF=Math.tan(FOV/2);// get gl drawing context\nvar gl=getWebGLContext(canvas,{antialias:false,alpha:false,premultipliedAlpha:true});// no drawing context received, exit\nif(!gl)return;// enable derivatives\ngl.getExtension('OES_standard_derivatives');// toggle gl settings\ngl.disable(gl.DEPTH_TEST);// set blend mode, we need it for alpha blending\ngl.enable(gl.BLEND);/*\n    https://webglfundamentals.org/webgl/lessons/webgl-and-alpha.html\n    most if not all Canvas 2D implementations work with pre-multiplied alpha.\n    That means when you transfer them to WebGL and UNPACK_PREMULTIPLY_ALPHA_WEBGL\n    is false WebGL will convert them back to un-premultipiled.\n    With pre-multiplied alpha on, [1, .5, .5, 0] does not exist, it's always [0, 0, 0, 0]\n    */gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);// something to look into:\n// gl.UNPACK_COLORSPACE_CONVERSION_WEBGL\n// create white base shape texture\nvar whiteTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,whiteTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,// width\n1,// height\n0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])// white background\n);setTextureObject(TEXTURE_WHITE_INDEX,whiteTexture);var transparentTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,transparentTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,// width\n1,// height\n0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])// transparent background\n);setTextureObject(TEXTURE_TRANSPARENT_INDEX,transparentTexture);// create image markup texture and framebuffer\nvar imageMarkupTexture=gl.createTexture();setTextureObject(TEXTURE_PREVIEW_MARKUP_INDEX,imageMarkupTexture);var fb=gl.createFramebuffer();// #region image\n// create preview texture\nsetTexture(TEXTURE_PREVIEW_INDEX,imageData);var imagePositionsBuffer=gl.createBuffer();var texturePositionsBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texturePositionsBuffer);gl.bufferData(gl.ARRAY_BUFFER,rectUV,gl.STATIC_DRAW);// prettier-ignore\n// B   D\n// | \\ |\n// A  C\nvar imageCoordinateCount=4;// create default pixel drawing program, supports what we need\nvar previewShader=createShader(gl,previewVertexShader,previewFragmentShader,['aPosition','aTexCoord'],['uMatrix','uTexture','uTextureMarkup','uTextureSize','uColorGamma','uColorVignette','uColorOffset','uColorMatrix','uClarityKernel','uClarityKernelWeight','uOpacity','uMaskOpacity','uMaskBounds','uMaskCornerRadius','uMaskFeather','uFillColor','uOverlayColor']);// tell canvas context to use program\ngl.useProgram(previewShader.program);// transform vars\nvar matrix;var drawPreviewImage=function drawPreviewImage(originX,originY,translateX,translateY,rotateX,rotateY,rotateZ,scale,colorMatrix){var opacity=arguments.length>9&&arguments[9]!==undefined?arguments[9]:1;var clarity=arguments.length>10?arguments[10]:undefined;var gamma=arguments.length>11&&arguments[11]!==undefined?arguments[11]:1;var vignette=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var maskFeather=arguments.length>13&&arguments[13]!==undefined?arguments[13]:[1,0,1,0,1,viewSizeVisual.width,1,viewSizeVisual.width];var maskCornerRadius=arguments.length>14&&arguments[14]!==undefined?arguments[14]:[0,0,0,0];var imageBackgroundColor=arguments.length>15&&arguments[15]!==undefined?arguments[15]:[0,0,0,0];var imageOverlayColor=arguments.length>16&&arguments[16]!==undefined?arguments[16]:[0,0,0,0];var enableMarkup=arguments.length>17&&arguments[17]!==undefined?arguments[17]:true;var program=previewShader.program,locations=previewShader.locations;// convert to pixel density\ntranslateX*=viewPixelDensity;translateY*=viewPixelDensity;originX*=viewPixelDensity;originY*=viewPixelDensity;// apply\nmatrix=mat4Create();mat4Perspective(matrix,FOV,viewAspectRatio,1,-viewZ*2);// move image\nmat4Translate(matrix,translateX,-translateY,viewZ);// set rotation origin in view\nmat4Translate(matrix,originX,-originY,0);// rotate image\nmat4RotateZ(matrix,-rotateZ);// resize\nmat4Scale(matrix,scale);// reset rotation origin\nmat4Translate(matrix,-originX,originY,0);// flip\nmat4RotateY(matrix,rotateY);mat4RotateX(matrix,rotateX);//\n// tell context to draw preview\n//\ngl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);// set up texture\nvar previewTexture=textures[TEXTURE_PREVIEW_INDEX];gl.uniform1i(locations.uTexture,TEXTURE_PREVIEW_INDEX);gl.uniform2f(locations.uTextureSize,imageData.width,imageData.height);gl.activeTexture(gl.TEXTURE0+TEXTURE_PREVIEW_INDEX);gl.bindTexture(gl.TEXTURE_2D,previewTexture.texture);// set up markup texture\nvar textureIndex=enableMarkup?TEXTURE_PREVIEW_MARKUP_INDEX:TEXTURE_TRANSPARENT_INDEX;var markupTexture=textures[textureIndex];gl.uniform1i(locations.uTextureMarkup,textureIndex);gl.activeTexture(gl.TEXTURE0+textureIndex);gl.bindTexture(gl.TEXTURE_2D,markupTexture.texture);// set up buffers\ngl.bindBuffer(gl.ARRAY_BUFFER,imagePositionsBuffer);gl.vertexAttribPointer(locations.aPosition,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,texturePositionsBuffer);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);// update matrix\ngl.uniformMatrix4fv(locations.uMatrix,false,matrix);// overlay color\ngl.uniform4fv(locations.uOverlayColor,imageOverlayColor);gl.uniform4fv(locations.uFillColor,imageBackgroundColor);// convolution\nvar clarityWeight;if(!clarity){clarity=[0,0,0,0,1,0,0,0,0];clarityWeight=-1;}else{clarityWeight=clarity.reduce(function(prev,curr){return prev+curr;},0);clarityWeight=clarityWeight<=0?1:clarityWeight;}gl.uniform1fv(locations.uClarityKernel,clarity);gl.uniform1f(locations.uClarityKernelWeight,clarityWeight);gl.uniform1f(locations.uColorGamma,1.0/gamma);gl.uniform1f(locations.uColorVignette,vignette);// set color matrix values\ngl.uniform4f(locations.uColorOffset,colorMatrix[4],colorMatrix[9],colorMatrix[14],colorMatrix[19]);gl.uniformMatrix4fv(locations.uColorMatrix,false,[colorMatrix[0],colorMatrix[1],colorMatrix[2],colorMatrix[3],colorMatrix[5],colorMatrix[6],colorMatrix[7],colorMatrix[8],colorMatrix[10],colorMatrix[11],colorMatrix[12],colorMatrix[13],colorMatrix[15],colorMatrix[16],colorMatrix[17],colorMatrix[18]]);// opacity level\ngl.uniform1f(locations.uOpacity,opacity);// mask\ngl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1fv(locations.uMaskCornerRadius,maskCornerRadius.map(function(v){return v*pixelDensity;}));gl.uniform1fv(locations.uMaskFeather,maskFeather.map(function(v,i){return i%2===0?v:v*pixelDensity;}));gl.drawArrays(gl.TRIANGLE_STRIP,0,imageCoordinateCount);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);};//#endregion\n// #region path\nvar pathShader=createShader(gl,pathVertexShader,pathFragmentShader,['aPosition','aNormal','aMiter'],['uColor','uCanvasColor','uMatrix','uWidth','uMaskBounds','uMaskOpacity']);var pathBuffer=gl.createBuffer();var strokePath=function strokePath(points,width,color,close){var program=pathShader.program,locations=pathShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aNormal);gl.enableVertexAttribArray(locations.aMiter);var vertices=createPathVertices(points,close);var stride=Float32Array.BYTES_PER_ELEMENT*5;var normalOffset=Float32Array.BYTES_PER_ELEMENT*2;// at position 2\nvar miterOffset=Float32Array.BYTES_PER_ELEMENT*4;// at position 4\ngl.uniform1f(locations.uWidth,width+2.0);gl.uniform4fv(locations.uColor,color);gl.uniformMatrix4fv(locations.uMatrix,false,markupMatrix);gl.uniform4f(locations.uCanvasColor,canvasColor[0],canvasColor[1],canvasColor[2],1);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.bindBuffer(gl.ARRAY_BUFFER,pathBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,stride,0);gl.vertexAttribPointer(locations.aNormal,2,gl.FLOAT,false,stride,normalOffset);gl.vertexAttribPointer(locations.aMiter,1,gl.FLOAT,false,stride,miterOffset);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/5);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aNormal);gl.disableVertexAttribArray(locations.aMiter);};//#endregion\n// #region triangle\nvar triangleShader=createShader(gl,triangleVertexShader,triangleFragmentShader,['aPosition'],['uColor','uCanvasColor','uMatrix','uMaskBounds','uMaskOpacity']);var triangleBuffer=gl.createBuffer();var fillTriangle=function fillTriangle(vertices,backgroundColor){var program=triangleShader.program,locations=triangleShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniformMatrix4fv(locations.uMatrix,false,markupMatrix);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform4f(locations.uCanvasColor,canvasColor[0],canvasColor[1],canvasColor[2],1);gl.bindBuffer(gl.ARRAY_BUFFER,triangleBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);return vertices;};//#endregion\n// #region rect\nvar rectShaderAttributes=['aPosition','aTexCoord','aRectCoord'];var rectShaderUniforms=['uTexture','uColor','uMatrix','uCanvasColor','uTextureColor','uTextureOpacity','uPosition','uSize','uMaskBounds','uMaskOpacity','uMaskFeather','uCornerRadius'];var rectShader=createShader(gl,rectVertexShader,rectFragmentShader,rectShaderAttributes,rectShaderUniforms);var rectBuffer=gl.createBuffer();var rectTextureBuffer=gl.createBuffer();var rectCornerBuffer=gl.createBuffer();var rectTextureColorFilter=[0,0,0,0];var fillRect=function fillRect(vertices,width,height,cornerRadius,backgroundColor,backgroundImage){var opacity=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1.0;var colorFilter=arguments.length>7&&arguments[7]!==undefined?arguments[7]:rectTextureColorFilter;var uv=arguments.length>8&&arguments[8]!==undefined?arguments[8]:rectUV;var maskFeather=arguments.length>9&&arguments[9]!==undefined?arguments[9]:[1,0,1,0,1,Math.max(viewSize.width,imageData.width),1,Math.max(viewSize.width,imageData.width)];var program=rectShader.program,locations=rectShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);gl.enableVertexAttribArray(locations.aRectCoord);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniform4fv(locations.uTextureColor,colorFilter);gl.uniform1f(locations.uTextureOpacity,opacity);gl.uniform2fv(locations.uSize,[width,height]);gl.uniform2fv(locations.uPosition,[vertices[2],vertices[3]]);gl.uniform1fv(locations.uCornerRadius,cornerRadius);gl.uniform4f(locations.uCanvasColor,canvasColor[0],canvasColor[1],canvasColor[2],1);// mask\ngl.uniform1fv(locations.uMaskFeather,maskFeather.map(function(v,i){return i%2===0?v:v*pixelDensity;}));gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniformMatrix4fv(locations.uMatrix,false,markupMatrix);var textureIndex=textures[backgroundImage]&&textures[backgroundImage].texture?backgroundImage:TEXTURE_TRANSPARENT_INDEX;gl.uniform1i(locations.uTexture,textureIndex);gl.activeTexture(gl.TEXTURE0+textureIndex);gl.bindTexture(gl.TEXTURE_2D,textures[textureIndex].texture);gl.bindBuffer(gl.ARRAY_BUFFER,rectTextureBuffer);gl.bufferData(gl.ARRAY_BUFFER,uv,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);// we use these coordinates combined with the size of the rect to interpolate and alias edges\ngl.bindBuffer(gl.ARRAY_BUFFER,rectCornerBuffer);gl.bufferData(gl.ARRAY_BUFFER,rectUV,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aRectCoord,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,rectBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);gl.disableVertexAttribArray(locations.aRectCoord);return vertices;};//#endregion\n// #region ellipse\nvar ellipseShader=createShader(gl,ellipseVertexShader,ellipseFragmentShader,['aPosition','aTexCoord'],['uTexture','uTextureOpacity','uColor','uCanvasColor','uMatrix','uRadius','uInverted','uMaskBounds','uMaskOpacity']);var ellipseBuffer=gl.createBuffer();var ellipseTextureBuffer=gl.createBuffer();var fillEllipse=function fillEllipse(vertices,width,height,backgroundColor){var backgroundImage=arguments.length>4&&arguments[4]!==undefined?arguments[4]:TEXTURE_TRANSPARENT_INDEX;var opacity=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1.0;var inverted=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var program=ellipseShader.program,locations=ellipseShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);gl.uniform2fv(locations.uRadius,[width*0.5,height*0.5]);gl.uniform1i(locations.uInverted,inverted?1:0);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniformMatrix4fv(locations.uMatrix,false,markupMatrix);gl.uniform4f(locations.uCanvasColor,canvasColor[0],canvasColor[1],canvasColor[2],1);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform1i(locations.uTexture,backgroundImage);gl.uniform1f(locations.uTextureOpacity,opacity);gl.activeTexture(gl.TEXTURE0+backgroundImage);gl.bindTexture(gl.TEXTURE_2D,textures[backgroundImage].texture);gl.bindBuffer(gl.ARRAY_BUFFER,ellipseTextureBuffer);gl.bufferData(gl.ARRAY_BUFFER,rectUV,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,ellipseBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);};//#endregion\n//\n// draw calls\n//\nvar drawPath=function drawPath(points,strokeWidth,strokeColor,opacity){// is no line\nif(points.length<2)return;strokePath(points.map(function(p){return{x:p.x*pixelDensity,y:p.y*pixelDensity};}),strokeWidth*pixelDensity,applyOpacity(strokeColor,opacity),false);};var drawTriangle=function drawTriangle(points){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var flipY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var backgroundColor=arguments.length>4?arguments[4]:undefined;var opacity=arguments.length>5?arguments[5]:undefined;if(!backgroundColor)return;var clonedPoints=points.map(function(p){return{x:p.x*pixelDensity,y:p.y*pixelDensity};});var center=quadCentroid(clonedPoints);if(flipX||flipY)vectorsFlip(clonedPoints,flipX,flipY,center.x,center.y);vectorsRotate(clonedPoints,rotation,center.x,center.y);var vertices=trianglePointToVertices(clonedPoints);fillTriangle(vertices,applyOpacity(backgroundColor,opacity));};var getBackgroundUV=function getBackgroundUV(width,height,backgroundSize,backgroundPosition){if(!backgroundSize&&!backgroundPosition)return rectUV;var x=backgroundPosition.x/backgroundSize.width;var y=backgroundPosition.y/backgroundSize.height;var w=width/backgroundSize.width/pixelDensity;var h=height/backgroundSize.height/pixelDensity;w-=x;h-=y;// prettier-ignore\n// B   D\n// | \\ |\n// A  C\n// bottom left\nvar ax=-x;var ay=h;// top left\nvar bx=-x;var by=-y;// bottom right\nvar cx=w;var cy=h;// top right\nvar dx=w;var dy=-y;return new Float32Array([ax,ay,bx,by,cx,cy,dx,dy]);};var limitCornerRadius=function limitCornerRadius(r,size){return Math.floor(clamp(r,0,Math.min((size.width-1)*0.5,(size.height-1)*0.5)));};var drawRect=function drawRect(rect){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var flipY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var cornerRadius=arguments.length>4?arguments[4]:undefined;var backgroundColor=arguments.length>5?arguments[5]:undefined;var backgroundImage=arguments.length>6?arguments[6]:undefined;var backgroundSize=arguments.length>7&&arguments[7]!==undefined?arguments[7]:undefined;var backgroundPosition=arguments.length>8&&arguments[8]!==undefined?arguments[8]:undefined;var strokeWidth=arguments.length>9?arguments[9]:undefined;var strokeColor=arguments.length>10?arguments[10]:undefined;var opacity=arguments.length>11?arguments[11]:undefined;var maskFeather=arguments.length>12&&arguments[12]!==undefined?arguments[12]:undefined;var colorize=arguments.length>13?arguments[13]:undefined;// clone first\nvar rectOut=rectMultiply(rectClone(rect),pixelDensity);// has radius, doesn't matter for coordinates\nvar cornerRadiusOut=cornerRadius.map(function(r){return limitCornerRadius(r||0,rect);}).map(function(r){return r*viewPixelDensity;});// should fill\nif(backgroundColor||backgroundImage){// adjust for edge anti-aliasing, if we don't do this the\n// visible rectangle will be 1 pixel smaller than the actual rectangle\nvar rectFill=rectClone(rectOut);rectFill.x-=0.5;rectFill.y-=0.5;rectFill.width+=1.0;rectFill.height+=1.0;var points=createRectPoints(rectFill,rotation,flipX,flipY);var vertices=rectPointsToVertices(points);var color;if(colorize){color=applyOpacity(colorize);// as 0 transparancy is used to test if the colorize filter should be applied we set it to 0.001\nif(color[3]===0)color[3]=0.001;}fillRect(vertices,rectFill.width,rectFill.height,cornerRadiusOut,applyOpacity(backgroundColor,opacity),backgroundImage,opacity,color,getBackgroundUV(rectFill.width,rectFill.height,backgroundSize,backgroundPosition),maskFeather);}// should draw outline\nif(strokeWidth){// fixes issue where stroke would render weirdly\nstrokeWidth=Math.min(strokeWidth,rectOut.width,rectOut.height);strokePath(// rect out is already multiplied by pixel density\ncreateRectOutline(rectOut.x,rectOut.y,rectOut.width,rectOut.height,rotation,cornerRadiusOut,flipX,flipY),strokeWidth*pixelDensity,applyOpacity(strokeColor,opacity),true);}};var drawEllipse=function drawEllipse(center,rx,ry,rotation,flipX,flipY,backgroundColor,backgroundImage,strokeWidth,strokeColor,opacity,inverted){var rectOut=rectMultiply(rectCreate(center.x-rx,center.y-ry,rx*2,ry*2),pixelDensity);if(backgroundColor||backgroundImage){// adjust for edge anti-aliasing, if we don't do this the\n// visible rectangle will be 1 pixel smaller than the actual rectangle\nvar rectFill=rectClone(rectOut);rectFill.x-=0.5;rectFill.y-=0.5;rectFill.width+=1.0;rectFill.height+=1.0;var points=createRectPoints(rectFill,rotation,flipX,flipY);var vertices=rectPointsToVertices(points);fillEllipse(vertices,rectFill.width,rectFill.height,applyOpacity(backgroundColor,opacity),backgroundImage,opacity,inverted);}if(strokeWidth)strokePath(// rect out is already multiplied by pixeldensity\ncreateEllipseOutline(rectOut.x,rectOut.y,rectOut.width,rectOut.height,rotation,flipX,flipY),strokeWidth*pixelDensity,applyOpacity(strokeColor,opacity),true);};//#endregion\nreturn{// draw api\ndrawPath:drawPath,drawTriangle:drawTriangle,drawRect:drawRect,drawEllipse:drawEllipse,drawPreviewImage:drawPreviewImage,setCanvasColor:function setCanvasColor(color){canvasColor=color;},drawToCanvas:function drawToCanvas(){gl.bindFramebuffer(gl.FRAMEBUFFER,null);// switch transform matrix\nmarkupMatrix=markupMatrixCanvas;// tell webgl about the viewport\ngl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);// black (or other color depending on background)\ngl.colorMask(true,true,true,false);gl.clearColor(canvasColor[0],canvasColor[1],canvasColor[2],1);// gl.clearColor(0.25, 0.25, 0.25, 1); // for debugging\ngl.clear(gl.COLOR_BUFFER_BIT);},drawToFramebuffer:function drawToFramebuffer(){// is twice as big as the loaded image\ngl.bindFramebuffer(gl.FRAMEBUFFER,fb);// switch transform matrix\nmarkupMatrix=markupMatrixFrameBuffer;// tell webgl about the \"viewport\"\ngl.viewport(0,0,imageData.width,imageData.height);// always transparent\ngl.colorMask(true,true,true,true);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);},// texture management\naddTexture:addTexture,setTexture:setTexture,reserveTexture:reserveTexture,removeTexture:removeTexture,getTextureSize:getTextureSize,getAvailableTextureIndex:getAvailableTextureIndex,// set mask\nenableMask:function enableMask(rect,opacity){var maskX=rect.x*viewPixelDensity;var maskY=rect.y*viewPixelDensity;var maskWidth=rect.width*viewPixelDensity;var maskHeight=rect.height*viewPixelDensity;maskLeft=maskX;maskRight=maskLeft+maskWidth;maskTop=viewSize.height-maskY;maskBottom=viewSize.height-(maskY+maskHeight);maskOpacity=1.0-opacity;maskBounds=[maskTop,maskRight,maskBottom,maskLeft];},disableMask:function disableMask(){maskLeft=0;maskRight=viewSize.width;maskTop=viewSize.height;maskBottom=0;maskOpacity=1;maskBounds=[maskTop,maskRight,maskBottom,maskLeft];},// canvas\nresize:resize,release:function release(){canvas.width=1;canvas.height=1;}};};/* src/core/ui/components/Canvas.svelte generated by Svelte v3.29.4 */function create_fragment(ctx){var div;var canvas_1;var measurable_action;var mounted;var dispose;return{c:function c(){div=element(\"div\");canvas_1=element(\"canvas\");attr(div,\"class\",\"DokaCanvas\");},m:function m(target,anchor){insert(target,div,anchor);append(div,canvas_1);/*canvas_1_binding*/ctx[15](canvas_1);if(!mounted){dispose=[listen(canvas_1,\"measure\",/*handleSizeChange*/ctx[4]),action_destroyer(measurable_action=measurable.call(null,canvas_1))];mounted=true;}},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(div);/*canvas_1_binding*/ctx[15](null);mounted=false;run_all(dispose);}};}function instance($$self,$$props,$$invalidate){var $imageMain;var $background;var $mask;var dispatch=createEventDispatcher();// fallback matrix\nvar COLOR_MATRIX_IDENTITY=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];var animate=$$props.animate;var imageData=$$props.imageData;var imageSize=$$props.imageSize;var imageProps=$$props.imageProps;var _$$props$imagePreview=$$props.imagePreviews,imagePreviews=_$$props$imagePreview===void 0?[]:_$$props$imagePreview;var maskRect=$$props.maskRect;var _$$props$pixelRatio=$$props.pixelRatio,pixelRatio=_$$props$pixelRatio===void 0?1:_$$props$pixelRatio;var _$$props$willRender=$$props.willRender,willRender=_$$props$willRender===void 0?passthrough:_$$props$willRender;var _$$props$loadImageDat=$$props.loadImageData,loadImageData=_$$props$loadImageDat===void 0?passthrough:_$$props$loadImageDat;var backgroundColor=$$props.backgroundColor;//\n// springyness for main preview\n//\nvar updateSpring=function updateSpring(spring,value){return spring.set(value,{hard:!animate});};var blendWithCanvasBackground=function blendWithCanvasBackground(back,front){var _back=_slicedToArray(back,3),bR=_back[0],bG=_back[1],bB=_back[2];var _front=_slicedToArray(front,4),fR=_front[0],fG=_front[1],fB=_front[2],fA=_front[3];return[fR*fA+bR*(1-fA),fG*fA+bG*(1-fA),fB*fA+bB*(1-fA),1];};var SPRING_PROPS={precision:0.0001};var SPRING_PROPS_FRACTION={precision:SPRING_PROPS.precision*0.01};var background=tweened(undefined,{duration:250});component_subscribe($$self,background,function(value){return $$invalidate(22,$background=value);});var translation=spring(undefined,SPRING_PROPS);var rotation=spring(undefined,SPRING_PROPS_FRACTION);var origin=spring(undefined,SPRING_PROPS);var perspective=spring(undefined,SPRING_PROPS_FRACTION);var scale=spring(undefined,SPRING_PROPS_FRACTION);var gamma=spring(undefined,SPRING_PROPS_FRACTION);var vignette=spring(undefined,SPRING_PROPS_FRACTION);var colorMatrix=spring([].concat(COLOR_MATRIX_IDENTITY),SPRING_PROPS);var clarity=writable(undefined);var opacity=spring(0,SPRING_PROPS_FRACTION);var maskOpacity=spring(1,SPRING_PROPS_FRACTION);var mask=writable();component_subscribe($$self,mask,function(value){return $$invalidate(24,$mask=value);});var imageBackgroundColor=writable();var imageMain=derived([origin,translation,perspective,rotation,scale,opacity,colorMatrix,mask,maskOpacity,clarity,gamma,vignette,imageBackgroundColor,background],function(_ref92,set){var _ref93=_slicedToArray(_ref92,14),$origin=_ref93[0],$translation=_ref93[1],$perspective=_ref93[2],$rotation=_ref93[3],$scale=_ref93[4],$opacity=_ref93[5],$colorMatrix=_ref93[6],$mask=_ref93[7],$maskOpacity=_ref93[8],$clarity=_ref93[9],$gamma=_ref93[10],$vignette=_ref93[11],$imageBackgroundColor=_ref93[12],$background=_ref93[13];if(!imageProps||!$background)return set(undefined);var maskOpacityClamped=clamp($maskOpacity,0,1);set({origin:$origin,translation:$translation,perspective:$perspective,rotation:$rotation,scale:$scale,colorMatrix:$colorMatrix,opacity:clamp($opacity,0,1),clarity:$clarity,gamma:$gamma,vignette:$vignette,mask:$mask,maskOpacity:maskOpacityClamped,overlayColor:[$background[0],$background[1],$background[2],maskOpacityClamped],backgroundColor:$imageBackgroundColor});});component_subscribe($$self,imageMain,function(value){return $$invalidate(21,$imageMain=value);});//\n// rendering\n//\nvar canvas;var webGLImageDrawer=null;var width=null;var height=null;var drawPreviewImage=function drawPreviewImage(_ref94){var origin=_ref94.origin,translation=_ref94.translation,rotation=_ref94.rotation,scale=_ref94.scale,colorMatrix=_ref94.colorMatrix,opacity=_ref94.opacity,clarity=_ref94.clarity,gamma=_ref94.gamma,vignette=_ref94.vignette,offset=_ref94.offset,maskFeather=_ref94.maskFeather,maskCornerRadius=_ref94.maskCornerRadius,backgroundColor=_ref94.backgroundColor,overlayColor=_ref94.overlayColor,enableShapes=_ref94.enableShapes;var tx=translation.x;var ty=translation.y;if(offset){tx+=offset.x-width*0.5;ty+=offset.y-height*0.5;}// calculate opaque backgroundColor if is background color is transparent and visible\nif(backgroundColor[3]<1&&backgroundColor[3]>0){backgroundColor=blendWithCanvasBackground($background,backgroundColor);}webGLImageDrawer.drawPreviewImage(origin.x,origin.y,tx,ty,rotation.x,rotation.y,rotation.z,scale,colorMatrix||COLOR_MATRIX_IDENTITY,opacity,clarity,gamma,vignette,maskFeather,maskCornerRadius,backgroundColor,overlayColor,enableShapes);};// shape texture cache\nvar TextureUnits=new Map([]);var getShapeImageTexture=function getShapeImageTexture(_ref95){var backgroundImage=_ref95.backgroundImage;// get texture unit assigned to this image\nvar texture=TextureUnits.get(backgroundImage);// texture already available, we done\nif(texture)return texture;// reserve texture unit\ntexture=webGLImageDrawer.getAvailableTextureIndex();webGLImageDrawer.reserveTexture(texture);// this background is now available in this texture unit\nTextureUnits.set(backgroundImage,texture);// load the new background image data\nloadImageData(backgroundImage).then(function(imageData){// create new texture\nwebGLImageDrawer.setTexture(texture,imageData);// need to redraw because texture is now available\nrequestAnimationFrame(drawUpdate);})[\"catch\"](function(err){console.error(err);});return texture;};var TEXT_MEASURE_CONTEXT=createSimpleContext();var getShapeTextTexture=function getShapeTextTexture(shape){var text=shape.text,textAlign=shape.textAlign,fontFamily=shape.fontFamily,fontSize=shape.fontSize,fontWeight=shape.fontWeight,fontVariant=shape.fontVariant,fontStyle=shape.fontStyle,lineHeight=shape.lineHeight,width=shape.width;// we need this context to correctly wrap text\nupdateTextContext(TEXT_MEASURE_CONTEXT,{fontSize:fontSize,fontFamily:fontFamily,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,textAlign:textAlign});// wrap the text\nvar textString=width?wrapText(TEXT_MEASURE_CONTEXT,text,width):text;// create UID for this texture so we can cache it and fetch it later on\nvar textUID=shapeTextUID(_objectSpread(_objectSpread({},shape),{},{text:textString}));// get texture unit assigned to this specific text shape\nvar texture=TextureUnits.get(textUID);if(texture)return texture;// we need to create a new texture\nvar ctx=createSimpleContext();updateTextContext(ctx,{fontSize:fontSize,fontFamily:fontFamily,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,textAlign:textAlign});// calculate canvas height\nresizeContextToFitText(ctx,textString,{fontSize:fontSize,fontFamily:fontFamily,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,textAlign:textAlign,lineHeight:lineHeight});var contextMinWidth=ctx.canvas.width;// scale context to account for italic styles\nctx.canvas.width+=textPadding;// context resized, we now need to re-apply style\nupdateTextContext(ctx,{fontSize:fontSize,fontFamily:fontFamily,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,textAlign:textAlign,color:[1,0,1]// color we'll replace in the shader\n});// if so, draw text and update texture\ndrawText(ctx,textString,{fontSize:fontSize,textAlign:textAlign,lineHeight:lineHeight,lineWidth:contextMinWidth});// TODO: Create power of 2 texture and update texture instead of delete -> replace\n// add this texture\ntexture=webGLImageDrawer.addTexture(ctx.canvas);// Store reference to the texture\nTextureUnits.set(textUID,texture);return texture;};var getShapeTexture=function getShapeTexture(shape){var texture;// let's create textures for backgrounds and texts\nif(shape.backgroundImage){texture=getShapeImageTexture(shape);}else if(isString(shape.text)){if(shape.width&&shape.width<1||shape.height&&shape.height<1)return undefined;texture=getShapeTextTexture(shape);}return texture;};var drawShapes=function drawShapes(){var shapes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return shapes.map(function(shape){var texture=getShapeTexture(shape);if(isArray(shape.points)){// is triangle\nif(shape.points.length===3&&shape.backgroundColor){webGLImageDrawer.drawTriangle(shape.points,shape.rotation,shape.flipX,shape.flipY,shape.backgroundColor,shape.strokeWidth,shape.strokeColor,shape.opacity);}else// is normal path\n{webGLImageDrawer.drawPath(shape.points,shape.strokeWidth,shape.strokeColor,shape.opacity);}}else// is ellipse \nif(isNumber(shape.rx)){webGLImageDrawer.drawEllipse(shape,shape.rx,shape.ry,shape.rotation,shape.flipX,shape.flipY,shape.backgroundColor,texture,shape.strokeWidth,shape.strokeColor,shape.opacity,shape.inverted);}else// is rect\nif(isString(shape.text)&&texture||shape.width){var textureSize=texture&&webGLImageDrawer.getTextureSize(texture);var colorize=undefined;var shapeRect;var shapeCornerRadius=[shape.cornerRadius,shape.cornerRadius,shape.cornerRadius,shape.cornerRadius];if(shape.width){shapeRect=shape;}else{shapeRect=_objectSpread({x:shape.x,y:shape.y},textureSize);}var backgroundSize;var backgroundPosition;if(textureSize){// background should be scaled\nif(shape.backgroundImage&&shape.backgroundSize){// always respect texture aspect ratio\nvar textureAspectRatio=getAspectRatio(textureSize.width,textureSize.height);// adjust position of background\nif(shape.backgroundSize===\"contain\"){var rect=rectContainRect(shape,textureAspectRatio,shapeRect);backgroundSize=sizeCreateFromRect(rect);backgroundPosition=vectorCreate((shape.width-backgroundSize.width)*0.5,(shape.height-backgroundSize.height)*0.5);}else if(shape.backgroundSize===\"cover\"){var _rect2=rectCoverRect(shape,textureAspectRatio,shapeRect);backgroundSize=sizeCreateFromRect(_rect2);backgroundPosition=vectorCreate(_rect2.x,_rect2.y);backgroundPosition=vectorCreate((shape.width-backgroundSize.width)*0.5,(shape.height-backgroundSize.height)*0.5);}}else// is text, \"background\" should be texture size and be positioned based on alignment\nif(shape.text&&shape.width){// position texture based on text alignment\nbackgroundSize=textureSize;backgroundPosition=vectorCreate(0,0);// auto height\nif(!shape.height)shape.height=textureSize.height;// textPadding so text doesn't clip on left and right edges\nshape.x-=textPadding;shape.width+=textPadding*2;if(shape.textAlign===\"left\"){backgroundPosition.x=textPadding;}if(shape.textAlign===\"center\"){backgroundPosition.x=textPadding*0.5+(shape.width-textureSize.width)*0.5;}if(shape.textAlign===\"right\"){backgroundPosition.x=shape.width-textureSize.width;}}else if(shape.text){backgroundPosition=vectorCreate(0,0);backgroundSize={width:shapeRect.width,height:shapeRect.height};// texture is slightly larger because of text padding, need to compensate for this in single line mode\nshapeRect.width-=textPadding;}if(shape.text)colorize=shape.color;}webGLImageDrawer.drawRect(shapeRect,shape.rotation,shape.flipX,shape.flipY,shapeCornerRadius,shape.backgroundColor,texture,backgroundSize,backgroundPosition,shape.strokeWidth,shape.strokeColor,shape.opacity,undefined,colorize);}return texture?[shape.id,texture]:undefined;}).filter(Boolean);};// redraws state\nvar redraw=function redraw(){// allow dev to inject more shapes\nvar canvas=willRender({opacity:$imageMain.opacity,// opacity of main image, can be used to change opacity of other elements\nrotation:$imageMain.rotation,scale:$imageMain.scale,size:canvasSize,backgroundColor:_toConsumableArray($background)});canvas.backgroundColor=_toConsumableArray($background);canvas.image=$imageMain;canvas.imageMask=$imageMain.mask;canvas.imageMaskOpacity=$imageMain.maskOpacity;canvas.imagePreviews=imagePreviews;// no need to draw to framebuffer is no annotations\nvar hasAnnotations=canvas.annotationShapes.length>0;// if image has background color\nvar hasImageBackgroundColor=$imageMain.backgroundColor[3]>0;// if the overlay is transparent so we can see the canvas\nvar hasTransparentOverlay=$imageMain.maskOpacity<1;// array of textures used in this draw call\nvar usedTextures=[];// set canvas background color to image background color if is defined\nif(hasTransparentOverlay&&hasImageBackgroundColor){var backR=canvas.backgroundColor[0];var backG=canvas.backgroundColor[1];var backB=canvas.backgroundColor[2];var frontA=1-$imageMain.maskOpacity;var frontR=$imageMain.backgroundColor[0]*frontA;var frontG=$imageMain.backgroundColor[1]*frontA;var frontB=$imageMain.backgroundColor[2]*frontA;var fA=1-frontA;canvas.backgroundColor=[frontR+backR*fA,frontG+backG*fA,frontB+backB*fA,1];}webGLImageDrawer.setCanvasColor(canvas.backgroundColor);// if has annotations draw annotation shapes to framebuffer\n// TODO: only run this if annotations have changed\nif(hasAnnotations){webGLImageDrawer.disableMask();webGLImageDrawer.drawToFramebuffer();usedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(canvas.annotationShapes)));}// switch to canvas drawing for other elements\nwebGLImageDrawer.drawToCanvas();webGLImageDrawer.enableMask(canvas.imageMask,canvas.imageMaskOpacity);// draw a colored rectangle behind main preview image\nif(hasImageBackgroundColor){webGLImageDrawer.drawRect($mask,0,false,false,[0,0,0,0],blendWithCanvasBackground($background,$imageMain.backgroundColor));}// draw main preview image\ncanvas.image.enableShapes=hasAnnotations;drawPreviewImage(canvas.image);// TODO: move vignette here (draw with colorized circular gradient texture instead of in shader)\n// draw decorations shapes relative to crop\nusedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(canvas.decorationShapes)));// crop mask not used for interface\nwebGLImageDrawer.disableMask();// draw custom interface shapes\nusedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(canvas.interfaceShapes)));canvas.imagePreviews.forEach(function(image){webGLImageDrawer.enableMask(image.mask,image.maskOpacity);// draw background fill\nif(hasImageBackgroundColor){webGLImageDrawer.drawRect(image.mask,0,false,false,image.maskCornerRadius,$imageMain.backgroundColor,undefined,undefined,undefined,undefined,undefined,image.opacity,image.maskFeather);}drawPreviewImage(_objectSpread(_objectSpread({},image),{},{backgroundColor:$imageMain.backgroundColor,overlayColor:[0,0,0,0],enableShapes:false}));});webGLImageDrawer.disableMask();// determine which textures can be dropped\nTextureUnits.forEach(function(registeredTextureUnit,key,map){var isUsed=!!usedTextures.find(function(_ref96){var _ref97=_slicedToArray(_ref96,2),id=_ref97[0],usedTextureUnit=_ref97[1];return usedTextureUnit===registeredTextureUnit;});// stil used, no need to release\nif(isUsed)return;// remove this texture\nTextureUnits[\"delete\"](key);webGLImageDrawer.removeTexture(registeredTextureUnit);});};//\n// events\n//\n// auto update when size changes\nvar handleSizeChange=function handleSizeChange(e){$$invalidate(17,width=e.detail.width);$$invalidate(18,height=e.detail.height);dispatch(\"measure\",{width:width,height:height});};//\n// hooks\n//\n// after DOM has been altered, draw to canvas\nafterUpdate(function(){return drawUpdate();});// hook up canvas and image\nonMount(function(){return $$invalidate(16,webGLImageDrawer=createGLImageDrawer(canvas,imageData,imageSize,pixelRatio));});// clean up canvas\nonDestroy(function(){// if canvas wasn't created we don't need to release it\nif(!webGLImageDrawer)return;// done drawing\nwebGLImageDrawer.release();// force release canvas for Safari\nreleaseCanvas(TEXT_MEASURE_CONTEXT.canvas);});function canvas_1_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){canvas=$$value;$$invalidate(0,canvas);});}$$self.$$set=function($$props){if(\"animate\"in $$props)$$invalidate(5,animate=$$props.animate);if(\"imageData\"in $$props)$$invalidate(6,imageData=$$props.imageData);if(\"imageSize\"in $$props)$$invalidate(7,imageSize=$$props.imageSize);if(\"imageProps\"in $$props)$$invalidate(8,imageProps=$$props.imageProps);if(\"imagePreviews\"in $$props)$$invalidate(9,imagePreviews=$$props.imagePreviews);if(\"maskRect\"in $$props)$$invalidate(10,maskRect=$$props.maskRect);if(\"pixelRatio\"in $$props)$$invalidate(11,pixelRatio=$$props.pixelRatio);if(\"willRender\"in $$props)$$invalidate(12,willRender=$$props.willRender);if(\"loadImageData\"in $$props)$$invalidate(13,loadImageData=$$props.loadImageData);if(\"backgroundColor\"in $$props)$$invalidate(14,backgroundColor=$$props.backgroundColor);};var canvasSize;var canDraw;var drawUpdate;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*backgroundColor*/16384){// canvas style\nbackgroundColor&&updateSpring(background,backgroundColor);}if($$self.$$.dirty[0]&/*imageProps*/256){// image transforms\nimageProps&&updateSpring(origin,imageProps.origin);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(translation,imageProps.translation);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(perspective,imageProps.perspective);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(rotation,imageProps.rotation);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(scale,imageProps.scale);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(colorMatrix,imageProps.colorMatrix||[].concat(COLOR_MATRIX_IDENTITY));}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(vignette,imageProps.vignette||0);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(gamma,imageProps.gamma||1);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&clarity.set(imageProps.convolutionMatrix&&imageProps.convolutionMatrix.clarity||undefined);}if($$self.$$.dirty[0]&/*imageProps*/256){// image ui style\nimageProps&&updateSpring(opacity,1);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&updateSpring(maskOpacity,isNumber(imageProps.maskOpacity)?imageProps.maskOpacity:1);}if($$self.$$.dirty[0]&/*maskRect*/1024){maskRect&&mask.set(maskRect);}if($$self.$$.dirty[0]&/*imageProps*/256){imageProps&&imageBackgroundColor.set(imageProps.backgroundColor);}if($$self.$$.dirty[0]&/*width, height*/393216){// canvas size\ncanvasSize={width:width,height:height};}if($$self.$$.dirty[0]&/*webGLImageDrawer, width, height, $imageMain*/2555904){// can draw view\n$$invalidate(20,canDraw=webGLImageDrawer&&width&&height&&$imageMain);}if($$self.$$.dirty[0]&/*width, height, webGLImageDrawer, pixelRatio*/460800){// observe width and height changes and resize the canvas proportionally\nwidth&&height&&webGLImageDrawer&&webGLImageDrawer.resize(width,height,pixelRatio);}if($$self.$$.dirty[0]&/*canDraw*/1048576){// switch to draw method when can draw\ndrawUpdate=canDraw?redraw:noop;}};return[canvas,background,mask,imageMain,handleSizeChange,animate,imageData,imageSize,imageProps,imagePreviews,maskRect,pixelRatio,willRender,loadImageData,backgroundColor,canvas_1_binding];}var Canvas=/*#__PURE__*/function(_SvelteComponent){_inherits(Canvas,_SvelteComponent);var _super2=_createSuper(Canvas);function Canvas(options){var _this2;_classCallCheck(this,Canvas);_this2=_super2.call(this);init(_assertThisInitialized(_this2),options,instance,create_fragment,safe_not_equal,{animate:5,imageData:6,imageSize:7,imageProps:8,imagePreviews:9,maskRect:10,pixelRatio:11,willRender:12,loadImageData:13,backgroundColor:14},[-1,-1]);return _this2;}return Canvas;}(SvelteComponent);var arrayJoin=function arrayJoin(arr){var filter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Boolean;var str=arguments.length>2&&arguments[2]!==undefined?arguments[2]:' ';return arr.filter(filter).join(str);};/* src/core/ui/components/TabList.svelte generated by Svelte v3.29.4 */var get_default_slot_changes=function get_default_slot_changes(dirty){return{tab:dirty&/*tabNodes*/8};};var get_default_slot_context=function get_default_slot_context(ctx){return{tab:/*tab*/ctx[16]};};function get_each_context(ctx,list,i){var child_ctx=ctx.slice();child_ctx[16]=list[i];return child_ctx;}// (72:4) {#each tabNodes as tab (tab.id) }\nfunction create_each_block(key_1,ctx){var li;var button;var button_aria_controls_value;var button_id_value;var button_aria_selected_value;var button_disabled_value;var t;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[10][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[9],get_default_slot_context);function keydown_handler(){var _ctx5;for(var _len4=arguments.length,args=new Array(_len4),_key7=0;_key7<_len4;_key7++){args[_key7]=arguments[_key7];}return(/*keydown_handler*/(_ctx5=ctx)[11].apply(_ctx5,[/*tab*/ctx[16]].concat(args)));}function click_handler(){var _ctx6;for(var _len5=arguments.length,args=new Array(_len5),_key8=0;_key8<_len5;_key8++){args[_key8]=arguments[_key8];}return(/*click_handler*/(_ctx6=ctx)[12].apply(_ctx6,[/*tab*/ctx[16]].concat(args)));}return{key:key_1,first:null,c:function c(){li=element(\"li\");button=element(\"button\");if(default_slot)default_slot.c();t=space();attr(button,\"role\",\"tab\");attr(button,\"aria-controls\",button_aria_controls_value=/*tab*/ctx[16].href);attr(button,\"id\",button_id_value=/*tab*/ctx[16].tabId);attr(button,\"aria-selected\",button_aria_selected_value=/*tab*/ctx[16].selected);button.disabled=button_disabled_value=/*tab*/ctx[16].disabled;this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,button);if(default_slot){default_slot.m(button,null);}append(li,t);current=true;if(!mounted){dispose=[listen(button,\"keydown\",keydown_handler),listen(button,\"click\",click_handler)];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(default_slot){if(default_slot.p&&dirty&/*$$scope, tabNodes*/520){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[9],dirty,get_default_slot_changes,get_default_slot_context);}}if(!current||dirty&/*tabNodes*/8&&button_aria_controls_value!==(button_aria_controls_value=/*tab*/ctx[16].href)){attr(button,\"aria-controls\",button_aria_controls_value);}if(!current||dirty&/*tabNodes*/8&&button_id_value!==(button_id_value=/*tab*/ctx[16].tabId)){attr(button,\"id\",button_id_value);}if(!current||dirty&/*tabNodes*/8&&button_aria_selected_value!==(button_aria_selected_value=/*tab*/ctx[16].selected)){attr(button,\"aria-selected\",button_aria_selected_value);}if(!current||dirty&/*tabNodes*/8&&button_disabled_value!==(button_disabled_value=/*tab*/ctx[16].disabled)){button.disabled=button_disabled_value;}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function create_fragment$1(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var ul_class_value;var current;var each_value=/*tabNodes*/ctx[3];var get_key=function get_key(ctx){return(/*tab*/ctx[16].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block(key,child_ctx));}return{c:function c(){ul=element(\"ul\");for(var _i3=0;_i3<each_blocks.length;_i3+=1){each_blocks[_i3].c();}attr(ul,\"class\",ul_class_value=arrayJoin([\"DokaTabList\",/*klass*/ctx[0]]));attr(ul,\"role\",\"tablist\");attr(ul,\"data-layout\",/*layout*/ctx[1]);},m:function m(target,anchor){insert(target,ul,anchor);for(var _i4=0;_i4<each_blocks.length;_i4+=1){each_blocks[_i4].m(ul,null);}/*ul_binding*/ctx[13](ul);current=true;},p:function p(ctx,_ref98){var _ref99=_slicedToArray(_ref98,1),dirty=_ref99[0];if(dirty&/*tabNodes, handleKeyTab, handleClickTab, $$scope*/568){var _each_value=/*tabNodes*/ctx[3];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block,null,get_each_context);check_outros();}if(!current||dirty&/*klass*/1&&ul_class_value!==(ul_class_value=arrayJoin([\"DokaTabList\",/*klass*/ctx[0]]))){attr(ul,\"class\",ul_class_value);}if(!current||dirty&/*layout*/2){attr(ul,\"data-layout\",/*layout*/ctx[1]);}},i:function i(local){if(current)return;for(var _i5=0;_i5<each_value.length;_i5+=1){transition_in(each_blocks[_i5]);}current=true;},o:function o(local){for(var _i6=0;_i6<each_blocks.length;_i6+=1){transition_out(each_blocks[_i6]);}current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i7=0;_i7<each_blocks.length;_i7+=1){each_blocks[_i7].d();}/*ul_binding*/ctx[13](null);}};}function instance$1($$self,$$props,$$invalidate){var _$$props$$$slots=$$props.$$slots,slots=_$$props$$$slots===void 0?{}:_$$props$$$slots,$$scope=$$props.$$scope;var root;var _$$props$class=$$props[\"class\"],klass=_$$props$class===void 0?undefined:_$$props$class;var name=$$props.name;var selected=$$props.selected;var _$$props$tabs=$$props.tabs,tabs=_$$props$tabs===void 0?[]:_$$props$tabs;var _$$props$layout=$$props.layout,layout=_$$props$layout===void 0?undefined:_$$props$layout;var dispatch=createEventDispatcher();var focusTab=function focusTab(index){var tab=root.querySelectorAll(\"button[role=\\\"tab\\\"]\")[index];if(!tab)return;tab.focus();};var handleClickTab=function handleClickTab(e,id){e.preventDefault();e.stopPropagation();dispatch(\"select\",id);};var handleKeyTab=function handleKeyTab(_ref100,id){var key=_ref100.key;if(!/arrow/i.test(key))return;var index=tabs.findIndex(function(tab){return tab.id===id;});// next\nif(/right|down/i.test(key))return focusTab(index<tabs.length-1?index+1:0);// prev\nif(/left|up/i.test(key))return focusTab(index>0?index-1:tabs.length-1);};var keydown_handler=function keydown_handler(tab,e){return handleKeyTab(e,tab.id);};var click_handler=function click_handler(tab,e){return handleClickTab(e,tab.id);};function ul_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(2,root);});}$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(0,klass=$$props[\"class\"]);if(\"name\"in $$props)$$invalidate(6,name=$$props.name);if(\"selected\"in $$props)$$invalidate(7,selected=$$props.selected);if(\"tabs\"in $$props)$$invalidate(8,tabs=$$props.tabs);if(\"layout\"in $$props)$$invalidate(1,layout=$$props.layout);if(\"$$scope\"in $$props)$$invalidate(9,$$scope=$$props.$$scope);};var tabNodes;$$self.$$.update=function(){if($$self.$$.dirty&/*tabs, selected, name*/448){$$invalidate(3,tabNodes=tabs.map(function(tab){var isActive=tab.id===selected;return _objectSpread(_objectSpread({},tab),{},{tabId:\"doka-tab-\".concat(name,\"-\").concat(tab.id),href:\"#doka-\".concat(name,\"-\").concat(tab.id),selected:isActive});}));}};return[klass,layout,root,tabNodes,handleClickTab,handleKeyTab,name,selected,tabs,$$scope,slots,keydown_handler,click_handler,ul_binding];}var TabList=/*#__PURE__*/function(_SvelteComponent2){_inherits(TabList,_SvelteComponent2);var _super3=_createSuper(TabList);function TabList(options){var _this3;_classCallCheck(this,TabList);_this3=_super3.call(this);init(_assertThisInitialized(_this3),options,instance$1,create_fragment$1,safe_not_equal,{\"class\":0,name:6,selected:7,tabs:8,layout:1});return _this3;}return TabList;}(SvelteComponent);/* src/core/ui/components/TabPanels.svelte generated by Svelte v3.29.4 */var get_default_slot_changes$1=function get_default_slot_changes$1(dirty){return{panel:dirty&/*panelNodes*/16,panelIsActive:dirty&/*panelNodes*/16};};var get_default_slot_context$1=function get_default_slot_context$1(ctx){return{panel:/*id*/ctx[11],panelIsActive:!/*hidden*/ctx[15]};};function get_each_context$1(ctx,list,i){var child_ctx=ctx.slice();child_ctx[11]=list[i].id;child_ctx[12]=list[i].panelId;child_ctx[13]=list[i].tabindex;child_ctx[14]=list[i].labelledBy;child_ctx[15]=list[i].hidden;child_ctx[3]=list[i].visible;return child_ctx;}// (61:4) {#each panelNodes as { id, panelId, tabindex, labelledBy, hidden, visible }\nfunction create_each_block$1(key_1,ctx){var div;var t;var div_class_value;var div_hidden_value;var div_id_value;var div_tabindex_value;var div_aria_labelledby_value;var div_data_inert_value;var current;var default_slot_template=/*#slots*/ctx[9][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[8],get_default_slot_context$1);return{key:key_1,first:null,c:function c(){div=element(\"div\");if(default_slot)default_slot.c();t=space();attr(div,\"class\",div_class_value=arrayJoin([\"DokaTabPanel\",/*panelClass*/ctx[1]]));div.hidden=div_hidden_value=/*hidden*/ctx[15];attr(div,\"id\",div_id_value=/*panelId*/ctx[12]);attr(div,\"tabindex\",div_tabindex_value=/*tabindex*/ctx[13]);attr(div,\"aria-labelledby\",div_aria_labelledby_value=/*labelledBy*/ctx[14]);attr(div,\"data-inert\",div_data_inert_value=!/*visible*/ctx[3]);this.first=div;},m:function m(target,anchor){insert(target,div,anchor);if(default_slot){default_slot.m(div,null);}append(div,t);current=true;},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&dirty&/*$$scope, panelNodes*/272){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[8],dirty,get_default_slot_changes$1,get_default_slot_context$1);}}if(!current||dirty&/*panelClass*/2&&div_class_value!==(div_class_value=arrayJoin([\"DokaTabPanel\",/*panelClass*/ctx[1]]))){attr(div,\"class\",div_class_value);}if(!current||dirty&/*panelNodes*/16&&div_hidden_value!==(div_hidden_value=/*hidden*/ctx[15])){div.hidden=div_hidden_value;}if(!current||dirty&/*panelNodes*/16&&div_id_value!==(div_id_value=/*panelId*/ctx[12])){attr(div,\"id\",div_id_value);}if(!current||dirty&/*panelNodes*/16&&div_tabindex_value!==(div_tabindex_value=/*tabindex*/ctx[13])){attr(div,\"tabindex\",div_tabindex_value);}if(!current||dirty&/*panelNodes*/16&&div_aria_labelledby_value!==(div_aria_labelledby_value=/*labelledBy*/ctx[14])){attr(div,\"aria-labelledby\",div_aria_labelledby_value);}if(!current||dirty&/*panelNodes*/16&&div_data_inert_value!==(div_data_inert_value=!/*visible*/ctx[3])){attr(div,\"data-inert\",div_data_inert_value);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(default_slot)default_slot.d(detaching);}};}function create_fragment$2(ctx){var div;var each_blocks=[];var each_1_lookup=new Map();var div_class_value;var measurable_action;var current;var mounted;var dispose;var each_value=/*panelNodes*/ctx[4];var get_key=function get_key(ctx){return(/*id*/ctx[11]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$1(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$1(key,child_ctx));}return{c:function c(){div=element(\"div\");for(var _i8=0;_i8<each_blocks.length;_i8+=1){each_blocks[_i8].c();}attr(div,\"class\",div_class_value=arrayJoin([\"DokaTabPanels\",/*klass*/ctx[0]]));attr(div,\"style\",/*style*/ctx[2]);},m:function m(target,anchor){insert(target,div,anchor);for(var _i9=0;_i9<each_blocks.length;_i9+=1){each_blocks[_i9].m(div,null);}current=true;if(!mounted){dispose=[listen(div,\"measure\",/*measure_handler*/ctx[10]),action_destroyer(measurable_action=measurable.call(null,div))];mounted=true;}},p:function p(ctx,_ref101){var _ref102=_slicedToArray(_ref101,1),dirty=_ref102[0];if(dirty&/*arrayJoin, panelClass, panelNodes, $$scope*/274){var _each_value2=/*panelNodes*/ctx[4];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value2,each_1_lookup,div,outro_and_destroy_block,create_each_block$1,null,get_each_context$1);check_outros();}if(!current||dirty&/*klass*/1&&div_class_value!==(div_class_value=arrayJoin([\"DokaTabPanels\",/*klass*/ctx[0]]))){attr(div,\"class\",div_class_value);}if(!current||dirty&/*style*/4){attr(div,\"style\",/*style*/ctx[2]);}},i:function i(local){if(current)return;for(var _i10=0;_i10<each_value.length;_i10+=1){transition_in(each_blocks[_i10]);}current=true;},o:function o(local){for(var _i11=0;_i11<each_blocks.length;_i11+=1){transition_out(each_blocks[_i11]);}current=false;},d:function d(detaching){if(detaching)detach(div);for(var _i12=0;_i12<each_blocks.length;_i12+=1){each_blocks[_i12].d();}mounted=false;run_all(dispose);}};}function instance$2($$self,$$props,$$invalidate){var _$$props$$$slots2=$$props.$$slots,slots=_$$props$$$slots2===void 0?{}:_$$props$$$slots2,$$scope=$$props.$$scope;var _$$props$class2=$$props[\"class\"],klass=_$$props$class2===void 0?undefined:_$$props$class2;var name=$$props.name;var selected=$$props.selected;var _$$props$visible=$$props.visible,visible=_$$props$visible===void 0?undefined:_$$props$visible;var _$$props$panelClass=$$props.panelClass,panelClass=_$$props$panelClass===void 0?undefined:_$$props$panelClass;var _$$props$panels=$$props.panels,panels=_$$props$panels===void 0?[]:_$$props$panels;var _$$props$style=$$props.style,style=_$$props$style===void 0?undefined:_$$props$style;function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(0,klass=$$props[\"class\"]);if(\"name\"in $$props)$$invalidate(5,name=$$props.name);if(\"selected\"in $$props)$$invalidate(6,selected=$$props.selected);if(\"visible\"in $$props)$$invalidate(3,visible=$$props.visible);if(\"panelClass\"in $$props)$$invalidate(1,panelClass=$$props.panelClass);if(\"panels\"in $$props)$$invalidate(7,panels=$$props.panels);if(\"style\"in $$props)$$invalidate(2,style=$$props.style);if(\"$$scope\"in $$props)$$invalidate(8,$$scope=$$props.$$scope);};var panelNodes;$$self.$$.update=function(){if($$self.$$.dirty&/*panels, selected, visible, name*/232){$$invalidate(4,panelNodes=panels.map(function(id){var isActive=id===selected;var isVisible=visible?visible.indexOf(id)!==-1:true;return{id:id,panelId:\"doka-\".concat(name,\"_\").concat(id),labelledBy:\"doka-tab-\".concat(name,\"_\").concat(id),hidden:!isActive,visible:isVisible,tabindex:isActive?0:-1};}));}};return[klass,panelClass,style,visible,panelNodes,name,selected,panels,$$scope,slots,measure_handler];}var TabPanels=/*#__PURE__*/function(_SvelteComponent3){_inherits(TabPanels,_SvelteComponent3);var _super4=_createSuper(TabPanels);function TabPanels(options){var _this4;_classCallCheck(this,TabPanels);_this4=_super4.call(this);init(_assertThisInitialized(_this4),options,instance$2,create_fragment$2,safe_not_equal,{\"class\":0,name:5,selected:6,visible:3,panelClass:1,panels:7,style:2});return _this4;}return TabPanels;}(SvelteComponent);/* src/core/ui/components/Panel.svelte generated by Svelte v3.29.4 */function create_fragment$3(ctx){var div;var switch_instance;var updating_name;var div_class_value;var current;var switch_instance_spread_levels=[/*componentProps*/ctx[7]];function switch_instance_name_binding(value){/*switch_instance_name_binding*/ctx[17].call(null,value);}var switch_value=/*componentView*/ctx[11];function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}if(/*panelName*/ctx[3]!==void 0){switch_instance_props.name=/*panelName*/ctx[3];}return{props:switch_instance_props};}if(switch_value){switch_instance=new switch_value(switch_props(ctx));binding_callbacks.push(function(){return bind(switch_instance,\"name\",switch_instance_name_binding);});/*switch_instance_binding*/ctx[18](switch_instance);switch_instance.$on(\"measure\",/*measure_handler*/ctx[19]);}return{c:function c(){div=element(\"div\");if(switch_instance)create_component(switch_instance.$$.fragment);attr(div,\"data-util\",/*panelName*/ctx[3]);attr(div,\"class\",div_class_value=arrayJoin([\"DokaPanel\",/*klass*/ctx[1]]));attr(div,\"style\",/*style*/ctx[6]);},m:function m(target,anchor){insert(target,div,anchor);if(switch_instance){mount_component(switch_instance,div,null);}current=true;},p:function p(ctx,_ref103){var _ref104=_slicedToArray(_ref103,1),dirty=_ref104[0];var switch_instance_changes=dirty&/*componentProps*/128?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*componentProps*/ctx[7])]):{};if(!updating_name&&dirty&/*panelName*/8){updating_name=true;switch_instance_changes.name=/*panelName*/ctx[3];add_flush_callback(function(){return updating_name=false;});}if(switch_value!==(switch_value=/*componentView*/ctx[11])){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=new switch_value(switch_props(ctx));binding_callbacks.push(function(){return bind(switch_instance,\"name\",switch_instance_name_binding);});/*switch_instance_binding*/ctx[18](switch_instance);switch_instance.$on(\"measure\",/*measure_handler*/ctx[19]);create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,div,null);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}if(!current||dirty&/*panelName*/8){attr(div,\"data-util\",/*panelName*/ctx[3]);}if(!current||dirty&/*klass*/2&&div_class_value!==(div_class_value=arrayJoin([\"DokaPanel\",/*klass*/ctx[1]]))){attr(div,\"class\",div_class_value);}if(!current||dirty&/*style*/64){attr(div,\"style\",/*style*/ctx[6]);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);/*switch_instance_binding*/ctx[18](null);if(switch_instance)destroy_component(switch_instance);}};}function instance$3($$self,$$props,$$invalidate){var $opacityClamped;var $isActivePrivateStore;var dispatch=createEventDispatcher();var _$$props$isActive=$$props.isActive,isActive=_$$props$isActive===void 0?true:_$$props$isActive;var stores=$$props.stores;var content=$$props.content;var component=$$props.component;var locale=$$props.locale;var _$$props$class3=$$props[\"class\"],klass=_$$props$class3===void 0?undefined:_$$props$class3;// we remember the view rect in this variable\nvar rect;var opacity=spring(0);var opacityClamped=derived(opacity,function($opacity){return clamp($opacity,0,1);});component_subscribe($$self,opacityClamped,function(value){return $$invalidate(22,$opacityClamped=value);});// throw hide / show events\nvar isHidden=!isActive;// create active store so can be used in derived stores\nvar isActivePrivateStore=writable(isActive);component_subscribe($$self,isActivePrivateStore,function(value){return $$invalidate(23,$isActivePrivateStore=value);});var stateProps={isActive:derived(isActivePrivateStore,function($isActivePrivateStore){return $isActivePrivateStore;}),isActiveFraction:derived(opacityClamped,function($opacityClamped){return $opacityClamped;}),isVisible:derived(opacityClamped,function($opacityClamped){return $opacityClamped>0;})};// build the component props\nvar componentView=content.view;var componentExportedProps=getComponentExportedProps(componentView);var componentComputedProps=Object.keys(content.props||{}).reduce(function(computedProps,key){if(!componentExportedProps.includes(key))return computedProps;computedProps[key]=content.props[key];return computedProps;},{});var componentComputedStateProps=Object.keys(stateProps).reduce(function(computedStateProps,key){if(!componentExportedProps.includes(key))return computedStateProps;computedStateProps[key]=stateProps[key];return computedStateProps;},{});// class used on panel element\nvar panelName;// we use the `hasBeenMounted` bool to block rect updates until the entire panel is ready\nvar hasBeenMounted=false;var preMountRect;var mountRectTimeout;onMount(function(){$$invalidate(4,hasBeenMounted=true);// this fixes a weird issue where the measure event isn't fired \n// when no components active in subview\nclearTimeout(mountRectTimeout);mountRectTimeout=setTimeout(function(){if(rect||!preMountRect)return;dispatch(\"measure\",_objectSpread({},preMountRect));},0);});function switch_instance_name_binding(value){panelName=value;$$invalidate(3,panelName);}function switch_instance_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){component=$$value;$$invalidate(0,component);});}var measure_handler=function measure_handler(e){$$invalidate(5,preMountRect=_objectSpread({},e.detail));if(!hasBeenMounted)return;$$invalidate(2,rect=e.detail);dispatch(\"measure\",_objectSpread({},rect));};$$self.$$set=function($$props){if(\"isActive\"in $$props)$$invalidate(12,isActive=$$props.isActive);if(\"stores\"in $$props)$$invalidate(13,stores=$$props.stores);if(\"content\"in $$props)$$invalidate(14,content=$$props.content);if(\"component\"in $$props)$$invalidate(0,component=$$props.component);if(\"locale\"in $$props)$$invalidate(15,locale=$$props.locale);if(\"class\"in $$props)$$invalidate(1,klass=$$props[\"class\"]);};var style;var componentProps;$$self.$$.update=function(){if($$self.$$.dirty&/*rect, isActive, component*/4101){// when the view rect changes and the panel is in active state or became active, dispatch measure event\nif(rect&&isActive&&component)dispatch(\"measure\",rect);}if($$self.$$.dirty&/*isActive*/4096){opacity.set(isActive?1:0);}if($$self.$$.dirty&/*$opacityClamped, isHidden*/5242880){if($opacityClamped<=0&&!isHidden){$$invalidate(20,isHidden=true);dispatch(\"hide\");}else if($opacityClamped>0&&isHidden){$$invalidate(20,isHidden=false);dispatch(\"show\");}}if($$self.$$.dirty&/*$opacityClamped*/4194304){dispatch(\"fade\",$opacityClamped);}if($$self.$$.dirty&/*$opacityClamped*/4194304){// only set opacity prop if is below 0\n$$invalidate(6,style=$opacityClamped<1?\"opacity: \".concat($opacityClamped):undefined);}if($$self.$$.dirty&/*isActive*/4096){set_store_value(isActivePrivateStore,$isActivePrivateStore=isActive,$isActivePrivateStore);}if($$self.$$.dirty&/*stores, locale*/40960){$$invalidate(7,componentProps=_objectSpread(_objectSpread(_objectSpread({},componentComputedProps),componentComputedStateProps),{},{stores:stores,locale:locale}));}};return[component,klass,rect,panelName,hasBeenMounted,preMountRect,style,componentProps,dispatch,opacityClamped,isActivePrivateStore,componentView,isActive,stores,content,locale,opacity,switch_instance_name_binding,switch_instance_binding,measure_handler];}var Panel=/*#__PURE__*/function(_SvelteComponent4){_inherits(Panel,_SvelteComponent4);var _super5=_createSuper(Panel);function Panel(options){var _this5;_classCallCheck(this,Panel);_this5=_super5.call(this);init(_assertThisInitialized(_this5),options,instance$3,create_fragment$3,safe_not_equal,{isActive:12,stores:13,content:14,component:0,locale:15,\"class\":1,opacity:16});return _this5;}_createClass(Panel,[{key:\"opacity\",get:function get(){return this.$$.ctx[16];}}]);return Panel;}(SvelteComponent);/* src/core/ui/components/Icon.svelte generated by Svelte v3.29.4 */function create_fragment$4(ctx){var svg;var svg_viewBox_value;var current;var default_slot_template=/*#slots*/ctx[5][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[4],null);return{c:function c(){svg=svg_element(\"svg\");if(default_slot)default_slot.c();attr(svg,\"class\",/*klass*/ctx[3]);attr(svg,\"style\",/*style*/ctx[2]);attr(svg,\"width\",/*width*/ctx[0]);attr(svg,\"height\",/*height*/ctx[1]);attr(svg,\"viewBox\",svg_viewBox_value=\"0 0 \"+/*width*/ctx[0]+\"\\n    \"+/*height*/ctx[1]);attr(svg,\"xmlns\",\"http://www.w3.org/2000/svg\");attr(svg,\"aria-hidden\",\"true\");attr(svg,\"focusable\",\"false\");attr(svg,\"stroke-linecap\",\"round\");attr(svg,\"stroke-linejoin\",\"round\");},m:function m(target,anchor){insert(target,svg,anchor);if(default_slot){default_slot.m(svg,null);}current=true;},p:function p(ctx,_ref105){var _ref106=_slicedToArray(_ref105,1),dirty=_ref106[0];if(default_slot){if(default_slot.p&&dirty&/*$$scope*/16){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[4],dirty,null,null);}}if(!current||dirty&/*klass*/8){attr(svg,\"class\",/*klass*/ctx[3]);}if(!current||dirty&/*style*/4){attr(svg,\"style\",/*style*/ctx[2]);}if(!current||dirty&/*width*/1){attr(svg,\"width\",/*width*/ctx[0]);}if(!current||dirty&/*height*/2){attr(svg,\"height\",/*height*/ctx[1]);}if(!current||dirty&/*width, height*/3&&svg_viewBox_value!==(svg_viewBox_value=\"0 0 \"+/*width*/ctx[0]+\"\\n    \"+/*height*/ctx[1])){attr(svg,\"viewBox\",svg_viewBox_value);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(svg);if(default_slot)default_slot.d(detaching);}};}function instance$4($$self,$$props,$$invalidate){var _$$props$$$slots3=$$props.$$slots,slots=_$$props$$$slots3===void 0?{}:_$$props$$$slots3,$$scope=$$props.$$scope;var _$$props$width=$$props.width,width=_$$props$width===void 0?24:_$$props$width;var _$$props$height=$$props.height,height=_$$props$height===void 0?24:_$$props$height;var _$$props$style2=$$props.style,style=_$$props$style2===void 0?undefined:_$$props$style2;var _$$props$class4=$$props[\"class\"],klass=_$$props$class4===void 0?undefined:_$$props$class4;$$self.$$set=function($$props){if(\"width\"in $$props)$$invalidate(0,width=$$props.width);if(\"height\"in $$props)$$invalidate(1,height=$$props.height);if(\"style\"in $$props)$$invalidate(2,style=$$props.style);if(\"class\"in $$props)$$invalidate(3,klass=$$props[\"class\"]);if(\"$$scope\"in $$props)$$invalidate(4,$$scope=$$props.$$scope);};return[width,height,style,klass,$$scope,slots];}var Icon=/*#__PURE__*/function(_SvelteComponent5){_inherits(Icon,_SvelteComponent5);var _super6=_createSuper(Icon);function Icon(options){var _this6;_classCallCheck(this,Icon);_this6=_super6.call(this);init(_assertThisInitialized(_this6),options,instance$4,create_fragment$4,safe_not_equal,{width:0,height:1,style:2,\"class\":3});return _this6;}return Icon;}(SvelteComponent);var isEventTarget=function isEventTarget(e,element){return element===e.target||element.contains(e.target);};/* src/core/ui/components/Button.svelte generated by Svelte v3.29.4 */function create_if_block_1(ctx){var icon_1;var current;icon_1=new Icon({props:{\"class\":\"DokaButtonIcon\",$$slots:{\"default\":[create_default_slot]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*$$scope, icon*/1048578){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (40:16) <Icon class=\"DokaButtonIcon\">\nfunction create_default_slot(ctx){var g;return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[1];},p:function p(ctx,dirty){if(dirty&/*icon*/2)g.innerHTML=/*icon*/ctx[1];},d:function d(detaching){if(detaching)detach(g);}};}// (46:12) {#if label}\nfunction create_if_block(ctx){var span;var t;return{c:function c(){span=element(\"span\");t=text(/*label*/ctx[0]);attr(span,\"class\",/*elLabelClass*/ctx[11]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*label*/1)set_data(t,/*label*/ctx[0]);if(dirty&/*elLabelClass*/2048){attr(span,\"class\",/*elLabelClass*/ctx[11]);}},d:function d(detaching){if(detaching)detach(span);}};}// (37:10)          \nfunction fallback_block(ctx){var span;var t;var current;var if_block0=/*icon*/ctx[1]&&create_if_block_1(ctx);var if_block1=/*label*/ctx[0]&&create_if_block(ctx);return{c:function c(){span=element(\"span\");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(span,\"class\",/*elButtonInnerClass*/ctx[9]);},m:function m(target,anchor){insert(target,span,anchor);if(if_block0)if_block0.m(span,null);append(span,t);if(if_block1)if_block1.m(span,null);current=true;},p:function p(ctx,dirty){if(/*icon*/ctx[1]){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*icon*/2){transition_in(if_block0,1);}}else{if_block0=create_if_block_1(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(span,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*label*/ctx[0]){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block(ctx);if_block1.c();if_block1.m(span,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}if(!current||dirty&/*elButtonInnerClass*/512){attr(span,\"class\",/*elButtonInnerClass*/ctx[9]);}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(span);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}function create_fragment$5(ctx){var button;var action_action;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[18][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[20],null);var default_slot_or_fallback=default_slot||fallback_block(ctx);return{c:function c(){button=element(\"button\");if(default_slot_or_fallback)default_slot_or_fallback.c();attr(button,\"type\",/*type*/ctx[4]);attr(button,\"style\",/*style*/ctx[2]);button.disabled=/*disabled*/ctx[3];attr(button,\"class\",/*elButtonClass*/ctx[10]);attr(button,\"title\",/*label*/ctx[0]);},m:function m(target,anchor){insert(target,button,anchor);if(default_slot_or_fallback){default_slot_or_fallback.m(button,null);}/*button_binding*/ctx[19](button);current=true;if(!mounted){dispose=[listen(button,\"keydown\",function(){if(is_function(/*onkeydown*/ctx[6]))/*onkeydown*/ctx[6].apply(this,arguments);}),listen(button,\"click\",function(){if(is_function(/*onclick*/ctx[5]))/*onclick*/ctx[5].apply(this,arguments);}),action_destroyer(action_action=/*action*/ctx[7].call(null,button))];mounted=true;}},p:function p(new_ctx,_ref107){var _ref108=_slicedToArray(_ref107,1),dirty=_ref108[0];ctx=new_ctx;if(default_slot){if(default_slot.p&&dirty&/*$$scope*/1048576){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[20],dirty,null,null);}}else{if(default_slot_or_fallback&&default_slot_or_fallback.p&&dirty&/*elButtonInnerClass, elLabelClass, label, icon*/2563){default_slot_or_fallback.p(ctx,dirty);}}if(!current||dirty&/*type*/16){attr(button,\"type\",/*type*/ctx[4]);}if(!current||dirty&/*style*/4){attr(button,\"style\",/*style*/ctx[2]);}if(!current||dirty&/*disabled*/8){button.disabled=/*disabled*/ctx[3];}if(!current||dirty&/*elButtonClass*/1024){attr(button,\"class\",/*elButtonClass*/ctx[10]);}if(!current||dirty&/*label*/1){attr(button,\"title\",/*label*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot_or_fallback,local);current=true;},o:function o(local){transition_out(default_slot_or_fallback,local);current=false;},d:function d(detaching){if(detaching)detach(button);if(default_slot_or_fallback)default_slot_or_fallback.d(detaching);/*button_binding*/ctx[19](null);mounted=false;run_all(dispose);}};}function instance$5($$self,$$props,$$invalidate){var _$$props$$$slots4=$$props.$$slots,slots=_$$props$$$slots4===void 0?{}:_$$props$$$slots4,$$scope=$$props.$$scope;var _$$props$class5=$$props[\"class\"],klass=_$$props$class5===void 0?undefined:_$$props$class5;var _$$props$label=$$props.label,label=_$$props$label===void 0?undefined:_$$props$label;var _$$props$labelClass=$$props.labelClass,labelClass=_$$props$labelClass===void 0?undefined:_$$props$labelClass;var _$$props$innerClass=$$props.innerClass,innerClass=_$$props$innerClass===void 0?undefined:_$$props$innerClass;var _$$props$hideLabel=$$props.hideLabel,hideLabel=_$$props$hideLabel===void 0?false:_$$props$hideLabel;var _$$props$icon=$$props.icon,icon=_$$props$icon===void 0?undefined:_$$props$icon;var _$$props$style3=$$props.style,style=_$$props$style3===void 0?undefined:_$$props$style3;var _$$props$disabled=$$props.disabled,disabled=_$$props$disabled===void 0?undefined:_$$props$disabled;var _$$props$type=$$props.type,type=_$$props$type===void 0?\"button\":_$$props$type;var _$$props$onclick=$$props.onclick,onclick=_$$props$onclick===void 0?undefined:_$$props$onclick;var _$$props$onkeydown=$$props.onkeydown,onkeydown=_$$props$onkeydown===void 0?undefined:_$$props$onkeydown;var _$$props$action=$$props.action,action=_$$props$action===void 0?function(){}:_$$props$action;var root;var isEventTarget$1=function isEventTarget$1(e){return isEventTarget(e,root);};var getElement=function getElement(){return root;};function button_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(8,root);});}$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(12,klass=$$props[\"class\"]);if(\"label\"in $$props)$$invalidate(0,label=$$props.label);if(\"labelClass\"in $$props)$$invalidate(13,labelClass=$$props.labelClass);if(\"innerClass\"in $$props)$$invalidate(14,innerClass=$$props.innerClass);if(\"hideLabel\"in $$props)$$invalidate(15,hideLabel=$$props.hideLabel);if(\"icon\"in $$props)$$invalidate(1,icon=$$props.icon);if(\"style\"in $$props)$$invalidate(2,style=$$props.style);if(\"disabled\"in $$props)$$invalidate(3,disabled=$$props.disabled);if(\"type\"in $$props)$$invalidate(4,type=$$props.type);if(\"onclick\"in $$props)$$invalidate(5,onclick=$$props.onclick);if(\"onkeydown\"in $$props)$$invalidate(6,onkeydown=$$props.onkeydown);if(\"action\"in $$props)$$invalidate(7,action=$$props.action);if(\"$$scope\"in $$props)$$invalidate(20,$$scope=$$props.$$scope);};var elButtonInnerClass;var elButtonClass;var elLabelClass;$$self.$$.update=function(){if($$self.$$.dirty&/*innerClass*/16384){$$invalidate(9,elButtonInnerClass=arrayJoin([\"DokaButtonInner\",innerClass]));}if($$self.$$.dirty&/*hideLabel, klass*/36864){$$invalidate(10,elButtonClass=arrayJoin([\"DokaButton\",hideLabel&&\"DokaButtonIconOnly\",klass]));}if($$self.$$.dirty&/*hideLabel, labelClass*/40960){$$invalidate(11,elLabelClass=arrayJoin([hideLabel?\"implicit\":\"DokaButtonLabel\",labelClass]));}};return[label,icon,style,disabled,type,onclick,onkeydown,action,root,elButtonInnerClass,elButtonClass,elLabelClass,klass,labelClass,innerClass,hideLabel,isEventTarget$1,getElement,slots,button_binding,$$scope];}var Button=/*#__PURE__*/function(_SvelteComponent6){_inherits(Button,_SvelteComponent6);var _super7=_createSuper(Button);function Button(options){var _this7;_classCallCheck(this,Button);_this7=_super7.call(this);init(_assertThisInitialized(_this7),options,instance$5,create_fragment$5,safe_not_equal,{\"class\":12,label:0,labelClass:13,innerClass:14,hideLabel:15,icon:1,style:2,disabled:3,type:4,onclick:5,onkeydown:6,action:7,isEventTarget:16,getElement:17});return _this7;}_createClass(Button,[{key:\"isEventTarget\",get:function get(){return this.$$.ctx[16];}},{key:\"getElement\",get:function get(){return this.$$.ctx[17];}}]);return Button;}(SvelteComponent);var arrayRemove=function arrayRemove(array,predicate){var index=array.findIndex(predicate);if(index>=0)return array.splice(index,1);return undefined;};// svelte\n// constants\nvar INERTIA_THRESHOLD=0.25;// when force of velocity exceeds this value we drift\nvar INERTIA_DISTANCE_MULTIPLIER=50;var INERTIA_DURATION_MULTIPLIER=80;var TAP_DURATION_MAX=300;var TAP_DISTANCE_MAX=64;var DOUBLE_TAP_DURATION_MAX=700;var DOUBLE_TAP_DISTANCE_MAX=128;var isContextMenuAction=function isContextMenuAction(e){return isNumber(e.button)&&e.button!==0;};var getPinchScalar=function getPinchScalar(offset,current){return(current-offset)/offset;};var interactable=function interactable(node){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// set defaults\nvar _options$inertia=options.inertia,inertia=_options$inertia===void 0?false:_options$inertia,_options$matchTarget=options.matchTarget,matchTarget=_options$matchTarget===void 0?false:_options$matchTarget,_options$pinch=options.pinch,pinch=_options$pinch===void 0?false:_options$pinch,_options$getEventPosi=options.getEventPosition,getEventPosition=_options$getEventPosi===void 0?function(e){return vectorCreate(e.clientX,e.clientY);}:_options$getEventPosi;//\n// helpers\n//\nfunction dispatch(type,detail){node.dispatchEvent(new CustomEvent(type,{detail:detail}));}function resetInertia(){if(inertiaTweenUnsubscribe)inertiaTweenUnsubscribe();inertiaTweenUnsubscribe=undefined;}//#region pointer registry\nvar pointers=[];var addPointer=function addPointer(e){var pointer={timeStamp:e.timeStamp,timeStampInitial:e.timeStamp,position:getEventPosition(e),origin:getEventPosition(e),velocity:vectorCreateEmpty(),translation:vectorCreateEmpty(),interactionState:undefined,event:e};pointers.push(pointer);pointer.interactionState=getInteractionState(pointers);};var removePointer=function removePointer(e){var pointer=arrayRemove(pointers,function(pointer){return pointer.event.pointerId===e.pointerId;});if(pointer)return pointer[0];};var getPointerIndex=function getPointerIndex(e){return pointers.findIndex(function(pointer){return pointer.event.pointerId===e.pointerId;});};var flattenPointerOrigin=function flattenPointerOrigin(pointer){pointer.origin.x=pointer.position.x;pointer.origin.y=pointer.position.y;pointer.translation.x=0;pointer.translation.y=0;};var updatePointer=function updatePointer(e){var pointer=getPointer(e);if(!pointer)return;var timeStamp=e.timeStamp;// position\nvar eventPosition=getEventPosition(e);// duration between previous interaction and new interaction, an interaction duration cannot be faster than 1 millisecond\nvar interactionDuration=Math.max(1,timeStamp-pointer.timeStamp);// calculate velocity\npointer.velocity.x=(eventPosition.x-pointer.position.x)/interactionDuration;pointer.velocity.y=(eventPosition.y-pointer.position.y)/interactionDuration;// update the translation\npointer.translation.x=eventPosition.x-pointer.origin.x;pointer.translation.y=eventPosition.y-pointer.origin.y;// set new state\npointer.timeStamp=timeStamp;pointer.position.x=eventPosition.x;pointer.position.y=eventPosition.y;pointer.event=e;};var getPointer=function getPointer(e){var i=getPointerIndex(e);if(i<0)return;return pointers[i];};var isSingleTouching=function isSingleTouching(){return pointers.length===1;};var isMultiTouching=function isMultiTouching(){return pointers.length===2;};var getDistance=function getDistance(pointers,position){var distanceTotal=pointers.reduce(function(prev,curr){prev+=vectorDistance(position,curr.position);return prev;},0);return distanceTotal/pointers.length;};var getInteractionState=function getInteractionState(pointers){var center=vectorCenter(pointers.map(function(pointer){return pointer.position;}));var distance=getDistance(pointers,center);return{center:center,distance:distance,velocity:vectorCenter(pointers.map(function(pointer){return pointer.velocity;})),translation:vectorCenter(pointers.map(function(pointer){return pointer.translation;}))};};//#endregion\nvar inertiaTween;var inertiaTweenUnsubscribe;var pinchOffset;var currentTranslation;var currentScale;var isGesture;var lastTapTimeStamp=0;var lastTapPosition=undefined;// start handling interactions\nnode.addEventListener('pointerdown',handlePointerdown);function handlePointerdown(e){// ignore more than two pointers for now\nif(isMultiTouching())return;// not interested in context menu\nif(isContextMenuAction(e))return;// target should equal node, if it doesn't user might have clicked one of the nodes children\nif(matchTarget&&e.target!==node)return;// stop any previous inertia tweens\nresetInertia();// register this pointer\naddPointer(e);// if is first pointer we need to init the drag gesture\nif(isSingleTouching()){// handle pointer events\ndocument.documentElement.addEventListener('pointermove',handlePointermove);document.documentElement.addEventListener('pointerup',handlePointerup);document.documentElement.addEventListener('pointercancel',handlePointerup);// clear vars\nisGesture=false;currentScale=0;currentTranslation=vectorCreateEmpty();pinchOffset=undefined;dispatch('interactionstart',{origin:vectorClone(getPointer(e).origin)});}else if(pinch){isGesture=true;pinchOffset=vectorDistance(pointers[0].position,pointers[1].position);currentTranslation.x+=pointers[0].translation.x;currentTranslation.y+=pointers[0].translation.y;flattenPointerOrigin(pointers[0]);}}//\n// pointer move can only be a primary event (other pointers are not handled)\n//\nfunction handlePointermove(e){// prevent selection of text (Safari)\ne.preventDefault();// update pointer state\nupdatePointer(e);var scalar=currentScale;var translation=vectorClone(pointers[0].translation);if(pinch&&isMultiTouching()){// current offset\ntranslation.x+=pointers[1].translation.x;translation.y+=pointers[1].translation.y;// current pinch distance\nvar pinchCurrent=vectorDistance(pointers[0].position,pointers[1].position);// to find out scalar we calculate the difference between the pinch offset and the new pinch\nscalar+=getPinchScalar(pinchOffset,pinchCurrent);}translation.x+=currentTranslation.x;translation.y+=currentTranslation.y;dispatch('interactionupdate',{translation:translation,scalar:pinch?scalar:undefined});}//\n// pointer up can only be a primary event (other pointers are not handled)\n//\nfunction handlePointerup(e){// remove pointer from active pointers array\nvar removedPointer=removePointer(e);// store current size\nif(pinch&&isSingleTouching()){// calculate current scale\nvar pinchCurrent=vectorDistance(pointers[0].position,removedPointer.position);currentScale=(currentScale||0)+getPinchScalar(pinchOffset,pinchCurrent);currentTranslation.x+=pointers[0].translation.x+removedPointer.translation.x;currentTranslation.y+=pointers[0].translation.y+removedPointer.translation.y;flattenPointerOrigin(pointers[0]);}// check if this was a tap\nvar isTap=false;var isDoubleTap=false;if(!isGesture){var interactionEnd=performance.now();var interactionDuration=interactionEnd-removedPointer.timeStampInitial;var interactionDistanceSquared=vectorDistanceSquared(removedPointer.translation);isTap=interactionDistanceSquared<TAP_DISTANCE_MAX&&interactionDuration<TAP_DURATION_MAX;isDoubleTap=!!(lastTapPosition&&isTap&&interactionEnd-lastTapTimeStamp<DOUBLE_TAP_DURATION_MAX&&vectorDistanceSquared(lastTapPosition,removedPointer.position)<DOUBLE_TAP_DISTANCE_MAX);if(isTap){lastTapPosition=vectorClone(removedPointer.position);lastTapTimeStamp=interactionEnd;}}// we wait till last multi-touch interaction is finished, all pointers need to be de-registered before proceeding\nif(pointers.length>0)return;// stop listening\ndocument.documentElement.removeEventListener('pointermove',handlePointermove);document.documentElement.removeEventListener('pointerup',handlePointerup);document.documentElement.removeEventListener('pointercancel',handlePointerup);var translation=vectorClone(removedPointer.translation);var velocity=vectorClone(removedPointer.velocity);// allows cancelling inertia from release handler\nvar inertiaPrevented=false;// user has released interaction\ndispatch('interactionrelease',{isTap:isTap,isDoubleTap:isDoubleTap,translation:translation,scalar:currentScale,preventInertia:function preventInertia(){return inertiaPrevented=true;}});// stop intantly if not a lot of force applied\nvar force=vectorDistance(velocity);if(inertiaPrevented||!inertia||force<INERTIA_THRESHOLD){return handleEnd(translation,{isTap:isTap,isDoubleTap:isDoubleTap});}// drift\ninertiaTween=tweened(vectorClone(translation),{easing:circOut,duration:force*INERTIA_DURATION_MULTIPLIER});inertiaTween.set({x:translation.x+velocity.x*INERTIA_DISTANCE_MULTIPLIER,y:translation.y+velocity.y*INERTIA_DISTANCE_MULTIPLIER}).then(function(){// if has unsubscribed (tween was reset)\nif(!inertiaTweenUnsubscribe)return;// go!\nhandleEnd(get_store_value(inertiaTween),{isTap:isTap,isDoubleTap:isDoubleTap});});inertiaTweenUnsubscribe=inertiaTween.subscribe(handleInertiaUpdate);}function handleInertiaUpdate(inertiaTranslation){// if is same as previous position, ignore\nif(!inertiaTranslation)return;// || vectorEqual(inertiaTranslation, translation)) return;\n// this will handle drift interactions\ndispatch('interactionupdate',{translation:inertiaTranslation,scalar:pinch?currentScale:undefined});}function handleEnd(translation,tapState){resetInertia();dispatch('interactionend',_objectSpread(_objectSpread({},tapState),{},{translation:translation,scalar:pinch?currentScale:undefined}));}return{destroy:function destroy(){resetInertia();node.removeEventListener('pointerdown',handlePointerdown);}};};var nudgeable=function nudgeable(element){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// if added as action on non focusable element you should add tabindex=0 attribute\nvar _options$direction=options.direction,direction=_options$direction===void 0?undefined:_options$direction,_options$shiftMultipl=options.shiftMultiplier,shiftMultiplier=_options$shiftMultipl===void 0?10:_options$shiftMultipl,_options$bubbles=options.bubbles,bubbles=_options$bubbles===void 0?false:_options$bubbles,_options$stopKeydownP=options.stopKeydownPropagation,stopKeydownPropagation=_options$stopKeydownP===void 0?true:_options$stopKeydownP;var isHorizontalDirection=direction==='horizontal';var isVerticalDirection=direction==='vertical';var handleKeydown=function handleKeydown(e){var key=e.key;var isShift=e.shiftKey;var isHorizontalAction=/up|down/i.test(key);var isVerticalAction=/left|right/i.test(key);// no directional key\nif(!isHorizontalAction&&!isVerticalAction)return;// is horizontal but up or down pressed\nif(isHorizontalDirection&&isVerticalAction)return;// is vertical but left or right pressed\nif(isVerticalDirection&&isHorizontalAction)return;// if holding shift move by a factor 10\nvar multiplier=isShift?shiftMultiplier:1;if(stopKeydownPropagation)e.stopPropagation();element.dispatchEvent(new CustomEvent('nudge',{bubbles:bubbles,detail:vectorCreate((/left/i.test(key)?-1:/right/i.test(key)?1:0)*multiplier,(/up/i.test(key)?-1:/down/i.test(key)?1:0)*multiplier)}));};element.addEventListener('keydown',handleKeydown);return{destroy:function destroy(){element.removeEventListener('keydown',handleKeydown);}};};function elastify(translation,dist){return dist*Math.sign(translation)*Math.log10(1+Math.abs(translation)/dist);}var elastifyRects=function elastifyRects(a,b,dist){if(!b)return rectClone(a);var left=a.x+elastify(b.x-a.x,dist);var right=a.x+a.width+elastify(b.x+b.width-(a.x+a.width),dist);var top=a.y+elastify(b.y-a.y,dist);var bottom=a.y+a.height+elastify(b.y+b.height-(a.y+a.height),dist);return{x:left,y:top,width:right-left,height:bottom-top};};var unitToPixels=function unitToPixels(value,element){if(!value)return;if(/em/.test(value))return parseInt(value,10)*16;if(/px/.test(value))return parseInt(value,10);};var getWheelDelta=function getWheelDelta(e){var d=e.detail||0;// @ts-ignore\nif(e.wheelDelta||e.wheelDeltaY)d=(-e.wheelDelta||-e.wheelDeltaY)/120;if(!d)d=e.deltaY;return d;};/* src/core/ui/components/Scrollable.svelte generated by Svelte v3.29.4 */function create_fragment$6(ctx){var div1;var div0;var interactable_action;var measurable_action;var div1_class_value;var measurable_action_1;var nudgeable_action;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[29][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[28],null);return{c:function c(){div1=element(\"div\");div0=element(\"div\");if(default_slot)default_slot.c();attr(div0,\"style\",/*childStyle*/ctx[6]);attr(div1,\"class\",div1_class_value=arrayJoin([\"DokaScrollable\",/*klass*/ctx[0]]));attr(div1,\"style\",/*overflowStyle*/ctx[4]);attr(div1,\"data-direction\",/*scrollDirection*/ctx[1]);attr(div1,\"data-state\",/*containerState*/ctx[5]);},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(default_slot){default_slot.m(div0,null);}/*div1_binding*/ctx[31](div1);current=true;if(!mounted){dispose=[listen(div0,\"interactionstart\",/*handleDragStart*/ctx[9]),listen(div0,\"interactionupdate\",/*handleDragMove*/ctx[11]),listen(div0,\"interactionend\",/*handleDragEnd*/ctx[12]),listen(div0,\"interactionrelease\",/*handleDragRelease*/ctx[10]),action_destroyer(interactable_action=interactable.call(null,div0,{inertia:true})),listen(div0,\"measure\",/*measure_handler*/ctx[30]),action_destroyer(measurable_action=measurable.call(null,div0)),listen(div1,\"wheel\",/*handleWheel*/ctx[14]),listen(div1,\"scroll\",/*handleScroll*/ctx[16]),listen(div1,\"focusin\",/*handleFocus*/ctx[15]),listen(div1,\"nudge\",/*handleNudge*/ctx[17]),listen(div1,\"measure\",/*handleResizeScrollContainer*/ctx[13]),action_destroyer(measurable_action_1=measurable.call(null,div1,{observePosition:true})),action_destroyer(nudgeable_action=nudgeable.call(null,div1,{direction:/*scrollDirection*/ctx[1]===\"x\"?\"horizontal\":\"vertical\",stopKeydownPropagation:false}))];mounted=true;}},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&dirty[0]&/*$$scope*/268435456){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[28],dirty,null,null);}}if(!current||dirty[0]&/*childStyle*/64){attr(div0,\"style\",/*childStyle*/ctx[6]);}if(!current||dirty[0]&/*klass*/1&&div1_class_value!==(div1_class_value=arrayJoin([\"DokaScrollable\",/*klass*/ctx[0]]))){attr(div1,\"class\",div1_class_value);}if(!current||dirty[0]&/*overflowStyle*/16){attr(div1,\"style\",/*overflowStyle*/ctx[4]);}if(!current||dirty[0]&/*scrollDirection*/2){attr(div1,\"data-direction\",/*scrollDirection*/ctx[1]);}if(!current||dirty[0]&/*containerState*/32){attr(div1,\"data-state\",/*containerState*/ctx[5]);}if(nudgeable_action&&is_function(nudgeable_action.update)&&dirty[0]&/*scrollDirection*/2)nudgeable_action.update.call(null,{direction:/*scrollDirection*/ctx[1]===\"x\"?\"horizontal\":\"vertical\",stopKeydownPropagation:false});},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(default_slot)default_slot.d(detaching);/*div1_binding*/ctx[31](null);mounted=false;run_all(dispose);}};}function instance$6($$self,$$props,$$invalidate){var $scrollOffset;var $keysPressedStore;var _$$props$$$slots5=$$props.$$slots,slots=_$$props$$$slots5===void 0?{}:_$$props$$$slots5,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();var keysPressedStore=getContext(\"keysPressed\");component_subscribe($$self,keysPressedStore,function(value){return $$invalidate(46,$keysPressedStore=value);});var scrollState=\"idle\";var scrollOrigin;var scrollRect;var scrollContainerRect;var scrollReleased;var scrollOffset=spring(0);component_subscribe($$self,scrollOffset,function(value){return $$invalidate(44,$scrollOffset=value);});var _$$props$class6=$$props[\"class\"],klass=_$$props$class6===void 0?undefined:_$$props$class6;var _$$props$scrollBlockI=$$props.scrollBlockInteractionDist,scrollBlockInteractionDist=_$$props$scrollBlockI===void 0?5:_$$props$scrollBlockI;var _$$props$scrollStep=$$props.scrollStep,scrollStep=_$$props$scrollStep===void 0?10:_$$props$scrollStep;// the distance multiplier for each mouse scroll interaction (delta)\nvar _$$props$scrollFocusM=$$props.scrollFocusMargin,scrollFocusMargin=_$$props$scrollFocusM===void 0?64:_$$props$scrollFocusM;// the margin used around elements to decided where to move the focus so elements are positioned into view with some spacing around them, this allows peaking at next/previous elements\nvar _$$props$scrollDirect=$$props.scrollDirection,scrollDirection=_$$props$scrollDirect===void 0?\"x\":_$$props$scrollDirect;var _$$props$scrollAutoCa=$$props.scrollAutoCancel,scrollAutoCancel=_$$props$scrollAutoCa===void 0?false:_$$props$scrollAutoCa;var _$$props$elasticity=$$props.elasticity,elasticity=_$$props$elasticity===void 0?0:_$$props$elasticity;var _$$props$onscroll=$$props.onscroll,onscroll=_$$props$onscroll===void 0?noop:_$$props$onscroll;var _$$props$maskFeatherS=$$props.maskFeatherSize,maskFeatherSize=_$$props$maskFeatherS===void 0?undefined:_$$props$maskFeatherS;var _$$props$maskFeatherS2=$$props.maskFeatherStartOpacity,maskFeatherStartOpacity=_$$props$maskFeatherS2===void 0?undefined:_$$props$maskFeatherS2;var _$$props$maskFeatherE=$$props.maskFeatherEndOpacity,maskFeatherEndOpacity=_$$props$maskFeatherE===void 0?undefined:_$$props$maskFeatherE;var _$$props$scroll=$$props.scroll,scroll=_$$props$scroll===void 0?undefined:_$$props$scroll;// logic\nvar container;var overflowStyle=\"\";// is scroll in reset state\nvar scrollAtRest=true;// triggers onscroll callback\nscrollOffset.subscribe(function(value){var pos=vectorCreateEmpty();pos[scrollDirection]=value;onscroll(pos);});var limitOffsetToContainer=function limitOffsetToContainer(offset){return Math.max(Math.min(0,offset),scrollContainerRect[size]-scrollRect[size]);};var scrollFirstMove;var scrollCancelled;var scrollTranslationPrev;var isHorizontalTranslation=function isHorizontalTranslation(translation){var velocity=vectorApply(vectorCreate(translation.x-scrollTranslationPrev.x,translation.y-scrollTranslationPrev.y),Math.abs);scrollTranslationPrev=vectorClone(translation);var speed=vectorDistanceSquared(velocity);var diff=velocity.x-velocity.y;return!(speed>1&&diff<-0.5);};var handleDragStart=function handleDragStart(){// not overflowing so no need to handle\nif(!overflows)return;scrollCancelled=false;scrollFirstMove=true;scrollTranslationPrev=vectorCreate(0,0);scrollReleased=false;$$invalidate(32,scrollState=\"idle\");scrollOrigin=get_store_value(scrollOffset);};var handleDragRelease=function handleDragRelease(_ref109){var detail=_ref109.detail;if(!overflows)return;scrollReleased=true;$$invalidate(32,scrollState=\"idle\");};var handleDragMove=function handleDragMove(_ref110){var detail=_ref110.detail;if(!overflows)return;if(scrollCancelled)return;// fixes problem with single move event fired when clicking\nif(scrollFirstMove){scrollFirstMove=false;if(vectorDistanceSquared(detail.translation)<0.1)return;}if(scrollAutoCancel&&scrollDirection===\"x\"&&!isHorizontalTranslation(detail.translation)){scrollCancelled=true;return;}setScrollOffset(scrollOrigin+detail.translation[scrollDirection],{elastic:true});};var handleDragEnd=function handleDragEnd(_ref111){var detail=_ref111.detail;if(!overflows)return;if(scrollCancelled)return;var offset=scrollOrigin+detail.translation[scrollDirection];var offsetLimited=limitOffsetToContainer(offset);scrollAtRest=false;scrollOffset.set(offsetLimited).then(function(res){if(!scrollReleased)return;scrollAtRest=true;});};var handleResizeScrollContainer=function handleResizeScrollContainer(_ref112){var detail=_ref112.detail;$$invalidate(34,scrollContainerRect=detail);dispatch(\"measure\",{x:detail.x,y:detail.y,width:detail.width,height:detail.height});};var setScrollOffset=function setScrollOffset(offset){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$elastic=options.elastic,elastic=_options$elastic===void 0?false:_options$elastic,_options$animate=options.animate,animate=_options$animate===void 0?false:_options$animate;// prevents clicks on child elements if the container is being scrolled\nif(Math.abs(offset)>scrollBlockInteractionDist&&scrollState===\"idle\"&&!scrollReleased){$$invalidate(32,scrollState=\"scrolling\");}var offsetLimited=limitOffsetToContainer(offset);var offsetVisual=elastic&&elasticity&&!scrollReleased?offsetLimited+elastify(offset-offsetLimited,elasticity):offsetLimited;var snapToPosition=true;if(animate){snapToPosition=false;}else if(!scrollAtRest){snapToPosition=!scrollReleased;}scrollAtRest=false;scrollOffset.set(offsetVisual,{hard:snapToPosition}).then(function(res){if(!scrollReleased)return;scrollAtRest=true;});};var handleWheel=function handleWheel(e){// don't do anything if isn't overflowing\nif(!overflows)return;// scroll down -> move to right/down\n// scroll up -> move to left/up\n// don't run default actions, prevent other actions from running\ne.preventDefault();e.stopPropagation();// apply wheel delta to offset\nvar delta=getWheelDelta(e);var offset=get_store_value(scrollOffset);setScrollOffset(offset+delta*scrollStep,{animate:true});};var handleFocus=function handleFocus(e){// don't do anything if isn't overflowing\nif(!overflows)return;// ignore this handler if is dragging\nif(!scrollReleased&&!$keysPressedStore.length)return;var target=e.target;// when a target is marked as implicit we use its parent elemetn\nif(e.target.classList.contains(\"implicit\"))target=target.parentNode;// get bounds\nvar start=target[scrollDirection===\"x\"?\"offsetLeft\":\"offsetTop\"];//.offsetLeft;\nvar space=target[scrollDirection===\"x\"?\"offsetWidth\":\"offsetHeight\"];//.offsetWidth;\nvar end=start+space;// we need to know the current offset of the scroll so we can determine if the target is in view\nvar currentScrollOffset=get_store_value(scrollOffset);// the margin around elements to keep in mind when focussing items\nvar margin=scrollFocusMargin+maskFeatherSize;if(currentScrollOffset+start<margin){setScrollOffset(-start+margin);}else if(currentScrollOffset+end>scrollContainerRect[size]-margin){setScrollOffset(scrollContainerRect[size]-end-margin,{animate:true});}};var handleScroll=function handleScroll(){// the scroll handler corrects auto browser scroll, \n// is triggered when browser tries to focus an \n// element outside of the scrollcontiner\n$$invalidate(3,container[scrollDirection===\"x\"?\"scrollLeft\":\"scrollTop\"]=0,container);};var handleNudge=function handleNudge(_ref113){var detail=_ref113.detail;var delta=-2*detail[scrollDirection];var offset=get_store_value(scrollOffset);setScrollOffset(offset+delta*scrollStep,{animate:true});};var measure_handler=function measure_handler(e){return $$invalidate(2,scrollRect=e.detail);};function div1_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){container=$$value;$$invalidate(3,container);});}$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(0,klass=$$props[\"class\"]);if(\"scrollBlockInteractionDist\"in $$props)$$invalidate(21,scrollBlockInteractionDist=$$props.scrollBlockInteractionDist);if(\"scrollStep\"in $$props)$$invalidate(22,scrollStep=$$props.scrollStep);if(\"scrollFocusMargin\"in $$props)$$invalidate(23,scrollFocusMargin=$$props.scrollFocusMargin);if(\"scrollDirection\"in $$props)$$invalidate(1,scrollDirection=$$props.scrollDirection);if(\"scrollAutoCancel\"in $$props)$$invalidate(24,scrollAutoCancel=$$props.scrollAutoCancel);if(\"elasticity\"in $$props)$$invalidate(25,elasticity=$$props.elasticity);if(\"onscroll\"in $$props)$$invalidate(26,onscroll=$$props.onscroll);if(\"maskFeatherSize\"in $$props)$$invalidate(18,maskFeatherSize=$$props.maskFeatherSize);if(\"maskFeatherStartOpacity\"in $$props)$$invalidate(19,maskFeatherStartOpacity=$$props.maskFeatherStartOpacity);if(\"maskFeatherEndOpacity\"in $$props)$$invalidate(20,maskFeatherEndOpacity=$$props.maskFeatherEndOpacity);if(\"scroll\"in $$props)$$invalidate(27,scroll=$$props.scroll);if(\"$$scope\"in $$props)$$invalidate(28,$$scope=$$props.$$scope);};var size;var axis;var containerStyle;var containerFeatherSize;var overflows;var containerState;var childStyle;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*scrollDirection*/2){$$invalidate(40,size=scrollDirection===\"x\"?\"width\":\"height\");}if($$self.$$.dirty[0]&/*scrollDirection*/2){$$invalidate(41,axis=scrollDirection.toUpperCase());}if($$self.$$.dirty[0]&/*container*/8){$$invalidate(42,containerStyle=container&&getComputedStyle(container));}if($$self.$$.dirty[0]&/*container*/8|$$self.$$.dirty[1]&/*containerStyle*/2048){$$invalidate(43,containerFeatherSize=containerStyle&&unitToPixels(containerStyle.getPropertyValue(\"--scrollable-feather-size\")));}if($$self.$$.dirty[0]&/*scrollRect, maskFeatherStartOpacity, maskFeatherEndOpacity*/1572868|$$self.$$.dirty[1]&/*$scrollOffset, scrollContainerRect, containerFeatherSize, size*/12808){if($scrollOffset!=null&&scrollContainerRect&&containerFeatherSize!=null&&scrollRect){var startOffset=-$scrollOffset/containerFeatherSize;var endOffset=-(scrollContainerRect[size]-scrollRect[size]-$scrollOffset)/containerFeatherSize;$$invalidate(19,maskFeatherStartOpacity=clamp(1-startOffset,0,1));$$invalidate(20,maskFeatherEndOpacity=clamp(1-endOffset,0,1));$$invalidate(18,maskFeatherSize=containerFeatherSize);$$invalidate(4,overflowStyle=\"--scrollable-feather-start-opacity: \".concat(maskFeatherStartOpacity,\";--scrollable-feather-end-opacity: \").concat(maskFeatherEndOpacity));}}if($$self.$$.dirty[0]&/*container, scroll*/134217736){// update scroll position\nif(container&&scroll!==undefined){if(isNumber(scroll))setScrollOffset(scroll);else setScrollOffset(scroll.scrollOffset,scroll);}}if($$self.$$.dirty[0]&/*scrollRect*/4|$$self.$$.dirty[1]&/*scrollContainerRect, size*/520){$$invalidate(45,overflows=scrollContainerRect&&scrollRect?scrollRect[size]>scrollContainerRect[size]:undefined);}if($$self.$$.dirty[1]&/*scrollState, overflows*/16386){$$invalidate(5,containerState=arrayJoin([scrollState,overflows?\"overflows\":undefined]));}if($$self.$$.dirty[1]&/*overflows, axis, $scrollOffset*/25600){$$invalidate(6,childStyle=overflows?\"transform: translate\".concat(axis,\"(\").concat($scrollOffset,\"px)\"):undefined);}};return[klass,scrollDirection,scrollRect,container,overflowStyle,containerState,childStyle,keysPressedStore,scrollOffset,handleDragStart,handleDragRelease,handleDragMove,handleDragEnd,handleResizeScrollContainer,handleWheel,handleFocus,handleScroll,handleNudge,maskFeatherSize,maskFeatherStartOpacity,maskFeatherEndOpacity,scrollBlockInteractionDist,scrollStep,scrollFocusMargin,scrollAutoCancel,elasticity,onscroll,scroll,$$scope,slots,measure_handler,div1_binding];}var Scrollable=/*#__PURE__*/function(_SvelteComponent7){_inherits(Scrollable,_SvelteComponent7);var _super8=_createSuper(Scrollable);function Scrollable(options){var _this8;_classCallCheck(this,Scrollable);_this8=_super8.call(this);init(_assertThisInitialized(_this8),options,instance$6,create_fragment$6,safe_not_equal,{\"class\":0,scrollBlockInteractionDist:21,scrollStep:22,scrollFocusMargin:23,scrollDirection:1,scrollAutoCancel:24,elasticity:25,onscroll:26,maskFeatherSize:18,maskFeatherStartOpacity:19,maskFeatherEndOpacity:20,scroll:27},[-1,-1]);return _this8;}return Scrollable;}(SvelteComponent);function fade(node,_ref114){var _ref114$delay=_ref114.delay,delay=_ref114$delay===void 0?0:_ref114$delay,_ref114$duration=_ref114.duration,duration=_ref114$duration===void 0?400:_ref114$duration,_ref114$easing=_ref114.easing,easing=_ref114$easing===void 0?identity:_ref114$easing;var o=+getComputedStyle(node).opacity;return{delay:delay,duration:duration,easing:easing,css:function css(t){return\"opacity: \".concat(t*o);}};}/* src/core/ui/components/StatusMessage.svelte generated by Svelte v3.29.4 */function create_fragment$7(ctx){var span;var t;var measure_action;var span_transition;var current;var mounted;var dispose;return{c:function c(){span=element(\"span\");t=text(/*text*/ctx[0]);attr(span,\"class\",\"DokaStatusMessage\");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);current=true;if(!mounted){dispose=[listen(span,\"measure\",function(){if(is_function(/*onmeasure*/ctx[1]))/*onmeasure*/ctx[1].apply(this,arguments);}),action_destroyer(measure_action=measurable.call(null,span))];mounted=true;}},p:function p(new_ctx,_ref115){var _ref116=_slicedToArray(_ref115,1),dirty=_ref116[0];ctx=new_ctx;if(!current||dirty&/*text*/1)set_data(t,/*text*/ctx[0]);},i:function i(local){if(current)return;add_render_callback(function(){if(!span_transition)span_transition=create_bidirectional_transition(span,fade,{},true);span_transition.run(1);});current=true;},o:function o(local){if(!span_transition)span_transition=create_bidirectional_transition(span,fade,{},false);span_transition.run(0);current=false;},d:function d(detaching){if(detaching)detach(span);if(detaching&&span_transition)span_transition.end();mounted=false;run_all(dispose);}};}function instance$7($$self,$$props,$$invalidate){var text=$$props.text;var _$$props$onmeasure=$$props.onmeasure,onmeasure=_$$props$onmeasure===void 0?noop:_$$props$onmeasure;$$self.$$set=function($$props){if(\"text\"in $$props)$$invalidate(0,text=$$props.text);if(\"onmeasure\"in $$props)$$invalidate(1,onmeasure=$$props.onmeasure);};return[text,onmeasure];}var StatusMessage=/*#__PURE__*/function(_SvelteComponent8){_inherits(StatusMessage,_SvelteComponent8);var _super9=_createSuper(StatusMessage);function StatusMessage(options){var _this9;_classCallCheck(this,StatusMessage);_this9=_super9.call(this);init(_assertThisInitialized(_this9),options,instance$7,create_fragment$7,safe_not_equal,{text:0,onmeasure:1});return _this9;}return StatusMessage;}(SvelteComponent);/* src/core/ui/components/ProgressIndicator.svelte generated by Svelte v3.29.4 */function create_fragment$8(ctx){var span1;var svg;var g;var circle0;var circle1;var t0;var span0;var t1;return{c:function c(){span1=element(\"span\");svg=svg_element(\"svg\");g=svg_element(\"g\");circle0=svg_element(\"circle\");circle1=svg_element(\"circle\");t0=space();span0=element(\"span\");t1=text(/*formattedValue*/ctx[0]);attr(circle0,\"class\",\"DokaProgressIndicatorBar\");attr(circle0,\"r\",\"8.5\");attr(circle0,\"cx\",\"10\");attr(circle0,\"cy\",\"10\");attr(circle0,\"stroke-linecap\",\"round\");attr(circle0,\"opacity\",\".25\");attr(circle1,\"class\",\"DokaProgressIndicatorFill\");attr(circle1,\"r\",\"8.5\");attr(circle1,\"stroke-dasharray\",/*circleValue*/ctx[1]);attr(circle1,\"cx\",\"10\");attr(circle1,\"cy\",\"10\");attr(circle1,\"transform\",\"rotate(-90) translate(-20)\");attr(g,\"fill\",\"none\");attr(g,\"stroke\",\"currentColor\");attr(g,\"stroke-width\",\"2.5\");attr(g,\"stroke-linecap\",\"round\");attr(g,\"opacity\",/*circleOpacity*/ctx[2]);attr(svg,\"width\",\"20\");attr(svg,\"height\",\"20\");attr(svg,\"viewBox\",\"0 0 20 20\");attr(svg,\"xmlns\",\"http://www.w3.org/2000/svg\");attr(svg,\"aria-hidden\",\"true\");attr(svg,\"focusable\",\"false\");attr(span0,\"class\",\"implicit\");attr(span1,\"class\",\"DokaProgressIndicator\");attr(span1,\"data-status\",/*status*/ctx[3]);},m:function m(target,anchor){insert(target,span1,anchor);append(span1,svg);append(svg,g);append(g,circle0);append(g,circle1);append(span1,t0);append(span1,span0);append(span0,t1);},p:function p(ctx,_ref117){var _ref118=_slicedToArray(_ref117,1),dirty=_ref118[0];if(dirty&/*circleValue*/2){attr(circle1,\"stroke-dasharray\",/*circleValue*/ctx[1]);}if(dirty&/*circleOpacity*/4){attr(g,\"opacity\",/*circleOpacity*/ctx[2]);}if(dirty&/*formattedValue*/1)set_data(t1,/*formattedValue*/ctx[0]);if(dirty&/*status*/8){attr(span1,\"data-status\",/*status*/ctx[3]);}},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(span1);}};}function instance$8($$self,$$props,$$invalidate){var $animatedProgressClamped;var dispatch=createEventDispatcher();var progress=$$props.progress;var _$$props$min=$$props.min,min=_$$props$min===void 0?0:_$$props$min;var _$$props$max=$$props.max,max=_$$props$max===void 0?100:_$$props$max;var _$$props$labelBusy=$$props.labelBusy,labelBusy=_$$props$labelBusy===void 0?\"Busy\":_$$props$labelBusy;var animatedValue=spring(0,{precision:0.01});var animatedProgressClamped=derived([animatedValue],function($animatedValue){return clamp($animatedValue,min,max);});component_subscribe($$self,animatedProgressClamped,function(value){return $$invalidate(9,$animatedProgressClamped=value);});animatedProgressClamped.subscribe(function(value){if(progress===1&&Math.round(value)>=100)dispatch(\"complete\");});$$self.$$set=function($$props){if(\"progress\"in $$props)$$invalidate(5,progress=$$props.progress);if(\"min\"in $$props)$$invalidate(6,min=$$props.min);if(\"max\"in $$props)$$invalidate(7,max=$$props.max);if(\"labelBusy\"in $$props)$$invalidate(8,labelBusy=$$props.labelBusy);};var formattedValue;var circleValue;var circleOpacity;var status;$$self.$$.update=function(){if($$self.$$.dirty&/*progress*/32){progress&&progress!==Infinity&&animatedValue.set(progress*100);}if($$self.$$.dirty&/*progress, labelBusy, $animatedProgressClamped*/800){$$invalidate(0,formattedValue=progress===Infinity?labelBusy:\"\".concat(Math.round($animatedProgressClamped),\"%\"));}if($$self.$$.dirty&/*progress, $animatedProgressClamped*/544){$$invalidate(1,circleValue=progress===Infinity?\"26.5 53\":\"\".concat($animatedProgressClamped/100*53,\" 53\"));}if($$self.$$.dirty&/*progress, $animatedProgressClamped*/544){$$invalidate(2,circleOpacity=Math.min(1,progress===Infinity?1:$animatedProgressClamped/10));}if($$self.$$.dirty&/*progress*/32){$$invalidate(3,status=progress===Infinity?\"busy\":\"loading\");}};return[formattedValue,circleValue,circleOpacity,status,animatedProgressClamped,progress,min,max,labelBusy];}var ProgressIndicator=/*#__PURE__*/function(_SvelteComponent9){_inherits(ProgressIndicator,_SvelteComponent9);var _super10=_createSuper(ProgressIndicator);function ProgressIndicator(options){var _this10;_classCallCheck(this,ProgressIndicator);_this10=_super10.call(this);init(_assertThisInitialized(_this10),options,instance$8,create_fragment$8,safe_not_equal,{progress:5,min:6,max:7,labelBusy:8});return _this10;}return ProgressIndicator;}(SvelteComponent);/* src/core/ui/components/StatusProgress.svelte generated by Svelte v3.29.4 */function create_fragment$9(ctx){var span;var progressindicator;var current;progressindicator=new ProgressIndicator({props:{progress:/*progress*/ctx[0]}});progressindicator.$on(\"complete\",function(){if(is_function(/*oncomplete*/ctx[1]))/*oncomplete*/ctx[1].apply(this,arguments);});return{c:function c(){span=element(\"span\");create_component(progressindicator.$$.fragment);attr(span,\"class\",\"DokaStatusProgress\");attr(span,\"style\",/*style*/ctx[2]);},m:function m(target,anchor){insert(target,span,anchor);mount_component(progressindicator,span,null);current=true;},p:function p(new_ctx,_ref119){var _ref120=_slicedToArray(_ref119,1),dirty=_ref120[0];ctx=new_ctx;var progressindicator_changes={};if(dirty&/*progress*/1)progressindicator_changes.progress=/*progress*/ctx[0];progressindicator.$set(progressindicator_changes);if(!current||dirty&/*style*/4){attr(span,\"style\",/*style*/ctx[2]);}},i:function i(local){if(current)return;transition_in(progressindicator.$$.fragment,local);current=true;},o:function o(local){transition_out(progressindicator.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(progressindicator);}};}function instance$9($$self,$$props,$$invalidate){var _$$props$offset=$$props.offset,offset=_$$props$offset===void 0?0:_$$props$offset;var _$$props$visible2=$$props.visible,visible=_$$props$visible2===void 0?true:_$$props$visible2;var progress=$$props.progress;var _$$props$oncomplete=$$props.oncomplete,oncomplete=_$$props$oncomplete===void 0?noop:_$$props$oncomplete;$$self.$$set=function($$props){if(\"offset\"in $$props)$$invalidate(3,offset=$$props.offset);if(\"visible\"in $$props)$$invalidate(4,visible=$$props.visible);if(\"progress\"in $$props)$$invalidate(0,progress=$$props.progress);if(\"oncomplete\"in $$props)$$invalidate(1,oncomplete=$$props.oncomplete);};var style;$$self.$$.update=function(){if($$self.$$.dirty&/*offset, visible*/24){$$invalidate(2,style=\"transform: translateX(\".concat(offset,\"px); opacity: \").concat(visible?1:0));}};return[progress,oncomplete,style,offset,visible];}var StatusProgress=/*#__PURE__*/function(_SvelteComponent10){_inherits(StatusProgress,_SvelteComponent10);var _super11=_createSuper(StatusProgress);function StatusProgress(options){var _this11;_classCallCheck(this,StatusProgress);_this11=_super11.call(this);init(_assertThisInitialized(_this11),options,instance$9,create_fragment$9,safe_not_equal,{offset:3,visible:4,progress:0,oncomplete:1});return _this11;}return StatusProgress;}(SvelteComponent);/* src/core/ui/components/DynamicComponentTree.svelte generated by Svelte v3.29.4 */function get_each_context$2(ctx,list,i){var child_ctx=ctx.slice();child_ctx[4]=list[i][0];child_ctx[5]=list[i][1];child_ctx[6]=list[i][2];child_ctx[0]=list[i][3];return child_ctx;}// (28:4) {:else}\nfunction create_else_block(ctx){var switch_instance;var switch_instance_anchor;var current;var switch_instance_spread_levels=[/*props*/ctx[6]];var switch_value=/*node*/ctx[4];function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}return{props:switch_instance_props};}if(switch_value){switch_instance=new switch_value(switch_props());}return{c:function c(){if(switch_instance)create_component(switch_instance.$$.fragment);switch_instance_anchor=empty();},m:function m(target,anchor){if(switch_instance){mount_component(switch_instance,target,anchor);}insert(target,switch_instance_anchor,anchor);current=true;},p:function p(ctx,dirty){var switch_instance_changes=dirty&/*children*/1?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*props*/ctx[6])]):{};if(switch_value!==(switch_value=/*node*/ctx[4])){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=new switch_value(switch_props());create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,switch_instance_anchor.parentNode,switch_instance_anchor);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(switch_instance_anchor);if(switch_instance)destroy_component(switch_instance,detaching);}};}// (26:4) {#if isString(node)}\nfunction create_if_block$1(ctx){var div;var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*children*/ctx[0],discardEmptyItems:true}});var div_levels=[/*props*/ctx[6]];var div_data={};for(var i=0;i<div_levels.length;i+=1){div_data=assign(div_data,div_levels[i]);}return{c:function c(){div=element(\"div\");create_component(dynamiccomponenttree.$$.fragment);set_attributes(div,div_data);},m:function m(target,anchor){insert(target,div,anchor);mount_component(dynamiccomponenttree,div,null);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty&/*children*/1)dynamiccomponenttree_changes.items=/*children*/ctx[0];dynamiccomponenttree.$set(dynamiccomponenttree_changes);set_attributes(div,div_data=get_spread_update(div_levels,[dirty&/*children*/1&&/*props*/ctx[6]]));},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(dynamiccomponenttree);}};}// (25:0) {#each children as [node, key, props, children] (key) }\nfunction create_each_block$2(key_1,ctx){var first;var show_if;var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block$1,create_else_block];var if_blocks=[];function select_block_type(ctx,dirty){if(dirty&/*children*/1)show_if=!!isString(/*node*/ctx[4]);if(show_if)return 0;return 1;}current_block_type_index=select_block_type(ctx,-1);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{key:key_1,first:null,c:function c(){first=empty();if_block.c();if_block_anchor=empty();this.first=first;},m:function m(target,anchor){insert(target,first,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx,dirty);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(first);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}function create_fragment$a(ctx){var each_blocks=[];var each_1_lookup=new Map();var each_1_anchor;var current;var each_value=/*children*/ctx[0];var get_key=function get_key(ctx){return(/*key*/ctx[5]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$2(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$2(key,child_ctx));}return{c:function c(){for(var _i13=0;_i13<each_blocks.length;_i13+=1){each_blocks[_i13].c();}each_1_anchor=empty();},m:function m(target,anchor){for(var _i14=0;_i14<each_blocks.length;_i14+=1){each_blocks[_i14].m(target,anchor);}insert(target,each_1_anchor,anchor);current=true;},p:function p(ctx,_ref121){var _ref122=_slicedToArray(_ref121,1),dirty=_ref122[0];if(dirty&/*children, isString*/1){var _each_value3=/*children*/ctx[0];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value3,each_1_lookup,each_1_anchor.parentNode,outro_and_destroy_block,create_each_block$2,each_1_anchor,get_each_context$2);check_outros();}},i:function i(local){if(current)return;for(var _i15=0;_i15<each_value.length;_i15+=1){transition_in(each_blocks[_i15]);}current=true;},o:function o(local){for(var _i16=0;_i16<each_blocks.length;_i16+=1){transition_out(each_blocks[_i16]);}current=false;},d:function d(detaching){for(var _i17=0;_i17<each_blocks.length;_i17+=1){each_blocks[_i17].d(detaching);}if(detaching)detach(each_1_anchor);}};}function instance$a($$self,$$props,$$invalidate){var items=$$props.items;var _$$props$discardEmpty=$$props.discardEmptyItems,discardEmptyItems=_$$props$discardEmpty===void 0?true:_$$props$discardEmpty;var shouldRenderItem=function shouldRenderItem(item){// don't render falsy items\nif(!item)return false;// get relevant props\nvar _item=_slicedToArray(item,4),node=_item[0],children=_item[3];// if item is component, we always render it\nif(!isString(node))return true;// item is tag, we have to check if children are empty\nreturn children.some(shouldRenderItem);};$$self.$$set=function($$props){if(\"items\"in $$props)$$invalidate(1,items=$$props.items);if(\"discardEmptyItems\"in $$props)$$invalidate(2,discardEmptyItems=$$props.discardEmptyItems);};var children;$$self.$$.update=function(){if($$self.$$.dirty&/*items, discardEmptyItems*/6){$$invalidate(0,children=(items&&discardEmptyItems?items.filter(shouldRenderItem):items)||[]);}};return[children,items,discardEmptyItems];}var DynamicComponentTree_1=/*#__PURE__*/function(_SvelteComponent11){_inherits(DynamicComponentTree_1,_SvelteComponent11);var _super12=_createSuper(DynamicComponentTree_1);function DynamicComponentTree_1(options){var _this12;_classCallCheck(this,DynamicComponentTree_1);_this12=_super12.call(this);init(_assertThisInitialized(_this12),options,instance$a,create_fragment$a,safe_not_equal,{items:1,discardEmptyItems:2});return _this12;}return DynamicComponentTree_1;}(SvelteComponent);var ImageStoreProps=['file','size','loadState','processState','cropAspectRatio','cropLimitToImage','crop','cropMinSize','cropMaxSize','cropRange','cropOrigin','cropRectAspectRatio','rotation','rotationRange','targetSize','flipX','flipY','perspectiveX','perspectiveY','perspective','colorMatrix','convolutionMatrix','gamma','vignette','noise','decoration','annotation','backgroundColor','state'];var proxy=function proxy(get,set,update){var subscribers=[];return{set:set,update:update,publish:function publish(value){subscribers.forEach(function(cb){return cb(value);});},subscribe:function subscribe(cb){subscribers.push(cb);get(cb);return function(){subscribers=subscribers.filter(function(item){return item!==cb;});};}};};var createImageProxy=function createImageProxy(){var unsubs;var image;var proxyStores=ImageStoreProps.reduce(function(prev,curr){prev[curr]=proxy(// getter\nfunction(cb){// subscribe\nif(!image)return cb();var unsub=image.stores[curr].subscribe(cb);unsub();},// setter\nfunction(value){// set value on actual store if is defined\nif(!image)return;image.stores[curr].set(value);},// updater\nfunction(cb){if(!image)return;image.stores[curr].update(cb);});return prev;},{});var update=function update(newImage){image=newImage;if(unsubs){// remove subscribers\nunsubs.forEach(function(unsub){return unsub();});unsubs=undefined;}if(!newImage){// need to reset load state\nproxyStores['file'].publish(undefined);proxyStores['loadState'].publish(undefined);return;}unsubs=ImageStoreProps.map(function(prop){return newImage.stores[prop].subscribe(function(value){return proxyStores[prop].publish(value);});});};return{update:update,stores:proxyStores};};var createPingRouter=function createPingRouter(route){var cancel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(e){if(e.type!=='ping')return;if(cancel)e.stopPropagation();route(e.detail.type,e.detail.data);};};var isTextarea=function isTextarea(element){return /textarea/i.test(element.nodeName);};var isTextInput=function isTextInput(node){return /date|email|number|search|text|url/.test(node.type);};var isTextField=function isTextField(node){return isTextarea(node)||isTextInput(node);};var toKebabCase=function toKebabCase(str,abbr){return(abbr?stringReplace(str,abbr):str).replace(/([a-z])([A-Z])/g,'$1-$2').replace(/\\s+/g,'-').toLowerCase();};var matchMedia$1=function matchMedia$1(query,cb){var mql=matchMedia(query);mql.addListener(cb);cb(mql);return{get matches(){return mql.matches;},destroy:function destroy(){return mql.removeListener(cb);}};};var mediaQueryStore=function mediaQueryStore(query){var formatValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:passthrough;var _writable2=writable(undefined),subscribe=_writable2.subscribe,set=_writable2.set;var mm=matchMedia$1(query,function(_ref123){var matches=_ref123.matches;return set(formatValue(matches));});return{subscribe:subscribe,unsubscribe:mm.destroy};};var canPreventNavSwipe=function canPreventNavSwipe(){// if not iOS we can't prevent swipe because it probably isn't a thing\nif(!isIOS())return false;// extract version number\nvar matches=navigator.userAgent.match(/OS (\\d+)_(\\d+)_?(\\d+)?/i)||[];var _matches$map=matches.map(function(v){return parseInt(v,10)||0;}),_matches$map2=_slicedToArray(_matches$map,3),major=_matches$map2[1],minor=_matches$map2[2];// is atleast version 13.4+\nreturn major>13||major===13&&minor>=4;};var calculateImageTransforms=function calculateImageTransforms(stageRect,rootRect,imageSize,cropRect,imageSelectionRect,imageScale,imagePerspectiveX,imagePerspectiveY,imageRotation,imageFlipX,imageFlipY){if(!stageRect||!rootRect||!imageSize||!cropRect||!imageScale)return undefined;var viewRect=rectNormalizeOffset(rectClone(rootRect));var viewCenter=rectCenter(viewRect);var stageCenter=rectCenter(stageRect);var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imagePerspective=vectorCreate(imagePerspectiveX,imagePerspectiveY);// get base crop rect so we can correctly apply transforms\nvar cropRectBase=getBaseCropRect(imageSize,cropRect,imageRotation,imagePerspective);var cropRectBaseCenter=rectCenter(cropRectBase);var imageTranslation=vectorSubtract(vectorClone(imageCenter),cropRectBaseCenter);// calculate stage center offset from view center\nvar imageOffset=vectorSubtract(vectorClone(stageCenter),viewCenter);// correct for stage offset\nimageTranslation.x+=imageOffset.x;imageTranslation.y+=imageOffset.y;// set origin of translation (so rotates around center of selection)\nvar imageOrigin=vectorInvert(vectorClone(imageTranslation));// correct for stage offset\nimageOrigin.x+=imageOffset.x;imageOrigin.y+=imageOffset.y;// correct for image selection offset relative to view\nvar imageSelectionCenter=rectCenter(rectTranslate(rectClone(imageSelectionRect),stageRect));var imageSelectionOffset=vectorSubtract(imageSelectionCenter,stageCenter);vectorAdd(imageTranslation,imageSelectionOffset);return{// offset: imageOffset,\norigin:imageOrigin,translation:imageTranslation,rotation:{x:imageFlipY?Math.PI:0,y:imageFlipX?Math.PI:0,z:imageRotation},perspective:imagePerspective,scale:imageScale};};// @ts-ignore\nvar historyCreate=function historyCreate(getState,setState){// set up pub/sub for history object\nvar _pubsub3=pubsub(),sub=_pubsub3.sub,pub=_pubsub3.pub;// current history state\nvar baseState;var entries=[];var index=writable(-1);var subs=[];var updateSubs=function updateSubs(){return subs.forEach(function(cb){return cb({index:get_store_value(index),length:entries.length});});};var history={get index(){return get_store_value(index);},set index(i){// validate new index\ni=Number.isInteger(i)?i:-1;i=clamp(i,-1,entries.length-1);// remember\nindex.set(i);setState(entries[history.index]||baseState);// update subs\nupdateSubs();},get state(){return entries[entries.length-1]||baseState;},length:function length(){return entries.length;},undo:function undo(){var newIndex=history.index--;pub('undo',newIndex);return newIndex;},redo:function redo(){var newIndex=history.index++;pub('redo',history.index);return newIndex;},revert:function revert(){entries.length=0;history.index=-1;pub('revert');},write:function write(){// reset length to current index\nentries.length=history.index+1;// add new entry\nentries.push(getState());// move pointer to last added index\nindex.set(entries.length-1);updateSubs();},set:function set(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};baseState=state;},subscribe:function subscribe(cb){subs.push(cb);cb({index:history.index,length:entries.length});return function(){return subs.splice(subs.indexOf(cb),1);};},on:sub};return history;};var isChrome=function isChrome(){return isBrowser()&&!!window['chrome'];};var imageBitmapToImageData=/*#__PURE__*/function(){var _ref124=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee33(imageBitmap){return _regeneratorRuntime.wrap(function _callee33$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:_context34.t0=canvasToImageData;_context34.next=3;return imageDataToCanvas(imageBitmap);case 3:_context34.t1=_context34.sent;return _context34.abrupt(\"return\",(0,_context34.t0)(_context34.t1));case 5:case\"end\":return _context34.stop();}}},_callee33);}));return function imageBitmapToImageData(_x53){return _ref124.apply(this,arguments);};}();var blobToImageBitmap=function blobToImageBitmap(file,ImageOrienter,canvasMemoryLimit){return new Promise(/*#__PURE__*/function(){var _ref125=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee34(resolve,reject){var orientation,toImageData,imageBitmap;return _regeneratorRuntime.wrap(function _callee34$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:_context35.next=2;return ImageOrienter.read(file);case 2:orientation=_context35.sent;// helper method to apply orientation fix if needed\ntoImageData=function toImageData(file){return blobToImageData(file,canvasMemoryLimit).then(function(imageData){return ImageOrienter.apply(imageData,orientation);}).then(resolve)[\"catch\"](reject);};// cannot create image bitmaps in worker\nif(!(!canCreateImageBitmap()||isSVGFile(file))){_context35.next=6;break;}return _context35.abrupt(\"return\",toImageData(file));case 6:_context35.prev=6;_context35.next=9;return thread(function(file,done){return createImageBitmap(file).then(function(bitmap){return done(null,bitmap);})[\"catch\"](done);},[file]);case 9:imageBitmap=_context35.sent;_context35.next=14;break;case 12:_context35.prev=12;_context35.t0=_context35[\"catch\"](6);case 14:if(!(!imageBitmap||!imageBitmap.width)){_context35.next=16;break;}return _context35.abrupt(\"return\",toImageData(file));case 16:_context35.next=18;return canOrientImages();case 18:if(_context35.sent){_context35.next=20;break;}return _context35.abrupt(\"return\",resolve(ImageOrienter.apply(imageBitmap,orientation)));case 20:if(!(isChrome()&&orientation>1)){_context35.next=26;break;}_context35.t1=resolve;_context35.next=24;return imageBitmapToImageData(imageBitmap);case 24:_context35.t2=_context35.sent;return _context35.abrupt(\"return\",(0,_context35.t1)(_context35.t2));case 26:// yay we got our bitmap\nresolve(imageBitmap);case 27:case\"end\":return _context35.stop();}}},_callee34,null,[[6,12]]);}));return function(_x54,_x55){return _ref125.apply(this,arguments);};}());};var imageDataContain=function imageDataContain(imageData,size){return new Promise(/*#__PURE__*/function(){var _ref126=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee35(resolve){var scalar,targetWidth,targetHeight,canvas,ctx,data;return _regeneratorRuntime.wrap(function _callee35$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:if(!(imageData.width<size.width&&imageData.height<size.height)){_context36.next=2;break;}return _context36.abrupt(\"return\",resolve(imageData));case 2:scalar=Math.min(size.width/imageData.width,size.height/imageData.height);// scale\ntargetWidth=scalar*imageData.width;targetHeight=scalar*imageData.height;canvas=h('canvas',{width:targetWidth,height:targetHeight});ctx=canvas.getContext('2d');if(!isImageData(imageData)){_context36.next=13;break;}_context36.next=10;return imageDataToCanvas(imageData);case 10:_context36.t0=_context36.sent;_context36.next=14;break;case 13:_context36.t0=imageData;case 14:data=_context36.t0;ctx.drawImage(data,0,0,targetWidth,targetHeight);resolve(canvasToImageData(canvas));case 17:case\"end\":return _context36.stop();}}},_callee35);}));return function(_x56){return _ref126.apply(this,arguments);};}());};var limit=null;var getWebGLTextureSizeLimit=function getWebGLTextureSizeLimit(){if(limit!==null)return limit;var canvas=h('canvas');var gl=getWebGLContext(canvas);limit=gl?gl.getParameter(gl.MAX_TEXTURE_SIZE):undefined;releaseCanvas(canvas);return limit;};var getDevicePixelRatio=function getDevicePixelRatio(){return isBrowser()&&window.devicePixelRatio||1;};var hexToRGB=function hexToRGB(str){var _str$split=str.split(''),_str$split2=_slicedToArray(_str$split,4),q=_str$split2[1],w=_str$split2[2],e=_str$split2[3];str=str.length===4?\"#\".concat(q).concat(q).concat(w).concat(w).concat(e).concat(e):str;var _$exec=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(str),_$exec2=_slicedToArray(_$exec,4),r=_$exec2[1],g=_$exec2[2],b=_$exec2[3];return[r,g,b].map(function(v){return parseInt(v,16)/255;});};var colorStringToColorArray=function colorStringToColorArray(color){// if rgba(128, 128, 128, .5)\nif(/^rgba/.test(color)){return color.substr(5).split(',').map(parseFloat).map(function(v,i){return v/(i===3?1:255);});}// if rgb(128, 128, 128)\nif(/^rgb/.test(color)){return color.substr(4).split(',').map(parseFloat).map(function(v){return v/255;});}// if #777\nif(/^#/.test(color)){return hexToRGB(color);}};var isDarkColor=function isDarkColor(color){return color[0]<0.25&&color[1]<0.25&&color[2]<0.25;};var result$9=null;var supportsWebGL=function supportsWebGL(){if(result$9===null){var canvas=h('canvas');result$9=!!getWebGLContext(canvas);releaseCanvas(canvas);}return result$9;};/* src/core/ui/index.svelte generated by Svelte v3.29.4 */function create_if_block$2(ctx){var t;var if_block1_anchor;var current;var if_block0=/*isStatusVisible*/ctx[47]&&create_if_block_5(ctx);var if_block1=/*$imagePreview*/ctx[38]&&!/*isSupportsError*/ctx[32]&&create_if_block_1$1(ctx);return{c:function c(){if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*isStatusVisible*/ctx[47]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[1]&/*isStatusVisible*/65536){transition_in(if_block0,1);}}else{if_block0=create_if_block_5(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*$imagePreview*/ctx[38]&&!/*isSupportsError*/ctx[32]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[1]&/*$imagePreview, isSupportsError*/130){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$1(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (1410:2) {#if isStatusVisible}\nfunction create_if_block_5(ctx){var div;var _p;var current_block_type_index;var if_block;var p_style_value;var div_style_value;var current;var if_block_creators=[create_if_block_6,create_if_block_7,create_if_block_9];var if_blocks=[];function select_block_type(ctx,dirty){if(/*isSupportsError*/ctx[32])return 0;if(/*isWaitingForImage*/ctx[34]||/*isImageLoadError*/ctx[33]||/*isLoadingImageData*/ctx[36]||/*isCreatingImagePreview*/ctx[37])return 1;if(/*isProcessingImage*/ctx[39]&&/*imageProcessStatusLabel*/ctx[42])return 2;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element(\"div\");_p=element(\"p\");if(if_block)if_block.c();attr(_p,\"style\",p_style_value=\"transform: translateX(\".concat(/*$statusOffsetX*/ctx[48],\"px)\"));attr(div,\"class\",\"DokaStatus\");attr(div,\"style\",div_style_value=\"opacity: \".concat(/*$statusOpacity*/ctx[46]));},m:function m(target,anchor){insert(target,div,anchor);append(div,_p);if(~current_block_type_index){if_blocks[current_block_type_index].m(_p,null);}current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(_p,null);}else{if_block=null;}}if(!current||dirty[1]&/*$statusOffsetX*/131072&&p_style_value!==(p_style_value=\"transform: translateX(\".concat(/*$statusOffsetX*/ctx[48],\"px)\"))){attr(_p,\"style\",p_style_value);}if(!current||dirty[1]&/*$statusOpacity*/32768&&div_style_value!==(div_style_value=\"opacity: \".concat(/*$statusOpacity*/ctx[46]))){attr(div,\"style\",div_style_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}// (1433:58) \nfunction create_if_block_9(ctx){var statusmessage;var t0;var statusprogress;var t1;var if_block_anchor;var current;statusmessage=new StatusMessage({props:{text:/*imageProcessStatusLabel*/ctx[42],onmeasure:/*offsetProgress*/ctx[106]}});statusprogress=new StatusProgress({props:{offset:/*$progressOffsetX*/ctx[49],visible:/*imageProcessShowProgressIndicator*/ctx[44],progress:/*imageProcessProgress*/ctx[43]}});var if_block=/*isImageProcessingError*/ctx[45]&&create_if_block_10(ctx);return{c:function c(){create_component(statusmessage.$$.fragment);t0=space();create_component(statusprogress.$$.fragment);t1=space();if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){mount_component(statusmessage,target,anchor);insert(target,t0,anchor);mount_component(statusprogress,target,anchor);insert(target,t1,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var statusmessage_changes={};if(dirty[1]&/*imageProcessStatusLabel*/2048)statusmessage_changes.text=/*imageProcessStatusLabel*/ctx[42];statusmessage.$set(statusmessage_changes);var statusprogress_changes={};if(dirty[1]&/*$progressOffsetX*/262144)statusprogress_changes.offset=/*$progressOffsetX*/ctx[49];if(dirty[1]&/*imageProcessShowProgressIndicator*/8192)statusprogress_changes.visible=/*imageProcessShowProgressIndicator*/ctx[44];if(dirty[1]&/*imageProcessProgress*/4096)statusprogress_changes.progress=/*imageProcessProgress*/ctx[43];statusprogress.$set(statusprogress_changes);if(/*isImageProcessingError*/ctx[45]){if(if_block){if_block.p(ctx,dirty);if(dirty[1]&/*isImageProcessingError*/16384){transition_in(if_block,1);}}else{if_block=create_if_block_10(ctx);if_block.c();transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(statusmessage.$$.fragment,local);transition_in(statusprogress.$$.fragment,local);transition_in(if_block);current=true;},o:function o(local){transition_out(statusmessage.$$.fragment,local);transition_out(statusprogress.$$.fragment,local);transition_out(if_block);current=false;},d:function d(detaching){destroy_component(statusmessage,detaching);if(detaching)detach(t0);destroy_component(statusprogress,detaching);if(detaching)detach(t1);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}// (1422:99) \nfunction create_if_block_7(ctx){var statusmessage;var t0;var statusprogress;var t1;var if_block_anchor;var current;statusmessage=new StatusMessage({props:{text:/*imageLoadStatusLabel*/ctx[41],onmeasure:/*offsetProgress*/ctx[106]}});statusprogress=new StatusProgress({props:{offset:/*$progressOffsetX*/ctx[49],visible:/*imageLoadShowProgressIndicator*/ctx[40],progress:/*imageLoadProgress*/ctx[35]}});var if_block=/*isImageLoadError*/ctx[33]&&create_if_block_8(ctx);return{c:function c(){create_component(statusmessage.$$.fragment);t0=space();create_component(statusprogress.$$.fragment);t1=space();if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){mount_component(statusmessage,target,anchor);insert(target,t0,anchor);mount_component(statusprogress,target,anchor);insert(target,t1,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var statusmessage_changes={};if(dirty[1]&/*imageLoadStatusLabel*/1024)statusmessage_changes.text=/*imageLoadStatusLabel*/ctx[41];statusmessage.$set(statusmessage_changes);var statusprogress_changes={};if(dirty[1]&/*$progressOffsetX*/262144)statusprogress_changes.offset=/*$progressOffsetX*/ctx[49];if(dirty[1]&/*imageLoadShowProgressIndicator*/512)statusprogress_changes.visible=/*imageLoadShowProgressIndicator*/ctx[40];if(dirty[1]&/*imageLoadProgress*/16)statusprogress_changes.progress=/*imageLoadProgress*/ctx[35];statusprogress.$set(statusprogress_changes);if(/*isImageLoadError*/ctx[33]){if(if_block){if_block.p(ctx,dirty);if(dirty[1]&/*isImageLoadError*/4){transition_in(if_block,1);}}else{if_block=create_if_block_8(ctx);if_block.c();transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(statusmessage.$$.fragment,local);transition_in(statusprogress.$$.fragment,local);transition_in(if_block);current=true;},o:function o(local){transition_out(statusmessage.$$.fragment,local);transition_out(statusprogress.$$.fragment,local);transition_out(if_block);current=false;},d:function d(detaching){destroy_component(statusmessage,detaching);if(detaching)detach(t0);destroy_component(statusprogress,detaching);if(detaching)detach(t1);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}// (1414:3) {#if isSupportsError}\nfunction create_if_block_6(ctx){var statusmessage;var t;var span;var icon;var span_style_value;var current;statusmessage=new StatusMessage({props:{text:/*isSupportsError*/ctx[32],onmeasure:/*offsetProgress*/ctx[106]}});icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_4]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(statusmessage.$$.fragment);t=space();span=element(\"span\");create_component(icon.$$.fragment);attr(span,\"class\",\"DokaStatusIcon\");attr(span,\"style\",span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"));},m:function m(target,anchor){mount_component(statusmessage,target,anchor);insert(target,t,anchor);insert(target,span,anchor);mount_component(icon,span,null);current=true;},p:function p(ctx,dirty){var statusmessage_changes={};if(dirty[1]&/*isSupportsError*/2)statusmessage_changes.text=/*isSupportsError*/ctx[32];statusmessage.$set(statusmessage_changes);var icon_changes={};if(dirty[0]&/*locale*/4|dirty[8]&/*$$scope*/4096){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);if(!current||dirty[1]&/*$progressOffsetX*/262144&&span_style_value!==(span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"))){attr(span,\"style\",span_style_value);}},i:function i(local){if(current)return;transition_in(statusmessage.$$.fragment,local);transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(statusmessage.$$.fragment,local);transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(statusmessage,detaching);if(detaching)detach(t);if(detaching)detach(span);destroy_component(icon);}};}// (1438:4) {#if isImageProcessingError}\nfunction create_if_block_10(ctx){var span;var button;var span_style_value;var current;button=new Button({props:{onclick:/*handleCloseImageProcessError*/ctx[108],label:/*locale*/ctx[2].statusLabelButtonClose,icon:/*locale*/ctx[2].statusIconButtonClose,hideLabel:true}});return{c:function c(){span=element(\"span\");create_component(button.$$.fragment);attr(span,\"class\",\"DokaStatusButton\");attr(span,\"style\",span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"));},m:function m(target,anchor){insert(target,span,anchor);mount_component(button,span,null);current=true;},p:function p(ctx,dirty){var button_changes={};if(dirty[0]&/*locale*/4)button_changes.label=/*locale*/ctx[2].statusLabelButtonClose;if(dirty[0]&/*locale*/4)button_changes.icon=/*locale*/ctx[2].statusIconButtonClose;button.$set(button_changes);if(!current||dirty[1]&/*$progressOffsetX*/262144&&span_style_value!==(span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"))){attr(span,\"style\",span_style_value);}},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(button);}};}// (1427:4) {#if isImageLoadError}\nfunction create_if_block_8(ctx){var span;var button;var span_style_value;var current;button=new Button({props:{onclick:/*handleCloseImageLoadError*/ctx[107],label:/*locale*/ctx[2].statusLabelButtonClose,icon:/*locale*/ctx[2].statusIconButtonClose,hideLabel:true}});return{c:function c(){span=element(\"span\");create_component(button.$$.fragment);attr(span,\"class\",\"DokaStatusButton\");attr(span,\"style\",span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"));},m:function m(target,anchor){insert(target,span,anchor);mount_component(button,span,null);current=true;},p:function p(ctx,dirty){var button_changes={};if(dirty[0]&/*locale*/4)button_changes.label=/*locale*/ctx[2].statusLabelButtonClose;if(dirty[0]&/*locale*/4)button_changes.icon=/*locale*/ctx[2].statusIconButtonClose;button.$set(button_changes);if(!current||dirty[1]&/*$progressOffsetX*/262144&&span_style_value!==(span_style_value=\"transform: translateX(\".concat(/*$progressOffsetX*/ctx[49],\"px)\"))){attr(span,\"style\",span_style_value);}},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(button);}};}// (1419:5) <Icon>\nfunction create_default_slot_4(ctx){var g;var raw_value=/*locale*/ctx[2].iconSupportError+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*locale*/4&&raw_value!==(raw_value=/*locale*/ctx[2].iconSupportError+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (1449:2) {#if $imagePreview && !isSupportsError}\nfunction create_if_block_1$1(ctx){var t0;var t1;var current_block_type_index;var if_block2;var t2;var canvas;var t3;var div;var current;var if_block0=/*enableToolbar*/ctx[6]&&create_if_block_4(ctx);var if_block1=/*shouldRenderTabs*/ctx[16]&&/*showUtils*/ctx[14]&&create_if_block_3(ctx);var if_block_creators=[create_if_block_2,create_else_block$1];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldRenderTabs*/ctx[16])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block2=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);canvas=new Canvas({props:{animate:/*shouldAnimate*/ctx[18],pixelRatio:/*$pixelRatio*/ctx[56],backgroundColor:/*$rootBackgroundColor*/ctx[28],maskRect:/*$imageSelectionRectPresentation*/ctx[31],imageSize:/*$imageSize*/ctx[17],imageData:/*$imagePreview*/ctx[38],imageProps:/*imageProps*/ctx[30],imagePreviews:/*$imagePreviews*/ctx[57],loadImageData:/*imageSourceToImageData*/ctx[8],willRender:/*func_2*/ctx[152]}});return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();if_block2.c();t2=space();create_component(canvas.$$.fragment);t3=space();div=element(\"div\");attr(div,\"class\",\"DokaRootPortal\");},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,t2,anchor);mount_component(canvas,target,anchor);insert(target,t3,anchor);insert(target,div,anchor);/*div_binding*/ctx[153](div);current=true;},p:function p(ctx,dirty){if(/*enableToolbar*/ctx[6]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*enableToolbar*/64){transition_in(if_block0,1);}}else{if_block0=create_if_block_4(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderTabs*/ctx[16]&&/*showUtils*/ctx[14]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*shouldRenderTabs, showUtils*/81920){transition_in(if_block1,1);}}else{if_block1=create_if_block_3(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(t1.parentNode,t1);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block2=if_blocks[current_block_type_index];if(!if_block2){if_block2=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block2.c();}transition_in(if_block2,1);if_block2.m(t2.parentNode,t2);}var canvas_changes={};if(dirty[0]&/*shouldAnimate*/262144)canvas_changes.animate=/*shouldAnimate*/ctx[18];if(dirty[1]&/*$pixelRatio*/33554432)canvas_changes.pixelRatio=/*$pixelRatio*/ctx[56];if(dirty[0]&/*$rootBackgroundColor*/268435456)canvas_changes.backgroundColor=/*$rootBackgroundColor*/ctx[28];if(dirty[1]&/*$imageSelectionRectPresentation*/1)canvas_changes.maskRect=/*$imageSelectionRectPresentation*/ctx[31];if(dirty[0]&/*$imageSize*/131072)canvas_changes.imageSize=/*$imageSize*/ctx[17];if(dirty[1]&/*$imagePreview*/128)canvas_changes.imageData=/*$imagePreview*/ctx[38];if(dirty[0]&/*imageProps*/1073741824)canvas_changes.imageProps=/*imageProps*/ctx[30];if(dirty[1]&/*$imagePreviews*/67108864)canvas_changes.imagePreviews=/*$imagePreviews*/ctx[57];if(dirty[0]&/*imageSourceToImageData*/256)canvas_changes.loadImageData=/*imageSourceToImageData*/ctx[8];if(dirty[0]&/*willRenderCanvas*/32|dirty[1]&/*$imageDecoration, $imageAnnotation, $imageOverlay*/939524096)canvas_changes.willRender=/*func_2*/ctx[152];canvas.$set(canvas_changes);},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);transition_in(canvas.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);transition_out(canvas.$$.fragment,local);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(t2);destroy_component(canvas,detaching);if(detaching)detach(t3);if(detaching)detach(div);/*div_binding*/ctx[153](null);}};}// (1451:3) {#if enableToolbar}\nfunction create_if_block_4(ctx){var div;var dynamiccomponenttree;var measurable_action;var current;var mounted;var dispose;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*toolbarItems*/ctx[51]}});return{c:function c(){div=element(\"div\");create_component(dynamiccomponenttree.$$.fragment);attr(div,\"class\",\"DokaNav DokaNavTools\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(dynamiccomponenttree,div,null);current=true;if(!mounted){dispose=[listen(div,\"measure\",/*measure_handler*/ctx[137]),action_destroyer(measurable_action=measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[1]&/*toolbarItems*/1048576)dynamiccomponenttree_changes.items=/*toolbarItems*/ctx[51];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(dynamiccomponenttree);mounted=false;run_all(dispose);}};}// (1457:3) {#if shouldRenderTabs && showUtils }\nfunction create_if_block_3(ctx){var div;var scrollable;var current;scrollable=new Scrollable({props:{elasticity:/*elasticityMultiplier*/ctx[4]*scrollElasticity,scrollDirection:/*isLandscape*/ctx[27]?\"y\":\"x\",$$slots:{\"default\":[create_default_slot_1]},$$scope:{ctx:ctx}}});return{c:function c(){div=element(\"div\");create_component(scrollable.$$.fragment);attr(div,\"class\",\"DokaNav DokaNavMain\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*elasticityMultiplier*/16)scrollable_changes.elasticity=/*elasticityMultiplier*/ctx[4]*scrollElasticity;if(dirty[0]&/*isLandscape*/134217728)scrollable_changes.scrollDirection=/*isLandscape*/ctx[27]?\"y\":\"x\";if(dirty[0]&/*tabsConfig, tabs, utilSelected*/27262976|dirty[8]&/*$$scope*/4096){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);}};}// (1461:6) <Icon>\nfunction create_default_slot_3(ctx){var g;var raw_value=/*tab*/ctx[259].icon+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[8]&/*tab*/2048&&raw_value!==(raw_value=/*tab*/ctx[259].icon+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (1460:5) <TabList {...tabsConfig} {tabs} on:select={({ detail }) => utilSelected = detail} let:tab={tab}>\nfunction create_default_slot_2(ctx){var icon;var t0;var span;var t1_value=/*tab*/ctx[259].label+\"\";var t1;var current;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_3]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);t0=space();span=element(\"span\");t1=text(t1_value);},m:function m(target,anchor){mount_component(icon,target,anchor);insert(target,t0,anchor);insert(target,span,anchor);append(span,t1);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[8]&/*$$scope, tab*/6144){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);if((!current||dirty[8]&/*tab*/2048)&&t1_value!==(t1_value=/*tab*/ctx[259].label+\"\"))set_data(t1,t1_value);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);if(detaching)detach(t0);if(detaching)detach(span);}};}// (1459:4) <Scrollable elasticity={elasticityMultiplier * scrollElasticity} scrollDirection={isLandscape ? 'y' : 'x'}>\nfunction create_default_slot_1(ctx){var tablist;var current;var tablist_spread_levels=[/*tabsConfig*/ctx[23],{tabs:/*tabs*/ctx[24]}];var tablist_props={$$slots:{\"default\":[create_default_slot_2,function(_ref127){var tab=_ref127.tab;return{259:tab};},function(_ref128){var tab=_ref128.tab;return[0,0,0,0,0,0,0,0,tab?2048:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on(\"select\",/*select_handler*/ctx[138]);return{c:function c(){create_component(tablist.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[0]&/*tabsConfig, tabs*/25165824?get_spread_update(tablist_spread_levels,[dirty[0]&/*tabsConfig*/8388608&&get_spread_object(/*tabsConfig*/ctx[23]),dirty[0]&/*tabs*/16777216&&{tabs:/*tabs*/ctx[24]}]):{};if(dirty[8]&/*$$scope, tab*/6144){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);}};}// (1481:3) {:else}\nfunction create_else_block$1(ctx){var panel;var updating_component;var current;function panel_component_binding_1(value){/*panel_component_binding_1*/ctx[147].call(null,value);}var panel_props={\"class\":\"DokaMain\",content:_objectSpread(_objectSpread({},/*utilsMerged*/ctx[20].find(/*func_1*/ctx[146])),{},{props:/*pluginOptions*/ctx[7][/*utilSelected*/ctx[21]]}),locale:/*locale*/ctx[2],stores:/*utilStores*/ctx[101]};if(/*pluginInterface*/ctx[0][/*utilSelected*/ctx[21]]!==void 0){panel_props.component=/*pluginInterface*/ctx[0][/*utilSelected*/ctx[21]];}panel=new Panel({props:panel_props});binding_callbacks.push(function(){return bind(panel,\"component\",panel_component_binding_1);});panel.$on(\"measure\",/*measure_handler_3*/ctx[148]);panel.$on(\"show\",/*show_handler_1*/ctx[149]);panel.$on(\"hide\",/*hide_handler_1*/ctx[150]);panel.$on(\"fade\",/*fade_handler_1*/ctx[151]);return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(ctx,dirty){var panel_changes={};if(dirty[0]&/*utilsMerged, utilSelected, pluginOptions*/3145856)panel_changes.content=_objectSpread(_objectSpread({},/*utilsMerged*/ctx[20].find(/*func_1*/ctx[146])),{},{props:/*pluginOptions*/ctx[7][/*utilSelected*/ctx[21]]});if(dirty[0]&/*locale*/4)panel_changes.locale=/*locale*/ctx[2];if(!updating_component&&dirty[0]&/*pluginInterface, utilSelected*/2097153){updating_component=true;panel_changes.component=/*pluginInterface*/ctx[0][/*utilSelected*/ctx[21]];add_flush_callback(function(){return updating_component=false;});}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}// (1468:3) {#if shouldRenderTabs}\nfunction create_if_block_2(ctx){var tabpanels;var current;var tabpanels_spread_levels=[{\"class\":\"DokaMain\"},{visible:/*utilsVisible*/ctx[12]},/*tabsConfig*/ctx[23],{panels:/*panels*/ctx[25]}];var tabpanels_props={$$slots:{\"default\":[create_default_slot$1,function(_ref129){var panel=_ref129.panel;return{258:panel};},function(_ref130){var panel=_ref130.panel;return[0,0,0,0,0,0,0,0,panel?1024:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});tabpanels.$on(\"measure\",/*measure_handler_2*/ctx[145]);return{c:function c(){create_component(tabpanels.$$.fragment);},m:function m(target,anchor){mount_component(tabpanels,target,anchor);current=true;},p:function p(ctx,dirty){var tabpanels_changes=dirty[0]&/*utilsVisible, tabsConfig, panels*/41947136?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],dirty[0]&/*utilsVisible*/4096&&{visible:/*utilsVisible*/ctx[12]},dirty[0]&/*tabsConfig*/8388608&&get_spread_object(/*tabsConfig*/ctx[23]),dirty[0]&/*panels*/33554432&&{panels:/*panels*/ctx[25]}]):{};if(dirty[0]&/*utilsMerged, pluginOptions, locale, utilSelected, pluginInterface, utilsVisible, utilsVisibleFraction*/7344261|dirty[1]&/*$utilRect*/16777216|dirty[8]&/*$$scope, panel*/5120){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tabpanels,detaching);}};}// (1469:3) <TabPanels class=\"DokaMain\" visible={utilsVisible} {...tabsConfig} {panels} let:panel on:measure={e => $tabRect = e.detail}>\nfunction create_default_slot$1(ctx){var panel;var updating_component;var current;function func(){var _ctx7;for(var _len6=arguments.length,args=new Array(_len6),_key9=0;_key9<_len6;_key9++){args[_key9]=arguments[_key9];}return(/*func*/(_ctx7=ctx)[139].apply(_ctx7,[/*panel*/ctx[258]].concat(args)));}function panel_component_binding(value){/*panel_component_binding*/ctx[140].call(null,value,/*panel*/ctx[258]);}function show_handler(){var _ctx8;for(var _len7=arguments.length,args=new Array(_len7),_key10=0;_key10<_len7;_key10++){args[_key10]=arguments[_key10];}return(/*show_handler*/(_ctx8=ctx)[142].apply(_ctx8,[/*panel*/ctx[258]].concat(args)));}function hide_handler(){var _ctx9;for(var _len8=arguments.length,args=new Array(_len8),_key11=0;_key11<_len8;_key11++){args[_key11]=arguments[_key11];}return(/*hide_handler*/(_ctx9=ctx)[143].apply(_ctx9,[/*panel*/ctx[258]].concat(args)));}function fade_handler(){var _ctx10;for(var _len9=arguments.length,args=new Array(_len9),_key12=0;_key12<_len9;_key12++){args[_key12]=arguments[_key12];}return(/*fade_handler*/(_ctx10=ctx)[144].apply(_ctx10,[/*panel*/ctx[258]].concat(args)));}var panel_props={content:_objectSpread(_objectSpread({},/*utilsMerged*/ctx[20].find(func)),{},{props:/*pluginOptions*/ctx[7][/*panel*/ctx[258]]}),locale:/*locale*/ctx[2],isActive:/*panel*/ctx[258]===/*utilSelected*/ctx[21],stores:/*utilStores*/ctx[101]};if(/*pluginInterface*/ctx[0][/*panel*/ctx[258]]!==void 0){panel_props.component=/*pluginInterface*/ctx[0][/*panel*/ctx[258]];}panel=new Panel({props:panel_props});binding_callbacks.push(function(){return bind(panel,\"component\",panel_component_binding);});panel.$on(\"measure\",/*measure_handler_1*/ctx[141]);panel.$on(\"show\",show_handler);panel.$on(\"hide\",hide_handler);panel.$on(\"fade\",fade_handler);return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var panel_changes={};if(dirty[0]&/*utilsMerged, pluginOptions*/1048704|dirty[8]&/*panel*/1024)panel_changes.content=_objectSpread(_objectSpread({},/*utilsMerged*/ctx[20].find(func)),{},{props:/*pluginOptions*/ctx[7][/*panel*/ctx[258]]});if(dirty[0]&/*locale*/4)panel_changes.locale=/*locale*/ctx[2];if(dirty[0]&/*utilSelected*/2097152|dirty[8]&/*panel*/1024)panel_changes.isActive=/*panel*/ctx[258]===/*utilSelected*/ctx[21];if(!updating_component&&dirty[0]&/*pluginInterface*/1|dirty[8]&/*panel*/1024){updating_component=true;panel_changes.component=/*pluginInterface*/ctx[0][/*panel*/ctx[258]];add_flush_callback(function(){return updating_component=false;});}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}function create_fragment$b(ctx){var div;var measurable_action;var focusvisible_action;var dropable_action;var current;var mounted;var dispose;add_render_callback(/*onwindowresize*/ctx[136]);var if_block=/*canRender*/ctx[52]&&create_if_block$2(ctx);return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"id\",/*id*/ctx[3]);attr(div,\"class\",/*className*/ctx[26]);attr(div,\"data-env\",/*envStr*/ctx[29]);},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);/*div_binding_1*/ctx[154](div);current=true;if(!mounted){dispose=[listen(window,\"keydown\",/*handleKeydown*/ctx[110]),listen(window,\"keyup\",/*handleKeyup*/ctx[111]),listen(window,\"blur\",/*handleWindowBlur*/ctx[112]),listen(window,\"resize\",/*onwindowresize*/ctx[136]),listen(div,\"ping\",function(){if(is_function(/*routePing*/ctx[53]))/*routePing*/ctx[53].apply(this,arguments);}),listen(div,\"contextmenu\",/*handleContextMenu*/ctx[113]),listen(div,\"touchstart\",function(){if(is_function(/*handleTouchStart*/ctx[50]))/*handleTouchStart*/ctx[50].apply(this,arguments);}),listen(div,\"transitionend\",/*handleTransitionEnd*/ctx[102]),listen(div,\"dropfiles\",/*handleDropFiles*/ctx[114]),listen(div,\"measure\",/*measure_handler_4*/ctx[155]),action_destroyer(measurable_action=measurable.call(null,div,{observeViewRect:true})),action_destroyer(focusvisible_action=focusvisible.call(null,div)),action_destroyer(dropable_action=dropable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*canRender*/ctx[52]){if(if_block){if_block.p(ctx,dirty);if(dirty[1]&/*canRender*/2097152){transition_in(if_block,1);}}else{if_block=create_if_block$2(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty[0]&/*id*/8){attr(div,\"id\",/*id*/ctx[3]);}if(!current||dirty[0]&/*className*/67108864){attr(div,\"class\",/*className*/ctx[26]);}if(!current||dirty[0]&/*envStr*/536870912){attr(div,\"data-env\",/*envStr*/ctx[29]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();/*div_binding_1*/ctx[154](null);mounted=false;run_all(dispose);}};}var imageCropRectElasticity=5;// updating crop selection / the intended selection rect, combined with actual selection rect, used to render elasticity visualisation\nvar imageSelectionRectElasticity=1;var scrollElasticity=10;var rangeInputElasticity=5;function instance$b($$self,$$props,$$invalidate){var $images;var $clientRect;var $rootRect;var $imageState;var $imageLoadState;var $imageCropRectSnapshot;var $imageCropRectIntent;var $previewShouldUpscale;var $imageCropRect;var $isInteracting;var $imageSelectionRect;var $imageSelectionRectIntent;var $stageRect;var $stageScalar;var $imageSize;var $presentationScalar;var $imageSelectionRectSnapshot;var $prefersReducedMotion;var $tabRect;var $history,$$unsubscribe_history=noop$1,$$subscribe_history=function $$subscribe_history(){return $$unsubscribe_history(),$$unsubscribe_history=subscribe(history,function($$value){return $$invalidate(181,$history=$$value);}),history;};var $imageProcessingPreparing;var $rootBackgroundColor;var $env;var $pointerAccuracy;var $pointerHoverable;var $imageTransforms;var $imagePreviewModifiers;var $imageEffects;var $imageBackgroundColor;var $imageSelectionRectPresentation;var $imageVisualLoadComplete;var $imageFile;var $imagePreview;var $imageProcessState;var $statusOpacity;var $statusOffsetX;var $progressOffsetX;var $pressedKeysStore;var $isInteractingFraction;var $toolRect;var $utilRect;var $pixelRatio;var $imagePreviews;var $imageDecoration;var $imageAnnotation;var $imageOverlay;component_subscribe($$self,prefersReducedMotion,function($$value){return $$invalidate(179,$prefersReducedMotion=$$value);});$$self.$$.on_destroy.push(function(){return $$unsubscribe_history();});var eventProxy=pubsub();var dispatch=createEventDispatcher();//\n// View Props\n//\nvar _$$props$class7=$$props[\"class\"],klass=_$$props$class7===void 0?undefined:_$$props$class7;var _$$props$layout2=$$props.layout,layoutMode=_$$props$layout2===void 0?undefined:_$$props$layout2;var stores=$$props.stores;var _$$props$locale=$$props.locale,locale=_$$props$locale===void 0?undefined:_$$props$locale;var _$$props$id=$$props.id,id=_$$props$id===void 0?undefined:_$$props$id;var _$$props$util=$$props.util,util=_$$props$util===void 0?undefined:_$$props$util;var _$$props$utils=$$props.utils,utils=_$$props$utils===void 0?undefined:_$$props$utils;// which utils are active (list of ids), or is derived from plugins automatically\nvar _$$props$animations=$$props.animations,animations=_$$props$animations===void 0?\"auto\":_$$props$animations;var _$$props$previewUpsca=$$props.previewUpscale,previewUpscale=_$$props$previewUpsca===void 0?false:_$$props$previewUpsca;var _$$props$elasticityMu=$$props.elasticityMultiplier,elasticityMultiplier=_$$props$elasticityMu===void 0?10:_$$props$elasticityMu;var _$$props$willRevert=$$props.willRevert,willRevert=_$$props$willRevert===void 0?function(){return Promise.resolve(true);}:_$$props$willRevert;var _$$props$willRenderCa=$$props.willRenderCanvas,willRenderCanvas=_$$props$willRenderCa===void 0?passthrough:_$$props$willRenderCa;var _$$props$willRenderTo=$$props.willRenderToolbar,willRenderToolbar=_$$props$willRenderTo===void 0?passthrough:_$$props$willRenderTo;var _$$props$enableButton=$$props.enableButtonExport,enableButtonExport=_$$props$enableButton===void 0?true:_$$props$enableButton;var _$$props$enableButton2=$$props.enableButtonRevert,enableButtonRevert=_$$props$enableButton2===void 0?true:_$$props$enableButton2;var _$$props$enableNaviga=$$props.enableNavigateHistory,enableNavigateHistory=_$$props$enableNaviga===void 0?true:_$$props$enableNaviga;var _$$props$enableToolba=$$props.enableToolbar,enableToolbar=_$$props$enableToolba===void 0?true:_$$props$enableToolba;var _$$props$enableUtils=$$props.enableUtils,enableUtils=_$$props$enableUtils===void 0?true:_$$props$enableUtils;var _$$props$enableButton3=$$props.enableButtonClose,enableButtonClose=_$$props$enableButton3===void 0?false:_$$props$enableButton3;var _$$props$previewImage=$$props.previewImageDataMaxSize,previewImageDataMaxSize=_$$props$previewImage===void 0?undefined:_$$props$previewImage;var _$$props$enableDropIm=$$props.enableDropImage,enableDropImage=_$$props$enableDropIm===void 0?false:_$$props$enableDropIm;var _$$props$imageOriente=$$props.imageOrienter,imageOrienter=_$$props$imageOriente===void 0?{read:function read(){return 1;},apply:function apply(v){return v;}}:_$$props$imageOriente;var _$$props$pluginCompon=$$props.pluginComponents,pluginComponents=_$$props$pluginCompon===void 0?undefined:_$$props$pluginCompon;var _$$props$pluginOption=$$props.pluginOptions,pluginOptions=_$$props$pluginOption===void 0?{}:_$$props$pluginOption;var sub=eventProxy.sub;var pluginInterface={};var root=$$props.root;var registeredPluginsComponents=[];// \n// this method is used to read image resources (preview image / shape images)\nvar glMaxTextureSize=getWebGLTextureSizeLimit()||1024;var maxTextureSize=sizeCreate(glMaxTextureSize,glMaxTextureSize);var canvasMemoryLimit=isIOS()?4096*4096:Infinity;var _$$props$imageSourceT=$$props.imageSourceToImageData,imageSourceToImageData=_$$props$imageSourceT===void 0?function(src){return isString(src)?fetch(src).then(function(res){return res.blob();}).then(function(blob){return blobToImageBitmap(blob,imageOrienter,canvasMemoryLimit);}).then(function(imageData){return imageDataContain(imageData,maxImageDataSize);}):blobToImageBitmap(src,imageOrienter,canvasMemoryLimit).then(function(imageData){return imageDataContain(imageData,maxImageDataSize);});}:_$$props$imageSourceT;var imageProxy=createImageProxy();var _imageProxy$stores=imageProxy.stores,imageFile=_imageProxy$stores.file,imageSize=_imageProxy$stores.size,imageLoadState=_imageProxy$stores.loadState,imageProcessState=_imageProxy$stores.processState,imageCropAspectRatio=_imageProxy$stores.cropAspectRatio,imageCropLimitToImage=_imageProxy$stores.cropLimitToImage,imageCropRect=_imageProxy$stores.crop,imageCropMinSize=_imageProxy$stores.cropMinSize,imageCropMaxSize=_imageProxy$stores.cropMaxSize,imageCropRange=_imageProxy$stores.cropRange,imageCropRectOrigin=_imageProxy$stores.cropOrigin,imageCropRectAspectRatio=_imageProxy$stores.cropRectAspectRatio,imageRotation=_imageProxy$stores.rotation,imageRotationRange=_imageProxy$stores.rotationRange,imageOutputSize=_imageProxy$stores.targetSize,imageFlipX=_imageProxy$stores.flipX,imageFlipY=_imageProxy$stores.flipY,imageBackgroundColor=_imageProxy$stores.backgroundColor,imageColorMatrix=_imageProxy$stores.colorMatrix,imageConvolutionMatrix=_imageProxy$stores.convolutionMatrix,imageGamma=_imageProxy$stores.gamma,imageVignette=_imageProxy$stores.vignette,imageNoise=_imageProxy$stores.noise,imageDecoration=_imageProxy$stores.decoration,imageAnnotation=_imageProxy$stores.annotation,imageState=_imageProxy$stores.state;component_subscribe($$self,imageFile,function(value){return $$invalidate(210,$imageFile=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(17,$imageSize=value);});component_subscribe($$self,imageLoadState,function(value){return $$invalidate(165,$imageLoadState=value);});component_subscribe($$self,imageProcessState,function(value){return $$invalidate(211,$imageProcessState=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(169,$imageCropRect=value);});component_subscribe($$self,imageBackgroundColor,function(value){return $$invalidate(207,$imageBackgroundColor=value);});component_subscribe($$self,imageDecoration,function(value){return $$invalidate(58,$imageDecoration=value);});component_subscribe($$self,imageAnnotation,function(value){return $$invalidate(59,$imageAnnotation=value);});component_subscribe($$self,imageState,function(value){return $$invalidate(164,$imageState=value);});var _stores=stores,images=_stores.images,imageReader=_stores.imageReader;component_subscribe($$self,images,function(value){return $$invalidate(162,$images=value);});//\n// handles the view rect size, makes sure it is offset from the top\n//\n// root element reference used to read styles\nvar rootBackgroundColor=writable([0,0,0]);component_subscribe($$self,rootBackgroundColor,function(value){return $$invalidate(28,$rootBackgroundColor=value);});// client rect is the doka editor rect excluding scroll offset\nvar clientRect=writable();component_subscribe($$self,clientRect,function(value){return $$invalidate(15,$clientRect=value);});// root rect is the doka editor rect including scroll offset\nvar rootRect=writable();component_subscribe($$self,rootRect,function(value){return $$invalidate(163,$rootRect=value);});// when in overlay mode force aspect ratio to aspect ratio of editor root\nvar syncRootAspectRatio=function syncRootAspectRatio(){// set aspect ratio\nimageCropAspectRatio.set(rectAspectRatio($rootRect));// need to set history 0 point to this state\nhistory.set($imageState);};var tabRect=writable(rectCreateEmpty());component_subscribe($$self,tabRect,function(value){return $$invalidate(19,$tabRect=value);});var toolRect=writable(rectCreateEmpty());component_subscribe($$self,toolRect,function(value){return $$invalidate(54,$toolRect=value);});var utilRect=writable();// is undefined because we wait till util is set before defining stage rect\ncomponent_subscribe($$self,utilRect,function(value){return $$invalidate(55,$utilRect=value);});var stageRect=derived([utilRect,tabRect,toolRect],function(_ref131,set){var _ref132=_slicedToArray(_ref131,3),$utilRect=_ref132[0],$tabRect=_ref132[1],$toolRect=_ref132[2];if(!$utilRect)return set(undefined);var utiloffsetX=$tabRect.x;var utilOffsetY=$tabRect.y+(shouldRenderTabs&&showUtils||isOverlayModeEnabled?0:$toolRect.y+$toolRect.height);set(rectCreate(utiloffsetX+$utilRect.x,utilOffsetY+$utilRect.y,$utilRect.width,$utilRect.height));});component_subscribe($$self,stageRect,function(value){return $$invalidate(173,$stageRect=value);});//\n// environment\n//\nvar pointerAccuracy=mediaQueryStore(\"(pointer: fine)\",function(matches){return matches?\"pointer-fine\":\"pointer-coarse\";});component_subscribe($$self,pointerAccuracy,function(value){return $$invalidate(202,$pointerAccuracy=value);});var pointerHoverable=mediaQueryStore(\"(hover: hover)\",function(matches){return matches?\"pointer-hover\":\"pointer-no-hover\";});component_subscribe($$self,pointerHoverable,function(value){return $$invalidate(203,$pointerHoverable=value);});//\n// app API\n//\nvar isInteracting=writable(false);component_subscribe($$self,isInteracting,function(value){return $$invalidate(170,$isInteracting=value);});var isInteractingFraction=readable(undefined,function(set){var animator=spring(0);var updater=function updater(value){animator.set(value?1:0);};var subs=[isInteracting.subscribe(updater),animator.subscribe(set)];// destroy subs\nreturn function(){return subs.forEach(function(unsub){return unsub();});};});component_subscribe($$self,isInteractingFraction,function(value){return $$invalidate(214,$isInteractingFraction=value);});var previewShouldUpscale=writable(previewUpscale);component_subscribe($$self,previewShouldUpscale,function(value){return $$invalidate(168,$previewShouldUpscale=value);});//\n// image related\n//\nvar stageScalar=derived([stageRect,imageCropRect],function(_ref133,set){var _ref134=_slicedToArray(_ref133,2),$stageRect=_ref134[0],$imageCropRect=_ref134[1];var isManipulatingImageCropRect=!!($imageCropRectSnapshot||$imageCropRectIntent);// update stage scalar, the crop output size relative to the stage, if image fits it's 1\nif(!$stageRect||!$imageCropRect||isManipulatingImageCropRect)return;// calculate scale factor needed to fit crop rect to stage\nvar scalar=Math.min($stageRect.width/$imageCropRect.width,$stageRect.height/$imageCropRect.height);// always scaled down to fit stage, if is allowed to upscale, zoom to fit stage\nvar scale=$previewShouldUpscale?scalar:Math.min(1,scalar);set(scale);});component_subscribe($$self,stageScalar,function(value){return $$invalidate(174,$stageScalar=value);});var imageCropRectSnapshot=writable();component_subscribe($$self,imageCropRectSnapshot,function(value){return $$invalidate(166,$imageCropRectSnapshot=value);});var imageCropRectIntent=writable();// should always be set before setting `imageCropRect`\ncomponent_subscribe($$self,imageCropRectIntent,function(value){return $$invalidate(167,$imageCropRectIntent=value);});var imageCropRectPresentation=readable(undefined,function(set){var animator=spring(undefined,{precision:0.0001});var update=function update(){if(!$imageCropRect)return;var instantUpdate=$imageCropRectIntent===undefined||$isInteracting;var elasticRect=elastifyRects($imageCropRect,$imageCropRectIntent,imageCropRectElasticity*elasticityMultiplier);animator.set(elasticRect,{hard:instantUpdate});};var subs=[// need to update presentation rect when crop rect is updated\nimageCropRect.subscribe(update),// update parent store\nanimator.subscribe(set)];return function(){return subs.forEach(function(unsub){return unsub();});};});var imageSelectionRect=writable();component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(171,$imageSelectionRect=value);});var imageSelectionRectSnapshot=writable();component_subscribe($$self,imageSelectionRectSnapshot,function(value){return $$invalidate(176,$imageSelectionRectSnapshot=value);});var imageSelectionRectIntent=writable(undefined);// should always be set before setting `imageSelectionRect`\ncomponent_subscribe($$self,imageSelectionRectIntent,function(value){return $$invalidate(172,$imageSelectionRectIntent=value);});//\n// Image selection\n//\nvar imageSelectionRectPresentation=readable(undefined,function(set){var animator=spring(undefined,{precision:0.0001});var updater=function updater(){if(!$imageSelectionRect)return;var instantUpdate=$isInteracting;var elasticRect=elastifyRects($imageSelectionRect,$imageSelectionRectIntent,imageSelectionRectElasticity*elasticityMultiplier);// prevent negative size (can happen because of elastics)\nif(elasticRect.width<0){elasticRect.width=0;elasticRect.x=$imageSelectionRect.x;}if(elasticRect.height<0){elasticRect.height=0;elasticRect.y=$imageSelectionRect.y;}// translate elastic rect x,y by stage rect x,y\nrectTranslate(elasticRect,$stageRect);animator.set(elasticRect,{hard:instantUpdate});};var subs=[// need to update selection rect when stage is resized\nstageRect.subscribe(updater),// listen for selection rect changes (as is assigned rect will always trigger, even if assigned same rect, this is needed to also update when intent changes)\nimageSelectionRect.subscribe(updater),// update parent store\nanimator.subscribe(set)];// destroy subs\nreturn function(){return subs.forEach(function(unsub){return unsub();});};});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(31,$imageSelectionRectPresentation=value);});// when scaling the stage we need to recenter the image selection\nstageRect.subscribe(function(){if(!$stageRect||!$imageCropRect)return;var imageCropRectFitsStage=$imageCropRect.width<=$stageRect.width&&$imageCropRect.height<=$stageRect.height;var centeredImageSelectionRect=// if we have a crop rect and it fits the stage, center it\nimageCropRectFitsStage?// center the crop rectangle to the stage\nrectCenterRect($stageRect,rectMultiply(rectClone($imageCropRect),$stageScalar||1)):// render a rectangle based on the fixed crop aspect ratio, or the aspect ratio of the current crop rectangle, or as a last resort the input image\nrectContainRect($stageRect,rectAspectRatio($imageCropRect||$imageSize));imageSelectionRect.set(centeredImageSelectionRect);});// if we've taken a snapshot of the selection, also take a snapshot of the crop rect and the presentationScalar\n// - cropRect so we can adjust it based on the adjustments to the imageSelectionRect\n// - presentationScalar so we can use the snapshot for the calculation of the cropRect scale relative to the original imageSelectionRect (if we use the live $presentationScalar small rounding errors of the scalar result in weird glitches)\nvar presentationScalarSnapshot;imageSelectionRectSnapshot.subscribe(function(rect){if(!rect){presentationScalarSnapshot=undefined;set_store_value(imageCropRectSnapshot,$imageCropRectSnapshot=undefined,$imageCropRectSnapshot);return;}presentationScalarSnapshot=$presentationScalar;var cropRectClone=rectClone($imageCropRect);imageCropRectSnapshot.set(cropRectClone);});// if image selection rect is being manipulated, and imageSelectionRectSnapshot has been defined, we also need to update the crop rect\nimageSelectionRect.subscribe(function(rect){// only sync crop rect with image selection rect when no longer manipulating\nif(!rect||!$imageSelectionRectSnapshot)return;var offset=rectSubtract(rectClone(rect),$imageSelectionRectSnapshot);rectDivide(offset,presentationScalarSnapshot);var crop=rectAdd(rectClone($imageCropRectSnapshot),offset);imageCropRect.set(crop);});imageCropRect.subscribe(function(rect){// don't update image selection rect while we're intertacting with the view, this prevents feedback loop from cropRect model updates\nif($isInteracting||$imageSelectionRectSnapshot||$imageCropRectIntent)return;// if no rect, we can't do anything\n// if no selection rect yet, we wait for a selection rect to be loaded\nif(!rect||!$imageSelectionRect)return;// only if crop aspect ratio differs from image selection aspect ratio we update image selection rectangle\nvar imageSelectionRectAspectRatio=rectAspectRatio($imageSelectionRect);var cropRectAspectRatio=rectAspectRatio(rect);if(fixPrecision(imageSelectionRectAspectRatio,6)===fixPrecision(cropRectAspectRatio,6))return;// TEMP DUPLICATE OF STAGESCALAR DERIVED STORE TO FIX ZOOM OUT AFTER WHEEL ISSUE\n// reproduce -> crop view => resize selection rect vertically, tap recenter, zoom out with scroll wheel\nvar scalar=Math.min($stageRect.width/$imageCropRect.width,$stageRect.height/$imageCropRect.height);// const scale = $previewShouldUpscale ? scalar : Math.min(1, scalar);\nvar size=sizeCreate(rect.width*scalar,rect.height*scalar);var tx=($imageSelectionRect.width-size.width)*0.5;var ty=($imageSelectionRect.height-size.height)*0.5;var selectionRect=rectCreate($imageSelectionRect.x+tx,$imageSelectionRect.y+ty,size.width,size.height);imageSelectionRect.set(selectionRect);});var imageScalar=derived([stageScalar,imageCropRect,imageSelectionRect],function(_ref135,set){var _ref136=_slicedToArray(_ref135,3),$stageScalar=_ref136[0],$imageCropRect=_ref136[1],$imageSelectionRect=_ref136[2];// update the image scalar, the image zoom calculated by the image selection and the actual crop coordinates\nif(!$stageScalar||!$imageCropRect||!$imageSelectionRect)return;var selectionScaledWidth=$imageSelectionRect.width/$imageCropRect.width;var selectionScaledHeight=$imageSelectionRect.height/$imageCropRect.height;// need to correct for scale of stage\nvar scalar=Math.max(selectionScaledWidth,selectionScaledHeight)/$stageScalar;set(scalar);});var presentationScalar=derived([stageScalar,imageScalar],function(_ref137,set){var _ref138=_slicedToArray(_ref137,2),$stageScalar=_ref138[0],$imageScalar=_ref138[1];// can't scale presentation if no image scalar defined\nif(!$imageScalar)return;var scalar=$stageScalar*$imageScalar;set(scalar);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(175,$presentationScalar=value);});//\n// UI Elements\n//\n// guides and edges rendered on top of image\nvar imageSelectionGuides=derived([rootBackgroundColor,isInteracting,imageSelectionRectPresentation,isInteractingFraction],function(_ref139,set){var _ref140=_slicedToArray(_ref139,4),$rootBackgroundColor=_ref140[0],$isInteracting=_ref140[1],$rect=_ref140[2],$opacity=_ref140[3];if(!$rect)return set([]);var x=$rect.x,y=$rect.y,width=$rect.width,height=$rect.height;var showGrid=$opacity>0;var rows=showGrid?3:1;var cols=showGrid?3:1;var w=width/cols;var h=height/rows;var guides=[];var strokeColor=isDarkColor($rootBackgroundColor)?[1,1,1]:[0,0,0];// rows\nfor(var _r5=0;_r5<=rows;_r5++){var _isEdge=_r5===0||_r5===rows;if(isOverlayModeEnabled&&_isEdge)continue;var o=_isEdge?1:$opacity*0.25;var yo=y+h*_r5;guides.push({id:\"image-selection-guide-row-\".concat(_r5),points:[vectorCreate(x,yo),vectorCreate(x+width,yo)],opacity:o,strokeWidth:1,strokeColor:strokeColor});}// cols\nfor(var c=0;c<=cols;c++){var _isEdge2=c===0||c===cols;if(isOverlayModeEnabled&&_isEdge2)continue;var _o=_isEdge2?1:$opacity*0.25;var xo=x+w*c;guides.push({id:\"image-selection-guide-col-\".concat(c),points:[vectorCreate(xo,y),vectorCreate(xo,y+height)],opacity:_o,strokeWidth:1,strokeColor:strokeColor});}set(guides);});// custom markup rendered on top of image\nvar imageOverlayMarkup=writable([]);// the resulting overlay markup\nvar imageOverlay=derived([imageSelectionGuides,imageOverlayMarkup],function(_ref141,set){var _ref142=_slicedToArray(_ref141,2),$imageSelectionGuides=_ref142[0],$imageOverlayMarkup=_ref142[1];set($imageSelectionGuides.concat($imageOverlayMarkup));});component_subscribe($$self,imageOverlay,function(value){return $$invalidate(60,$imageOverlay=value);});//\n// Loading the preview\n//\nvar imageVisualLoadComplete=writable(false);component_subscribe($$self,imageVisualLoadComplete,function(value){return $$invalidate(209,$imageVisualLoadComplete=value);});var imagePreviewLoaderCancelToken;var createImagePreviewLoader=function createImagePreviewLoader(file,token){return new Promise(function(resolve,reject){var cancelled=false;var timer;token.cancel=function(){return cancelled=true;};var now=Date.now();imageSourceToImageData(file).then(function(imageData){var dist=Date.now()-now;clearTimeout(timer);timer=setTimeout(function(){if(cancelled)return;resolve(imageData);},Math.max(0,1000-dist));})[\"catch\"](reject);});};var imagePreview=derived([imageVisualLoadComplete,imageFile],function(_ref143,set){var _ref144=_slicedToArray(_ref143,2),$imageVisualLoadComplete=_ref144[0],$imageFile=_ref144[1];// cancel existing loader\nif(imagePreviewLoaderCancelToken)imagePreviewLoaderCancelToken.cancel();// no data, reset preview data\nif(!$imageVisualLoadComplete||!$imageFile)return set(undefined);imagePreviewLoaderCancelToken={cancel:noop};createImagePreviewLoader($imageFile,imagePreviewLoaderCancelToken).then(set)[\"catch\"](function(err){return set_store_value(imageLoadState,$imageLoadState.error=err,$imageLoadState);});});component_subscribe($$self,imagePreview,function(value){return $$invalidate(38,$imagePreview=value);});//\n// Calculates the image transforms and effects necessary for the preview\n//\nvar imagePreviewModifiers=writable({});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(205,$imagePreviewModifiers=value);});var imagePreviews=writable([]);component_subscribe($$self,imagePreviews,function(value){return $$invalidate(57,$imagePreviews=value);});var imageTransforms=derived([stageRect,rootRect,imageSize,imageCropRectPresentation,imageSelectionRect,presentationScalar,imageRotation,imageFlipX,imageFlipY],function(_ref145,set){var _ref146=_slicedToArray(_ref145,9),$stageRect=_ref146[0],$rootRect=_ref146[1],$imageSize=_ref146[2],$imageCropRectPresentation=_ref146[3],$imageSelectionRect=_ref146[4],$presentationScalar=_ref146[5],$imageRotation=_ref146[6],$imageFlipX=_ref146[7],$imageFlipY=_ref146[8];set(calculateImageTransforms($stageRect,$rootRect,$imageSize,$imageCropRectPresentation,$imageSelectionRect,$presentationScalar,0,0,$imageRotation,$imageFlipX,$imageFlipY));});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(204,$imageTransforms=value);});var imageEffects=derived([imageColorMatrix,imageConvolutionMatrix,imageGamma,imageVignette,imageNoise],function(_ref147,set){var _ref148=_slicedToArray(_ref147,5),$colorMatrix=_ref148[0],$convolutionMatrix=_ref148[1],$gamma=_ref148[2],$vignette=_ref148[3],$noise=_ref148[4];var colorMatrices=$colorMatrix&&Object.keys($colorMatrix).map(function(name){return $colorMatrix[name];}).filter(Boolean);var effects={gamma:$gamma||undefined,vignette:$vignette||undefined,noise:$noise||undefined,convolutionMatrix:$convolutionMatrix||undefined,colorMatrix:colorMatrices&&colorMatrices.length&&getColorMatrixFromColorMatrices(colorMatrices)};set(effects);});component_subscribe($$self,imageEffects,function(value){return $$invalidate(206,$imageEffects=value);});//\n// current environment variables\n//\nvar windowWidth;var windowHeight;var shouldPreventSwipe=canPreventNavSwipe();var env=writable({});component_subscribe($$self,env,function(value){return $$invalidate(201,$env=value);});var initialPixelRatio=getDevicePixelRatio();var pixelRatio=readable(initialPixelRatio,function(set){var handleResolutionChange=function handleResolutionChange(){return set(getDevicePixelRatio());};var resolutionObserver=matchMedia(\"(resolution: \".concat(initialPixelRatio,\"dppx)\"));resolutionObserver.addListener(handleResolutionChange);return function(){return resolutionObserver.removeListener(handleResolutionChange);};});component_subscribe($$self,pixelRatio,function(value){return $$invalidate(56,$pixelRatio=value);});var history=historyCreate(function(){return $imageState;},function(state){// set new state from history, $imageState will store a clone of the received state\nset_store_value(imageState,$imageState=state,$imageState);// image state will return a clone of the current state\n// trigger recenter of image selection rect\ntabRect.set($tabRect);});$$subscribe_history();imageLoadState.subscribe(function(){var _ref149=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},complete=_ref149.complete;if(!complete)return;history.set($imageState);});var revert=function revert(){return willRevert().then(function(shouldReset){return shouldReset&&history.revert();});};//\n// Visual processing of the image\n//\nvar imageProcessingPreparing=writable(false);component_subscribe($$self,imageProcessingPreparing,function(value){return $$invalidate(183,$imageProcessingPreparing=value);});var handleExport=function handleExport(){// this will trigger status overlay fade in\nset_store_value(imageProcessingPreparing,$imageProcessingPreparing=true,$imageProcessingPreparing);// wait for status to be done fading in, then requests image writing\nvar unsub=statusOpacity.subscribe(function(value){if(value!==1)return;// stop listening for\nunsub();// request write image\ndispatch(\"processImage\");});};imageProcessState.subscribe(function(state){if(!state)return;set_store_value(imageProcessingPreparing,$imageProcessingPreparing=true,$imageProcessingPreparing);var task=state.task,error=state.error,complete=state.complete;if(complete)set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);});//\n// Configure the available views\n//\nvar utilStores=_objectSpread(_objectSpread({},stores),{},{// image\nimageFile:imageFile,imageSize:imageSize,imageCropAspectRatio:imageCropAspectRatio,imageCropMinSize:imageCropMinSize,imageCropMaxSize:imageCropMaxSize,imageCropLimitToImage:imageCropLimitToImage,imageCropRect:imageCropRect,imageCropRectOrigin:imageCropRectOrigin,imageCropRectSnapshot:imageCropRectSnapshot,imageCropRectAspectRatio:imageCropRectAspectRatio,imageCropRange:imageCropRange,imageRotation:imageRotation,imageRotationRange:imageRotationRange,imageFlipX:imageFlipX,imageFlipY:imageFlipY,imageOutputSize:imageOutputSize,// effects\nimageColorMatrix:imageColorMatrix,imageConvolutionMatrix:imageConvolutionMatrix,imageGamma:imageGamma,imageVignette:imageVignette,imageNoise:imageNoise,// markup\nimageDecoration:imageDecoration,imageAnnotation:imageAnnotation,// image preview for utils that need access to pixel data\nimagePreview:imagePreview,// top left position of image preview\nimageTransforms:imageTransforms,// allows utils to control how the preview is presented (for example more opacity for mask)\nimagePreviewModifiers:imagePreviewModifiers,// history state and update\nhistory:history,// static env info\npixelRatio:pixelRatio,elasticityMultiplier:elasticityMultiplier,scrollElasticity:scrollElasticity,rangeInputElasticity:rangeInputElasticity,// dynamic env info\npointerAccuracy:pointerAccuracy,pointerHoverable:pointerHoverable,env:env,rootRect:rootRect,stageRect:stageRect,stageScalar:stageScalar,utilRect:utilRect,presentationScalar:presentationScalar,rootBackgroundColor:rootBackgroundColor,// (write) add guides to ui (for example is used by markup util to add lines for shape manipulator)\nimageOverlayMarkup:imageOverlayMarkup,// (write) previews to render\nimagePreviews:imagePreviews,// (write) set to true to disable animations\nisInteracting:isInteracting,// (write) the current intended crop rect\nimageCropRectIntent:imageCropRectIntent,// (read) the current presented crop rect\nimageCropRectPresentation:imageCropRectPresentation,// (write) the current limited size of the image selection rect\nimageSelectionRect:imageSelectionRect,// (write) the inteded rectangle by the user\nimageSelectionRectIntent:imageSelectionRectIntent,// (read) the current presentation of the image selection rect, includes elasticity etc.\nimageSelectionRectPresentation:imageSelectionRectPresentation,// (read) a snapshot of the image selection rectangle, use to store the rectangle before modification so alterations to the rectangle can be applied to the snapshot\nimageSelectionRectSnapshot:imageSelectionRectSnapshot,// scalar of image in view\nimageScalar:imageScalar});// don't expose image store\ndelete utilStores.image;var utilsUniqueId=\"util-\".concat(getUniqueId());var utilsVisible=[];// env\nvar iOS=isIOS();// canvas background color\nvar syncBackgroundColor=function syncBackgroundColor(){var colorString=rootElementComputedStyle.getPropertyValue(\"background-color\");var colorArray=colorStringToColorArray(colorString);// hide transparent color\nif(colorArray[3]===0)return;// limit to opaque colors\ncolorArray.length=3;// update background\nset_store_value(rootBackgroundColor,$rootBackgroundColor=colorArray,$rootBackgroundColor);};var handleTransitionEnd=function handleTransitionEnd(_ref150){var target=_ref150.target,propertyName=_ref150.propertyName;if(target!==root||propertyName!==\"background-color\")return;syncBackgroundColor();};// test if some shapes have left/top/bottom/right offsets, if so, convert to crop space\n// updates original shape (which at this point is a flattened shape (clone))\nvar positionDecorationShape=function positionDecorationShape(shape,canvasState){return shapeComputeDisplay(shape,{x:$imageSelectionRectPresentation.x/canvasState.scale,y:$imageSelectionRectPresentation.y/canvasState.scale,width:$imageSelectionRectPresentation.width/canvasState.scale,height:$imageSelectionRectPresentation.height/canvasState.scale});};// decoration is drawn relative to view space, so we need to translate relative to crop presentation rect\nvar transformDecorationShape=function transformDecorationShape(shape,canvasState){shapeComputeTransform(shape,$imageSelectionRectPresentation,canvasState.scale,canvasState.size);return shape;};var flattenShapes=function flattenShapes(shapes){var flattenedShapes=[];shapes.forEach(function(shape){return flattenedShapes.push.apply(flattenedShapes,_toConsumableArray(flattenShape(shape)));});return flattenedShapes.filter(Boolean);};var flattenShape=function flattenShape(shape){// at this point shape is a copy of the original shape\n// the shapes to draw, can be multiple shapes\nvar drawableShapes=[shape];if(shapeIsLine(shape)){var start=vectorCreate(shape.x1,shape.y1);var end=vectorCreate(shape.x2,shape.y2);if(shape.lineStart){var style=shapeComputeLineEnd(start,shape.strokeWidth,shape.strokeColor,shape.lineStart,vectorCreate(end.x-start.x,end.y-start.y));start=style.position||start;drawableShapes.push(style.shape);}if(shape.lineEnd){var _style=shapeComputeLineEnd(end,shape.strokeWidth,shape.strokeColor,shape.lineEnd,vectorCreate(start.x-end.x,start.y-end.y));end=_style.position||start;drawableShapes.push(_style.shape);}// transform into line\nshape.points=[start,end];}else if(shapeIsTriangle(shape)){shape.points=[vectorCreate(shape.x1,shape.y1),vectorCreate(shape.x2,shape.y2),vectorCreate(shape.x3,shape.y3)];}else// is empty text\nif(shapeIsTextEmpty(shape)){// make sure shape is still visible\nif(shapeIsTextLine(shape)){shape.width=5;shape.height=isFunction(shape.lineHeight)?shape.lineHeight(shape.fontSize):shape.lineHeight;}// set to empty text style\nshape.strokeWidth=1;shape.strokeColor=[1,1,1,0.5];shape.backgroundColor=[0,0,0,0.1];}return drawableShapes;};var statusOpacity=tweened(undefined,{duration:500});component_subscribe($$self,statusOpacity,function(value){return $$invalidate(46,$statusOpacity=value);});var loadTimer;var statusOffsetX=spring(undefined,{stiffness:0.02,damping:0.5,precision:0.25});component_subscribe($$self,statusOffsetX,function(value){return $$invalidate(48,$statusOffsetX=value);});var progressOffsetX=spring(undefined,{stiffness:0.03,damping:0.4,precision:0.25});component_subscribe($$self,progressOffsetX,function(value){return $$invalidate(49,$progressOffsetX=value);});var hideStatus=function hideStatus(){statusOffsetX.set(undefined,{hard:true});progressOffsetX.set(undefined,{hard:true});};var offsetProgress=function offsetProgress(e){set_store_value(statusOffsetX,$statusOffsetX=Math.round(-e.detail.width*0.5)-16,$statusOffsetX);// -16 offsets text so it's better centered to the viewport\nset_store_value(progressOffsetX,$progressOffsetX=e.detail.width,$progressOffsetX);};var handleCloseImageLoadError=function handleCloseImageLoadError(){dispatch(\"abortLoadImage\");};var handleCloseImageProcessError=function handleCloseImageProcessError(){dispatch(\"abortProcessImage\");set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);};// context for children to know if a key is down\nvar pressedKeysStore=writable([]);component_subscribe($$self,pressedKeysStore,function(value){return $$invalidate(213,$pressedKeysStore=value);});setContext(\"keysPressed\",pressedKeysStore);var handleKeydown=function handleKeydown(e){var keyCode=e.keyCode;var keySet=new Set([].concat(_toConsumableArray($pressedKeysStore),[keyCode]));pressedKeysStore.set(Array.from(keySet));};var handleKeyup=function handleKeyup(_ref151){var keyCode=_ref151.keyCode;pressedKeysStore.set($pressedKeysStore.filter(function(pressedKey){return pressedKey!==keyCode;}));};// so no keys get stuck when user cmd-tabs out of the window, or when dev-tools open by key-press\nvar handleWindowBlur=function handleWindowBlur(){pressedKeysStore.set([]);};// block context menu on everything but text input fields\nvar handleContextMenu=function handleContextMenu(e){if(isTextField(e.target))return;e.preventDefault();};// handle files being dropped on the editor\nvar handleDropFiles=function handleDropFiles(e){// if no files dropped, exit!\nif(!enableDropImage||!e.detail.files.length)return;// request load image\ndispatch(\"loadImage\",e.detail.files[0]);};// canvas drawing\nvar getStageState=function getStageState(){return{// add information on which util is active\nutilVisibility:_objectSpread({},utilsVisibleFraction),// used to fade in elements when interacting\nisInteracting:$isInteracting,isInteractingFraction:$isInteractingFraction,// add the root rectangle so will render can use width/height of root element\nrootRect:rectClone($rootRect),// add the stage rectangle so will render knows where stage starts and ends\nstageRect:rectClone($stageRect),// preview selection rect\nselectionRect:rectClone($imageSelectionRectPresentation)};};var createCanvasState=function createCanvasState(canvasState,annotationShapes,decorationShapes,interfaceShapes){return{annotationShapes:flattenShapes(annotationShapes.filter(shapeIsVisible).map(shapeDeepCopy).map(function(shape){return shapeComputeDisplay(shape,$imageSize);})),decorationShapes:flattenShapes(decorationShapes.filter(shapeIsVisible).map(shapeDeepCopy).map(function(shape){return positionDecorationShape(shape,canvasState);}).map(function(shape){return transformDecorationShape(shape,canvasState);})),interfaceShapes:flattenShapes(interfaceShapes.filter(shapeIsVisible))};};// setup root portal for detail panel dropdown\nvar rootPortal;var rootPortalStore=writable();setContext(\"rootPortal\",rootPortalStore);// setup root rect store for global access\nsetContext(\"rootRect\",rootRect);function onwindowresize(){$$invalidate(10,windowWidth=window.innerWidth);$$invalidate(11,windowHeight=window.innerHeight);}var measure_handler=function measure_handler(e){return set_store_value(toolRect,$toolRect=e.detail,$toolRect);};var select_handler=function select_handler(_ref152){var detail=_ref152.detail;return $$invalidate(21,utilSelected=detail);};var func=function func(panel,util){return util.id===panel;};function panel_component_binding(value,panel){pluginInterface[panel]=value;($$invalidate(0,pluginInterface),$$invalidate(7,pluginOptions)),$$invalidate(134,pluginComponents);}var measure_handler_1=function measure_handler_1(e){return set_store_value(utilRect,$utilRect=e.detail,$utilRect);};var show_handler=function show_handler(panel){return $$invalidate(12,utilsVisible=utilsVisible.concat(panel));};var hide_handler=function hide_handler(panel){return $$invalidate(12,utilsVisible=utilsVisible.filter(function(util){return util!==panel;}));};var fade_handler=function fade_handler(panel,_ref153){var detail=_ref153.detail;return $$invalidate(22,utilsVisibleFraction[panel]=detail,utilsVisibleFraction);};var measure_handler_2=function measure_handler_2(e){return set_store_value(tabRect,$tabRect=e.detail,$tabRect);};var func_1=function func_1(util){return util.id===utilSelected;};function panel_component_binding_1(value){pluginInterface[utilSelected]=value;($$invalidate(0,pluginInterface),$$invalidate(7,pluginOptions)),$$invalidate(134,pluginComponents);}var measure_handler_3=function measure_handler_3(e){return set_store_value(utilRect,$utilRect=e.detail,$utilRect);};var show_handler_1=function show_handler_1(){return $$invalidate(12,utilsVisible=utilsVisible.concat(utilSelected));};var hide_handler_1=function hide_handler_1(){return $$invalidate(12,utilsVisible=utilsVisible.filter(function(util){return util!==utilSelected;}));};var fade_handler_1=function fade_handler_1(_ref154){var detail=_ref154.detail;return $$invalidate(22,utilsVisibleFraction[utilSelected]=detail,utilsVisibleFraction);};var func_2=function func_2(canvasState){// current draw state\nvar drawState=_objectSpread(_objectSpread({},canvasState),getStageState());// allow dev to add custom overlay to `imageOverlay`\nvar _willRenderCanvas=willRenderCanvas({decorationShapes:$imageDecoration,annotationShapes:$imageAnnotation,interfaceShapes:$imageOverlay},drawState),annotationShapes=_willRenderCanvas.annotationShapes,decorationShapes=_willRenderCanvas.decorationShapes,interfaceShapes=_willRenderCanvas.interfaceShapes;// need to map shapes\nreturn createCanvasState(drawState,annotationShapes,decorationShapes,interfaceShapes);};function div_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){rootPortal=$$value;$$invalidate(13,rootPortal);});}function div_binding_1($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(1,root);});}var measure_handler_4=function measure_handler_4(e){return set_store_value(clientRect,$clientRect=e.detail,$clientRect);};$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(117,klass=$$props[\"class\"]);if(\"layout\"in $$props)$$invalidate(118,layoutMode=$$props.layout);if(\"stores\"in $$props)$$invalidate(119,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(2,locale=$$props.locale);if(\"id\"in $$props)$$invalidate(3,id=$$props.id);if(\"util\"in $$props)$$invalidate(120,util=$$props.util);if(\"utils\"in $$props)$$invalidate(121,utils=$$props.utils);if(\"animations\"in $$props)$$invalidate(122,animations=$$props.animations);if(\"previewUpscale\"in $$props)$$invalidate(123,previewUpscale=$$props.previewUpscale);if(\"elasticityMultiplier\"in $$props)$$invalidate(4,elasticityMultiplier=$$props.elasticityMultiplier);if(\"willRevert\"in $$props)$$invalidate(124,willRevert=$$props.willRevert);if(\"willRenderCanvas\"in $$props)$$invalidate(5,willRenderCanvas=$$props.willRenderCanvas);if(\"willRenderToolbar\"in $$props)$$invalidate(125,willRenderToolbar=$$props.willRenderToolbar);if(\"enableButtonExport\"in $$props)$$invalidate(126,enableButtonExport=$$props.enableButtonExport);if(\"enableButtonRevert\"in $$props)$$invalidate(127,enableButtonRevert=$$props.enableButtonRevert);if(\"enableNavigateHistory\"in $$props)$$invalidate(128,enableNavigateHistory=$$props.enableNavigateHistory);if(\"enableToolbar\"in $$props)$$invalidate(6,enableToolbar=$$props.enableToolbar);if(\"enableUtils\"in $$props)$$invalidate(129,enableUtils=$$props.enableUtils);if(\"enableButtonClose\"in $$props)$$invalidate(130,enableButtonClose=$$props.enableButtonClose);if(\"previewImageDataMaxSize\"in $$props)$$invalidate(131,previewImageDataMaxSize=$$props.previewImageDataMaxSize);if(\"enableDropImage\"in $$props)$$invalidate(132,enableDropImage=$$props.enableDropImage);if(\"imageOrienter\"in $$props)$$invalidate(133,imageOrienter=$$props.imageOrienter);if(\"pluginComponents\"in $$props)$$invalidate(134,pluginComponents=$$props.pluginComponents);if(\"pluginOptions\"in $$props)$$invalidate(7,pluginOptions=$$props.pluginOptions);if(\"root\"in $$props)$$invalidate(1,root=$$props.root);if(\"imageSourceToImageData\"in $$props)$$invalidate(8,imageSourceToImageData=$$props.imageSourceToImageData);};var isOverlayModeEnabled;var showUtils;var maxImageDataSize;var canAnimate;var acceptsAnimations;var shouldAnimate;var canUndo;var canRedo;var utilsFiltered;var utilsAvailable;var utilsDefined;var utilsMerged;var utilSelected;var utilTools;var utilsVisibleFraction;var tabsConfig;var tabs;var panels;var shouldRenderTabs;var className;var orientation;var isLandscape;var horizontalSpace;var hasLimitedSpace;var verticalSpace;var isModal;var isCenteredHorizontally;var isCenteredVertically;var isCentered;var isNarrow;var isCompact;var hasSwipeNavigation;var shouldRenderUtilTools;var rootElementComputedStyle;var envStr;var imageProps;var missingFeatures;var isSupportsError;var isImageLoadError;var isWaitingForImage;var imageLoadProgress;var isLoadingImageData;var isCreatingImagePreview;var isProcessingImage;var imageLoadShowProgressIndicator;var imageLoadStatusLabel;var imageProcessStatusLabel;var imageProcessProgress;var imageProcessShowProgressIndicator;var isImageProcessingError;var isStatusVisible;var handleTouchStart;var toolbarItems;var hasClientRect;var canRender;var routePing;$$self.$$.update=function(){if($$self.$$.dirty[3]&/*layoutMode*/33554432){$$invalidate(160,isOverlayModeEnabled=layoutMode===\"overlay\");}if($$self.$$.dirty[4]&/*enableUtils*/32|$$self.$$.dirty[5]&/*isOverlayModeEnabled*/32){$$invalidate(14,showUtils=enableUtils&&!isOverlayModeEnabled);}if($$self.$$.dirty[0]&/*pluginOptions, pluginInterface*/129){// map plugin options to plugin interface\nif(pluginOptions){// for every plugin in plugin options\nObject.keys(pluginOptions).forEach(function(plugin){// for every prop defined for this plugin\nObject.keys(pluginOptions[plugin]).forEach(function(prop){// set value to interface\nif(!pluginInterface[plugin])return;// set prop value\n$$invalidate(0,pluginInterface[plugin][prop]=pluginOptions[plugin][prop],pluginInterface);});});}}if($$self.$$.dirty[0]&/*pluginInterface*/1|$$self.$$.dirty[4]&/*pluginComponents*/1024){{var changed=false;pluginComponents.forEach(function(_ref155){var _ref156=_slicedToArray(_ref155,1),key=_ref156[0];if(pluginInterface[key])return;$$invalidate(0,pluginInterface[key]={},pluginInterface);changed=true;});if(changed){$$invalidate(156,registeredPluginsComponents=_toConsumableArray(pluginComponents));}}}if($$self.$$.dirty[4]&/*previewImageDataMaxSize*/128){maxImageDataSize=previewImageDataMaxSize?sizeMin(previewImageDataMaxSize,maxTextureSize):maxTextureSize;}if($$self.$$.dirty[5]&/*$images*/128){imageProxy.update($images[0]);}if($$self.$$.dirty[0]&/*$clientRect*/32768){$clientRect&&rootRect.set(rectCreate($clientRect.x,$clientRect.y,$clientRect.width,$clientRect.height));}if($$self.$$.dirty[5]&/*$rootRect, isOverlayModeEnabled, $imageLoadState*/1312){$rootRect&&isOverlayModeEnabled&&$imageLoadState&&$imageLoadState.complete&&syncRootAspectRatio();}if($$self.$$.dirty[3]&/*previewUpscale*/1073741824|$$self.$$.dirty[5]&/*isOverlayModeEnabled*/32){previewShouldUpscale.set(previewUpscale||isOverlayModeEnabled);}if($$self.$$.dirty[5]&/*$isInteracting*/32768){//\n// Animations based on prefers-reduced-motion, automatically checks if user prefers reduced animations\n//\n$$invalidate(177,canAnimate=!$isInteracting);}if($$self.$$.dirty[5]&/*$prefersReducedMotion*/16777216){$$invalidate(178,acceptsAnimations=!$prefersReducedMotion);}if($$self.$$.dirty[3]&/*animations*/536870912|$$self.$$.dirty[5]&/*canAnimate, acceptsAnimations*/12582912){$$invalidate(18,shouldAnimate=animations===\"always\"?canAnimate:animations===\"never\"?false:canAnimate&&acceptsAnimations);}if($$self.$$.dirty[5]&/*$history*/67108864){$$invalidate(180,canUndo=$history.index>-1);}if($$self.$$.dirty[5]&/*$history*/67108864){$$invalidate(182,canRedo=$history.index<$history.length-1);}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[3]&/*utils*/268435456|$$self.$$.dirty[5]&/*registeredPluginsComponents*/2){$$invalidate(184,utilsFiltered=locale&&registeredPluginsComponents.length?utils||registeredPluginsComponents.map(function(_ref157){var _ref158=_slicedToArray(_ref157,1),id=_ref158[0];return id;}):[]);}if($$self.$$.dirty[5]&/*registeredPluginsComponents, utilsFiltered*/536870914){$$invalidate(185,utilsAvailable=registeredPluginsComponents.filter(function(_ref159){var _ref160=_slicedToArray(_ref159,1),id=_ref160[0];return utilsFiltered.includes(id);}));}if($$self.$$.dirty[5]&/*utilsAvailable*/1073741824){$$invalidate(186,utilsDefined=utilsAvailable.length);}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[5]&/*utilsFiltered, utilsAvailable*/1610612736){$$invalidate(20,utilsMerged=utilsFiltered.map(function(utilId){var util=utilsAvailable.find(function(_ref161){var _ref162=_slicedToArray(_ref161,1),id=_ref162[0];return utilId===id;});// [id, view]\nif(!util)return;return{id:utilId,view:util[1],tabIcon:locale[\"\".concat(utilId,\"Icon\")],tabLabel:locale[\"\".concat(utilId,\"Label\")]};}).filter(Boolean)||[]);}if($$self.$$.dirty[3]&/*util*/134217728|$$self.$$.dirty[5]&/*utilsFiltered*/536870912|$$self.$$.dirty[6]&/*utilsDefined*/1){$$invalidate(21,utilSelected=util&&typeof util===\"string\"&&utilsFiltered.includes(util)?util:utilsDefined&&utilsFiltered[0]);}if($$self.$$.dirty[0]&/*utilSelected, pluginInterface*/2097153){$$invalidate(187,utilTools=utilSelected&&pluginInterface[utilSelected].tools||[]);}if($$self.$$.dirty[0]&/*utilsMerged, utilsVisibleFraction*/5242880){$$invalidate(22,utilsVisibleFraction=utilsMerged.reduce(function(prev,curr){prev[curr.id]=utilsVisibleFraction&&utilsVisibleFraction[curr.id]||0;return prev;},{}));}if($$self.$$.dirty[0]&/*utilSelected*/2097152){$$invalidate(23,tabsConfig={name:utilsUniqueId,selected:utilSelected});}if($$self.$$.dirty[0]&/*utilsMerged*/1048576){$$invalidate(24,tabs=utilsMerged.map(function(util){return{id:util.id,icon:util.tabIcon,label:util.tabLabel};}));}if($$self.$$.dirty[0]&/*utilsMerged*/1048576){$$invalidate(25,panels=utilsMerged.map(function(util){return util.id;}));}if($$self.$$.dirty[5]&/*utilsFiltered*/536870912){$$invalidate(16,shouldRenderTabs=utilsFiltered.length>1);}if($$self.$$.dirty[3]&/*klass*/16777216){$$invalidate(26,className=arrayJoin([\"DokaRoot\",\"DokaRootComponent\",klass]));}if($$self.$$.dirty[5]&/*$rootRect*/256){$$invalidate(188,orientation=$rootRect&&($rootRect.width>$rootRect.height?\"landscape\":\"portrait\"));}if($$self.$$.dirty[6]&/*orientation*/4){$$invalidate(27,isLandscape=orientation===\"landscape\");}if($$self.$$.dirty[5]&/*$rootRect*/256){$$invalidate(189,horizontalSpace=$rootRect&&($rootRect.width>1000?\"wide\":$rootRect.width<600?\"narrow\":undefined));}if($$self.$$.dirty[5]&/*$rootRect*/256){$$invalidate(190,hasLimitedSpace=$rootRect&&($rootRect.width<=320||$rootRect.height<=460));}if($$self.$$.dirty[5]&/*$rootRect*/256){$$invalidate(191,verticalSpace=$rootRect&&($rootRect.height>1000?\"tall\":$rootRect.height<600?\"short\":undefined));}if($$self.$$.dirty[0]&/*root*/2){$$invalidate(192,isModal=root&&root.parentNode&&root.parentNode.classList.contains(\"DokaModal\"));}if($$self.$$.dirty[0]&/*windowWidth*/1024|$$self.$$.dirty[5]&/*$rootRect*/256|$$self.$$.dirty[6]&/*isModal*/64){$$invalidate(193,isCenteredHorizontally=isModal&&$rootRect&&windowWidth>$rootRect.width);}if($$self.$$.dirty[0]&/*windowHeight*/2048|$$self.$$.dirty[5]&/*$rootRect*/256|$$self.$$.dirty[6]&/*isModal*/64){$$invalidate(194,isCenteredVertically=isModal&&$rootRect&&windowHeight>$rootRect.height);}if($$self.$$.dirty[6]&/*isCenteredHorizontally, isCenteredVertically*/384){$$invalidate(195,isCentered=isCenteredHorizontally&&isCenteredVertically);}if($$self.$$.dirty[6]&/*horizontalSpace*/8){$$invalidate(196,isNarrow=horizontalSpace===\"narrow\");}if($$self.$$.dirty[6]&/*isNarrow, verticalSpace*/1056){$$invalidate(197,isCompact=isNarrow||verticalSpace===\"short\");}if($$self.$$.dirty[0]&/*windowWidth*/1024|$$self.$$.dirty[5]&/*$rootRect*/256){$$invalidate(198,hasSwipeNavigation=iOS&&$rootRect&&windowWidth===$rootRect.width&&!shouldPreventSwipe);}if($$self.$$.dirty[6]&/*utilTools, verticalSpace*/34){$$invalidate(199,shouldRenderUtilTools=utilTools.length&&verticalSpace===\"short\");}if($$self.$$.dirty[0]&/*root*/2){// will update when root element is available\n$$invalidate(200,rootElementComputedStyle=root&&getComputedStyle(root));}if($$self.$$.dirty[6]&/*rootElementComputedStyle*/16384){// sync for first time\nif(rootElementComputedStyle)syncBackgroundColor();}if($$self.$$.dirty[0]&/*enableToolbar, shouldRenderTabs, showUtils*/81984|$$self.$$.dirty[3]&/*layoutMode*/33554432|$$self.$$.dirty[6]&/*$env, orientation, horizontalSpace, verticalSpace, isModal, isCentered, isCenteredHorizontally, isCenteredVertically, $pointerAccuracy, $pointerHoverable, isCompact, hasSwipeNavigation, hasLimitedSpace*/236540){env.set(_objectSpread(_objectSpread({},$env),{},{layoutMode:layoutMode,orientation:orientation,horizontalSpace:horizontalSpace,verticalSpace:verticalSpace,isModal:isModal,isCentered:isCentered,isCenteredHorizontally:isCenteredHorizontally,isCenteredVertically:isCenteredVertically,pointerAccuracy:$pointerAccuracy,pointerHoverable:$pointerHoverable,isCompact:isCompact,hasSwipeNavigation:hasSwipeNavigation,hasLimitedSpace:hasLimitedSpace,hasToolbar:enableToolbar,hasNavigation:shouldRenderTabs&&showUtils,isIOS:iOS}));}if($$self.$$.dirty[6]&/*$env*/32768){$$invalidate(29,envStr=Object.keys($env).map(function(key){// is true boolean prop, use key\nif(/^is|has/.test(key)){return $env[key]?toKebabCase(key):undefined;}// use value\nreturn $env[key];}).filter(Boolean).join(\" \"));}if($$self.$$.dirty[5]&/*$imageCropRect*/16384|$$self.$$.dirty[6]&/*$imageTransforms, $imagePreviewModifiers, $imageEffects, $imageBackgroundColor*/3932160){$$invalidate(30,imageProps=$imageTransforms?_objectSpread(_objectSpread(_objectSpread(_objectSpread({},Object.keys($imagePreviewModifiers).filter(function(key){return $imagePreviewModifiers[key]!=null;}).reduce(function(prev,curr){prev=_objectSpread(_objectSpread({},prev),$imagePreviewModifiers[curr]);return prev;},{})),$imageTransforms),$imageEffects),{},{backgroundColor:$imageBackgroundColor,size:sizeCreateFromRect($imageCropRect)}):undefined);}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[6]&/*missingFeatures*/4194304){$$invalidate(32,isSupportsError=locale&&missingFeatures.length&&locale.labelSupportError(missingFeatures));}if($$self.$$.dirty[5]&/*$imageLoadState*/1024){//\n// loading status\n//\n$$invalidate(33,isImageLoadError=$imageLoadState&&!!$imageLoadState.error);}if($$self.$$.dirty[5]&/*$imageLoadState*/1024){$$invalidate(34,isWaitingForImage=!$imageLoadState||!$imageLoadState.complete&&$imageLoadState.task===undefined);}if($$self.$$.dirty[5]&/*$imageLoadState*/1024){$$invalidate(35,imageLoadProgress=$imageLoadState&&($imageLoadState.taskLengthComputable?$imageLoadState.taskProgress:Infinity));}if($$self.$$.dirty[5]&/*$imageLoadState, loadTimer*/1040){if($imageLoadState&&$imageLoadState.complete){// TODO: derive visual load complete from interface rest state instead of arbitrary timer\nclearTimeout(loadTimer);$$invalidate(159,loadTimer=setTimeout(function(){set_store_value(imageVisualLoadComplete,$imageVisualLoadComplete=true,$imageVisualLoadComplete);},500));}else if(!$imageLoadState){set_store_value(imageVisualLoadComplete,$imageVisualLoadComplete=false,$imageVisualLoadComplete);}}if($$self.$$.dirty[1]&/*isImageLoadError, isWaitingForImage*/12|$$self.$$.dirty[5]&/*$imageLoadState*/1024|$$self.$$.dirty[6]&/*$imageVisualLoadComplete*/8388608){$$invalidate(36,isLoadingImageData=$imageLoadState&&!isImageLoadError&&!isWaitingForImage&&!$imageVisualLoadComplete);}if($$self.$$.dirty[1]&/*$imagePreview*/128|$$self.$$.dirty[6]&/*$imageFile*/16777216){$$invalidate(37,isCreatingImagePreview=!!($imageFile&&!$imagePreview));}if($$self.$$.dirty[5]&/*$imageProcessingPreparing*/268435456|$$self.$$.dirty[6]&/*$imageProcessState*/33554432){//\n// processing status\n//\n$$invalidate(39,isProcessingImage=$imageProcessingPreparing||$imageProcessState&&$imageProcessState.progress!==undefined&&!$imageProcessState.complete);}if($$self.$$.dirty[1]&/*isWaitingForImage*/8|$$self.$$.dirty[5]&/*$imageLoadState*/1024){$$invalidate(40,imageLoadShowProgressIndicator=$imageLoadState&&!($imageLoadState.error||isWaitingForImage));}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[5]&/*$imageLoadState*/1024){$$invalidate(41,imageLoadStatusLabel=locale&&(!$imageLoadState?locale.statusLabelLoadImage($imageLoadState):!$imageLoadState.complete?stringReplace(locale.statusLabelLoadImage($imageLoadState),$imageLoadState.error&&$imageLoadState.error.metadata,\"{\",\"}\"):locale.statusLabelLoadImage({progress:Infinity,task:\"blob-to-bitmap\"})));}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[6]&/*$imageProcessState*/33554432){$$invalidate(42,imageProcessStatusLabel=$imageProcessState&&locale&&locale.statusLabelProcessImage($imageProcessState));}if($$self.$$.dirty[6]&/*$imageProcessState*/33554432){$$invalidate(43,imageProcessProgress=$imageProcessState&&($imageProcessState.taskLengthComputable?$imageProcessState.taskProgress:Infinity));}if($$self.$$.dirty[6]&/*$imageProcessState*/33554432){$$invalidate(44,imageProcessShowProgressIndicator=$imageProcessState&&!$imageProcessState.error);}if($$self.$$.dirty[6]&/*$imageProcessState*/33554432){$$invalidate(45,isImageProcessingError=$imageProcessState&&$imageProcessState.error);}if($$self.$$.dirty[1]&/*isSupportsError, isWaitingForImage, isImageLoadError, isLoadingImageData, isCreatingImagePreview, isProcessingImage*/366){set_store_value(statusOpacity,$statusOpacity=isSupportsError||isWaitingForImage||isImageLoadError||isLoadingImageData||isCreatingImagePreview||isProcessingImage?1:0,$statusOpacity);}if($$self.$$.dirty[1]&/*$statusOpacity*/32768){$$invalidate(47,isStatusVisible=$statusOpacity>0);}if($$self.$$.dirty[1]&/*$statusOpacity*/32768){if($statusOpacity<=0)hideStatus();}if($$self.$$.dirty[0]&/*windowWidth*/1024){$$invalidate(50,handleTouchStart=shouldPreventSwipe&&function(e){// get touch or event itself (fixes issue with chrome dev tools)\nvar event=e.touches?e.touches[0]:e;// if is not an attempt to swipe back or forward\nif(event.pageX>10&&event.pageX<windowWidth-10)return;// stop the navigation attempt\ne.preventDefault();});}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[4]&/*willRenderToolbar, enableButtonClose, enableButtonRevert, enableNavigateHistory, enableButtonExport*/94|$$self.$$.dirty[5]&/*canUndo, canRedo*/167772160|$$self.$$.dirty[6]&/*shouldRenderUtilTools, utilTools, isNarrow, $env*/41986){// dynamic IO menu\n$$invalidate(51,toolbarItems=locale&&willRenderToolbar([[\"div\",\"alpha\",{\"class\":\"DokaNavGroup\"},[[\"div\",\"alpha-set\",{\"class\":\"DokaNavSet\"},[// button close\nenableButtonClose&&[Button,\"close\",{label:locale.labelClose,icon:locale.iconButtonClose,onclick:function onclick(){return dispatch(\"close\");},hideLabel:true}],// button revert\nenableButtonRevert&&[Button,\"revert\",{label:locale.labelButtonRevert,icon:locale.iconButtonRevert,disabled:!canUndo,onclick:revert,hideLabel:true}]]]]],[\"div\",\"beta\",{\"class\":\"DokaNavGroup DokaNavGroupFloat\"},[enableNavigateHistory&&[\"div\",\"history\",{\"class\":\"DokaNavSet\"},[[Button,\"undo\",{label:locale.labelButtonUndo,icon:locale.iconButtonUndo,disabled:!canUndo,onclick:history.undo,hideLabel:true}],[Button,\"redo\",{label:locale.labelButtonRedo,icon:locale.iconButtonRedo,disabled:!canRedo,onclick:history.redo,hideLabel:true}]]],shouldRenderUtilTools&&[\"div\",\"plugin-tools\",{\"class\":\"DokaNavSet\"},utilTools.filter(Boolean).map(// in\nfunction(_ref163){var _ref164=_slicedToArray(_ref163,3),component=_ref164[0],key=_ref164[1],props=_ref164[2];return(// out\n[component,key,_objectSpread(_objectSpread({},props),{},{hideLabel:true})]);})]]],[\"div\",\"gamma\",{\"class\":\"DokaNavGroup\"},[enableButtonExport&&[Button,\"export\",{label:locale.labelButtonExport,icon:isNarrow&&locale.iconButtonExport,\"class\":\"DokaButtonExport\",onclick:handleExport,hideLabel:isNarrow}]]]],_objectSpread({},$env)));}if($$self.$$.dirty[0]&/*$clientRect*/32768){$$invalidate(212,hasClientRect=$clientRect&&$clientRect.width>0&&$clientRect.height>0);}if($$self.$$.dirty[0]&/*locale*/4|$$self.$$.dirty[6]&/*hasClientRect, utilsDefined*/67108865){$$invalidate(52,canRender=hasClientRect&&locale&&utilsDefined);}if($$self.$$.dirty[0]&/*rootPortal*/8192){rootPortal&&rootPortalStore.set(rootPortal);}};$$invalidate(208,missingFeatures=[!supportsWebGL()&&\"WebGL\"].filter(Boolean));// used to route ping events\n$$invalidate(53,routePing=createPingRouter(eventProxy.pub));return[pluginInterface,root,locale,id,elasticityMultiplier,willRenderCanvas,enableToolbar,pluginOptions,imageSourceToImageData,history,windowWidth,windowHeight,utilsVisible,rootPortal,showUtils,$clientRect,shouldRenderTabs,$imageSize,shouldAnimate,$tabRect,utilsMerged,utilSelected,utilsVisibleFraction,tabsConfig,tabs,panels,className,isLandscape,$rootBackgroundColor,envStr,imageProps,$imageSelectionRectPresentation,isSupportsError,isImageLoadError,isWaitingForImage,imageLoadProgress,isLoadingImageData,isCreatingImagePreview,$imagePreview,isProcessingImage,imageLoadShowProgressIndicator,imageLoadStatusLabel,imageProcessStatusLabel,imageProcessProgress,imageProcessShowProgressIndicator,isImageProcessingError,$statusOpacity,isStatusVisible,$statusOffsetX,$progressOffsetX,handleTouchStart,toolbarItems,canRender,routePing,$toolRect,$utilRect,$pixelRatio,$imagePreviews,$imageDecoration,$imageAnnotation,$imageOverlay,imageFile,imageSize,imageLoadState,imageProcessState,imageCropRect,imageBackgroundColor,imageDecoration,imageAnnotation,imageState,images,rootBackgroundColor,clientRect,rootRect,tabRect,toolRect,utilRect,stageRect,pointerAccuracy,pointerHoverable,isInteracting,isInteractingFraction,previewShouldUpscale,stageScalar,imageCropRectSnapshot,imageCropRectIntent,imageSelectionRect,imageSelectionRectSnapshot,imageSelectionRectIntent,imageSelectionRectPresentation,presentationScalar,imageOverlay,imageVisualLoadComplete,imagePreview,imagePreviewModifiers,imagePreviews,imageTransforms,imageEffects,env,pixelRatio,imageProcessingPreparing,utilStores,handleTransitionEnd,statusOpacity,statusOffsetX,progressOffsetX,offsetProgress,handleCloseImageLoadError,handleCloseImageProcessError,pressedKeysStore,handleKeydown,handleKeyup,handleWindowBlur,handleContextMenu,handleDropFiles,getStageState,createCanvasState,klass,layoutMode,stores,util,utils,animations,previewUpscale,willRevert,willRenderToolbar,enableButtonExport,enableButtonRevert,enableNavigateHistory,enableUtils,enableButtonClose,previewImageDataMaxSize,enableDropImage,imageOrienter,pluginComponents,sub,onwindowresize,measure_handler,select_handler,func,panel_component_binding,measure_handler_1,show_handler,hide_handler,fade_handler,measure_handler_2,func_1,panel_component_binding_1,measure_handler_3,show_handler_1,hide_handler_1,fade_handler_1,func_2,div_binding,div_binding_1,measure_handler_4];}var Ui=/*#__PURE__*/function(_SvelteComponent12){_inherits(Ui,_SvelteComponent12);var _super13=_createSuper(Ui);function Ui(options){var _this13;_classCallCheck(this,Ui);_this13=_super13.call(this);init(_assertThisInitialized(_this13),options,instance$b,create_fragment$b,safe_not_equal,{\"class\":117,layout:118,stores:119,locale:2,id:3,util:120,utils:121,animations:122,previewUpscale:123,elasticityMultiplier:4,willRevert:124,willRenderCanvas:5,willRenderToolbar:125,enableButtonExport:126,enableButtonRevert:127,enableNavigateHistory:128,enableToolbar:6,enableUtils:129,enableButtonClose:130,previewImageDataMaxSize:131,enableDropImage:132,imageOrienter:133,pluginComponents:134,pluginOptions:7,sub:135,pluginInterface:0,root:1,imageSourceToImageData:8,history:9},[-1,-1,-1,-1,-1,-1,-1,-1,-1]);return _this13;}_createClass(Ui,[{key:\"class\",get:function get(){return this.$$.ctx[117];},set:function set(klass){this.$set({\"class\":klass});flush();}},{key:\"layout\",get:function get(){return this.$$.ctx[118];},set:function set(layoutMode){this.$set({layout:layoutMode});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[119];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[2];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"id\",get:function get(){return this.$$.ctx[3];},set:function set(id){this.$set({id:id});flush();}},{key:\"util\",get:function get(){return this.$$.ctx[120];},set:function set(util){this.$set({util:util});flush();}},{key:\"utils\",get:function get(){return this.$$.ctx[121];},set:function set(utils){this.$set({utils:utils});flush();}},{key:\"animations\",get:function get(){return this.$$.ctx[122];},set:function set(animations){this.$set({animations:animations});flush();}},{key:\"previewUpscale\",get:function get(){return this.$$.ctx[123];},set:function set(previewUpscale){this.$set({previewUpscale:previewUpscale});flush();}},{key:\"elasticityMultiplier\",get:function get(){return this.$$.ctx[4];},set:function set(elasticityMultiplier){this.$set({elasticityMultiplier:elasticityMultiplier});flush();}},{key:\"willRevert\",get:function get(){return this.$$.ctx[124];},set:function set(willRevert){this.$set({willRevert:willRevert});flush();}},{key:\"willRenderCanvas\",get:function get(){return this.$$.ctx[5];},set:function set(willRenderCanvas){this.$set({willRenderCanvas:willRenderCanvas});flush();}},{key:\"willRenderToolbar\",get:function get(){return this.$$.ctx[125];},set:function set(willRenderToolbar){this.$set({willRenderToolbar:willRenderToolbar});flush();}},{key:\"enableButtonExport\",get:function get(){return this.$$.ctx[126];},set:function set(enableButtonExport){this.$set({enableButtonExport:enableButtonExport});flush();}},{key:\"enableButtonRevert\",get:function get(){return this.$$.ctx[127];},set:function set(enableButtonRevert){this.$set({enableButtonRevert:enableButtonRevert});flush();}},{key:\"enableNavigateHistory\",get:function get(){return this.$$.ctx[128];},set:function set(enableNavigateHistory){this.$set({enableNavigateHistory:enableNavigateHistory});flush();}},{key:\"enableToolbar\",get:function get(){return this.$$.ctx[6];},set:function set(enableToolbar){this.$set({enableToolbar:enableToolbar});flush();}},{key:\"enableUtils\",get:function get(){return this.$$.ctx[129];},set:function set(enableUtils){this.$set({enableUtils:enableUtils});flush();}},{key:\"enableButtonClose\",get:function get(){return this.$$.ctx[130];},set:function set(enableButtonClose){this.$set({enableButtonClose:enableButtonClose});flush();}},{key:\"previewImageDataMaxSize\",get:function get(){return this.$$.ctx[131];},set:function set(previewImageDataMaxSize){this.$set({previewImageDataMaxSize:previewImageDataMaxSize});flush();}},{key:\"enableDropImage\",get:function get(){return this.$$.ctx[132];},set:function set(enableDropImage){this.$set({enableDropImage:enableDropImage});flush();}},{key:\"imageOrienter\",get:function get(){return this.$$.ctx[133];},set:function set(imageOrienter){this.$set({imageOrienter:imageOrienter});flush();}},{key:\"pluginComponents\",get:function get(){return this.$$.ctx[134];},set:function set(pluginComponents){this.$set({pluginComponents:pluginComponents});flush();}},{key:\"pluginOptions\",get:function get(){return this.$$.ctx[7];},set:function set(pluginOptions){this.$set({pluginOptions:pluginOptions});flush();}},{key:\"sub\",get:function get(){return this.$$.ctx[135];}},{key:\"pluginInterface\",get:function get(){return this.$$.ctx[0];}},{key:\"root\",get:function get(){return this.$$.ctx[1];},set:function set(root){this.$set({root:root});flush();}},{key:\"imageSourceToImageData\",get:function get(){return this.$$.ctx[8];},set:function set(imageSourceToImageData){this.$set({imageSourceToImageData:imageSourceToImageData});flush();}},{key:\"history\",get:function get(){return this.$$.ctx[9];}}]);return Ui;}(SvelteComponent);// which props to filter out of exported props\nvar utilPrivateProps=['klass','stores','isVisible','isActive','isActiveFraction','locale'];var viewPrivateProps=[// methods\n'history',// props\n'klass','stores','navButtons','pluginComponents','pluginInterface','pluginOptions','sub'];// view options array\nvar editorProps;var pluginProps=new Set([]);var propPluginRef={};// loops over plugins and registers all available options so we can define getters/setters\nvar pluginComponents=new Map();var setEditorViewPlugins=function setEditorViewPlugins(){for(var _len10=arguments.length,args=new Array(_len10),_key13=0;_key13<_len10;_key13++){args[_key13]=arguments[_key13];}args.forEach(function(plugin){var _plugin$util=_slicedToArray(plugin.util,2),id=_plugin$util[0],Component=_plugin$util[1];pluginComponents.set(id,Component);getComponentExportedProps(Component).filter(function(prop){return!utilPrivateProps.includes(prop);}).forEach(function(prop){pluginProps.add(prop);if(propPluginRef[prop]){propPluginRef[prop].push(id);return;}propPluginRef[prop]=[id];});});};var getEditorViewProps=function getEditorViewProps(){editorProps=new Set(getComponentExportedProps(Ui).filter(function(prop){return!viewPrivateProps.includes(prop);}));return[].concat(_toConsumableArray(editorProps),_toConsumableArray(pluginProps));};var attachEditorView=function attachEditorView(target,stores){var accessors={};var editor=new Ui({target:target,props:{stores:stores,pluginComponents:Array.from(pluginComponents)}});// set up accessors for editor props\nif(!editorProps)editorProps=new Set(getComponentExportedProps(Ui).filter(function(prop){return!viewPrivateProps.includes(prop);}));editorProps.forEach(function(prop){Object.defineProperty(accessors,prop,{get:function get(){return editor.prop;},set:function set(value){return editor[prop]=value;}});});// set up accessors for plugin props\npluginProps.forEach(function(prop){var plugins=propPluginRef[prop];var plugin=plugins[0];// will always get value from first plugin, when plugins share a property the value will be in sync when set\nObject.defineProperty(accessors,prop,{get:function get(){return editor.pluginInterface[plugin][prop];},set:function set(value){var opts=plugins.reduce(function(prev,plugin){prev[plugin]=_objectSpread(_objectSpread({},editor.pluginOptions[plugin]),{},_defineProperty({},prop,value));return prev;},{});editor.pluginOptions=_objectSpread(_objectSpread({},editor.pluginOptions),opts);}});});// add element root query\nObject.defineProperty(accessors,'element',{get:function get(){return editor.root;},set:function set(){return undefined;}});defineMethods(accessors,{on:function on(event,cb){if(/undo|redo|revert/.test(event))return editor.history.on(event,cb);var unsubs=[editor.sub(event,cb),editor.$on(event,function(e){return cb(e instanceof CustomEvent&&!e.detail?undefined:e);})].filter(Boolean);return function(){return unsubs.forEach(function(unsub){return unsub();});};},undo:function undo(){return editor.history.undo();},redo:function redo(){return editor.history.redo();},revert:function revert(){return editor.history.clear();},close:function close(){return editor.pub('close');},destroy:function destroy(){return editor.$destroy();}});// clean up on window unload\nif(isBrowser())window.addEventListener('pagehide',function(){return editor&&editor.$destroy();});return accessors;};var linkAccessors=function linkAccessors(destination,origin){var descriptors=Object.getOwnPropertyDescriptors(destination);Object.keys(descriptors).forEach(function(key){// props, set new setter and getter\nif(!!descriptors[key]['get']){Object.defineProperty(origin,key,{get:function get(){return destination[key];},set:function set(value){return destination[key]=value;}});}// method, copy reference\nelse{origin[key]=destination[key];}});};var editorEvents=[].concat(editorEventsToBubble,['undo','redo','revert','destroy','show','hide','close','selectshape','updateshape','addshape','removeshape']);var hasDoctype=function hasDoctype(){return isBrowser()&&document.doctype!==null;};var initEditorView=function initEditorView(target){var accessors={};var _pubsub4=pubsub(),sub=_pubsub4.sub,pub=_pubsub4.pub;// catch missing doctype\nif(!hasDoctype())console.warn('Missing Document Type Declaration');// create editor core\nvar core=createImageEditor();linkAccessors(core,accessors);// create editor view\nvar view=attachEditorView(target,core.stores);linkAccessors(view,accessors);// listen for UI interaction and link to editor API (internals)\nvar unsubs=['loadImage','processImage','abortProcessImage','abortLoadImage'].map(function(event){return view.on(event,function(e){return core[event](e&&e.detail);});});// auto subscribes on each possible publisher\nvar subscribe=function subscribe(event,cb){var unsubInit=sub(event,cb);var unsubCore=core.on(event,cb);var unsubView=view.on(event,cb);return function(){unsubInit();unsubCore();unsubView();};};// handles every event, useful for routing events from the options object\naccessors.handleEvent=noop;var handleEventUnsubs=editorEvents.map(function(type){return subscribe(type,function(res){return accessors.handleEvent(type,res);});});// set up new api\ndefineMethods(accessors,{on:subscribe,close:function close(){pub('close');},destroy:function destroy(){// unsub\n[].concat(_toConsumableArray(unsubs),_toConsumableArray(handleEventUnsubs)).forEach(function(unsub){return unsub();});// destroy\nview.destroy();core.destroy();// destroyed\npub('destroy');}});return accessors;};var appendEditor=function appendEditor(target){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var element=isString(target)?document.querySelector(target):target;if(!element)return undefined;options[\"class\"]=options[\"class\"]?\"doka-image-editor \".concat(options[\"class\"]):'doka-image-editor';var accessors=initEditorView(element);return Object.assign(accessors,options);};var appendEditors=function appendEditors(targets){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var elements=isString(targets)?Array.from(document.querySelectorAll(targets)):targets;return elements.filter(Boolean).map(function(element){return appendEditor(element,deepCopy(options));});};/* src/core/ui/modal/index.svelte generated by Svelte v3.29.4 */var document_1=globals.document;function create_fragment$c(ctx){var t;var div;var mounted;var dispose;add_render_callback(/*onwindowresize*/ctx[14]);return{c:function c(){t=space();div=element(\"div\");attr(div,\"class\",\"doka-image-editor DokaModal\");attr(div,\"style\",/*style*/ctx[4]);},m:function m(target,anchor){insert(target,t,anchor);insert(target,div,anchor);/*div_binding*/ctx[15](div);if(!mounted){dispose=[listen(window,\"keydown\",/*handleKey*/ctx[9]),listen(window,\"orientationchange\",/*spawnMeasureElement*/ctx[10]),listen(window,\"resize\",/*onwindowresize*/ctx[14]),listen(document_1.body,\"focusin\",function(){if(is_function(!/*hidden*/ctx[1]&&/*handleFocusIn*/ctx[6]))(!/*hidden*/ctx[1]&&/*handleFocusIn*/ctx[6]).apply(this,arguments);}),listen(document_1.body,\"focusout\",function(){if(is_function(/*hasFocussedTextField*/ctx[2]&&/*handleFocusOut*/ctx[7]))(/*hasFocussedTextField*/ctx[2]&&/*handleFocusOut*/ctx[7]).apply(this,arguments);}),listen(div,\"wheel\",/*handleWheel*/ctx[8])];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty[0]&/*style*/16){attr(div,\"style\",/*style*/ctx[4]);}},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);if(detaching)detach(div);/*div_binding*/ctx[15](null);mounted=false;run_all(dispose);}};}function instance$c($$self,$$props,$$invalidate){var $opacity;var dispatch=createEventDispatcher();var root=$$props.root;var _$$props$preventZoomV=$$props.preventZoomViewport,preventZoomViewport=_$$props$preventZoomV===void 0?true:_$$props$preventZoomV;var hidden=true;var hiding=false;var showing=false;var opacity=spring(0,{precision:0.001,damping:0.5});component_subscribe($$self,opacity,function(value){return $$invalidate(25,$opacity=value);});// animate hide and show\nvar unsub=opacity.subscribe(function(o){if(showing&&o>=1){showing=false;// now shown\n$$invalidate(1,hidden=false);dispatch(\"show\");}else if(hiding&&o<=0){hiding=false;// now hidden\n$$invalidate(1,hidden=true);dispatch(\"hide\");}});// clean up when removed\nonDestroy(function(){return unsub();});var hasFocussedTextField=false;var viewportDefaults=undefined;var showTimeoutId=undefined;var getViewPortElement=function getViewPortElement(){return document.querySelector(\"meta[name=viewport]\");};var show=function show(){// is visible, or busy becoming visible\nif(showing||!hidden)return;// now in 'showing' transition\nshowing=true;// store default viewport element values\nvar viewportElement=getViewPortElement()||h(\"meta\",{name:\"viewport\"});viewportDefaults=!viewportDefaults&&viewportElement.getAttribute(\"content\");viewportElement.setAttribute(\"content\",viewportRules+(/cover/.test(viewportDefaults)?\",viewport-fit=cover\":\"\"));if(!viewportElement.parentNode)document.head.appendChild(viewportElement);clearTimeout(showTimeoutId);showTimeoutId=setTimeout(function(){return set_store_value(opacity,$opacity=1,$opacity);},250);};var hide=function hide(){// is hiding or already hidden\nif(hiding||hidden)return;// if previous command was show, we need to prevent the timeout from kicking off\nclearTimeout(showTimeoutId);// now in 'hiding' transition\nhiding=true;// get a reference to the viewport element, it should be there as we created it earlier, \n// we restore defaults if the viewport metatag was defined, if not, we destroy it\nvar viewportElement=getViewPortElement();if(viewportDefaults)viewportElement.setAttribute(\"content\",viewportDefaults);else document.head.removeChild(viewportElement);// let's hide!\nset_store_value(opacity,$opacity=0,$opacity);};// handle soft keyboard impact on window height\nvar focusOutTimer;var focusInWindowHeight;var handleFocusIn=function handleFocusIn(e){// test if is text input element\nif(!/textarea/i.test(e.target))return;// now focussing a field\n$$invalidate(2,hasFocussedTextField=true);focusInWindowHeight=windowHeight;};var handleFocusOut=function handleFocusOut(e){// test if is text input element\nif(!/textarea/i.test(e.target))return;// prevent accidentally setting two timers\nclearTimeout(focusOutTimer);// test if window height changed, if not, no soft keyboard appeared and we can set false to focus state immidiately\nif(focusInWindowHeight===windowHeight){$$invalidate(2,hasFocussedTextField=false);}else// soft keyboard might have appeared, test for window height change before setting unfocus state\n{var windowCurrentHeight=windowHeight;runWhen(function(){return windowHeight!==windowCurrentHeight;},function(){return $$invalidate(2,hasFocussedTextField=false);});}};var runWhen=function runWhen(test,cb){var frame=function frame(){if(test()){cb();return;}requestAnimationFrame(frame);};requestAnimationFrame(frame);};// end soft keyboard logic\n// prevent mousewheel from scrolling content behind modal\nvar handleWheel=function handleWheel(e){return e.preventDefault();};// handle escape to close modal\nvar handleKey=function handleKey(e){// get key type\nvar key=e.key;// only deal with escape key\nif(!/escape/i.test(key))return;// don't close when in an input or textuarea\nvar targetElement=e.target;if(targetElement&&/input|textarea/i.test(targetElement.nodeName))return;hide();};// this logic scales modal to fit viewport height\nvar windowHeight=0;var windowHeightComputed;// iOS measure actual page height so we can make optional use of available space\nvar measureElement;var measureElementHeight=undefined;var spawnMeasureElement=function spawnMeasureElement(){// can't spawn more than one\nif(measureElement)return;measureElement=h(\"div\",{style:\"position:fixed;height:100vh;top:0\"});document.body.appendChild(measureElement);};onMount(function(){// no need to run this logic if is not on iOS\nif(!isIOS())return;// will be used in first read to determine page height and bottom padding\nspawnMeasureElement();});afterUpdate(function(){// will only run on iOS\nif(!measureElement)return;// get height and store\n$$invalidate(23,measureElementHeight=measureElement.offsetHeight);// remove measure element\nmeasureElement.parentNode.removeChild(measureElement);measureElement=undefined;});function onwindowresize(){$$invalidate(3,windowHeight=window.innerHeight);}function div_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(0,root);});}$$self.$$set=function($$props){if(\"root\"in $$props)$$invalidate(0,root=$$props.root);if(\"preventZoomViewport\"in $$props)$$invalidate(11,preventZoomViewport=$$props.preventZoomViewport);};var viewportRules;var isIOSFooterVisible;var style;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*preventZoomViewport*/2048){viewportRules=\"width=device-width,height=device-height,initial-scale=1\"+(preventZoomViewport?\",maximum-scale=1,user-scalable=0\":\"\");}if($$self.$$.dirty[0]&/*hasFocussedTextField, windowHeight*/12){if(!hasFocussedTextField)$$invalidate(21,windowHeightComputed=windowHeight);}if($$self.$$.dirty[0]&/*measureElementHeight, windowHeight*/8388616){$$invalidate(26,isIOSFooterVisible=isIOS()?\"--viewport-pad-footer:\".concat(measureElementHeight>windowHeight?0:1):\"\");}if($$self.$$.dirty[0]&/*windowHeightComputed, $opacity, isIOSFooterVisible*/102760448){$$invalidate(4,style=\"height:\".concat(windowHeightComputed,\"px;opacity:\").concat($opacity,\";--editor-modal:1;\").concat(isIOSFooterVisible));}};return[root,hidden,hasFocussedTextField,windowHeight,style,opacity,handleFocusIn,handleFocusOut,handleWheel,handleKey,spawnMeasureElement,preventZoomViewport,show,hide,onwindowresize,div_binding];}var Modal=/*#__PURE__*/function(_SvelteComponent13){_inherits(Modal,_SvelteComponent13);var _super14=_createSuper(Modal);function Modal(options){var _this14;_classCallCheck(this,Modal);_this14=_super14.call(this);init(_assertThisInitialized(_this14),options,instance$c,create_fragment$c,safe_not_equal,{root:0,preventZoomViewport:11,show:12,hide:13},[-1,-1]);return _this14;}_createClass(Modal,[{key:\"root\",get:function get(){return this.$$.ctx[0];},set:function set(root){this.$set({root:root});flush();}},{key:\"preventZoomViewport\",get:function get(){return this.$$.ctx[11];},set:function set(preventZoomViewport){this.$set({preventZoomViewport:preventZoomViewport});flush();}},{key:\"show\",get:function get(){return this.$$.ctx[12];}},{key:\"hide\",get:function get(){return this.$$.ctx[13];}}]);return Modal;}(SvelteComponent);// @ts-ignore\n// we export a function that renders the view as to not export svelte component related code to outside the ui dir\nvar createModal=function createModal(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var parent=arguments.length>1?arguments[1]:undefined;return new Modal({target:parent||document.body,props:{preventZoomViewport:options.preventZoomViewport}});};var openEditor=function openEditor(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var parent=arguments.length>1?arguments[1]:undefined;// set up pub/sub for the app layer\nvar _pubsub5=pubsub(),sub=_pubsub5.sub,pub=_pubsub5.pub;var accessors={};var modal=createModal(options,parent);var hide=function hide(){modal.hide();};var show=function show(){modal.show();};var view=initEditorView(modal.root);linkAccessors(view,accessors);// link up handle event\naccessors.handleEvent=noop;view.handleEvent=function(type,detail){return accessors.handleEvent(type,detail);};// route close request from view to modal\nview.on('close',hide);var subscribe=function subscribe(event,cb){// capture modal related events\nif(/show|hide/.test(event))return sub(event,cb);// route rest of events to view\nreturn view.on(event,cb);};var modalHandleEventUnsubs=['show','hide'].map(function(type){return subscribe(type,function(detail){return accessors.handleEvent(type,detail);});});// cleans up view\nvar destroy=function destroy(){// unsub\nmodalHandleEventUnsubs.forEach(function(unsub){return unsub();});// remove\nhide();modal.$destroy();view.destroy();};defineMethods(accessors,{on:subscribe,destroy:destroy,hide:hide,show:show});// add element root query\nObject.defineProperty(accessors,'modal',{get:function get(){return modal.root;},set:function set(){return undefined;}});// destroy when hidden\nmodal.$on('show',function(){return pub('show');});modal.$on('hide',function(){pub('hide');destroy();});// modal behavior\nview.on('process',hide);view.on('loadstart',show);// test if should\nif(options.enableButtonClose!==false)options.enableButtonClose=true;// update props\nObject.assign(accessors,options);return accessors;};var overlayEditor=function overlayEditor(target,options){var editor=appendEditor(target,_objectSpread(_objectSpread({},options),{},{layout:'overlay'}));return editor;};var dispatchElementEvent=function dispatchElementEvent(target,event,detail){return target.dispatchEvent(new CustomEvent(event,{detail:detail,bubbles:true,cancelable:true}));};var dispatchEditorEvents=function dispatchEditorEvents(editor,handler){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _options$prefix=options.prefix,prefix=_options$prefix===void 0?'doka:':_options$prefix;return editorEvents.map(function(event){return editor.on(event,function(value){return isElement(handler)?dispatchElementEvent(handler,\"\".concat(prefix).concat(event),value):handler(event,value);});});};var TAG='doka-image-editor';var customElement=function customElement(){return new Promise(function(resolve){if(!DokaImageEditorElement)return resolve([]);customElements.define(TAG,DokaImageEditorElement);customElements.whenDefined(TAG).then(function(){return resolve(document.querySelectorAll(TAG));});});};var DokaImageEditorElement=isBrowser()&&/*#__PURE__*/function(_HTMLElement){_inherits(_class,_HTMLElement);var _super15=_createSuper(_class);function _class(){var _this15;_classCallCheck(this,_class);_this15=_super15.call(this);_this15._editor=undefined;_this15._unsubs=undefined;return _this15;}_createClass(_class,[{key:\"attributeChangedCallback\",value:function attributeChangedCallback(attrName,oldValue,newValue){this[attrName]=newValue;}},{key:\"connectedCallback\",value:function connectedCallback(){this._editor=initEditorView(this);linkAccessors(this._editor,this);this._editor.src=this.getAttribute('src');this._unsubs=dispatchEditorEvents(this._editor,this);}},{key:\"disconnectedCallback\",value:function disconnectedCallback(){this._editor.destroy();this._unsubs.forEach(function(unsub){return unsub();});}}],[{key:\"observedAttributes\",get:function get(){return['src'];}}]);return _class;}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));var arrayInsert=function arrayInsert(array,index,item){array.splice(index,0,item);return array;};// first index is always id, so if is string, it's a node\nvar isNode=function isNode(item){return isString(item[0]);};// if it's not a node, it's a nodelist\nvar isNodeList=function isNodeList(item){return!isNode(item);};var getNodeId=function getNodeId(node){return node[1];};var getNodeChildren=function getNodeChildren(node){return node[3]||[];};var createNode=function createNode(instance,id){var props=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var children=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];return[instance,id,props,children];};var insertNode=function insertNode(node,needle,haystack){var getIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(index){return index;};var nodeList=findNodeList(needle,haystack);var targetIndex=nodeList.findIndex(function(item){return getNodeId(item)===needle;});arrayInsert(nodeList,getIndex(targetIndex),node);};var insertNodeBefore=function insertNodeBefore(node,needle,haystack){return insertNode(node,needle,haystack);};var insertNodeAfter=function insertNodeAfter(node,needle,haystack){return insertNode(node,needle,haystack,function(index){return index+1;});};var appendNode=function appendNode(node,needle,haystack){var parent=findNode(needle,haystack);getNodeChildren(parent).push(node);return parent;};var removeNode=function removeNode(needle,haystack){var nodeList=findNodeList(needle,haystack);arrayRemove(nodeList,function(item){return getNodeId(item)===needle;});return nodeList;};var findNode=function findNode(needle,haystack){return isNode(haystack)?// haystack is a node, maybe node is a match or one of children is a match\ngetNodeId(haystack)===needle?haystack:findNode(needle,getNodeChildren(haystack)):// haystack is a list of nodes\nhaystack.find(function(item){return findNode(needle,item);});};var findNodeList=function findNodeList(needle,haystack){// haystack is node list\nif(isNodeList(haystack)){// lets search nodes in this haystack\nif(haystack.find(function(item){return getNodeId(item)===needle;}))return haystack;// not found, lets move the search to the childnodes\nreturn haystack.find(function(item){return findNodeList(needle,getNodeChildren(item));});}// is node, lets find in children\nreturn findNodeList(needle,getNodeChildren(haystack));};//#region markup\nvar propertyMap={borderColor:'strokeColor',borderWidth:'strokeWidth',lineWidth:'strokeWidth',fontColor:'color',lineColor:'strokeColor',src:'backgroundImage',fit:'backgroundSize'};var convertValue=function convertValue(value){if(value===0)return 0;if(value==='0%')return 0;if(value==='0px')return 0;if(/px$/.test(value))return parseInt(value,10);if(/\\%$/.test(value))return value;if(value<=1)return\"\".concat(value*100,\"%\");};var addValues=function addValues(a,b){var _a,_b;if(/%$/.test(a)){_a=parseFloat(a);_b=parseFloat(b);return\"\".concat(_a+_b,\"%\");}if(/px$/.test(a)){_a=parseInt(a,10);_b=parseInt(b,10);return\"\".concat(_a+_b,\"px\");}};var shapeFromLegacyMarkup=function shapeFromLegacyMarkup(crop,type,style){var shape=Object.keys(style).reduce(function(res,prop){var value=style[prop];// rename prop\nprop=propertyMap[prop]||prop;// if is px value\nif(/px$/.test(value)){value=convertValue(value);}// if is number convert to percentage\nelse if(/^(?:x|y|left|right|top|bottom|width|height|fontSize|strokeWidth)$/.test(prop)&&typeof value==='number'){if(/strokeWidth/.test(prop))value*=2;value=convertValue(value);}// if is color value\nif(/color/i.test(prop)){value=colorStringToColorArray(value);}if(value===null)value=undefined;res[prop]=value;return res;},{});if(type==='line'){if(shape.lineDecoration.length===1)shape.lineEnd='arrow';if(shape.lineDecoration.length===2)shape.lineStart='arrow';shape.x1=shape.x;shape.y1=shape.y;shape.x2=addValues(shape.x,shape.width);shape.y2=addValues(shape.y,shape.height);delete shape.x;delete shape.y;delete shape.width;delete shape.height;delete shape.lineDecoration;delete shape.lineStyle;}if(type==='text'){shape.y=addValues(shape.y,'-'+shape.fontSize);delete shape.width;delete shape.height;delete shape.borderStyle;}if(type==='ellipse'){var w,_h2;// calculate `rx` and `ry` based on `width` and `h`eight`\nif(/%$/.test(shape.width)){w=parseFloat(shape.width)/100;_h2=parseFloat(shape.height)/100;var widthAbsolute=w*crop.width;var heightAbsolute=_h2*crop.height;w=widthAbsolute/crop.width*100;_h2=heightAbsolute/crop.height*100;}else{w=shape.width;_h2=shape.height;}shape.rx=w*0.5;shape.ry=_h2*0.5;if(/%$/.test(shape.width)){shape.rx+='%';shape.ry+='%';}shape.x=addValues(shape.x,shape.rx);shape.y=addValues(shape.y,shape.ry);delete shape.width;delete shape.height;delete shape.borderStyle;}if(type==='rect'){delete shape.borderStyle;}if(type==='path'){shape.points=shape.points.map(function(point){return{x:convertValue(point.x),y:convertValue(point.y)};});}return shape;};//#endregion\n//#region crop\nvar getOffsetPointOnEdge=function getOffsetPointOnEdge(length,rotation){var a=length;var A=1.5707963267948966;var B=rotation;var C=1.5707963267948966-rotation;var sinA=Math.sin(A);var sinB=Math.sin(B);var sinC=Math.sin(C);var cosC=Math.cos(C);var ratio=a/sinA;var b=ratio*sinB;var c=ratio*sinC;return vectorCreate(cosC*b,cosC*c);};var getRotatedRectSize=function getRotatedRectSize(rect,rotation){var w=rect.width;var h=rect.height;var hor=getOffsetPointOnEdge(w,rotation);var ver=getOffsetPointOnEdge(h,rotation);var tl=vectorCreate(rect.x+Math.abs(hor.x),rect.y-Math.abs(hor.y));var tr=vectorCreate(rect.x+rect.width+Math.abs(ver.y),rect.y+Math.abs(ver.x));var bl=vectorCreate(rect.x-Math.abs(ver.y),rect.y+rect.height-Math.abs(ver.x));return{width:vectorDistance(tl,tr),height:vectorDistance(tl,bl)};};var getBoundsAroundCenter=function getBoundsAroundCenter(imageSize,center){var cx=center.x>0.5?1-center.x:center.x;var cy=center.y>0.5?1-center.y:center.y;return sizeCreate(cx*2*imageSize.width,cy*2*imageSize.height);};var getCanvasSize=function getCanvasSize(imageSize,canvasAspectRatio){var zoom=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var imageAspectRatio=imageSize.height/imageSize.width;// determine actual pixels on x and y axis\nvar canvasWidth=1;var canvasHeight=canvasAspectRatio;var imgWidth=1;var imgHeight=imageAspectRatio;if(imgHeight>canvasHeight){imgHeight=canvasHeight;imgWidth=imgHeight/imageAspectRatio;}var scalar=Math.max(canvasWidth/imgWidth,canvasHeight/imgHeight);var width=imageSize.width/(zoom*scalar*imgWidth);var height=width*canvasAspectRatio;return{width:width,height:height};};var getCenteredCropRect=function getCenteredCropRect(imageSize,aspectRatio){var width=imageSize.width;var height=width*aspectRatio;if(height>imageSize.height){height=imageSize.height;width=height/aspectRatio;}var x=(imageSize.width-width)*0.5;var y=(imageSize.height-height)*0.5;return rectCreate(x,y,width,height);};var getCorrectedLegacyAspectRatio=function getCorrectedLegacyAspectRatio(imageSize,aspectRatio){return aspectRatio!=null?// fox the aspect ratio\n1/aspectRatio:// set image aspect ratio\nimageSize.width/imageSize.height;};var imagePropertiesFromLegacyCrop=function imagePropertiesFromLegacyCrop(imageSize,_ref165){var flip=_ref165.flip,aspectRatio=_ref165.aspectRatio,rotation=_ref165.rotation,center=_ref165.center,zoom=_ref165.zoom,scaleToFit=_ref165.scaleToFit;var res={};// is centered crop\nvar isCenteredCrop=!center||center&&center.x===0.5&&center.y===0.5;// handle basic props\nif(flip&&flip.horizontal)res.flipHorizontal=flip.horizontal;if(flip&&flip.vertical)res.flipVertical=flip.vertical;// fix aspect ratio, in FilePond and Doka classic it's height/width instead of width/height\nvar correctedAspectRatio=getCorrectedLegacyAspectRatio(imageSize,aspectRatio);// image bounds\nvar cropLimit=!(scaleToFit===false);var canvasSize=getCanvasSize(imageSize,aspectRatio,zoom);var cropSize=isCenteredCrop?imageSize:getBoundsAroundCenter(imageSize,cropLimit?center:{x:0.5,y:0.5});var cropCentered=getCenteredCropRect(imageSize,aspectRatio);// has different aspect ratio than image\nif(aspectRatio||!isCenteredCrop||zoom){res.crop=rectContainRect(rectCreateFromSize(cropSize),correctedAspectRatio);}if(typeof rotation==='number'&&rotation!==null){if(rotation!=null)res.rotation=rotation;var rotatedCropSize=getRotatedRectSize(cropCentered,rotation);var _scalar3=Math.max(rotatedCropSize.width/cropSize.width,rotatedCropSize.height/cropSize.height);// window.clear();\n// crop position in non-rotated image\nvar cropCenter=vectorCreate(center.x*imageSize.width,center.y*imageSize.height);// const imageCenter = sizeCenter(imageSize);\n// const imageCenterToCropCenter = vectorCreate(\n//     imageCenter.x - cropCenter.x,\n//     imageCenter.y - cropCenter.y\n// );\n// get rotated image center\nvar rotatedImageSize=getImageTransformedRect(imageSize,rotation);var rotatedImageCenter=sizeCenter(rotatedImageSize);var rotatedImageOffset=vectorCreate((rotatedImageSize.width-imageSize.width)*0.5,(rotatedImageSize.height-imageSize.height)*0.5);// window.draw(rotatedImageCenter, 'red');\n// window.draw(rotatedImageSize, 'red');\n// window.draw(\n//     {\n//         x: rotatedImageOffset.x,\n//         y: rotatedImageOffset.y,\n//         width: imageSize.width,\n//         height: imageSize.height,\n//     },\n//     'cyan'\n// );\n// const imagePoints = rectRotate(\n//     rectCreate(\n//         rotatedImageOffset.x,\n//         rotatedImageOffset.y,\n//         imageSize.width,\n//         imageSize.height\n//     ),\n//     rotation\n// );\n// window.draw(imagePoints, 'orange');\nvar cropPoints=rectRotate({x:rotatedImageOffset.x+cropCenter.x-canvasSize.width/_scalar3*0.5,y:rotatedImageOffset.y+cropCenter.y-canvasSize.height/_scalar3*0.5,width:canvasSize.width/_scalar3,height:canvasSize.height/_scalar3},rotation);// window.draw(cropPoints, 'cyan');\nvar cropBoundsPoints=vectorsRotate(cropPoints.map(vectorClone),rotation,rotatedImageCenter.x,rotatedImageCenter.y);// window.draw(cropBoundsPoints, 'orange');\nvar cropBoundsPointsCenter=rectCenter(rectCreateFromPoints(cropBoundsPoints));// window.draw(cropBoundsPointsCenter, 'green');\nvar deRotatedCropBoundsPoints=vectorsRotate(cropBoundsPoints.map(vectorClone),-(rotation*2),cropBoundsPointsCenter.x,cropBoundsPointsCenter.y);// window.draw(deRotatedCropBoundsPoints, 'green');\nres.crop=rectCreateFromPoints(deRotatedCropBoundsPoints);}else if(zoom!=null){rectScale(res.crop,1/zoom);}if(!cropLimit){res.cropLimitToImage=false;}return res;};//#endregion\nvar isLegacyData=function isLegacyData(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if('markup'in data||'color'in data||'filter'in data)return true;var crop=data.crop;if(crop&&('flip'in crop||'center'in crop||'aspectRatio'in crop||'rotation'in crop))return true;return false;};var legacyDataToImageState=function legacyDataToImageState(editor,imageSize){var data=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var res={};// test if isn't legacy data\nif(!isLegacyData(data))return data;if(data.crop){Object.assign(res,imagePropertiesFromLegacyCrop(imageSize,data.crop));}if(data.markup){res.decoration=data.markup.map(function(markup){return shapeFromLegacyMarkup(res.crop||imageSize,markup[0],markup[1]);}).sort(function(a,b){if(a.zIndex<b.zIndex)return-1;if(a.zIndex>b.zIndex)return 1;return 0;}).map(function(shape){delete shape.zIndex;return shape;});}if(data.color){res.colorMatrix={brightness:data.color.brightness.matrix,contrast:data.color.contrast.matrix,exposure:data.color.exposure.matrix,saturation:data.color.saturation.matrix};}if(data.filter){if(!res.colorMatrix)res.colorMatrix={};res.colorMatrix.filter=typeof data.filter==='string'&&editor['filterFunctions'][data.filter]?editor['filterFunctions'][data.filter]():data.filter.matrix;}return res;};var isOperaMini=function isOperaMini(){return Object.prototype.toString.call(window['operamini'])==='[object OperaMini]';};var hasPromises=function hasPromises(){return'Promise'in window;};var hasCreateObjectURL=function hasCreateObjectURL(){return'URL'in window&&'createObjectURL'in window.URL;};var hasVisibility=function hasVisibility(){return'visibilityState'in document;};var hasTiming=function hasTiming(){return'performance'in window;};// iOS 8.x\nvar hasFileConstructor=function hasFileConstructor(){return'File'in window;};// excludes IE11\nvar result$a=null;var isModernBrowser=function isModernBrowser(){if(result$a===null)result$a=isBrowser()&&// Can't run on Opera Mini due to lack of everything\n!isOperaMini()&&// Require these APIs to feature detect a modern browser\nhasVisibility()&&hasPromises()&&hasFileConstructor()&&hasCreateObjectURL()&&hasTiming();return result$a;};var toPercentageNumber=function toPercentageNumber(v){return Math.round(v*100);};var brightness={base:0,min:-0.25,max:0.25,getLabel:function getLabel(value){return toPercentageNumber(value/0.25);},getStore:function getStore(_ref166){var imageColorMatrix=_ref166.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.brightness)return;return store.brightness[4];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\nbrightness:[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0]});});}};var contrast={base:1,min:0.5,max:1.5,getLabel:function getLabel(value){return toPercentageNumber(-1+(value-0.5)*2);},getStore:function getStore(_ref167){var imageColorMatrix=_ref167.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.contrast)return;return store.contrast[0];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\ncontrast:[v,0,0,0,.5*(1-v),0,v,0,0,.5*(1-v),0,0,v,0,.5*(1-v),0,0,0,1,0]});});}};var saturation={base:1,min:0,max:2,getLabel:function getLabel(value){return toPercentageNumber(value-1);},getStore:function getStore(_ref168){var imageColorMatrix=_ref168.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.saturation)return;return(store.saturation[0]-0.213)/0.787;},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\nsaturation:[.213+.787*v,.715-.715*v,.072-.072*v,0,0,.213-.213*v,.715+.285*v,.072-.072*v,0,0,.213-.213*v,.715-.715*v,.072+.928*v,0,0,0,0,0,1,0]});});}};var exposure={base:1,min:0.5,max:1.5,getLabel:function getLabel(value){return toPercentageNumber(-1+(value-0.5)*2);},getStore:function getStore(_ref169){var imageColorMatrix=_ref169.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.exposure)return;return store.exposure[0];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\nexposure:[v,0,0,0,0,0,v,0,0,0,0,0,v,0,0,0,0,0,1,0]});});}};var gamma={base:1,min:0.15,max:4,getLabel:function getLabel(value){if(value<1){return toPercentageNumber((value-0.15)/0.85-1);}return toPercentageNumber((value-1)/3);},getStore:function getStore(_ref170){var imageGamma=_ref170.imageGamma;return imageGamma;}};var vignette={base:0,min:-1,max:1,getStore:function getStore(_ref171){var imageVignette=_ref171.imageVignette;return imageVignette;}};var clarity={base:0,min:-1,max:1,getStore:function getStore(_ref172){var imageConvolutionMatrix=_ref172.imageConvolutionMatrix;return imageConvolutionMatrix;},getValue:function getValue(store){if(!store.clarity)return;if(store.clarity[0]===0){return store.clarity[1]/-1;}else{return store.clarity[1]/-2;}},setValue:function setValue(store,v){store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\nclarity:v>=0?[0,-1*v,0,-1*v,1+4*v,-1*v,0,-1*v,0]:[-1*v,-2*v,-1*v,-2*v,1+-3*v,-2*v,-1*v,-2*v,-1*v]});});}};var temperature={base:0,min:-1,max:1,getStore:function getStore(_ref173){var imageColorMatrix=_ref173.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.temperature)return;var v=store.temperature[0];if(v>=1){return(v-1)/0.1;}return(1-v)/-0.15;},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore\ntemperature:v>0?[1+v*.1,0,0,0,0,0,1,0,0,0,0,0,1+-v*.1,0,0,0,0,0,1,0]:[1+v*.15,0,0,0,0,0,1+v*.05,0,0,0,0,0,1+-v*.15,0,0,0,0,0,1,0]});});}};var finetuneControlConfigurationDefault={gamma:gamma,brightness:brightness,contrast:contrast,saturation:saturation,exposure:exposure,temperature:temperature,clarity:clarity,vignette:vignette};var finetuneOptionsDefault=[['brightness',function(locale){return locale.finetuneLabelBrightness;}],['contrast',function(locale){return locale.finetuneLabelContrast;}],['saturation',function(locale){return locale.finetuneLabelSaturation;}],['exposure',function(locale){return locale.finetuneLabelExposure;}],['temperature',function(locale){return locale.finetuneLabelTemperature;}],['gamma',function(locale){return locale.finetuneLabelGamma;}],['clarity',function(locale){return locale.finetuneLabelClarity;}],['vignette',function(locale){return locale.finetuneLabelVignette;}]];var defaults={finetuneControlConfiguration:finetuneControlConfigurationDefault,finetuneOptions:finetuneOptionsDefault};/*\nTODO: fix inverse fn in getValue\nexport const hue = {\n    base: 0,\n    min: 0,\n    max: Math.PI,\n    getStore: ({ imageColorMatrix }) => imageColorMatrix,\n    getValue: (store) => {\n        if (!store.hue) return;\n\n        const v = store.hue[1];\n\n        const o = -(Math.acos((0.715 - v) / Math.sqrt(2) / 0.715) - Math.PI / 4);\n\n        return o;\n    },\n    setValue: (store, v: number) => {\n        store.update((matrices) => {\n            // const value = v * (Math.PI);\n\n            const cos = Math.cos(v);\n            const sin = Math.sin(v);\n\n            const a00 = 0.213 + cos * 0.787 - sin * 0.213;\n            const a01 = 0.715 - cos * 0.715 - sin * 0.715;\n            const a02 = 0.072 - cos * 0.072 + sin * 0.928;\n            const a10 = 0.213 - cos * 0.213 + sin * 0.143;\n            const a11 = 0.715 + cos * 0.285 + sin * 0.14;\n            const a12 = 0.072 - cos * 0.072 - sin * 0.283;\n            const a20 = 0.213 - cos * 0.213 - sin * 0.787;\n            const a21 = 0.715 - cos * 0.715 + sin * 0.715;\n            const a22 = 0.072 + cos * 0.928 + sin * 0.072;\n\n            return {\n                ...matrices,\n\n                // prettier-ignore\n                hue: [\n                    a00, a01, a02, 0, 0,\n                    a10, a11, a12, 0, 0,\n                    a20, a21, a22, 0, 0,\n                      0,   0,   0, 1, 0,\n                ]\n            };\n        });\n    },\n};\n*/var pastel=function pastel(){return(// prettier-ignore\n[0.75,0.25,0.25,0,0,0.25,0.75,0.25,0,0,0.25,0.25,0.75,0,0,0,0,0,1,0]);};var chrome=function chrome(){return(// prettier-ignore\n[1.398,-0.316,0.065,-0.273,0.201,-0.051,1.278,-0.080,-0.273,0.201,-0.051,0.119,1.151,-0.290,0.215,0,0,0,1,0]);};var fade$1=function fade$1(){return(// prettier-ignore\n[1.073,-0.015,0.092,-0.115,-0.017,0.107,0.859,0.184,-0.115,-0.017,0.015,0.077,1.104,-0.115,-0.017,0,0,0,1,0]);};var warm=function warm(){return(// prettier-ignore\n[1.06,0,0,0,0,0,1.01,0,0,0,0,0,0.93,0,0,0,0,0,1,0]);};var cold=function cold(){return(// prettier-ignore\n[1.1,0,0,0,-.1,0,1.1,0,0,-.1,0,0,1.2,0,-.1,0,0,0,1,0]);};var invert=function invert(){return(// prettier-ignore\n[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0]);};var monoDefault=function monoDefault(){return(// prettier-ignore\n[0.212,0.715,0.114,0,0,0.212,0.715,0.114,0,0,0.212,0.715,0.114,0,0,0,0,0,1,0]);};var monoNoir=function monoNoir(){return(// prettier-ignore\n[0.15,1.3,-0.25,0.1,-0.2,0.15,1.3,-0.25,0.1,-0.2,0.15,1.3,-0.25,0.1,-0.2,0,0,0,1,0]);};var monoWash=function monoWash(){return(// prettier-ignore\n[0.163,0.518,0.084,-0.010,0.208,0.163,0.529,0.082,-0.020,0.210,0.171,0.529,0.084,0.000,0.214,0.000,0.000,0.000,1.000,0.000]);};var monoStark=function monoStark(){return(// prettier-ignore\n[0.338,0.991,0.117,0.093,-0.196,0.302,1.049,0.096,0.078,-0.196,0.286,1.016,0.146,0.101,-0.196,0.000,0.000,0.000,1.000,0.000]);};var sepiaDefault=function sepiaDefault(){return(// prettier-ignore\n[0.393,0.768,0.188,0,0,0.349,0.685,0.167,0,0,0.272,0.533,0.130,0,0,0,0,0,1,0]);};var sepiaBlues=function sepiaBlues(){return(// prettier-ignore\n[0.289,0.620,0.185,0.000,0.077,0.257,0.566,0.163,0.000,0.115,0.200,0.430,0.128,0.000,0.188,0.000,0.000,0.000,1.000,0.000]);};var sepiaRust=function sepiaRust(){return(// prettier-ignore\n[0.269,0.764,0.172,0.050,0.100,0.239,0.527,0.152,0.000,0.176,0.186,0.400,0.119,0.000,0.159,0.000,0.000,0.000,1.000,0.000]);};var sepiaColor=function sepiaColor(){return(// prettier-ignore\n[0.547,0.764,0.134,0.000,-0.147,0.281,0.925,0.120,0.000,-0.135,0.225,0.558,0.330,0.000,-0.113,0.000,0.000,0.000,1.000,0.000]);};//\n// default filter set\n//\nvar filterFunctionsDefault={chrome:chrome,fade:fade$1,pastel:pastel,cold:cold,warm:warm,monoDefault:monoDefault,monoWash:monoWash,monoNoir:monoNoir,monoStark:monoStark,sepiaDefault:sepiaDefault,sepiaRust:sepiaRust,sepiaBlues:sepiaBlues,sepiaColor:sepiaColor};var filterOptionsDefault=[['Default',[[undefined,function(locale){return locale.labelDefault;}]]],['Classic',[['chrome',function(locale){return locale.filterLabelChrome;}],['fade',function(locale){return locale.filterLabelFade;}],['cold',function(locale){return locale.filterLabelCold;}],['warm',function(locale){return locale.filterLabelWarm;}],['pastel',function(locale){return locale.filterLabelPastel;}]]],['Monochrome',[['monoDefault',function(locale){return locale.filterLabelMonoDefault;}],['monoNoir',function(locale){return locale.filterLabelMonoNoir;}],['monoStark',function(locale){return locale.filterLabelMonoStark;}],['monoWash',function(locale){return locale.filterLabelMonoWash;}]]],['Sepia',[['sepiaDefault',function(locale){return locale.filterLabelSepiaDefault;}],['sepiaRust',function(locale){return locale.filterLabelSepiaRust;}],['sepiaBlues',function(locale){return locale.filterLabelSepiaBlues;}],['sepiaColor',function(locale){return locale.filterLabelSepiaColor;}]]]];var defaults$1={filterFunctions:filterFunctionsDefault,filterOptions:filterOptionsDefault};// if this is a non retina display snap to pixel\nvar fn=null;var snapToPixel=function snapToPixel(v){if(fn===null)fn=getDevicePixelRatio()===1?function(v){return Math.round(v);}:function(v){return v;};return fn(v);};/* src/core/ui/components/Details.svelte generated by Svelte v3.29.4 */var get_details_slot_changes=function get_details_slot_changes(dirty){return{};};var get_details_slot_context=function get_details_slot_context(ctx){return{};};var get_label_slot_changes=function get_label_slot_changes(dirty){return{};};var get_label_slot_context=function get_label_slot_context(ctx){return{};};// (167:0) <Button bind:this={buttonComponent}      class={arrayJoin(['DokaDetailsButton', buttonClass])}      onkeydown={handleButtonKeydown}      onclick={handleClick}>\nfunction create_default_slot$2(ctx){var current;var label_slot_template=/*#slots*/ctx[19].label;var label_slot=create_slot(label_slot_template,ctx,/*$$scope*/ctx[23],get_label_slot_context);return{c:function c(){if(label_slot)label_slot.c();},m:function m(target,anchor){if(label_slot){label_slot.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(label_slot){if(label_slot.p&&dirty[0]&/*$$scope*/8388608){update_slot(label_slot,label_slot_template,ctx,/*$$scope*/ctx[23],dirty,get_label_slot_changes,get_label_slot_context);}}},i:function i(local){if(current)return;transition_in(label_slot,local);current=true;},o:function o(local){transition_out(label_slot,local);current=false;},d:function d(detaching){if(label_slot)label_slot.d(detaching);}};}// (174:0) {#if isVisible}\nfunction create_if_block_1$2(ctx){var div;var div_class_value;var measure_action;var current;var mounted;var dispose;var details_slot_template=/*#slots*/ctx[19].details;var details_slot=create_slot(details_slot_template,ctx,/*$$scope*/ctx[23],get_details_slot_context);return{c:function c(){div=element(\"div\");if(details_slot)details_slot.c();attr(div,\"class\",div_class_value=arrayJoin([\"DokaDetailsPanel\",/*panelClass*/ctx[1]]));attr(div,\"tabindex\",\"-1\");attr(div,\"style\",/*style*/ctx[6]);},m:function m(target,anchor){insert(target,div,anchor);if(details_slot){details_slot.m(div,null);}/*div_binding*/ctx[21](div);current=true;if(!mounted){dispose=[listen(div,\"keydown\",/*handlePanelKeydown*/ctx[16]),listen(div,\"measure\",/*measure_handler*/ctx[22]),action_destroyer(measure_action=measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){if(details_slot){if(details_slot.p&&dirty[0]&/*$$scope*/8388608){update_slot(details_slot,details_slot_template,ctx,/*$$scope*/ctx[23],dirty,get_details_slot_changes,get_details_slot_context);}}if(!current||dirty[0]&/*panelClass*/2&&div_class_value!==(div_class_value=arrayJoin([\"DokaDetailsPanel\",/*panelClass*/ctx[1]]))){attr(div,\"class\",div_class_value);}if(!current||dirty[0]&/*style*/64){attr(div,\"style\",/*style*/ctx[6]);}},i:function i(local){if(current)return;transition_in(details_slot,local);current=true;},o:function o(local){transition_out(details_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(details_slot)details_slot.d(detaching);/*div_binding*/ctx[21](null);mounted=false;run_all(dispose);}};}function create_fragment$d(ctx){var t0;var button;var t1;var t2;var if_block1_anchor;var current;var mounted;var dispose;var button_props={\"class\":arrayJoin([\"DokaDetailsButton\",/*buttonClass*/ctx[0]]),onkeydown:/*handleButtonKeydown*/ctx[15],onclick:/*handleClick*/ctx[14],$$slots:{\"default\":[create_default_slot$2]},$$scope:{ctx:ctx}};button=new Button({props:button_props});/*button_binding*/ctx[20](button);var if_block0=/*isVisible*/ctx[5]&&create_if_block_1$2(ctx);var if_block1=false;return{c:function c(){t0=space();create_component(button.$$.fragment);t1=space();if(if_block0)if_block0.c();t2=space();if_block1_anchor=empty();},m:function m(target,anchor){insert(target,t0,anchor);mount_component(button,target,anchor);insert(target,t1,anchor);if(if_block0)if_block0.m(target,anchor);insert(target,t2,anchor);insert(target,if_block1_anchor,anchor);current=true;if(!mounted){dispose=[listen(document.body,\"pointerdown\",function(){if(is_function(/*handleDown*/ctx[7]))/*handleDown*/ctx[7].apply(this,arguments);}),listen(document.body,\"pointerup\",function(){if(is_function(/*handleUp*/ctx[8]))/*handleUp*/ctx[8].apply(this,arguments);})];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var button_changes={};if(dirty[0]&/*buttonClass*/1)button_changes[\"class\"]=arrayJoin([\"DokaDetailsButton\",/*buttonClass*/ctx[0]]);if(dirty[0]&/*$$scope*/8388608){button_changes.$$scope={dirty:dirty,ctx:ctx};}button.$set(button_changes);if(/*isVisible*/ctx[5]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*isVisible*/32){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t2.parentNode,t2);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(button.$$.fragment,local);transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(detaching)detach(t0);/*button_binding*/ctx[20](null);destroy_component(button,detaching);if(detaching)detach(t1);if(if_block0)if_block0.d(detaching);if(detaching)detach(t2);if(detaching)detach(if_block1_anchor);mounted=false;run_all(dispose);}};}var panelMargin=12;function instance$d($$self,$$props,$$invalidate){var $portalRootRect;var $position;var $opacity;var $offset;var $portal;var _$$props$$$slots6=$$props.$$slots,slots=_$$props$$$slots6===void 0?{}:_$$props$$$slots6,$$scope=$$props.$$scope;var _$$props$buttonClass=$$props.buttonClass,buttonClass=_$$props$buttonClass===void 0?undefined:_$$props$buttonClass;var _$$props$panelClass2=$$props.panelClass,panelClass=_$$props$panelClass2===void 0?undefined:_$$props$panelClass2;var _$$props$isActive2=$$props.isActive,isActive=_$$props$isActive2===void 0?false:_$$props$isActive2;var _$$props$onshow=$$props.onshow,onshow=_$$props$onshow===void 0?function(_ref174){var panel=_ref174.panel;return panel.focus();}:_$$props$onshow;var portal=getContext(\"rootPortal\");component_subscribe($$self,portal,function(value){return $$invalidate(35,$portal=value);});var portalRootRect=getContext(\"rootRect\");component_subscribe($$self,portalRootRect,function(value){return $$invalidate(29,$portalRootRect=value);});var panelSize;var buttonComponent;var buttonRect;var dir=vectorCreateEmpty();var opacity=spring(0);component_subscribe($$self,opacity,function(value){return $$invalidate(31,$opacity=value);});var position=writable({x:0,y:0});component_subscribe($$self,position,function(value){return $$invalidate(30,$position=value);});var offset=spring(-5);component_subscribe($$self,offset,function(value){return $$invalidate(34,$offset=value);});var isTargetSelf=function isTargetSelf(e){return isEventTarget(e,$portal)||buttonComponent.isEventTarget(e);};var downOutsidePanel=false;// move detail panel to portal\nvar detailPanel;var trigger;// test keydown press to open\nvar handleClick=function handleClick(e){if(!isActive)$$invalidate(24,buttonRect=buttonElement.getBoundingClientRect());$$invalidate(27,trigger=e);$$invalidate(17,isActive=!isActive);};var handleButtonKeydown=function handleButtonKeydown(e){if(!/down/i.test(e.key))return;$$invalidate(17,isActive=true);$$invalidate(27,trigger=e);};var handlePanelKeydown=function handlePanelKeydown(e){if(!/esc/i.test(e.key))return;$$invalidate(17,isActive=false);buttonElement.focus();};// clean up panel if it was appended to a portal\nonDestroy(function(){if(!$portal||!detailPanel)return;$portal.removeChild(detailPanel);});function button_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){buttonComponent=$$value;$$invalidate(3,buttonComponent);});}function div_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){detailPanel=$$value;$$invalidate(4,detailPanel);});}var measure_handler=function measure_handler(e){return $$invalidate(2,panelSize=sizeCreateFromAny(e.detail));};$$self.$$set=function($$props){if(\"buttonClass\"in $$props)$$invalidate(0,buttonClass=$$props.buttonClass);if(\"panelClass\"in $$props)$$invalidate(1,panelClass=$$props.panelClass);if(\"isActive\"in $$props)$$invalidate(17,isActive=$$props.isActive);if(\"onshow\"in $$props)$$invalidate(18,onshow=$$props.onshow);if(\"$$scope\"in $$props)$$invalidate(23,$$scope=$$props.$$scope);};var buttonElement;var isVisible;var isAnimating;var transform;var style;var handleDown;var handleUp;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*buttonComponent*/8){buttonElement=buttonComponent&&buttonComponent.getElement();}if($$self.$$.dirty[0]&/*isActive, downOutsidePanel*/67239936){$$invalidate(8,handleUp=isActive?function(e){if(!downOutsidePanel)return;$$invalidate(26,downOutsidePanel=false);if(isTargetSelf(e))return;$$invalidate(17,isActive=false);}:undefined);}if($$self.$$.dirty[0]&/*isActive*/131072){opacity.set(isActive?1:0);}if($$self.$$.dirty[0]&/*isActive*/131072){offset.set(isActive?0:-5);}if($$self.$$.dirty[0]&/*$portalRootRect, panelSize, buttonRect*/553648132){if($portalRootRect&&panelSize&&buttonRect){// as a starting point we'll align panel to center of button and position below\nvar _x57=buttonRect.x-$portalRootRect.x+buttonRect.width*0.5-panelSize.width*0.5;var _y3=buttonRect.y-$portalRootRect.y+buttonRect.height;var parentLeft=panelMargin;var parentTop=panelMargin;var parentRight=$portalRootRect.width-panelMargin;var parentBottom=$portalRootRect.height-panelMargin;var panelLeft=_x57;var panelTop=_y3;var panelRight=panelLeft+panelSize.width;var panelBottom=panelTop+panelSize.height;// move to right\nif(panelLeft<parentLeft){_x57=parentLeft;}// move to left\nif(panelRight>parentRight){_x57=parentRight-panelSize.width;}if(panelBottom>parentBottom){// doesn't fit vertically, push up\n$$invalidate(25,dir.y=-1,dir);var positionedAboveButtonY=_y3-panelSize.height-buttonRect.height;var panelFitsAboveButton=parentTop<positionedAboveButtonY;if(panelFitsAboveButton){_y3-=panelSize.height+buttonRect.height;}else{// overlap with button\n_y3-=panelBottom-parentBottom;}}else{// all is fine\n$$invalidate(25,dir.y=1,dir);}set_store_value(position,$position=vectorApply(vectorCreate(_x57,_y3),snapToPixel),$position);}}if($$self.$$.dirty[1]&/*$opacity*/1){$$invalidate(5,isVisible=$opacity>0);}if($$self.$$.dirty[1]&/*$opacity*/1){$$invalidate(32,isAnimating=$opacity<1);}if($$self.$$.dirty[0]&/*$position, dir*/1107296256|$$self.$$.dirty[1]&/*$offset*/8){$$invalidate(33,transform=\"translateX(\".concat($position.x+dir.x*panelMargin,\"px) translateY(\").concat($position.y+dir.y*panelMargin+dir.y*$offset,\"px)\"));}if($$self.$$.dirty[1]&/*isAnimating, $opacity, transform*/7){$$invalidate(6,style=isAnimating?\"opacity: \".concat($opacity,\"; pointer-events: \").concat($opacity<1?\"none\":\"all\",\"; transform: \").concat(transform,\";\"):\"transform: \".concat(transform));}if($$self.$$.dirty[0]&/*isActive*/131072){$$invalidate(7,handleDown=isActive?function(e){if(isTargetSelf(e))return;$$invalidate(26,downOutsidePanel=true);}:undefined);}if($$self.$$.dirty[0]&/*isVisible, detailPanel*/48|$$self.$$.dirty[1]&/*$portal*/16){if(isVisible&&$portal&&detailPanel&&detailPanel.parentNode!==$portal)$portal.appendChild(detailPanel);}if($$self.$$.dirty[0]&/*isActive*/131072){if(!isActive)$$invalidate(27,trigger=undefined);}if($$self.$$.dirty[0]&/*isVisible, detailPanel, onshow, trigger*/134479920){if(isVisible&&detailPanel)onshow({e:trigger,panel:detailPanel});}};return[buttonClass,panelClass,panelSize,buttonComponent,detailPanel,isVisible,style,handleDown,handleUp,portal,portalRootRect,opacity,position,offset,handleClick,handleButtonKeydown,handlePanelKeydown,isActive,onshow,slots,button_binding,div_binding,measure_handler,$$scope];}var Details=/*#__PURE__*/function(_SvelteComponent14){_inherits(Details,_SvelteComponent14);var _super16=_createSuper(Details);function Details(options){var _this16;_classCallCheck(this,Details);_this16=_super16.call(this);init(_assertThisInitialized(_this16),options,instance$d,create_fragment$d,safe_not_equal,{buttonClass:0,panelClass:1,isActive:17,onshow:18},[-1,-1]);return _this16;}return Details;}(SvelteComponent);/* src/core/ui/components/RadioItem.svelte generated by Svelte v3.29.4 */function create_fragment$e(ctx){var li;var input;var t;var label_1;var li_class_value;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[14][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[13],null);return{c:function c(){li=element(\"li\");input=element(\"input\");t=space();label_1=element(\"label\");if(default_slot)default_slot.c();attr(input,\"type\",\"radio\");attr(input,\"class\",\"implicit\");attr(input,\"id\",/*inputId*/ctx[6]);attr(input,\"name\",/*name*/ctx[0]);input.value=/*value*/ctx[3];input.disabled=/*disabled*/ctx[5];input.checked=/*checked*/ctx[4];attr(label_1,\"for\",/*inputId*/ctx[6]);attr(label_1,\"title\",/*label*/ctx[2]);attr(li,\"class\",li_class_value=arrayJoin([\"DokaRadioGroupOption\",/*klass*/ctx[1]]));attr(li,\"data-disabled\",/*disabled*/ctx[5]);attr(li,\"data-selected\",/*checked*/ctx[4]);},m:function m(target,anchor){insert(target,li,anchor);append(li,input);append(li,t);append(li,label_1);if(default_slot){default_slot.m(label_1,null);}current=true;if(!mounted){dispose=[listen(input,\"change\",stop_propagation(/*change_handler*/ctx[15])),listen(input,\"keydown\",/*handleKeydown*/ctx[8]),listen(input,\"click\",/*handleClick*/ctx[9])];mounted=true;}},p:function p(ctx,_ref175){var _ref176=_slicedToArray(_ref175,1),dirty=_ref176[0];if(!current||dirty&/*inputId*/64){attr(input,\"id\",/*inputId*/ctx[6]);}if(!current||dirty&/*name*/1){attr(input,\"name\",/*name*/ctx[0]);}if(!current||dirty&/*value*/8){input.value=/*value*/ctx[3];}if(!current||dirty&/*disabled*/32){input.disabled=/*disabled*/ctx[5];}if(!current||dirty&/*checked*/16){input.checked=/*checked*/ctx[4];}if(default_slot){if(default_slot.p&&dirty&/*$$scope*/8192){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[13],dirty,null,null);}}if(!current||dirty&/*inputId*/64){attr(label_1,\"for\",/*inputId*/ctx[6]);}if(!current||dirty&/*label*/4){attr(label_1,\"title\",/*label*/ctx[2]);}if(!current||dirty&/*klass*/2&&li_class_value!==(li_class_value=arrayJoin([\"DokaRadioGroupOption\",/*klass*/ctx[1]]))){attr(li,\"class\",li_class_value);}if(!current||dirty&/*disabled*/32){attr(li,\"data-disabled\",/*disabled*/ctx[5]);}if(!current||dirty&/*checked*/16){attr(li,\"data-selected\",/*checked*/ctx[4]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$e($$self,$$props,$$invalidate){var $keysPressedStored;var _$$props$$$slots7=$$props.$$slots,slots=_$$props$$$slots7===void 0?{}:_$$props$$$slots7,$$scope=$$props.$$scope;var name=$$props.name;var _$$props$class8=$$props[\"class\"],klass=_$$props$class8===void 0?undefined:_$$props$class8;var label=$$props.label;var id=$$props.id;var value=$$props.value;var checked=$$props.checked;var onkeydown=$$props.onkeydown;var onclick=$$props.onclick;var _$$props$disabled2=$$props.disabled,disabled=_$$props$disabled2===void 0?false:_$$props$disabled2;var keysPressedStored=getContext(\"keysPressed\");component_subscribe($$self,keysPressedStored,function(value){return $$invalidate(16,$keysPressedStored=value);});var handleKeydown=function handleKeydown(e){onkeydown(e);};var handleClick=function handleClick(e){if($keysPressedStored.length)return;onclick(e);};function change_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"name\"in $$props)$$invalidate(0,name=$$props.name);if(\"class\"in $$props)$$invalidate(1,klass=$$props[\"class\"]);if(\"label\"in $$props)$$invalidate(2,label=$$props.label);if(\"id\"in $$props)$$invalidate(10,id=$$props.id);if(\"value\"in $$props)$$invalidate(3,value=$$props.value);if(\"checked\"in $$props)$$invalidate(4,checked=$$props.checked);if(\"onkeydown\"in $$props)$$invalidate(11,onkeydown=$$props.onkeydown);if(\"onclick\"in $$props)$$invalidate(12,onclick=$$props.onclick);if(\"disabled\"in $$props)$$invalidate(5,disabled=$$props.disabled);if(\"$$scope\"in $$props)$$invalidate(13,$$scope=$$props.$$scope);};var inputId;$$self.$$.update=function(){if($$self.$$.dirty&/*name, id*/1025){$$invalidate(6,inputId=\"\".concat(name,\"-\").concat(id));}};return[name,klass,label,value,checked,disabled,inputId,keysPressedStored,handleKeydown,handleClick,id,onkeydown,onclick,$$scope,slots,change_handler];}var RadioItem=/*#__PURE__*/function(_SvelteComponent15){_inherits(RadioItem,_SvelteComponent15);var _super17=_createSuper(RadioItem);function RadioItem(options){var _this17;_classCallCheck(this,RadioItem);_this17=_super17.call(this);init(_assertThisInitialized(_this17),options,instance$e,create_fragment$e,safe_not_equal,{name:0,\"class\":1,label:2,id:10,value:3,checked:4,onkeydown:11,onclick:12,disabled:5});return _this17;}return RadioItem;}(SvelteComponent);var flattenOptions=function flattenOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return options.reduce(function(prev,current){var isGroup=isArray(current)?isArray(current[1]):!!current.options;if(isGroup){return prev.concat(isArray(current)?current[1]:current.options);}prev.push(current);return prev;},[]);};var mapOption=function mapOption(option,index,optionMapper){var mappedOption;if(isArray(option)){mappedOption=_objectSpread({id:index,value:option[0],label:option[1]},option[2]||{});}else{mappedOption=option;mappedOption.id=mappedOption.id!=null?mappedOption.id:index;}return optionMapper?optionMapper(mappedOption):mappedOption;};var mapOptions=function mapOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var optionMapper=arguments.length>1?arguments[1]:undefined;var index=0;return options.map(function(option){index++;if(isArray(option)){// is either [label, options] or [value, label]\nif(isArray(option[1])){return{id:index,label:option[0],options:option[1].map(function(option){return mapOption(option,++index,optionMapper);})};}return mapOption(option,index,optionMapper);}else{// is either { id?, label, options } or { id?, value, label }\nif(option.options){return{id:option.id||index,label:option.label,options:option.options.map(function(option){return mapOption(option,++index,optionMapper);})};}return mapOption(option,index,optionMapper);}});};var opop=function opop(fn){for(var _len11=arguments.length,args=new Array(_len11>1?_len11-1:0),_key14=1;_key14<_len11;_key14++){args[_key14-1]=arguments[_key14];}return fn&&fn.apply(void 0,args);};var localize=function localize(prop,locale,params){return isFunction(prop)?prop(locale,params):prop;};var localizeOptions=function localizeOptions(options,locale){return options.map(function(_ref177){var _ref178=_slicedToArray(_ref177,3),value=_ref178[0],label=_ref178[1],props=_ref178[2];if(isArray(label)){return[localize(value,locale),localizeOptions(label,locale)];}else{var res=[value,localize(label,locale)];if(props){var obj=_objectSpread({},props);if(props.icon)obj.icon=localize(props.icon,locale);res.push(obj);}return res;}});};var localizeOptions$1=function localizeOptions$1(options,locale){return localizeOptions(options,locale);};/* src/core/ui/components/RadioGroup.svelte generated by Svelte v3.29.4 */var get_option_slot_changes_1=function get_option_slot_changes_1(dirty){return{option:dirty[0]&/*mappedOptions*/2048};};var get_option_slot_context_1=function get_option_slot_context_1(ctx){return{option:/*option*/ctx[27]};};var get_option_slot_changes=function get_option_slot_changes(dirty){return{option:dirty[0]&/*mappedOptions*/2048};};var get_option_slot_context=function get_option_slot_context(ctx){return{option:/*option*/ctx[27]};};function get_each_context_1(ctx,list,i){var child_ctx=ctx.slice();child_ctx[27]=list[i];return child_ctx;}var get_group_slot_changes=function get_group_slot_changes(dirty){return{option:dirty[0]&/*mappedOptions*/2048};};var get_group_slot_context=function get_group_slot_context(ctx){return{option:/*option*/ctx[27]};};function get_each_context$3(ctx,list,i){var child_ctx=ctx.slice();child_ctx[27]=list[i];return child_ctx;}// (83:0) {#if localizedOptions.length}\nfunction create_if_block_1$3(ctx){var fieldset;var t;var ul;var each_blocks=[];var each_1_lookup=new Map();var fieldset_class_value;var current;var if_block=/*label*/ctx[1]&&create_if_block_7$1(ctx);var each_value=/*mappedOptions*/ctx[11];var get_key=function get_key(ctx){return(/*option*/ctx[27].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$3(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$3(key,child_ctx));}return{c:function c(){fieldset=element(\"fieldset\");if(if_block)if_block.c();t=space();ul=element(\"ul\");for(var _i18=0;_i18<each_blocks.length;_i18+=1){each_blocks[_i18].c();}attr(ul,\"class\",\"DokaRadioGroupOptions\");attr(fieldset,\"class\",fieldset_class_value=arrayJoin([\"DokaRadioGroup\",/*klass*/ctx[3]]));attr(fieldset,\"data-layout\",/*layout*/ctx[5]);attr(fieldset,\"title\",/*title*/ctx[7]);},m:function m(target,anchor){insert(target,fieldset,anchor);if(if_block)if_block.m(fieldset,null);append(fieldset,t);append(fieldset,ul);for(var _i19=0;_i19<each_blocks.length;_i19+=1){each_blocks[_i19].m(ul,null);}current=true;},p:function p(ctx,dirty){if(/*label*/ctx[1]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_7$1(ctx);if_block.c();if_block.m(fieldset,t);}}else if(if_block){if_block.d(1);if_block=null;}if(dirty[0]&/*optionGroupClass, mappedOptions, name, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/4225873){var _each_value4=/*mappedOptions*/ctx[11];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value4,each_1_lookup,ul,outro_and_destroy_block,create_each_block$3,null,get_each_context$3);check_outros();}if(!current||dirty[0]&/*klass*/8&&fieldset_class_value!==(fieldset_class_value=arrayJoin([\"DokaRadioGroup\",/*klass*/ctx[3]]))){attr(fieldset,\"class\",fieldset_class_value);}if(!current||dirty[0]&/*layout*/32){attr(fieldset,\"data-layout\",/*layout*/ctx[5]);}if(!current||dirty[0]&/*title*/128){attr(fieldset,\"title\",/*title*/ctx[7]);}},i:function i(local){if(current)return;for(var _i20=0;_i20<each_value.length;_i20+=1){transition_in(each_blocks[_i20]);}current=true;},o:function o(local){for(var _i21=0;_i21<each_blocks.length;_i21+=1){transition_out(each_blocks[_i21]);}current=false;},d:function d(detaching){if(detaching)detach(fieldset);if(if_block)if_block.d();for(var _i22=0;_i22<each_blocks.length;_i22+=1){each_blocks[_i22].d();}}};}// (85:4) {#if label}\nfunction create_if_block_7$1(ctx){var legend;var t;var legend_class_value;return{c:function c(){legend=element(\"legend\");t=text(/*label*/ctx[1]);attr(legend,\"class\",legend_class_value=/*hideLabel*/ctx[2]&&\"implicit\");},m:function m(target,anchor){insert(target,legend,anchor);append(legend,t);},p:function p(ctx,dirty){if(dirty[0]&/*label*/2)set_data(t,/*label*/ctx[1]);if(dirty[0]&/*hideLabel*/4&&legend_class_value!==(legend_class_value=/*hideLabel*/ctx[2]&&\"implicit\")){attr(legend,\"class\",legend_class_value);}},d:function d(detaching){if(detaching)detach(legend);}};}// (115:8) {:else}\nfunction create_else_block$2(ctx){var radioitem;var current;radioitem=new RadioItem({props:{name:/*name*/ctx[4],label:/*option*/ctx[27].label,id:/*option*/ctx[27].id,value:/*option*/ctx[27].value,disabled:/*option*/ctx[27].disabled,\"class\":/*optionClass*/ctx[8],checked:/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0],onkeydown:/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]),onclick:/*handleRadioClick*/ctx[14](/*option*/ctx[27]),$$slots:{\"default\":[create_default_slot_2$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radioitem.$$.fragment);},m:function m(target,anchor){mount_component(radioitem,target,anchor);current=true;},p:function p(ctx,dirty){var radioitem_changes={};if(dirty[0]&/*name*/16)radioitem_changes.name=/*name*/ctx[4];if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.label=/*option*/ctx[27].label;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.id=/*option*/ctx[27].id;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.value=/*option*/ctx[27].value;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.disabled=/*option*/ctx[27].disabled;if(dirty[0]&/*optionClass*/256)radioitem_changes[\"class\"]=/*optionClass*/ctx[8];if(dirty[0]&/*mappedOptions, selectedIndex*/2049)radioitem_changes.checked=/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0];if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.onkeydown=/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]);if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.onclick=/*handleRadioClick*/ctx[14](/*option*/ctx[27]);if(dirty[0]&/*$$scope, optionLabelClass, mappedOptions*/4196416){radioitem_changes.$$scope={dirty:dirty,ctx:ctx};}radioitem.$set(radioitem_changes);},i:function i(local){if(current)return;transition_in(radioitem.$$.fragment,local);current=true;},o:function o(local){transition_out(radioitem.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radioitem,detaching);}};}// (90:8) {#if option.options}\nfunction create_if_block_2$1(ctx){var li;var t0;var ul;var each_blocks=[];var each_1_lookup=new Map();var t1;var li_class_value;var current;var group_slot_template=/*#slots*/ctx[21].group;var group_slot=create_slot(group_slot_template,ctx,/*$$scope*/ctx[22],get_group_slot_context);var group_slot_or_fallback=group_slot||fallback_block_1(ctx);var each_value_1=/*option*/ctx[27].options;var get_key=function get_key(ctx){return(/*option*/ctx[27].id);};for(var i=0;i<each_value_1.length;i+=1){var child_ctx=get_each_context_1(ctx,each_value_1,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block_1(key,child_ctx));}return{c:function c(){li=element(\"li\");if(group_slot_or_fallback)group_slot_or_fallback.c();t0=space();ul=element(\"ul\");for(var _i23=0;_i23<each_blocks.length;_i23+=1){each_blocks[_i23].c();}t1=space();attr(ul,\"class\",\"DokaRadioGroupOptions\");attr(li,\"class\",li_class_value=arrayJoin([\"DokaRadioGroupOptionGroup\",/*optionGroupClass*/ctx[9]]));},m:function m(target,anchor){insert(target,li,anchor);if(group_slot_or_fallback){group_slot_or_fallback.m(li,null);}append(li,t0);append(li,ul);for(var _i24=0;_i24<each_blocks.length;_i24+=1){each_blocks[_i24].m(ul,null);}append(li,t1);current=true;},p:function p(ctx,dirty){if(group_slot){if(group_slot.p&&dirty[0]&/*$$scope, mappedOptions*/4196352){update_slot(group_slot,group_slot_template,ctx,/*$$scope*/ctx[22],dirty,get_group_slot_changes,get_group_slot_context);}}else{if(group_slot_or_fallback&&group_slot_or_fallback.p&&dirty[0]&/*mappedOptions*/2048){group_slot_or_fallback.p(ctx,dirty);}}if(dirty[0]&/*name, mappedOptions, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/4225361){var _each_value_=/*option*/ctx[27].options;group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value_,each_1_lookup,ul,outro_and_destroy_block,create_each_block_1,null,get_each_context_1);check_outros();}if(!current||dirty[0]&/*optionGroupClass*/512&&li_class_value!==(li_class_value=arrayJoin([\"DokaRadioGroupOptionGroup\",/*optionGroupClass*/ctx[9]]))){attr(li,\"class\",li_class_value);}},i:function i(local){if(current)return;transition_in(group_slot_or_fallback,local);for(var _i25=0;_i25<each_value_1.length;_i25+=1){transition_in(each_blocks[_i25]);}current=true;},o:function o(local){transition_out(group_slot_or_fallback,local);for(var _i26=0;_i26<each_blocks.length;_i26+=1){transition_out(each_blocks[_i26]);}current=false;},d:function d(detaching){if(detaching)detach(li);if(group_slot_or_fallback)group_slot_or_fallback.d(detaching);for(var _i27=0;_i27<each_blocks.length;_i27+=1){each_blocks[_i27].d();}}};}// (126:16) {#if option.icon}\nfunction create_if_block_6$1(ctx){var icon;var current;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_3$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*$$scope, mappedOptions*/4196352){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (127:16) <Icon>\nfunction create_default_slot_3$1(ctx){var g;var raw_value=/*option*/ctx[27].icon+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/2048&&raw_value!==(raw_value=/*option*/ctx[27].icon+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (129:16) {#if !option.hideLabel}\nfunction create_if_block_5$1(ctx){var span;var t_value=/*option*/ctx[27].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"class\",/*optionLabelClass*/ctx[6]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/2048&&t_value!==(t_value=/*option*/ctx[27].label+\"\"))set_data(t,t_value);if(dirty[0]&/*optionLabelClass*/64){attr(span,\"class\",/*optionLabelClass*/ctx[6]);}},d:function d(detaching){if(detaching)detach(span);}};}// (125:76)                  \nfunction fallback_block_2(ctx){var t0;var t1;var current;var if_block0=/*option*/ctx[27].icon&&create_if_block_6$1(ctx);var if_block1=!/*option*/ctx[27].hideLabel&&create_if_block_5$1(ctx);return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[27].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*mappedOptions*/2048){transition_in(if_block0,1);}}else{if_block0=create_if_block_6$1(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*option*/ctx[27].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_5$1(ctx);if_block1.c();if_block1.m(t1.parentNode,t1);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);}};}// (116:8) <RadioItem              {name}              label={option.label}             id={option.id}             value={option.value}             disabled={option.disabled}             class={optionClass}             checked={getOptionIndex(option) === selectedIndex}             onkeydown={handleRadioKeydown(option)}             onclick={handleRadioClick(option)}>\nfunction create_default_slot_2$1(ctx){var current;var option_slot_template=/*#slots*/ctx[21].option;var option_slot=create_slot(option_slot_template,ctx,/*$$scope*/ctx[22],get_option_slot_context_1);var option_slot_or_fallback=option_slot||fallback_block_2(ctx);return{c:function c(){if(option_slot_or_fallback)option_slot_or_fallback.c();},m:function m(target,anchor){if(option_slot_or_fallback){option_slot_or_fallback.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(option_slot){if(option_slot.p&&dirty[0]&/*$$scope, mappedOptions*/4196352){update_slot(option_slot,option_slot_template,ctx,/*$$scope*/ctx[22],dirty,get_option_slot_changes_1,get_option_slot_context_1);}}else{if(option_slot_or_fallback&&option_slot_or_fallback.p&&dirty[0]&/*optionLabelClass, mappedOptions*/2112){option_slot_or_fallback.p(ctx,dirty);}}},i:function i(local){if(current)return;transition_in(option_slot_or_fallback,local);current=true;},o:function o(local){transition_out(option_slot_or_fallback,local);current=false;},d:function d(detaching){if(option_slot_or_fallback)option_slot_or_fallback.d(detaching);}};}// (92:47) <span class=\"DokaRadioGroupOptionGroupLabel\">\nfunction fallback_block_1(ctx){var span;var t_value=/*option*/ctx[27].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"class\",\"DokaRadioGroupOptionGroupLabel\");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/2048&&t_value!==(t_value=/*option*/ctx[27].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (105:24) {#if option.icon}\nfunction create_if_block_4$1(ctx){var icon;var current;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_1$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*$$scope, mappedOptions*/4196352){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (106:24) <Icon>\nfunction create_default_slot_1$1(ctx){var g;var raw_value=/*option*/ctx[27].icon+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/2048&&raw_value!==(raw_value=/*option*/ctx[27].icon+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (108:24) {#if !option.hideLabel}\nfunction create_if_block_3$1(ctx){var span;var t_value=/*option*/ctx[27].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"class\",/*optionLabelClass*/ctx[6]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/2048&&t_value!==(t_value=/*option*/ctx[27].label+\"\"))set_data(t,t_value);if(dirty[0]&/*optionLabelClass*/64){attr(span,\"class\",/*optionLabelClass*/ctx[6]);}},d:function d(detaching){if(detaching)detach(span);}};}// (104:84)                          \nfunction fallback_block$1(ctx){var t0;var t1;var current;var if_block0=/*option*/ctx[27].icon&&create_if_block_4$1(ctx);var if_block1=!/*option*/ctx[27].hideLabel&&create_if_block_3$1(ctx);return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[27].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*mappedOptions*/2048){transition_in(if_block0,1);}}else{if_block0=create_if_block_4$1(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*option*/ctx[27].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_3$1(ctx);if_block1.c();if_block1.m(t1.parentNode,t1);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);}};}// (95:16) <RadioItem                      {name}                      label={option.label}                     id={option.id}                     value={option.value}                     disabled={option.disabled}                     class={optionClass}                     checked={getOptionIndex(option) === selectedIndex}                     onkeydown={handleRadioKeydown(option)}                     onclick={handleRadioClick(option)}>\nfunction create_default_slot$3(ctx){var current;var option_slot_template=/*#slots*/ctx[21].option;var option_slot=create_slot(option_slot_template,ctx,/*$$scope*/ctx[22],get_option_slot_context);var option_slot_or_fallback=option_slot||fallback_block$1(ctx);return{c:function c(){if(option_slot_or_fallback)option_slot_or_fallback.c();},m:function m(target,anchor){if(option_slot_or_fallback){option_slot_or_fallback.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(option_slot){if(option_slot.p&&dirty[0]&/*$$scope, mappedOptions*/4196352){update_slot(option_slot,option_slot_template,ctx,/*$$scope*/ctx[22],dirty,get_option_slot_changes,get_option_slot_context);}}else{if(option_slot_or_fallback&&option_slot_or_fallback.p&&dirty[0]&/*optionLabelClass, mappedOptions*/2112){option_slot_or_fallback.p(ctx,dirty);}}},i:function i(local){if(current)return;transition_in(option_slot_or_fallback,local);current=true;},o:function o(local){transition_out(option_slot_or_fallback,local);current=false;},d:function d(detaching){if(option_slot_or_fallback)option_slot_or_fallback.d(detaching);}};}// (94:16) {#each option.options as option (option.id) }\nfunction create_each_block_1(key_1,ctx){var first;var radioitem;var current;radioitem=new RadioItem({props:{name:/*name*/ctx[4],label:/*option*/ctx[27].label,id:/*option*/ctx[27].id,value:/*option*/ctx[27].value,disabled:/*option*/ctx[27].disabled,\"class\":/*optionClass*/ctx[8],checked:/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0],onkeydown:/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]),onclick:/*handleRadioClick*/ctx[14](/*option*/ctx[27]),$$slots:{\"default\":[create_default_slot$3]},$$scope:{ctx:ctx}}});return{key:key_1,first:null,c:function c(){first=empty();create_component(radioitem.$$.fragment);this.first=first;},m:function m(target,anchor){insert(target,first,anchor);mount_component(radioitem,target,anchor);current=true;},p:function p(ctx,dirty){var radioitem_changes={};if(dirty[0]&/*name*/16)radioitem_changes.name=/*name*/ctx[4];if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.label=/*option*/ctx[27].label;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.id=/*option*/ctx[27].id;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.value=/*option*/ctx[27].value;if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.disabled=/*option*/ctx[27].disabled;if(dirty[0]&/*optionClass*/256)radioitem_changes[\"class\"]=/*optionClass*/ctx[8];if(dirty[0]&/*mappedOptions, selectedIndex*/2049)radioitem_changes.checked=/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0];if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.onkeydown=/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]);if(dirty[0]&/*mappedOptions*/2048)radioitem_changes.onclick=/*handleRadioClick*/ctx[14](/*option*/ctx[27]);if(dirty[0]&/*$$scope, optionLabelClass, mappedOptions*/4196416){radioitem_changes.$$scope={dirty:dirty,ctx:ctx};}radioitem.$set(radioitem_changes);},i:function i(local){if(current)return;transition_in(radioitem.$$.fragment,local);current=true;},o:function o(local){transition_out(radioitem.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(first);destroy_component(radioitem,detaching);}};}// (89:8) {#each mappedOptions as option (option.id) }\nfunction create_each_block$3(key_1,ctx){var first;var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_2$1,create_else_block$2];var if_blocks=[];function select_block_type(ctx,dirty){if(/*option*/ctx[27].options)return 0;return 1;}current_block_type_index=select_block_type(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{key:key_1,first:null,c:function c(){first=empty();if_block.c();if_block_anchor=empty();this.first=first;},m:function m(target,anchor){insert(target,first,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(first);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}function create_fragment$f(ctx){var t;var if_block1_anchor;var current;var if_block0=/*localizedOptions*/ctx[10].length&&create_if_block_1$3(ctx);var if_block1=false;return{c:function c(){if(if_block0)if_block0.c();t=space();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*localizedOptions*/ctx[10].length){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*localizedOptions*/1024){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$3(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(detaching)detach(if_block1_anchor);}};}function instance$f($$self,$$props,$$invalidate){var _$$props$$$slots8=$$props.$$slots,slots=_$$props$$$slots8===void 0?{}:_$$props$$$slots8,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();var _$$props$label2=$$props.label,label=_$$props$label2===void 0?undefined:_$$props$label2;var _$$props$hideLabel2=$$props.hideLabel,hideLabel=_$$props$hideLabel2===void 0?true:_$$props$hideLabel2;var _$$props$class9=$$props[\"class\"],klass=_$$props$class9===void 0?undefined:_$$props$class9;var _$$props$name=$$props.name,name=_$$props$name===void 0?\"doka-radio-group-\".concat(getUniqueId()):_$$props$name;var _$$props$selectedInde=$$props.selectedIndex,selectedIndex=_$$props$selectedInde===void 0?-1:_$$props$selectedInde;var _$$props$options=$$props.options,options=_$$props$options===void 0?[]:_$$props$options;var _$$props$onchange=$$props.onchange,onchange=_$$props$onchange===void 0?undefined:_$$props$onchange;var _$$props$layout3=$$props.layout,layout=_$$props$layout3===void 0?undefined:_$$props$layout3;var _$$props$optionMapper=$$props.optionMapper,optionMapper=_$$props$optionMapper===void 0?undefined:_$$props$optionMapper;var _$$props$optionFilter=$$props.optionFilter,optionFilter=_$$props$optionFilter===void 0?undefined:_$$props$optionFilter;var _$$props$value=$$props.value,value=_$$props$value===void 0?undefined:_$$props$value;var _$$props$optionLabelC=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC===void 0?undefined:_$$props$optionLabelC;var _$$props$title=$$props.title,title=_$$props$title===void 0?undefined:_$$props$title;var _$$props$locale2=$$props.locale,locale=_$$props$locale2===void 0?undefined:_$$props$locale2;var _$$props$optionClass=$$props.optionClass,optionClass=_$$props$optionClass===void 0?undefined:_$$props$optionClass;var _$$props$optionGroupC=$$props.optionGroupClass,optionGroupClass=_$$props$optionGroupC===void 0?undefined:_$$props$optionGroupC;var getOptionIndex=function getOptionIndex(option){return flattenedOptions.findIndex(function(flattenedOption){return flattenedOption.id===option.id;});};var isConfirm=function isConfirm(key){return /enter| /i.test(key);};var changeSelection=function changeSelection(option){$$invalidate(0,selectedIndex=getOptionIndex(option));var payload=_objectSpread({index:selectedIndex},option);opop(onchange,payload);dispatch(\"change\",payload);};var handleRadioKeydown=function handleRadioKeydown(option){return function(e){// is confirm key ([enter] or [space])\nif(!isConfirm(e.key))return;changeSelection(option);};};var handleRadioClick=function handleRadioClick(option){return function(e){changeSelection(option);};};$$self.$$set=function($$props){if(\"label\"in $$props)$$invalidate(1,label=$$props.label);if(\"hideLabel\"in $$props)$$invalidate(2,hideLabel=$$props.hideLabel);if(\"class\"in $$props)$$invalidate(3,klass=$$props[\"class\"]);if(\"name\"in $$props)$$invalidate(4,name=$$props.name);if(\"selectedIndex\"in $$props)$$invalidate(0,selectedIndex=$$props.selectedIndex);if(\"options\"in $$props)$$invalidate(15,options=$$props.options);if(\"onchange\"in $$props)$$invalidate(16,onchange=$$props.onchange);if(\"layout\"in $$props)$$invalidate(5,layout=$$props.layout);if(\"optionMapper\"in $$props)$$invalidate(17,optionMapper=$$props.optionMapper);if(\"optionFilter\"in $$props)$$invalidate(18,optionFilter=$$props.optionFilter);if(\"value\"in $$props)$$invalidate(19,value=$$props.value);if(\"optionLabelClass\"in $$props)$$invalidate(6,optionLabelClass=$$props.optionLabelClass);if(\"title\"in $$props)$$invalidate(7,title=$$props.title);if(\"locale\"in $$props)$$invalidate(20,locale=$$props.locale);if(\"optionClass\"in $$props)$$invalidate(8,optionClass=$$props.optionClass);if(\"optionGroupClass\"in $$props)$$invalidate(9,optionGroupClass=$$props.optionGroupClass);if(\"$$scope\"in $$props)$$invalidate(22,$$scope=$$props.$$scope);};var localizedOptions;var mappedOptions;var flattenedOptions;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*optionFilter, options, locale*/1343488){$$invalidate(10,localizedOptions=localizeOptions$1(optionFilter?options.filter(optionFilter):options,locale));}if($$self.$$.dirty[0]&/*localizedOptions, optionMapper*/132096){$$invalidate(11,mappedOptions=mapOptions(localizedOptions,optionMapper));}if($$self.$$.dirty[0]&/*mappedOptions*/2048){$$invalidate(23,flattenedOptions=flattenOptions(mappedOptions));}if($$self.$$.dirty[0]&/*value, selectedIndex, flattenedOptions*/8912897){// can optionally pass value to have radio button group try to auto-select the right option\nif(value&&selectedIndex<0){$$invalidate(0,selectedIndex=flattenedOptions.findIndex(function(option){return option.value===value;}));}}};return[selectedIndex,label,hideLabel,klass,name,layout,optionLabelClass,title,optionClass,optionGroupClass,localizedOptions,mappedOptions,getOptionIndex,handleRadioKeydown,handleRadioClick,options,onchange,optionMapper,optionFilter,value,locale,slots,$$scope];}var RadioGroup=/*#__PURE__*/function(_SvelteComponent16){_inherits(RadioGroup,_SvelteComponent16);var _super18=_createSuper(RadioGroup);function RadioGroup(options){var _this18;_classCallCheck(this,RadioGroup);_this18=_super18.call(this);init(_assertThisInitialized(_this18),options,instance$f,create_fragment$f,safe_not_equal,{label:1,hideLabel:2,\"class\":3,name:4,selectedIndex:0,options:15,onchange:16,layout:5,optionMapper:17,optionFilter:18,value:19,optionLabelClass:6,title:7,locale:20,optionClass:8,optionGroupClass:9},[-1,-1]);return _this18;}return RadioGroup;}(SvelteComponent);var isDeepEqual=function isDeepEqual(a,b){if(Array.isArray(a)&&Array.isArray(b))return arrayEqual(a,b);return a===b;};/* src/core/ui/components/Dropdown.svelte generated by Svelte v3.29.4 */function create_if_block_2$2(ctx){var icon_1;var current;icon_1=new Icon({props:{$$slots:{\"default\":[create_default_slot_3$2]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*$$scope, icon*/134217792){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (145:8) <Icon>\nfunction create_default_slot_3$2(ctx){var g;return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[6];},p:function p(ctx,dirty){if(dirty&/*icon*/64)g.innerHTML=/*icon*/ctx[6];},d:function d(detaching){if(detaching)detach(g);}};}// (147:8) {#if !hideLabel}\nfunction create_if_block_1$4(ctx){var span;var t_value=(/*label*/ctx[2]||/*selectedLabel*/ctx[18])+\"\";var t;var span_class_value;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"class\",span_class_value=arrayJoin([\"DokaButtonLabel\",/*labelClass*/ctx[3]]));},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*label, selectedLabel*/262148&&t_value!==(t_value=(/*label*/ctx[2]||/*selectedLabel*/ctx[18])+\"\"))set_data(t,t_value);if(dirty&/*labelClass*/8&&span_class_value!==(span_class_value=arrayJoin([\"DokaButtonLabel\",/*labelClass*/ctx[3]]))){attr(span,\"class\",span_class_value);}},d:function d(detaching){if(detaching)detach(span);}};}// (143:4) <span slot=\"label\" title={localize(title, locale)} class={arrayJoin(['DokaButtonInner', innerClass])} >\nfunction create_label_slot(ctx){var span;var t;var span_title_value;var span_class_value;var current;var if_block0=/*icon*/ctx[6]&&create_if_block_2$2(ctx);var if_block1=!/*hideLabel*/ctx[5]&&create_if_block_1$4(ctx);return{c:function c(){span=element(\"span\");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(span,\"slot\",\"label\");attr(span,\"title\",span_title_value=localize(/*title*/ctx[1],/*locale*/ctx[15]));attr(span,\"class\",span_class_value=arrayJoin([\"DokaButtonInner\",/*innerClass*/ctx[4]]));},m:function m(target,anchor){insert(target,span,anchor);if(if_block0)if_block0.m(span,null);append(span,t);if(if_block1)if_block1.m(span,null);current=true;},p:function p(ctx,dirty){if(/*icon*/ctx[6]){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*icon*/64){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(span,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*hideLabel*/ctx[5]){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_1$4(ctx);if_block1.c();if_block1.m(span,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}if(!current||dirty&/*title, locale*/32770&&span_title_value!==(span_title_value=localize(/*title*/ctx[1],/*locale*/ctx[15]))){attr(span,\"title\",span_title_value);}if(!current||dirty&/*innerClass*/16&&span_class_value!==(span_class_value=arrayJoin([\"DokaButtonInner\",/*innerClass*/ctx[4]]))){attr(span,\"class\",span_class_value);}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(span);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}// (165:12) <span slot=\"group\">\nfunction create_group_slot(ctx){var span;var t_value=/*option*/ctx[26].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"slot\",\"group\");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*option*/67108864&&t_value!==(t_value=/*option*/ctx[26].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (167:16) {#if option.icon}\nfunction create_if_block$3(ctx){var icon_1;var current;icon_1=new Icon({props:{style:isFunction(/*optionIconStyle*/ctx[13])?/*optionIconStyle*/ctx[13](/*option*/ctx[26].value):/*optionIconStyle*/ctx[13],$$slots:{\"default\":[create_default_slot_2$2]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*optionIconStyle, option*/67117056)icon_1_changes.style=isFunction(/*optionIconStyle*/ctx[13])?/*optionIconStyle*/ctx[13](/*option*/ctx[26].value):/*optionIconStyle*/ctx[13];if(dirty&/*$$scope, option*/201326592){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (168:16) <Icon style={isFunction(optionIconStyle) ? optionIconStyle(option.value) : optionIconStyle}>\nfunction create_default_slot_2$2(ctx){var g;var raw_value=/*option*/ctx[26].icon+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*option*/67108864&&raw_value!==(raw_value=/*option*/ctx[26].icon+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (166:12) <span slot=\"option\">\nfunction create_option_slot(ctx){var span0;var t0;var span1;var t1_value=/*option*/ctx[26].label+\"\";var t1;var span1_style_value;var span1_class_value;var current;var if_block=/*option*/ctx[26].icon&&create_if_block$3(ctx);return{c:function c(){span0=element(\"span\");if(if_block)if_block.c();t0=space();span1=element(\"span\");t1=text(t1_value);attr(span1,\"style\",span1_style_value=isFunction(/*optionLabelStyle*/ctx[14])?/*optionLabelStyle*/ctx[14](/*option*/ctx[26].value):/*optionLabelStyle*/ctx[14]);attr(span1,\"class\",span1_class_value=arrayJoin([\"DokaDropdownOptionLabel\",/*optionLabelClass*/ctx[10]]));attr(span0,\"slot\",\"option\");},m:function m(target,anchor){insert(target,span0,anchor);if(if_block)if_block.m(span0,null);append(span0,t0);append(span0,span1);append(span1,t1);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[26].icon){if(if_block){if_block.p(ctx,dirty);if(dirty&/*option*/67108864){transition_in(if_block,1);}}else{if_block=create_if_block$3(ctx);if_block.c();transition_in(if_block,1);if_block.m(span0,t0);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if((!current||dirty&/*option*/67108864)&&t1_value!==(t1_value=/*option*/ctx[26].label+\"\"))set_data(t1,t1_value);if(!current||dirty&/*optionLabelStyle, option*/67125248&&span1_style_value!==(span1_style_value=isFunction(/*optionLabelStyle*/ctx[14])?/*optionLabelStyle*/ctx[14](/*option*/ctx[26].value):/*optionLabelStyle*/ctx[14])){attr(span1,\"style\",span1_style_value);}if(!current||dirty&/*optionLabelClass*/1024&&span1_class_value!==(span1_class_value=arrayJoin([\"DokaDropdownOptionLabel\",/*optionLabelClass*/ctx[10]]))){attr(span1,\"class\",span1_class_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(span0);if(if_block)if_block.d();}};}// (153:8) <RadioGroup              {name}             {value}             {selectedIndex}             {optionFilter}             {optionMapper}             optionLabelClass={arrayJoin(['DokaDropdownOptionLabel', optionLabelClass])}             optionGroupClass=\"DokaDropdownOptionGroup\"             optionClass=\"DokaDropdownOption\"             options={localizedOptions}             onchange={handleSelect}             let:option>\nfunction create_default_slot_1$2(ctx){var t;return{c:function c(){t=space();},m:function m(target,anchor){insert(target,t,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);}};}// (152:4) <div class=\"DokaDropdownPanel\" slot=\"details\" on:keydown={handleKeydown}>\nfunction create_details_slot(ctx){var div;var radiogroup;var current;var mounted;var dispose;radiogroup=new RadioGroup({props:{name:/*name*/ctx[7],value:/*value*/ctx[9],selectedIndex:/*selectedIndex*/ctx[8],optionFilter:/*optionFilter*/ctx[11],optionMapper:/*optionMapper*/ctx[12],optionLabelClass:arrayJoin([\"DokaDropdownOptionLabel\",/*optionLabelClass*/ctx[10]]),optionGroupClass:\"DokaDropdownOptionGroup\",optionClass:\"DokaDropdownOption\",options:/*localizedOptions*/ctx[17],onchange:/*handleSelect*/ctx[19],$$slots:{\"default\":[create_default_slot_1$2,function(_ref179){var option=_ref179.option;return{26:option};},function(_ref180){var option=_ref180.option;return option?67108864:0;}],option:[create_option_slot,function(_ref181){var option=_ref181.option;return{26:option};},function(_ref182){var option=_ref182.option;return option?67108864:0;}],group:[create_group_slot,function(_ref183){var option=_ref183.option;return{26:option};},function(_ref184){var option=_ref184.option;return option?67108864:0;}]},$$scope:{ctx:ctx}}});return{c:function c(){div=element(\"div\");create_component(radiogroup.$$.fragment);attr(div,\"class\",\"DokaDropdownPanel\");attr(div,\"slot\",\"details\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(radiogroup,div,null);current=true;if(!mounted){dispose=listen(div,\"keydown\",/*handleKeydown*/ctx[21]);mounted=true;}},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty&/*name*/128)radiogroup_changes.name=/*name*/ctx[7];if(dirty&/*value*/512)radiogroup_changes.value=/*value*/ctx[9];if(dirty&/*selectedIndex*/256)radiogroup_changes.selectedIndex=/*selectedIndex*/ctx[8];if(dirty&/*optionFilter*/2048)radiogroup_changes.optionFilter=/*optionFilter*/ctx[11];if(dirty&/*optionMapper*/4096)radiogroup_changes.optionMapper=/*optionMapper*/ctx[12];if(dirty&/*optionLabelClass*/1024)radiogroup_changes.optionLabelClass=arrayJoin([\"DokaDropdownOptionLabel\",/*optionLabelClass*/ctx[10]]);if(dirty&/*localizedOptions*/131072)radiogroup_changes.options=/*localizedOptions*/ctx[17];if(dirty&/*$$scope, optionLabelStyle, option, optionLabelClass, optionIconStyle*/201352192){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(radiogroup);mounted=false;dispose();}};}// (139:0) <Details bind:isActive={dropdownVisible}      onshow={handleShowPanel}      buttonClass={arrayJoin(['DokaDropdownButton',klass, hideLabel && 'DokaDropdownIconOnly'])}>\nfunction create_default_slot$4(ctx){var t;return{c:function c(){t=space();},m:function m(target,anchor){insert(target,t,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);}};}function create_fragment$g(ctx){var details;var updating_isActive;var current;function details_isActive_binding(value){/*details_isActive_binding*/ctx[24].call(null,value);}var details_props={onshow:/*handleShowPanel*/ctx[20],buttonClass:arrayJoin([\"DokaDropdownButton\",/*klass*/ctx[0],/*hideLabel*/ctx[5]&&\"DokaDropdownIconOnly\"]),$$slots:{\"default\":[create_default_slot$4],details:[create_details_slot],label:[create_label_slot]},$$scope:{ctx:ctx}};if(/*dropdownVisible*/ctx[16]!==void 0){details_props.isActive=/*dropdownVisible*/ctx[16];}details=new Details({props:details_props});binding_callbacks.push(function(){return bind(details,\"isActive\",details_isActive_binding);});return{c:function c(){create_component(details.$$.fragment);},m:function m(target,anchor){mount_component(details,target,anchor);current=true;},p:function p(ctx,_ref185){var _ref186=_slicedToArray(_ref185,1),dirty=_ref186[0];var details_changes={};if(dirty&/*klass, hideLabel*/33)details_changes.buttonClass=arrayJoin([\"DokaDropdownButton\",/*klass*/ctx[0],/*hideLabel*/ctx[5]&&\"DokaDropdownIconOnly\"]);if(dirty&/*$$scope, name, value, selectedIndex, optionFilter, optionMapper, optionLabelClass, localizedOptions, optionLabelStyle, optionIconStyle, title, locale, innerClass, labelClass, label, selectedLabel, hideLabel, icon*/134676478){details_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_isActive&&dirty&/*dropdownVisible*/65536){updating_isActive=true;details_changes.isActive=/*dropdownVisible*/ctx[16];add_flush_callback(function(){return updating_isActive=false;});}details.$set(details_changes);},i:function i(local){if(current)return;transition_in(details.$$.fragment,local);current=true;},o:function o(local){transition_out(details.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(details,detaching);}};}function instance$g($$self,$$props,$$invalidate){var _$$props$class10=$$props[\"class\"],klass=_$$props$class10===void 0?undefined:_$$props$class10;var _$$props$title2=$$props.title,title=_$$props$title2===void 0?undefined:_$$props$title2;var _$$props$label3=$$props.label,label=_$$props$label3===void 0?undefined:_$$props$label3;var _$$props$labelClass2=$$props.labelClass,labelClass=_$$props$labelClass2===void 0?undefined:_$$props$labelClass2;var _$$props$innerClass2=$$props.innerClass,innerClass=_$$props$innerClass2===void 0?undefined:_$$props$innerClass2;var _$$props$hideLabel3=$$props.hideLabel,hideLabel=_$$props$hideLabel3===void 0?false:_$$props$hideLabel3;var _$$props$icon2=$$props.icon,icon=_$$props$icon2===void 0?undefined:_$$props$icon2;var _$$props$name2=$$props.name,name=_$$props$name2===void 0?undefined:_$$props$name2;var _$$props$options2=$$props.options,options=_$$props$options2===void 0?[]:_$$props$options2;var _$$props$selectedInde2=$$props.selectedIndex,selectedIndex=_$$props$selectedInde2===void 0?-1:_$$props$selectedInde2;var _$$props$value2=$$props.value,value=_$$props$value2===void 0?undefined:_$$props$value2;var _$$props$optionLabelC2=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC2===void 0?undefined:_$$props$optionLabelC2;var _$$props$optionFilter2=$$props.optionFilter,optionFilter=_$$props$optionFilter2===void 0?undefined:_$$props$optionFilter2;var _$$props$optionMapper2=$$props.optionMapper,optionMapper=_$$props$optionMapper2===void 0?undefined:_$$props$optionMapper2;var _$$props$optionIconSt=$$props.optionIconStyle,optionIconStyle=_$$props$optionIconSt===void 0?undefined:_$$props$optionIconSt;var _$$props$optionLabelS=$$props.optionLabelStyle,optionLabelStyle=_$$props$optionLabelS===void 0?undefined:_$$props$optionLabelS;var _$$props$onchange2=$$props.onchange,onchange=_$$props$onchange2===void 0?undefined:_$$props$onchange2;var _$$props$locale3=$$props.locale,locale=_$$props$locale3===void 0?undefined:_$$props$locale3;var getUndefinedOptionLabel=function getUndefinedOptionLabel(options){var option=localizedOptions.find(function(option){return option[0]===undefined;});if(!option)return undefined;return option[1];};var dropdownVisible;var handleSelect=function handleSelect(detail){// triggers label update\n$$invalidate(18,selectedLabel=detail.value);// update value\nonchange(detail);// hide details\n$$invalidate(16,dropdownVisible=false);};var handleShowPanel=function handleShowPanel(_ref187){var e=_ref187.e,panel=_ref187.panel;if(e&&e.key&&/up|down/i.test(e.key))return panel.querySelector(\"input:not([disabled])\").focus();panel.querySelector(\"fieldset\").focus();};var handleKeydown=function handleKeydown(e){// don't allow tabbing ([tab] is also blocked in normal <select>)\nif(/tab/i.test(e.key))e.preventDefault();};function details_isActive_binding(value){dropdownVisible=value;$$invalidate(16,dropdownVisible);}$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(0,klass=$$props[\"class\"]);if(\"title\"in $$props)$$invalidate(1,title=$$props.title);if(\"label\"in $$props)$$invalidate(2,label=$$props.label);if(\"labelClass\"in $$props)$$invalidate(3,labelClass=$$props.labelClass);if(\"innerClass\"in $$props)$$invalidate(4,innerClass=$$props.innerClass);if(\"hideLabel\"in $$props)$$invalidate(5,hideLabel=$$props.hideLabel);if(\"icon\"in $$props)$$invalidate(6,icon=$$props.icon);if(\"name\"in $$props)$$invalidate(7,name=$$props.name);if(\"options\"in $$props)$$invalidate(22,options=$$props.options);if(\"selectedIndex\"in $$props)$$invalidate(8,selectedIndex=$$props.selectedIndex);if(\"value\"in $$props)$$invalidate(9,value=$$props.value);if(\"optionLabelClass\"in $$props)$$invalidate(10,optionLabelClass=$$props.optionLabelClass);if(\"optionFilter\"in $$props)$$invalidate(11,optionFilter=$$props.optionFilter);if(\"optionMapper\"in $$props)$$invalidate(12,optionMapper=$$props.optionMapper);if(\"optionIconStyle\"in $$props)$$invalidate(13,optionIconStyle=$$props.optionIconStyle);if(\"optionLabelStyle\"in $$props)$$invalidate(14,optionLabelStyle=$$props.optionLabelStyle);if(\"onchange\"in $$props)$$invalidate(23,onchange=$$props.onchange);if(\"locale\"in $$props)$$invalidate(15,locale=$$props.locale);};var localizedOptions;var selectedLabel;$$self.$$.update=function(){if($$self.$$.dirty&/*options, locale*/4227072){$$invalidate(17,localizedOptions=localizeOptions$1(options,locale));}if($$self.$$.dirty&/*localizedOptions, value*/131584){$$invalidate(18,selectedLabel=localizedOptions.reduce(function(prev,curr){if(prev)return prev;var _curr=_slicedToArray(curr,2),optionValue=_curr[0],optionLabel=_curr[1];if(isDeepEqual(optionValue,value))return optionLabel;},undefined)||getUndefinedOptionLabel());}};return[klass,title,label,labelClass,innerClass,hideLabel,icon,name,selectedIndex,value,optionLabelClass,optionFilter,optionMapper,optionIconStyle,optionLabelStyle,locale,dropdownVisible,localizedOptions,selectedLabel,handleSelect,handleShowPanel,handleKeydown,options,onchange,details_isActive_binding];}var Dropdown=/*#__PURE__*/function(_SvelteComponent17){_inherits(Dropdown,_SvelteComponent17);var _super19=_createSuper(Dropdown);function Dropdown(options){var _this19;_classCallCheck(this,Dropdown);_this19=_super19.call(this);init(_assertThisInitialized(_this19),options,instance$g,create_fragment$g,safe_not_equal,{\"class\":0,title:1,label:2,labelClass:3,innerClass:4,hideLabel:5,icon:6,name:7,options:22,selectedIndex:8,value:9,optionLabelClass:10,optionFilter:11,optionMapper:12,optionIconStyle:13,optionLabelStyle:14,onchange:23,locale:15});return _this19;}return Dropdown;}(SvelteComponent);/* src/core/ui/components/Slider.svelte generated by Svelte v3.29.4 */function create_fragment$h(ctx){var div3;var input_1;var nudgeable_action;var t0;var div0;var t1;var div2;var div1;var div2_style_value;var div3_class_value;var mounted;var dispose;return{c:function c(){div3=element(\"div\");input_1=element(\"input\");t0=space();div0=element(\"div\");t1=space();div2=element(\"div\");div1=element(\"div\");attr(input_1,\"type\",\"range\");attr(input_1,\"id\",/*id*/ctx[4]);attr(input_1,\"min\",/*min*/ctx[1]);attr(input_1,\"max\",/*max*/ctx[2]);attr(input_1,\"step\",/*step*/ctx[3]);input_1.value=/*value*/ctx[0];attr(div0,\"class\",\"DokaSliderTrack\");attr(div0,\"style\",/*trackStyle*/ctx[5]);attr(div1,\"class\",\"DokaSliderKnob\");attr(div1,\"style\",/*knobStyle*/ctx[6]);attr(div2,\"class\",\"DokaSliderKnobController\");attr(div2,\"style\",div2_style_value=\"transform: translateX(\".concat(/*position*/ctx[9],\"%)\"));attr(div3,\"class\",div3_class_value=arrayJoin([\"DokaSlider\",/*klass*/ctx[7]]));},m:function m(target,anchor){insert(target,div3,anchor);append(div3,input_1);/*input_1_binding*/ctx[14](input_1);append(div3,t0);append(div3,div0);append(div3,t1);append(div3,div2);append(div2,div1);if(!mounted){dispose=[listen(input_1,\"pointerdown\",/*handlePointerDown*/ctx[12]),listen(input_1,\"input\",/*handleInput*/ctx[10]),listen(input_1,\"nudge\",/*handleNudge*/ctx[11]),action_destroyer(nudgeable_action=nudgeable.call(null,input_1))];mounted=true;}},p:function p(ctx,_ref188){var _ref189=_slicedToArray(_ref188,1),dirty=_ref189[0];if(dirty&/*id*/16){attr(input_1,\"id\",/*id*/ctx[4]);}if(dirty&/*min*/2){attr(input_1,\"min\",/*min*/ctx[1]);}if(dirty&/*max*/4){attr(input_1,\"max\",/*max*/ctx[2]);}if(dirty&/*step*/8){attr(input_1,\"step\",/*step*/ctx[3]);}if(dirty&/*value*/1){input_1.value=/*value*/ctx[0];}if(dirty&/*trackStyle*/32){attr(div0,\"style\",/*trackStyle*/ctx[5]);}if(dirty&/*knobStyle*/64){attr(div1,\"style\",/*knobStyle*/ctx[6]);}if(dirty&/*position*/512&&div2_style_value!==(div2_style_value=\"transform: translateX(\".concat(/*position*/ctx[9],\"%)\"))){attr(div2,\"style\",div2_style_value);}if(dirty&/*klass*/128&&div3_class_value!==(div3_class_value=arrayJoin([\"DokaSlider\",/*klass*/ctx[7]]))){attr(div3,\"class\",div3_class_value);}},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(div3);/*input_1_binding*/ctx[14](null);mounted=false;run_all(dispose);}};}function instance$h($$self,$$props,$$invalidate){var _$$props$min2=$$props.min,min=_$$props$min2===void 0?0:_$$props$min2;var _$$props$max2=$$props.max,max=_$$props$max2===void 0?100:_$$props$max2;var _$$props$step=$$props.step,step=_$$props$step===void 0?1:_$$props$step;var _$$props$id2=$$props.id,id=_$$props$id2===void 0?undefined:_$$props$id2;var _$$props$value3=$$props.value,value=_$$props$value3===void 0?0:_$$props$value3;var _$$props$trackStyle=$$props.trackStyle,trackStyle=_$$props$trackStyle===void 0?undefined:_$$props$trackStyle;var _$$props$knobStyle=$$props.knobStyle,knobStyle=_$$props$knobStyle===void 0?undefined:_$$props$knobStyle;var _$$props$onchange3=$$props.onchange,onchange=_$$props$onchange3===void 0?undefined:_$$props$onchange3;var _$$props$class11=$$props[\"class\"],klass=_$$props$class11===void 0?undefined:_$$props$class11;var input;var inputWidth;var inputOffsetX;var pageOffsetX;var setValueByOffsetX=function setValueByOffsetX(offsetX,inputWidth){$$invalidate(0,value=clamp(min+offsetX/inputWidth*range,min,max));onchange(value);};var handleInput=function handleInput(e){// already handled by pointer events\nif(inputWidth)return;$$invalidate(0,value=parseFloat(e.target.value));onchange(value);};var handleNudge=function handleNudge(e){var width=input.offsetWidth;var offset=value/range*width;setValueByOffsetX(offset+e.detail.x,width);};var handlePointerDown=function handlePointerDown(e){e.stopPropagation();inputWidth=input.offsetWidth;inputOffsetX=e.offsetX;pageOffsetX=e.pageX;setValueByOffsetX(inputOffsetX,inputWidth);document.documentElement.addEventListener(\"pointermove\",handlePointerMove);document.documentElement.addEventListener(\"pointerup\",handlePointerUp);};var handlePointerMove=function handlePointerMove(e){var dx=e.pageX-pageOffsetX;setValueByOffsetX(inputOffsetX+dx,inputWidth);};var handlePointerUp=function handlePointerUp(e){inputWidth=undefined;document.documentElement.removeEventListener(\"pointermove\",handlePointerMove);document.documentElement.removeEventListener(\"pointerup\",handlePointerUp);onchange(value);};function input_1_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){input=$$value;$$invalidate(8,input);});}$$self.$$set=function($$props){if(\"min\"in $$props)$$invalidate(1,min=$$props.min);if(\"max\"in $$props)$$invalidate(2,max=$$props.max);if(\"step\"in $$props)$$invalidate(3,step=$$props.step);if(\"id\"in $$props)$$invalidate(4,id=$$props.id);if(\"value\"in $$props)$$invalidate(0,value=$$props.value);if(\"trackStyle\"in $$props)$$invalidate(5,trackStyle=$$props.trackStyle);if(\"knobStyle\"in $$props)$$invalidate(6,knobStyle=$$props.knobStyle);if(\"onchange\"in $$props)$$invalidate(13,onchange=$$props.onchange);if(\"class\"in $$props)$$invalidate(7,klass=$$props[\"class\"]);};var range;var position;$$self.$$.update=function(){if($$self.$$.dirty&/*max, min*/6){$$invalidate(18,range=max-min);}if($$self.$$.dirty&/*value, range*/262145){$$invalidate(9,position=value/range*100);}};return[value,min,max,step,id,trackStyle,knobStyle,klass,input,position,handleInput,handleNudge,handlePointerDown,onchange,input_1_binding];}var Slider=/*#__PURE__*/function(_SvelteComponent18){_inherits(Slider,_SvelteComponent18);var _super20=_createSuper(Slider);function Slider(options){var _this20;_classCallCheck(this,Slider);_this20=_super20.call(this);init(_assertThisInitialized(_this20),options,instance$h,create_fragment$h,safe_not_equal,{min:1,max:2,step:3,id:4,value:0,trackStyle:5,knobStyle:6,onchange:13,\"class\":7});return _this20;}return Slider;}(SvelteComponent);var RGBToHSV=function RGBToHSV(r,g,b){var v=Math.max(r,g,b),n=v-Math.min(r,g,b);var h=n&&(v==r?(g-b)/n:v==g?2+(b-r)/n:4+(r-g)/n);return[60*(h<0?h+6:h)/360,v&&n/v,v];};var HSVToRGB=function HSVToRGB(h,s,v){var r,g,b;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break;}return[r,g,b];};/* src/core/ui/components/ColorPreview.svelte generated by Svelte v3.29.4 */function create_fragment$i(ctx){var div;var span;var div_style_value;return{c:function c(){div=element(\"div\");span=element(\"span\");attr(div,\"class\",\"DokaColorPreview\");attr(div,\"title\",/*title*/ctx[0]);attr(div,\"style\",div_style_value=\"--color:\".concat(/*colorValue*/ctx[1]));},m:function m(target,anchor){insert(target,div,anchor);append(div,span);},p:function p(ctx,_ref190){var _ref191=_slicedToArray(_ref190,1),dirty=_ref191[0];if(dirty&/*title*/1){attr(div,\"title\",/*title*/ctx[0]);}if(dirty&/*colorValue*/2&&div_style_value!==(div_style_value=\"--color:\".concat(/*colorValue*/ctx[1]))){attr(div,\"style\",div_style_value);}},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(div);}};}function instance$i($$self,$$props,$$invalidate){var _$$props$color=$$props.color,color=_$$props$color===void 0?undefined:_$$props$color;var _$$props$title3=$$props.title,title=_$$props$title3===void 0?undefined:_$$props$title3;$$self.$$set=function($$props){if(\"color\"in $$props)$$invalidate(2,color=$$props.color);if(\"title\"in $$props)$$invalidate(0,title=$$props.title);};var colorValue;$$self.$$.update=function(){if($$self.$$.dirty&/*color*/4){$$invalidate(1,colorValue=color?colorArrayToRGBA(color):\"transparent\");}};return[title,colorValue,color];}var ColorPreview=/*#__PURE__*/function(_SvelteComponent19){_inherits(ColorPreview,_SvelteComponent19);var _super21=_createSuper(ColorPreview);function ColorPreview(options){var _this21;_classCallCheck(this,ColorPreview);_this21=_super21.call(this);init(_assertThisInitialized(_this21),options,instance$i,create_fragment$i,safe_not_equal,{color:2,title:0});return _this21;}return ColorPreview;}(SvelteComponent);/* src/core/ui/components/ColorPicker.svelte generated by Svelte v3.29.4 */function create_if_block_4$2(ctx){var span;var t;return{c:function c(){span=element(\"span\");t=text(/*label*/ctx[0]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*label*/1)set_data(t,/*label*/ctx[0]);},d:function d(detaching){if(detaching)detach(span);}};}// (312:4) <span slot=\"label\" class=\"DokaButtonLabel\">\nfunction create_label_slot$1(ctx){var span;var colorpreview;var t;var current;colorpreview=new ColorPreview({props:{color:/*value*/ctx[4],title:localize(/*title*/ctx[8],/*locale*/ctx[10])}});var if_block=!/*hidePresetLabel*/ctx[9]&&create_if_block_4$2(ctx);return{c:function c(){span=element(\"span\");create_component(colorpreview.$$.fragment);t=space();if(if_block)if_block.c();attr(span,\"slot\",\"label\");attr(span,\"class\",\"DokaButtonLabel\");},m:function m(target,anchor){insert(target,span,anchor);mount_component(colorpreview,span,null);append(span,t);if(if_block)if_block.m(span,null);current=true;},p:function p(ctx,dirty){var colorpreview_changes={};if(dirty[0]&/*value*/16)colorpreview_changes.color=/*value*/ctx[4];if(dirty[0]&/*title, locale*/1280)colorpreview_changes.title=localize(/*title*/ctx[8],/*locale*/ctx[10]);colorpreview.$set(colorpreview_changes);if(!/*hidePresetLabel*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_4$2(ctx);if_block.c();if_block.m(span,null);}}else if(if_block){if_block.d(1);if_block=null;}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(colorpreview);if(if_block)if_block.d();}};}// (324:8) {#if enablePicker}\nfunction create_if_block_2$3(ctx){var div3;var div2;var div1;var div0;var div0_style_value;var nudgeable_action;var div1_style_value;var div2_style_value;var t0;var slider;var t1;var current;var mounted;var dispose;slider=new Slider({props:{\"class\":\"DokaHuePicker\",knobStyle:\"background-color:\".concat(/*valueAsRGBAFullySaturated*/ctx[19]),onchange:/*updateHue*/ctx[24],value:/*hue*/ctx[14],min:0,max:1,step:0.001}});var if_block=/*enableOpacity*/ctx[11]&&create_if_block_3$2(ctx);return{c:function c(){div3=element(\"div\");div2=element(\"div\");div1=element(\"div\");div0=element(\"div\");t0=space();create_component(slider.$$.fragment);t1=space();if(if_block)if_block.c();attr(div0,\"role\",\"button\");attr(div0,\"class\",\"DokaPickerKnob\");attr(div0,\"tabindex\",\"0\");attr(div0,\"style\",div0_style_value=\"background-color:\".concat(/*valueAsRGBAFullyOpaque*/ctx[18],\";\"));attr(div1,\"class\",\"DokaPickerKnobController\");attr(div1,\"style\",div1_style_value=\"transform:translate(\".concat(/*sx*/ctx[21],\"%,\").concat(/*sy*/ctx[22],\"%)\"));attr(div2,\"class\",\"DokaSaturationPicker\");attr(div2,\"style\",div2_style_value=\"background-color: \".concat(/*valueAsRGBAFullySaturated*/ctx[19]));attr(div3,\"class\",\"DokaPicker\");},m:function m(target,anchor){insert(target,div3,anchor);append(div3,div2);append(div2,div1);append(div1,div0);/*div2_binding*/ctx[29](div2);append(div3,t0);mount_component(slider,div3,null);append(div3,t1);if(if_block)if_block.m(div3,null);current=true;if(!mounted){dispose=[listen(div0,\"nudge\",/*handleNudge*/ctx[27]),action_destroyer(nudgeable_action=nudgeable.call(null,div0)),listen(div2,\"pointerdown\",/*handlePointerDown*/ctx[26])];mounted=true;}},p:function p(ctx,dirty){if(!current||dirty[0]&/*valueAsRGBAFullyOpaque*/262144&&div0_style_value!==(div0_style_value=\"background-color:\".concat(/*valueAsRGBAFullyOpaque*/ctx[18],\";\"))){attr(div0,\"style\",div0_style_value);}if(!current||dirty[0]&/*sx, sy*/6291456&&div1_style_value!==(div1_style_value=\"transform:translate(\".concat(/*sx*/ctx[21],\"%,\").concat(/*sy*/ctx[22],\"%)\"))){attr(div1,\"style\",div1_style_value);}if(!current||dirty[0]&/*valueAsRGBAFullySaturated*/524288&&div2_style_value!==(div2_style_value=\"background-color: \".concat(/*valueAsRGBAFullySaturated*/ctx[19]))){attr(div2,\"style\",div2_style_value);}var slider_changes={};if(dirty[0]&/*valueAsRGBAFullySaturated*/524288)slider_changes.knobStyle=\"background-color:\".concat(/*valueAsRGBAFullySaturated*/ctx[19]);if(dirty[0]&/*hue*/16384)slider_changes.value=/*hue*/ctx[14];slider.$set(slider_changes);if(/*enableOpacity*/ctx[11]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*enableOpacity*/2048){transition_in(if_block,1);}}else{if_block=create_if_block_3$2(ctx);if_block.c();transition_in(if_block,1);if_block.m(div3,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(slider.$$.fragment,local);transition_in(if_block);current=true;},o:function o(local){transition_out(slider.$$.fragment,local);transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div3);/*div2_binding*/ctx[29](null);destroy_component(slider);if(if_block)if_block.d();mounted=false;run_all(dispose);}};}// (344:12) {#if enableOpacity}\nfunction create_if_block_3$2(ctx){var slider;var current;slider=new Slider({props:{\"class\":\"DokaOpacityPicker\",knobStyle:\"background-color: \".concat(/*valueAsRGBA*/ctx[16]),trackStyle:\"background-image: linear-gradient(to right, \".concat(/*valueAsRGBAFullyTransparent*/ctx[17],\", \").concat(/*valueAsRGBAFullyOpaque*/ctx[18],\")\"),onchange:/*updateOpacity*/ctx[25],value:/*opacity*/ctx[15],min:0,max:1,step:0.001}});return{c:function c(){create_component(slider.$$.fragment);},m:function m(target,anchor){mount_component(slider,target,anchor);current=true;},p:function p(ctx,dirty){var slider_changes={};if(dirty[0]&/*valueAsRGBA*/65536)slider_changes.knobStyle=\"background-color: \".concat(/*valueAsRGBA*/ctx[16]);if(dirty[0]&/*valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque*/393216)slider_changes.trackStyle=\"background-image: linear-gradient(to right, \".concat(/*valueAsRGBAFullyTransparent*/ctx[17],\", \").concat(/*valueAsRGBAFullyOpaque*/ctx[18],\")\");if(dirty[0]&/*opacity*/32768)slider_changes.value=/*opacity*/ctx[15];slider.$set(slider_changes);},i:function i(local){if(current)return;transition_in(slider.$$.fragment,local);current=true;},o:function o(local){transition_out(slider.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(slider,detaching);}};}// (357:8) {#if enablePresets}\nfunction create_if_block$4(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{label:\"Presets\",\"class\":arrayJoin([\"DokaColorPresets\",/*hidePresetLabel*/ctx[9]?\"DokaColorPresetsGrid\":\"DokaColorPresetsList\"]),hideLabel:false,name:/*name*/ctx[1],value:/*value*/ctx[4],optionGroupClass:\"DokaDropdownOptionGroup\",optionClass:\"DokaDropdownOption\",options:/*options*/ctx[2].map(/*func*/ctx[30]),selectedIndex:/*selectedIndex*/ctx[3],optionMapper:/*optionMapper*/ctx[7],optionLabelClass:/*optionLabelClass*/ctx[6],onchange:/*func_1*/ctx[31],$$slots:{\"default\":[create_default_slot_1$3,function(_ref192){var option=_ref192.option;return{44:option};},function(_ref193){var option=_ref193.option;return[0,option?8192:0];}],option:[create_option_slot$1,function(_ref194){var option=_ref194.option;return{44:option};},function(_ref195){var option=_ref195.option;return[0,option?8192:0];}],group:[create_group_slot$1,function(_ref196){var option=_ref196.option;return{44:option};},function(_ref197){var option=_ref197.option;return[0,option?8192:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*hidePresetLabel*/512)radiogroup_changes[\"class\"]=arrayJoin([\"DokaColorPresets\",/*hidePresetLabel*/ctx[9]?\"DokaColorPresetsGrid\":\"DokaColorPresetsList\"]);if(dirty[0]&/*name*/2)radiogroup_changes.name=/*name*/ctx[1];if(dirty[0]&/*value*/16)radiogroup_changes.value=/*value*/ctx[4];if(dirty[0]&/*options, locale*/1028)radiogroup_changes.options=/*options*/ctx[2].map(/*func*/ctx[30]);if(dirty[0]&/*selectedIndex*/8)radiogroup_changes.selectedIndex=/*selectedIndex*/ctx[3];if(dirty[0]&/*optionMapper*/128)radiogroup_changes.optionMapper=/*optionMapper*/ctx[7];if(dirty[0]&/*optionLabelClass*/64)radiogroup_changes.optionLabelClass=/*optionLabelClass*/ctx[6];if(dirty[0]&/*hidePresetLabel*/512|dirty[1]&/*$$scope, option*/24576){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (373:12) <span slot=\"group\">\nfunction create_group_slot$1(ctx){var span;var t_value=/*option*/ctx[44].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"slot\",\"group\");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*option*/8192&&t_value!==(t_value=/*option*/ctx[44].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (378:16) {#if !hidePresetLabel}\nfunction create_if_block_1$5(ctx){var span;var t_value=/*option*/ctx[44].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);attr(span,\"class\",\"DokaButtonLabel\");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*option*/8192&&t_value!==(t_value=/*option*/ctx[44].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (376:12) <span slot=\"option\">\nfunction create_option_slot$1(ctx){var span;var colorpreview;var t;var current;colorpreview=new ColorPreview({props:{title:/*option*/ctx[44].label,color:/*option*/ctx[44].value}});var if_block=!/*hidePresetLabel*/ctx[9]&&create_if_block_1$5(ctx);return{c:function c(){span=element(\"span\");create_component(colorpreview.$$.fragment);t=space();if(if_block)if_block.c();attr(span,\"slot\",\"option\");},m:function m(target,anchor){insert(target,span,anchor);mount_component(colorpreview,span,null);append(span,t);if(if_block)if_block.m(span,null);current=true;},p:function p(ctx,dirty){var colorpreview_changes={};if(dirty[1]&/*option*/8192)colorpreview_changes.title=/*option*/ctx[44].label;if(dirty[1]&/*option*/8192)colorpreview_changes.color=/*option*/ctx[44].value;colorpreview.$set(colorpreview_changes);if(!/*hidePresetLabel*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_1$5(ctx);if_block.c();if_block.m(span,null);}}else if(if_block){if_block.d(1);if_block=null;}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(colorpreview);if(if_block)if_block.d();}};}// (359:8) <RadioGroup              label=\"Presets\"             class={arrayJoin(['DokaColorPresets', hidePresetLabel ? 'DokaColorPresetsGrid' : 'DokaColorPresetsList'])}             hideLabel={false}             {name}             {value}             optionGroupClass=\"DokaDropdownOptionGroup\"             optionClass=\"DokaDropdownOption\"             options={options.map(([color, label]) => [color, isFunction(label) ? label(locale) : label])}             {selectedIndex}             {optionMapper}             {optionLabelClass}             onchange={(detail) => updateColorArray(detail.value)}             let:option>\nfunction create_default_slot_1$3(ctx){var t;return{c:function c(){t=space();},m:function m(target,anchor){insert(target,t,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);}};}// (321:4) <div slot=\"details\" class=\"DokaColorPickerPanel\">\nfunction create_details_slot$1(ctx){var div;var t;var current;var if_block0=/*enablePicker*/ctx[13]&&create_if_block_2$3(ctx);var if_block1=/*enablePresets*/ctx[12]&&create_if_block$4(ctx);return{c:function c(){div=element(\"div\");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(div,\"slot\",\"details\");attr(div,\"class\",\"DokaColorPickerPanel\");},m:function m(target,anchor){insert(target,div,anchor);if(if_block0)if_block0.m(div,null);append(div,t);if(if_block1)if_block1.m(div,null);current=true;},p:function p(ctx,dirty){if(/*enablePicker*/ctx[13]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*enablePicker*/8192){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$3(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*enablePresets*/ctx[12]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*enablePresets*/4096){transition_in(if_block1,1);}}else{if_block1=create_if_block$4(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div,null);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}// (310:0) <Details buttonClass={arrayJoin(['DokaColorPickerButton', buttonClass])}>\nfunction create_default_slot$5(ctx){var t;return{c:function c(){t=space();},m:function m(target,anchor){insert(target,t,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);}};}function create_fragment$j(ctx){var details;var current;details=new Details({props:{buttonClass:arrayJoin([\"DokaColorPickerButton\",/*buttonClass*/ctx[5]]),$$slots:{\"default\":[create_default_slot$5],details:[create_details_slot$1],label:[create_label_slot$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(details.$$.fragment);},m:function m(target,anchor){mount_component(details,target,anchor);current=true;},p:function p(ctx,dirty){var details_changes={};if(dirty[0]&/*buttonClass*/32)details_changes.buttonClass=arrayJoin([\"DokaColorPickerButton\",/*buttonClass*/ctx[5]]);if(dirty[0]&/*hidePresetLabel, name, value, options, locale, selectedIndex, optionMapper, optionLabelClass, enablePresets, valueAsRGBA, valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque, opacity, enableOpacity, valueAsRGBAFullySaturated, hue, input, sx, sy, enablePicker, label, title*/8388575|dirty[1]&/*$$scope*/16384){details_changes.$$scope={dirty:dirty,ctx:ctx};}details.$set(details_changes);},i:function i(local){if(current)return;transition_in(details.$$.fragment,local);current=true;},o:function o(local){transition_out(details.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(details,detaching);}};}function instance$j($$self,$$props,$$invalidate){var _$$props$label4=$$props.label,label=_$$props$label4===void 0?undefined:_$$props$label4;var _$$props$name3=$$props.name,name=_$$props$name3===void 0?undefined:_$$props$name3;var _$$props$options3=$$props.options,options=_$$props$options3===void 0?[]:_$$props$options3;var _$$props$selectedInde3=$$props.selectedIndex,selectedIndex=_$$props$selectedInde3===void 0?-1:_$$props$selectedInde3;var _$$props$value4=$$props.value,value=_$$props$value4===void 0?undefined:_$$props$value4;var _$$props$buttonClass2=$$props.buttonClass,buttonClass=_$$props$buttonClass2===void 0?undefined:_$$props$buttonClass2;var _$$props$optionLabelC3=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC3===void 0?undefined:_$$props$optionLabelC3;var _$$props$optionMapper3=$$props.optionMapper,optionMapper=_$$props$optionMapper3===void 0?undefined:_$$props$optionMapper3;var _$$props$onchange4=$$props.onchange,onchange=_$$props$onchange4===void 0?undefined:_$$props$onchange4;var _$$props$title4=$$props.title,title=_$$props$title4===void 0?undefined:_$$props$title4;var _$$props$hidePresetLa=$$props.hidePresetLabel,hidePresetLabel=_$$props$hidePresetLa===void 0?true:_$$props$hidePresetLa;var _$$props$locale4=$$props.locale,locale=_$$props$locale4===void 0?undefined:_$$props$locale4;var _$$props$enableOpacit=$$props.enableOpacity,enableOpacity=_$$props$enableOpacit===void 0?true:_$$props$enableOpacit;var _$$props$enablePreset=$$props.enablePresets,enablePresets=_$$props$enablePreset===void 0?true:_$$props$enablePreset;var _$$props$enablePicker=$$props.enablePicker,enablePicker=_$$props$enablePicker===void 0?true:_$$props$enablePicker;// inputs\nvar hue;var saturation;var brightness;var opacity;// shortcuts\nvar valueAsRGB;var valueAsRGBA;var valueAsRGBAFullyTransparent;var valueAsRGBAFullyOpaque;var valueAsRGBAFullySaturated;var updateProps=function updateProps(color,syncControls){valueAsRGB=[color[0],color[1],color[2]];if(syncControls){var valueAsHSV=RGBToHSV.apply(void 0,_toConsumableArray(valueAsRGB));$$invalidate(14,hue=valueAsHSV[0]);$$invalidate(32,saturation=valueAsHSV[1]);$$invalidate(33,brightness=valueAsHSV[2]);$$invalidate(15,opacity=isNumber(color[3])?color[3]:1);}$$invalidate(16,valueAsRGBA=colorArrayToRGBA(color));$$invalidate(17,valueAsRGBAFullyTransparent=colorArrayToRGBA([].concat(_toConsumableArray(valueAsRGB),[0])));$$invalidate(18,valueAsRGBAFullyOpaque=colorArrayToRGBA([].concat(_toConsumableArray(valueAsRGB),[1])));$$invalidate(19,valueAsRGBAFullySaturated=colorArrayToRGBA(HSVToRGB(hue,1,1)));};value&&updateProps(value,true);var update=function update(){var rgb=HSVToRGB(hue,saturation,brightness);var rgba=[].concat(_toConsumableArray(rgb),[opacity]);updateProps(rgba);onchange(rgba);};var updateColorArray=function updateColorArray(arr){var rgba=arr.length===3?[].concat(_toConsumableArray(arr),[1]):arr;updateProps(rgba,true);onchange(rgba);};var updateHue=function updateHue(h){$$invalidate(14,hue=h);if(opacity===0)$$invalidate(15,opacity=1);update();};var updateSaturationAndBrightness=function updateSaturationAndBrightness(s,b){$$invalidate(32,saturation=s);$$invalidate(33,brightness=b);if(opacity===0)$$invalidate(15,opacity=1);update();};var updateOpacity=function updateOpacity(o){$$invalidate(15,opacity=o);update();};var setValueByOffset=function setValueByOffset(offset,inputSize){var x=clamp(offset.x/inputSize.width,0,1);var y=clamp(offset.y/inputSize.height,0,1);updateSaturationAndBrightness(x,1-y);};var input;var inputSize;var inputOffset;var inputPageOffset;var handlePointerDown=function handlePointerDown(e){e.stopPropagation();inputSize=sizeCreate(input.offsetWidth,input.offsetHeight);inputOffset=vectorCreateFromPointerEventOffset(e);inputPageOffset=vectorCreateFromPointerEvent(e);setValueByOffset(inputOffset,inputSize);document.documentElement.addEventListener(\"pointermove\",handlePointerMove);document.documentElement.addEventListener(\"pointerup\",handlePointerUp);};var handlePointerMove=function handlePointerMove(e){var d=vectorSubtract(vectorCreateFromPointerEvent(e),inputPageOffset);setValueByOffset(vectorAdd(vectorClone(inputOffset),d),inputSize);};var handlePointerUp=function handlePointerUp(e){inputSize=undefined;document.documentElement.removeEventListener(\"pointermove\",handlePointerMove);document.documentElement.removeEventListener(\"pointerup\",handlePointerUp);};var handleNudge=function handleNudge(e){inputSize=sizeCreate(input.offsetWidth,input.offsetHeight);var x=sx/100*inputSize.width;var y=sy/100*inputSize.height;setValueByOffset({x:x+e.detail.x,y:y+e.detail.y},inputSize);};function div2_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){input=$$value;$$invalidate(20,input);});}var func=function func(_ref198){var _ref199=_slicedToArray(_ref198,2),color=_ref199[0],label=_ref199[1];return[color,isFunction(label)?label(locale):label];};var func_1=function func_1(detail){return updateColorArray(detail.value);};$$self.$$set=function($$props){if(\"label\"in $$props)$$invalidate(0,label=$$props.label);if(\"name\"in $$props)$$invalidate(1,name=$$props.name);if(\"options\"in $$props)$$invalidate(2,options=$$props.options);if(\"selectedIndex\"in $$props)$$invalidate(3,selectedIndex=$$props.selectedIndex);if(\"value\"in $$props)$$invalidate(4,value=$$props.value);if(\"buttonClass\"in $$props)$$invalidate(5,buttonClass=$$props.buttonClass);if(\"optionLabelClass\"in $$props)$$invalidate(6,optionLabelClass=$$props.optionLabelClass);if(\"optionMapper\"in $$props)$$invalidate(7,optionMapper=$$props.optionMapper);if(\"onchange\"in $$props)$$invalidate(28,onchange=$$props.onchange);if(\"title\"in $$props)$$invalidate(8,title=$$props.title);if(\"hidePresetLabel\"in $$props)$$invalidate(9,hidePresetLabel=$$props.hidePresetLabel);if(\"locale\"in $$props)$$invalidate(10,locale=$$props.locale);if(\"enableOpacity\"in $$props)$$invalidate(11,enableOpacity=$$props.enableOpacity);if(\"enablePresets\"in $$props)$$invalidate(12,enablePresets=$$props.enablePresets);if(\"enablePicker\"in $$props)$$invalidate(13,enablePicker=$$props.enablePicker);};var sx;var sy;$$self.$$.update=function(){if($$self.$$.dirty[1]&/*saturation*/2){$$invalidate(21,sx=saturation*100);}if($$self.$$.dirty[1]&/*brightness*/4){$$invalidate(22,sy=100-brightness*100);}};return[label,name,options,selectedIndex,value,buttonClass,optionLabelClass,optionMapper,title,hidePresetLabel,locale,enableOpacity,enablePresets,enablePicker,hue,opacity,valueAsRGBA,valueAsRGBAFullyTransparent,valueAsRGBAFullyOpaque,valueAsRGBAFullySaturated,input,sx,sy,updateColorArray,updateHue,updateOpacity,handlePointerDown,handleNudge,onchange,div2_binding,func,func_1];}var ColorPicker=/*#__PURE__*/function(_SvelteComponent20){_inherits(ColorPicker,_SvelteComponent20);var _super22=_createSuper(ColorPicker);function ColorPicker(options){var _this22;_classCallCheck(this,ColorPicker);_this22=_super22.call(this);init(_assertThisInitialized(_this22),options,instance$j,create_fragment$j,safe_not_equal,{label:0,name:1,options:2,selectedIndex:3,value:4,buttonClass:5,optionLabelClass:6,optionMapper:7,onchange:28,title:8,hidePresetLabel:9,locale:10,enableOpacity:11,enablePresets:12,enablePicker:13},[-1,-1]);return _this22;}return ColorPicker;}(SvelteComponent);var upperCaseFirstLetter=function upperCaseFirstLetter(str){return str.charAt(0).toUpperCase()+str.slice(1);};// @ts-ignore\nvar toLocaleFn=function toLocaleFn(key,localePrefix){return function(locale){return locale[localePrefix?\"\".concat(localePrefix).concat(upperCaseFirstLetter(key)):key];};};var mapToSizeOption=function mapToSizeOption(v){return[v,\"\".concat(v)];};var createLocaleMapper=function createLocaleMapper(options,localePrefix){return function(key){return[options[key],toLocaleFn(key,localePrefix)];};};var toolColorDefault=[1,0.2549,0.2118];var toolStrokeColorDefault=[1,1,1,0];//#region tools\nvar toolShapeDefaults={path:function path(){return{points:[],disableErase:false};},line:function line(){return{x1:0,y1:0,x2:0,y2:0,disableErase:false};},rectangle:function rectangle(){return{x:0,y:0,width:0,height:0};},ellipse:function ellipse(){return{x:0,y:0,rx:0,ry:0};},text:function text(){return{x:0,y:0,text:'Text'};}};var createToolStyle=function createToolStyle(type){var shape=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{position:'relative'};if(!toolShapeDefaults[type])return;var shapeDef=_objectSpread(_objectSpread({},toolShapeDefaults[type]()),shape);return[shapeDef,options];};var createToolStyles=function createToolStyles(tools){return _objectSpread({sharpie:createToolStyle('path',{strokeWidth:'0.5%',strokeColor:[].concat(toolColorDefault)}),line:createToolStyle('line',{strokeColor:[].concat(toolColorDefault),strokeWidth:'0.5%'}),arrow:createToolStyle('line',{lineEnd:'arrow-solid',strokeColor:[].concat(toolColorDefault),strokeWidth:'0.5%'}),rectangle:createToolStyle('rectangle',{strokeColor:[].concat(toolStrokeColorDefault),backgroundColor:[].concat(toolColorDefault)}),ellipse:createToolStyle('ellipse',{strokeColor:[].concat(toolStrokeColorDefault),backgroundColor:[].concat(toolColorDefault)}),text:createToolStyle('text',{color:[].concat(toolColorDefault),fontSize:'2%'})},tools);};//#endregion\n//#region toolbar\nvar createToolbarItem=function createToolbarItem(tool,label,props){return[tool,label||toLocaleFn(tool,'shapeLabelTool'),_objectSpread({icon:toLocaleFn(tool,'shapeIconTool')},props)];};var createToolbar=function createToolbar(){var tools=arguments.length>0&&arguments[0]!==undefined?arguments[0]:['sharpie','eraser','line','arrow','rectangle','ellipse','text','preset'];return tools.map(function(tool){// default tool definition, assume locale in\nif(isString(tool))return createToolbarItem(tool);// tool def with propery\nif(Array.isArray(tool)){// state update of tool with key in locale object\nif(isObject(tool[1]))return createToolbarItem(tool[0],undefined,tool[1]);// should be string, string\nreturn createToolbarItem(tool[0],tool[1],tool[2]);}}).filter(Boolean);};//#endregion\n//#region style option defaults\nvar createDefaultColorOptions=function createDefaultColorOptions(){return{transparent:[1,1,1,0],white:[1,1,1],silver:[0.8667,0.8667,0.8667],gray:[0.6667,0.6667,0.6667],black:[0,0,0],navy:[0,0.1216,0.2471],blue:[0,0.4549,0.851],aqua:[0.498,0.8588,1],teal:[0.2235,0.8,0.8],olive:[0.2392,0.6,0.4392],green:[0.1804,0.8,0.251],yellow:[1,0.8627,0],orange:[1,0.5216,0.1059],red:[1,0.2549,0.2118],maroon:[0.5216,0.0784,0.2941],fuchsia:[0.9412,0.0706,0.7451],purple:[0.6941,0.051,0.7882]};};var createDefaultFontSizeOptions=function createDefaultFontSizeOptions(){return[16,18,20,24,30,36,48,64,72,96,144];};var createDefaultFontScaleOptions=function createDefaultFontScaleOptions(){return{extraSmall:'2%',small:'4%',mediumSmall:'8%',medium:'10%',mediumLarge:'15%',large:'20%',extraLarge:'25%'};};var createDefaultStrokeWidthOptions=function createDefaultStrokeWidthOptions(){return[1,2,3,4,6,8,12,16,20,24,32,48];};var createDefaultStrokeScaleOptions=function createDefaultStrokeScaleOptions(){return{extraSmall:'0.25%',small:'0.5%',mediumSmall:'1%',medium:'1.75%',mediumLarge:'2.5%',large:'3.5%',extraLarge:'5%'};};var createDefaultLineEndStyleOptions=function createDefaultLineEndStyleOptions(){return['bar','arrow','arrowSolid','circle','circleSolid','square','squareSolid'];};var createDefaultFontFamilyOptions=function createDefaultFontFamilyOptions(){return[[\"Helvetica, Arial, Verdana, 'Droid Sans', sans-serif\",'Sans Serif'],[\"'Arial Black', 'Avenir-Black', 'Arial Bold'\",'Black'],[\"'Arial Narrow', 'Futura-CondensedMedium'\",'Narrow'],[\"'Trebuchet MS'\",'Humanist'],[\"Georgia, 'Avenir-Black', 'Times New Roman', 'Droid Serif', serif\",'Serif'],[\"Palatino\",'Old-Style'],[\"'Times New Roman', 'TimesNewRomanPSMT'\",'Transitional'],[\"Menlo, Monaco, 'Lucida Console', monospace\",'Monospaced'],[\"'Courier New', monospace\",'Slab Serif']];};var createDefaultTextAlignOptions=function createDefaultTextAlignOptions(){return['left','center','right'];};var createDefaultFontStyleOptions=function createDefaultFontStyleOptions(){return[['normal','bold'],['italic','normal'],['italic','bold']];};//#endregion\n//#region style options\nvar createColorOptions=function createColorOptions(colors){return Object.keys(colors).map(createLocaleMapper(colors,'shapeTitleColor'));};var createFontSizeOptions=function createFontSizeOptions(sizes){return sizes.map(mapToSizeOption);};var createFontScaleOptions=function createFontScaleOptions(scales){return Object.keys(scales).map(createLocaleMapper(scales,'labelSize'));};var createStrokeWidthOptions=function createStrokeWidthOptions(sizes){return sizes.map(mapToSizeOption);};var createStrokeScaleOptions=function createStrokeScaleOptions(scales){return Object.keys(scales).map(createLocaleMapper(scales,'labelSize'));};var createFontFamilyOptions=function createFontFamilyOptions(fonts){return _toConsumableArray(fonts);};var createFontStyleOptions=function createFontStyleOptions(styles){return styles.map(function(style){return[style,function(locale){return locale[\"shapeLabelFontStyle\".concat(style.filter(function(v){return v!=='normal';}).map(upperCaseFirstLetter).join(''))];}];});};var createLineEndStyleOptions=function createLineEndStyleOptions(styles){return styles.map(function(style){return[toKebabCase(style),function(locale){return locale[\"shapeTitleLineDecoration\".concat(upperCaseFirstLetter(style))];},{icon:function icon(locale){return locale[\"shapeIconLineDecoration\".concat(upperCaseFirstLetter(style))];}}];});};var createTextAlignOptions=function createTextAlignOptions(options){return options.map(function(align){return[align,function(locale){return locale[\"shapeTitleTextAlign\".concat(upperCaseFirstLetter(align))];},{hideLabel:true,icon:function icon(locale){return locale[\"shapeIconTextAlign\".concat(upperCaseFirstLetter(align))];}}];});};var createControlOptions=function createControlOptions(items,options){var _ref200=options||{},defaultKey=_ref200.defaultKey,defaultOptions=_ref200.defaultOptions;var arr=[];if(defaultKey)arr[0]=[undefined,function(locale){return locale[defaultKey];},_objectSpread({},defaultOptions)];return[].concat(arr,_toConsumableArray(items));};//#endregion\n//#region shape style controls\nvar createFontFamilyControl=function createFontFamilyControl(fontFamilies){return[Dropdown,{title:function title(locale){return locale.shapeTitleFontFamily;},optionLabelStyle:function optionLabelStyle(value){return\"font-family: \".concat(value);},options:createControlOptions(fontFamilies,{defaultKey:'labelDefault'}),optionFilter:function optionFilter(fontFamilyOption){// don't filter if not in browser context\nif(!isBrowser())return true;// get font stack\nvar _fontFamilyOption=_slicedToArray(fontFamilyOption,1),stack=_fontFamilyOption[0];// allow if undefined\nif(!stack)return true;// filter out fonts that aren't available\nreturn stack.split(',').map(function(name){return name.trim();}).some(function(name){// @ts-ignore\nreturn document.fonts.check(\"16px \".concat(name));});}}];};var createBackgroundColorControl=function createBackgroundColorControl(items){return[ColorPicker,{title:function title(locale){return locale.shapeTitleBackgroundColor;},options:createControlOptions(items)}];};var createStrokeColorControl=function createStrokeColorControl(items){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return[ColorPicker,{title:function title(locale){return locale.shapeTitleStrokeColor;},options:createControlOptions(items),buttonClass:'DokaColorPickerButtonStroke',onchange:function onchange(value,shape){// get shape strokeWidth as number\nvar strokeWidth=shape.strokeWidth;var strokeWidthParsed=isNumber(strokeWidth)||isString(strokeWidth)?parseFloat(strokeWidth):0;// already has outline\nif(strokeWidthParsed>0)return;// set outline to first stroke width\nshape.strokeWidth=options&&options.defaultStrokeWidth||'0.5%';}}];};var createStrokeWidthControl=function createStrokeWidthControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleStrokeWidth;},options:function options(shape){if(hasProp(shape,'backgroundColor'))return createControlOptions(items,{defaultKey:'shapeLabelStrokeNone'});return createControlOptions(items);}}];};var createLineControl=function createLineControl(items,titleKey,optionIconStyle){return[Dropdown,{title:function title(locale){return locale[titleKey];},options:createControlOptions(items,{defaultKey:'labelNone',defaultOptions:{icon:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-width=\\\".125em\\\"><path d=\\\"M5,12 H14\\\"/></g>\"}}),optionIconStyle:optionIconStyle}];};var createLineStartStyleControl=function createLineStartStyleControl(items){return createLineControl(items,'shapeTitleLineStart',\"transform: scaleX(-1)\");};var createLineEndStyleControl=function createLineEndStyleControl(items){return createLineControl(items,'shapeTitleLineEnd');};var createFontColorControl=function createFontColorControl(items){return[ColorPicker,{title:function title(locale){return locale.shapeTitleTextColor;},options:createControlOptions(items)}];};var createFontStyleControl=function createFontStyleControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleFontStyle;},optionLabelStyle:function optionLabelStyle(value){return value&&\"font-style:\".concat(value[0],\";font-weight:\").concat(value[1]);},options:createControlOptions(items,{defaultKey:'shapeLabelFontStyleNormal'})}];};var createFontSizeControl=function createFontSizeControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleFontSize;},options:createControlOptions(items,{defaultKey:'labelDefault'})}];};var createTextAlignControl=function createTextAlignControl(items){return[RadioGroup,{title:function title(locale){return locale.shapeTitleTextAlign;},options:createControlOptions(items)}];};var createLineHeightControl=function createLineHeightControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleLineHeight;},options:createControlOptions(items,{defaultKey:'labelAuto'})}];};var createShapeStyleControls=function createShapeStyleControls(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$colorOptions=options.colorOptions,colorOptions=_options$colorOptions===void 0?createColorOptions(createDefaultColorOptions()):_options$colorOptions,_options$strokeWidthO=options.strokeWidthOptions,strokeWidthOptions=_options$strokeWidthO===void 0?createStrokeScaleOptions(createDefaultStrokeScaleOptions()):_options$strokeWidthO,_options$lineEndStyle=options.lineEndStyleOptions,lineEndStyleOptions=_options$lineEndStyle===void 0?createLineEndStyleOptions(createDefaultLineEndStyleOptions()):_options$lineEndStyle,_options$fontFamilyOp=options.fontFamilyOptions,fontFamilyOptions=_options$fontFamilyOp===void 0?createFontFamilyOptions(createDefaultFontFamilyOptions()):_options$fontFamilyOp,_options$fontStyleOpt=options.fontStyleOptions,fontStyleOptions=_options$fontStyleOpt===void 0?createFontStyleOptions(createDefaultFontStyleOptions()):_options$fontStyleOpt,_options$fontSizeOpti=options.fontSizeOptions,fontSizeOptions=_options$fontSizeOpti===void 0?createFontScaleOptions(createDefaultFontScaleOptions()):_options$fontSizeOpti,_options$textAlignOpt=options.textAlignOptions,textAlignOptions=_options$textAlignOpt===void 0?createTextAlignOptions(createDefaultTextAlignOptions()):_options$textAlignOpt;return{// shape background\nbackgroundColor:colorOptions&&createBackgroundColorControl(colorOptions),// line/outline\nstrokeColor:colorOptions&&createStrokeColorControl(colorOptions),strokeWidth:strokeWidthOptions&&createStrokeWidthControl(strokeWidthOptions),// line\nlineStart:lineEndStyleOptions&&createLineStartStyleControl(lineEndStyleOptions),lineEnd:lineEndStyleOptions&&createLineEndStyleControl(lineEndStyleOptions),// text\ncolor:colorOptions&&createFontColorControl(colorOptions),fontFamily:fontFamilyOptions&&createFontFamilyControl(fontFamilyOptions),fontStyle_fontWeight:fontStyleOptions&&createFontStyleControl(fontStyleOptions),fontSize:fontSizeOptions&&createFontSizeControl(fontSizeOptions),textAlign:textAlignOptions&&createTextAlignControl(textAlignOptions)};};//#endregion\n/* src/core/ui/components/Measure.svelte generated by Svelte v3.29.4 */function create_fragment$k(ctx){var div;var measurable_action;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[3][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[2],null);return{c:function c(){div=element(\"div\");if(default_slot)default_slot.c();attr(div,\"class\",/*klass*/ctx[0]);},m:function m(target,anchor){insert(target,div,anchor);if(default_slot){default_slot.m(div,null);}current=true;if(!mounted){dispose=[listen(div,\"measure\",/*handleResize*/ctx[1]),action_destroyer(measurable_action=measurable.call(null,div))];mounted=true;}},p:function p(ctx,_ref201){var _ref202=_slicedToArray(_ref201,1),dirty=_ref202[0];if(default_slot){if(default_slot.p&&dirty&/*$$scope*/4){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[2],dirty,null,null);}}if(!current||dirty&/*klass*/1){attr(div,\"class\",/*klass*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$k($$self,$$props,$$invalidate){var _$$props$$$slots9=$$props.$$slots,slots=_$$props$$$slots9===void 0?{}:_$$props$$$slots9,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();var _$$props$class12=$$props[\"class\"],klass=_$$props$class12===void 0?null:_$$props$class12;var handleResize=function handleResize(_ref203){var detail=_ref203.detail;return dispatch(\"measure\",detail);};$$self.$$set=function($$props){if(\"class\"in $$props)$$invalidate(0,klass=$$props[\"class\"]);if(\"$$scope\"in $$props)$$invalidate(2,$$scope=$$props.$$scope);};return[klass,handleResize,$$scope,slots];}var Measure=/*#__PURE__*/function(_SvelteComponent21){_inherits(Measure,_SvelteComponent21);var _super23=_createSuper(Measure);function Measure(options){var _this23;_classCallCheck(this,Measure);_this23=_super23.call(this);init(_assertThisInitialized(_this23),options,instance$k,create_fragment$k,safe_not_equal,{\"class\":0});return _this23;}return Measure;}(SvelteComponent);/* src/core/ui/components/Util.svelte generated by Svelte v3.29.4 */var get_footer_slot_changes=function get_footer_slot_changes(dirty){return{};};var get_footer_slot_context=function get_footer_slot_context(ctx){return{};};var get_main_slot_changes=function get_main_slot_changes(dirty){return{};};var get_main_slot_context=function get_main_slot_context(ctx){return{};};var get_header_slot_changes=function get_header_slot_changes(dirty){return{};};var get_header_slot_context=function get_header_slot_context(ctx){return{};};// (209:0) {#if hasHeader}\nfunction create_if_block_2$4(ctx){var div;var current;var header_slot_template=/*#slots*/ctx[4].header;var header_slot=create_slot(header_slot_template,ctx,/*$$scope*/ctx[3],get_header_slot_context);return{c:function c(){div=element(\"div\");if(header_slot)header_slot.c();attr(div,\"class\",\"DokaUtilHeader\");},m:function m(target,anchor){insert(target,div,anchor);if(header_slot){header_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(header_slot){if(header_slot.p&&dirty&/*$$scope*/8){update_slot(header_slot,header_slot_template,ctx,/*$$scope*/ctx[3],dirty,get_header_slot_changes,get_header_slot_context);}}},i:function i(local){if(current)return;transition_in(header_slot,local);current=true;},o:function o(local){transition_out(header_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(header_slot)header_slot.d(detaching);}};}// (216:22) <Measure class=\"DokaStage\" on:measure/>\nfunction fallback_block$2(ctx){var measure;var current;measure=new Measure({props:{\"class\":\"DokaStage\"}});measure.$on(\"measure\",/*measure_handler*/ctx[5]);return{c:function c(){create_component(measure.$$.fragment);},m:function m(target,anchor){mount_component(measure,target,anchor);current=true;},p:noop$1,i:function i(local){if(current)return;transition_in(measure.$$.fragment,local);current=true;},o:function o(local){transition_out(measure.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(measure,detaching);}};}// (219:0) {#if hasFooter}\nfunction create_if_block_1$6(ctx){var div;var current;var footer_slot_template=/*#slots*/ctx[4].footer;var footer_slot=create_slot(footer_slot_template,ctx,/*$$scope*/ctx[3],get_footer_slot_context);return{c:function c(){div=element(\"div\");if(footer_slot)footer_slot.c();attr(div,\"class\",\"DokaUtilFooter\");},m:function m(target,anchor){insert(target,div,anchor);if(footer_slot){footer_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(footer_slot){if(footer_slot.p&&dirty&/*$$scope*/8){update_slot(footer_slot,footer_slot_template,ctx,/*$$scope*/ctx[3],dirty,get_footer_slot_changes,get_footer_slot_context);}}},i:function i(local){if(current)return;transition_in(footer_slot,local);current=true;},o:function o(local){transition_out(footer_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(footer_slot)footer_slot.d(detaching);}};}function create_fragment$l(ctx){var t0;var div;var t1;var t2;var if_block2_anchor;var current;var if_block0=/*hasHeader*/ctx[1]&&create_if_block_2$4(ctx);var main_slot_template=/*#slots*/ctx[4].main;var main_slot=create_slot(main_slot_template,ctx,/*$$scope*/ctx[3],get_main_slot_context);var main_slot_or_fallback=main_slot||fallback_block$2(ctx);var if_block1=/*hasFooter*/ctx[2]&&create_if_block_1$6(ctx);var if_block2=false;return{c:function c(){if(if_block0)if_block0.c();t0=space();div=element(\"div\");if(main_slot_or_fallback)main_slot_or_fallback.c();t1=space();if(if_block1)if_block1.c();t2=space();if_block2_anchor=empty();attr(div,\"class\",\"DokaUtilMain\");},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);insert(target,div,anchor);if(main_slot_or_fallback){main_slot_or_fallback.m(div,null);}/*div_binding*/ctx[6](div);insert(target,t1,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t2,anchor);insert(target,if_block2_anchor,anchor);current=true;},p:function p(ctx,_ref204){var _ref205=_slicedToArray(_ref204,1),dirty=_ref205[0];if(/*hasHeader*/ctx[1]){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*hasHeader*/2){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$4(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(main_slot){if(main_slot.p&&dirty&/*$$scope*/8){update_slot(main_slot,main_slot_template,ctx,/*$$scope*/ctx[3],dirty,get_main_slot_changes,get_main_slot_context);}}if(/*hasFooter*/ctx[2]){if(if_block1){if_block1.p(ctx,dirty);if(dirty&/*hasFooter*/4){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$6(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(t2.parentNode,t2);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(main_slot_or_fallback,local);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){transition_out(if_block0);transition_out(main_slot_or_fallback,local);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(detaching)detach(div);if(main_slot_or_fallback)main_slot_or_fallback.d(detaching);/*div_binding*/ctx[6](null);if(detaching)detach(t1);if(if_block1)if_block1.d(detaching);if(detaching)detach(t2);if(detaching)detach(if_block2_anchor);}};}function instance$l($$self,$$props,$$invalidate){var _$$props=$$props,_$$props$$$slots10=_$$props.$$slots,slots=_$$props$$$slots10===void 0?{}:_$$props$$$slots10,$$scope=_$$props.$$scope;var _$$props2=$$props,_$$props2$hasHeader=_$$props2.hasHeader,hasHeader=_$$props2$hasHeader===void 0?!!$$props.$$slots.header:_$$props2$hasHeader;var _$$props3=$$props,_$$props3$hasFooter=_$$props3.hasFooter,hasFooter=_$$props3$hasFooter===void 0?!!$$props.$$slots.footer:_$$props3$hasFooter;var _$$props4=$$props,_$$props4$root=_$$props4.root,root=_$$props4$root===void 0?undefined:_$$props4$root;function measure_handler(event){bubble($$self,event);}function div_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(0,root);});}$$self.$$set=function($$new_props){$$invalidate(7,$$props=assign(assign({},$$props),exclude_internal_props($$new_props)));if(\"hasHeader\"in $$new_props)$$invalidate(1,hasHeader=$$new_props.hasHeader);if(\"hasFooter\"in $$new_props)$$invalidate(2,hasFooter=$$new_props.hasFooter);if(\"root\"in $$new_props)$$invalidate(0,root=$$new_props.root);if(\"$$scope\"in $$new_props)$$invalidate(3,$$scope=$$new_props.$$scope);};$$props=exclude_internal_props($$props);return[root,hasHeader,hasFooter,$$scope,slots,measure_handler,div_binding];}var Util=/*#__PURE__*/function(_SvelteComponent22){_inherits(Util,_SvelteComponent22);var _super24=_createSuper(Util);function Util(options){var _this24;_classCallCheck(this,Util);_this24=_super24.call(this);init(_assertThisInitialized(_this24),options,instance$l,create_fragment$l,safe_not_equal,{hasHeader:1,hasFooter:2,root:0});return _this24;}return Util;}(SvelteComponent);var toFraction=function toFraction(value,min,max){return(value-min)/(max-min);};/* src/core/ui/components/RangeInput.svelte generated by Svelte v3.29.4 */function create_if_block$5(ctx){var div;var div_style_value;return{c:function c(){div=element(\"div\");attr(div,\"class\",\"DokaRangeInputMeter\");attr(div,\"style\",div_style_value=\"transform: translateX(\".concat(/*$position*/ctx[9].x-/*svgPadding*/ctx[10].x,\"px) translateY(\").concat(/*$position*/ctx[9].y-/*svgPadding*/ctx[10].y,\"px)\"));},m:function m(target,anchor){insert(target,div,anchor);div.innerHTML=/*svg*/ctx[6];},p:function p(ctx,dirty){if(dirty[0]&/*svg*/64)div.innerHTML=/*svg*/ctx[6];if(dirty[0]&/*$position*/512&&div_style_value!==(div_style_value=\"transform: translateX(\".concat(/*$position*/ctx[9].x-/*svgPadding*/ctx[10].x,\"px) translateY(\").concat(/*$position*/ctx[9].y-/*svgPadding*/ctx[10].y,\"px)\"))){attr(div,\"style\",div_style_value);}},d:function d(detaching){if(detaching)detach(div);}};}function create_fragment$m(ctx){var div1;var span;var t0;var t1;var button;var t2;var button_disabled_value;var t3;var div0;var interactable_action;var measurable_action;var nudgeable_action;var mounted;var dispose;var if_block=/*$position*/ctx[9]&&create_if_block$5(ctx);return{c:function c(){div1=element(\"div\");span=element(\"span\");t0=text(/*valueLabel*/ctx[4]);t1=space();button=element(\"button\");t2=text(/*labelReset*/ctx[1]);t3=space();div0=element(\"div\");if(if_block)if_block.c();attr(span,\"class\",\"DokaRangeInputValue\");attr(button,\"class\",\"DokaRangeInputReset\");attr(button,\"type\",\"button\");button.disabled=button_disabled_value=/*value*/ctx[0]===/*base*/ctx[3];attr(div0,\"class\",\"DokaRangeInputInner\");attr(div0,\"style\",/*rangeMask*/ctx[8]);attr(div0,\"data-value-limited\",/*isLimited*/ctx[7]);attr(div1,\"class\",\"DokaRangeInput\");attr(div1,\"tabindex\",\"0\");},m:function m(target,anchor){insert(target,div1,anchor);append(div1,span);append(span,t0);append(div1,t1);append(div1,button);append(button,t2);append(div1,t3);append(div1,div0);if(if_block)if_block.m(div0,null);if(!mounted){dispose=[listen(button,\"click\",/*handleReset*/ctx[15]),listen(div0,\"interactionstart\",/*handleDragStart*/ctx[11]),listen(div0,\"interactionupdate\",/*handleDragMove*/ctx[13]),listen(div0,\"interactionend\",/*handleDragEnd*/ctx[14]),listen(div0,\"interactionrelease\",/*handleDragRelease*/ctx[12]),action_destroyer(interactable_action=interactable.call(null,div0,{inertia:true})),listen(div0,\"measure\",/*measure_handler*/ctx[27]),action_destroyer(measurable_action=measurable.call(null,div0)),listen(div1,\"wheel\",/*handleWheel*/ctx[17]),listen(div1,\"nudge\",/*handleNudge*/ctx[18]),action_destroyer(nudgeable_action=nudgeable.call(null,div1,/*direction*/ctx[2]=\"horizontal\"))];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*valueLabel*/16)set_data(t0,/*valueLabel*/ctx[4]);if(dirty[0]&/*labelReset*/2)set_data(t2,/*labelReset*/ctx[1]);if(dirty[0]&/*value, base*/9&&button_disabled_value!==(button_disabled_value=/*value*/ctx[0]===/*base*/ctx[3])){button.disabled=button_disabled_value;}if(/*$position*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block$5(ctx);if_block.c();if_block.m(div0,null);}}else if(if_block){if_block.d(1);if_block=null;}if(dirty[0]&/*rangeMask*/256){attr(div0,\"style\",/*rangeMask*/ctx[8]);}if(dirty[0]&/*isLimited*/128){attr(div0,\"data-value-limited\",/*isLimited*/ctx[7]);}if(nudgeable_action&&is_function(nudgeable_action.update)&&dirty[0]&/*direction*/4)nudgeable_action.update.call(null,/*direction*/ctx[2]=\"horizontal\");},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(div1);if(if_block)if_block.d();mounted=false;run_all(dispose);}};}var radiusBig=2;var radiusSmall=0.75;var indicatorSpacing=10;var indicatorInterval=5;var indicatorCount=40;// must be even\nfunction instance$m($$self,$$props,$$invalidate){var $position;var _$$props$labelReset=$$props.labelReset,labelReset=_$$props$labelReset===void 0?\"Reset\":_$$props$labelReset;var _$$props$direction=$$props.direction,direction=_$$props$direction===void 0?\"x\":_$$props$direction;var _$$props$min3=$$props.min,min=_$$props$min3===void 0?0:_$$props$min3;var _$$props$max3=$$props.max,max=_$$props$max3===void 0?1:_$$props$max3;var _$$props$base=$$props.base,base=_$$props$base===void 0?min:_$$props$base;var _$$props$value5=$$props.value,value=_$$props$value5===void 0?0:_$$props$value5;var _$$props$valueLabel=$$props.valueLabel,valueLabel=_$$props$valueLabel===void 0?0:_$$props$valueLabel;var _$$props$valueMin=$$props.valueMin,valueMin=_$$props$valueMin===void 0?undefined:_$$props$valueMin;var _$$props$valueMax=$$props.valueMax,valueMax=_$$props$valueMax===void 0?undefined:_$$props$valueMax;var _$$props$oninputstart=$$props.oninputstart,oninputstart=_$$props$oninputstart===void 0?noop:_$$props$oninputstart;var _$$props$oninputmove=$$props.oninputmove,oninputmove=_$$props$oninputmove===void 0?noop:_$$props$oninputmove;var _$$props$oninputend=$$props.oninputend,oninputend=_$$props$oninputend===void 0?noop:_$$props$oninputend;var _$$props$elasticity2=$$props.elasticity,elasticity=_$$props$elasticity2===void 0?0:_$$props$elasticity2;var round=function round(number,increment,offset){return Math.ceil((number-offset)/increment)*increment+offset;};var size;var svg;var svgSize;var svgPadding={x:2,y:0};function getMask(limitedMin,limitedMax){var step=1/indicatorCount;var from=toFraction(limitedMin,min,max);var to=toFraction(limitedMax,min,max);var fromSnapped=fixPrecision(round(from,step,0)-step*0.5);var toSnapped=fixPrecision(round(to,step,0)-step*0.5);return\"--range-mask-from:\".concat(fromSnapped*100,\"%;--range-mask-to:\").concat(toSnapped*100,\"%\");}//\n// Dragging related\n//\nvar interactionOrigin=undefined;var interactionReleased=false;var interactionRange;var interactionOptions={snap:false,elastic:false};var handleDragStart=function handleDragStart(){interactionReleased=false;interactionOrigin=get_store_value(position);interactionRange=[valueToPosition(valueMin!=null?valueMin:min,direction),valueToPosition(valueMax!=null?valueMax:max,direction)];oninputstart();};var handleDragRelease=function handleDragRelease(){interactionReleased=true;};var handleDragMove=function handleDragMove(_ref206){var detail=_ref206.detail;interactionOptions.snap=!interactionReleased;interactionOptions.elastic=!interactionReleased;translatePosition(interactionOrigin,detail.translation,interactionOptions);};var handleDragEnd=function handleDragEnd(_ref207){var detail=_ref207.detail;interactionOptions.snap=false;interactionOptions.elastic=false;var valueAtPosition=translatePosition(interactionOrigin,detail.translation,interactionOptions);interactionOrigin=undefined;interactionRange=undefined;// if is near base position, set to base\nif(Math.abs(valueAtPosition-base)<0.01)return oninputend(base);oninputend(valueAtPosition);};var translatePosition=function translatePosition(origin,translation,options){var target=origin[direction]+translation[direction];var targetLimited=clamp(target,interactionRange[1][direction],interactionRange[0][direction]);var targetElastic=elasticity?targetLimited+elastify(target-targetLimited,elasticity):targetLimited;var targetVisual=options.elastic?targetElastic:targetLimited;// set position\nvar targetValid=vectorCreate(0,0);targetValid[direction]=targetVisual;position.set(targetValid,{hard:options.snap});return clamp(positionToValue(targetValid,direction),min,max);};var handleReset=function handleReset(){$$invalidate(0,value=clamp(base,valueMinLimited,valueMaxLimited));oninputstart();oninputend(value);};//\n// Meter position and value updates\n//\nvar position=spring();component_subscribe($$self,position,function(value){return $$invalidate(9,$position=value);});var valueToPosition=function valueToPosition(value,axis){var offset=(size[axis]-barSize[axis])*0.5;var fraction=toFraction(value,min,max);var v=fraction*barSize[axis]-barSize[axis]*0.5;var pos=offset-v;return{x:axis===\"x\"?pos:0,y:axis===\"y\"?pos:0};};var positionToValue=function positionToValue(position,axis){var dist=position[axis]-size[axis]*0.5;var fraction=-(dist/barSize[axis]);return min+fraction*range;};position.subscribe(function(currentPosition){// if not positioned yet or is not interacting we're not interested in this event\nif(!currentPosition||!interactionOrigin)return;oninputmove(clamp(positionToValue(currentPosition,direction),min,max));});var updatePosition=function updatePosition(value){var interactionRange=[valueToPosition(valueMin!=null?valueMin:min,direction),valueToPosition(valueMax!=null?valueMax:max,direction)];var target={x:direction===\"x\"?$position.x+value:0,y:direction===\"y\"?$position.y+value:0};var targetLimited=clamp(target[direction],interactionRange[1][direction],interactionRange[0][direction]);var positionTarget=_objectSpread(_objectSpread({},$position),{},_defineProperty({},direction,targetLimited));set_store_value(position,$position=positionTarget,$position);var result=clamp(positionToValue(positionTarget,direction),min,max);oninputstart();oninputmove(result);oninputend(result);};var handleWheel=function handleWheel(e){// don't run default actions, prevent other actions from running\ne.preventDefault();e.stopPropagation();// apply wheel delta to offset\nvar step=8;var delta=getWheelDelta(e)*step;updatePosition(delta);};var handleNudge=function handleNudge(_ref208){var detail=_ref208.detail;updatePosition(detail[direction]*8);};var measure_handler=function measure_handler(e){return $$invalidate(5,size=vectorCreateFromSize(e.detail));};$$self.$$set=function($$props){if(\"labelReset\"in $$props)$$invalidate(1,labelReset=$$props.labelReset);if(\"direction\"in $$props)$$invalidate(2,direction=$$props.direction);if(\"min\"in $$props)$$invalidate(19,min=$$props.min);if(\"max\"in $$props)$$invalidate(20,max=$$props.max);if(\"base\"in $$props)$$invalidate(3,base=$$props.base);if(\"value\"in $$props)$$invalidate(0,value=$$props.value);if(\"valueLabel\"in $$props)$$invalidate(4,valueLabel=$$props.valueLabel);if(\"valueMin\"in $$props)$$invalidate(21,valueMin=$$props.valueMin);if(\"valueMax\"in $$props)$$invalidate(22,valueMax=$$props.valueMax);if(\"oninputstart\"in $$props)$$invalidate(23,oninputstart=$$props.oninputstart);if(\"oninputmove\"in $$props)$$invalidate(24,oninputmove=$$props.oninputmove);if(\"oninputend\"in $$props)$$invalidate(25,oninputend=$$props.oninputend);if(\"elasticity\"in $$props)$$invalidate(26,elasticity=$$props.elasticity);};var range;var valueMinLimited;var valueMaxLimited;var barSize;var baseFraction;var isLimited;var rangeMask;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*max, min*/1572864){//\n// derived\n//\n$$invalidate(33,range=max-min);}if($$self.$$.dirty[0]&/*valueMin, min*/2621440){$$invalidate(34,valueMinLimited=valueMin!=null?Math.max(valueMin,min):min);}if($$self.$$.dirty[0]&/*valueMax, max*/5242880){$$invalidate(35,valueMaxLimited=valueMax!=null?Math.min(valueMax,max):max);}if($$self.$$.dirty[0]&/*base, min, max*/1572872){$$invalidate(37,baseFraction=toFraction(base,min,max));}if($$self.$$.dirty[0]&/*size*/32|$$self.$$.dirty[1]&/*baseFraction*/64){if(size){var centerY=size.y*0.5;var indicatorCenter=indicatorCount*baseFraction;var indicators=\"\";var svgWidth;var svgHeight=size.y;for(var i=0;i<=indicatorCount;i++){var _x58=svgPadding.x+i*indicatorSpacing;var _y4=centerY;var _r6=i%indicatorInterval===0?radiusBig:radiusSmall;indicators+=\"<circle cx=\\\"\".concat(_x58,\"\\\" cy=\\\"\").concat(_y4,\"\\\" r=\\\"\").concat(_r6,\"\\\"/>\");svgWidth=_x58+svgPadding.x;if(i===indicatorCenter){indicators+=\"<path stroke=\\\"none\\\" fill=\\\"currentColor\\\" d=\\\"M\".concat(_x58,\" \").concat(_y4-4,\" l2 3 l-2 -1 l-2 1 z\\\"/>\");}}$$invalidate(6,svg=\"<svg width=\\\"\".concat(svgWidth,\"\\\" height=\\\"\").concat(svgHeight,\"\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 \").concat(svgWidth,\" \").concat(svgHeight,\"\\\" aria-hidden=\\\"true\\\" focusable=\\\"false\\\">\").concat(indicators,\"<rect rx=\\\"4\\\" ry=\\\"4\\\" y=\\\"\").concat(centerY-4,\"\\\"\\\" height=\\\"8\\\"></rect></svg>\"));$$invalidate(28,svgSize={x:svgWidth-svgPadding.x*2,y:svgHeight});}}if($$self.$$.dirty[0]&/*size, svgSize*/268435488){barSize=size&&svgSize;}if($$self.$$.dirty[0]&/*min, max*/1572864|$$self.$$.dirty[1]&/*valueMinLimited, valueMaxLimited*/24){$$invalidate(7,isLimited=valueMinLimited!==min||valueMaxLimited!==max);}if($$self.$$.dirty[0]&/*isLimited*/128|$$self.$$.dirty[1]&/*valueMinLimited, valueMaxLimited*/24){$$invalidate(8,rangeMask=isLimited?getMask(valueMinLimited,valueMaxLimited):\"\");}if($$self.$$.dirty[0]&/*size, value, direction*/37|$$self.$$.dirty[1]&/*range*/4){// if has size (range is in here so the position is updated if the range is changed)\nif(range&&size&&size.x&&size.y){position.set(valueToPosition(value,direction));}}};return[value,labelReset,direction,base,valueLabel,size,svg,isLimited,rangeMask,$position,svgPadding,handleDragStart,handleDragRelease,handleDragMove,handleDragEnd,handleReset,position,handleWheel,handleNudge,min,max,valueMin,valueMax,oninputstart,oninputmove,oninputend,elasticity,measure_handler];}var RangeInput=/*#__PURE__*/function(_SvelteComponent23){_inherits(RangeInput,_SvelteComponent23);var _super25=_createSuper(RangeInput);function RangeInput(options){var _this25;_classCallCheck(this,RangeInput);_this25=_super25.call(this);init(_assertThisInitialized(_this25),options,instance$m,create_fragment$m,safe_not_equal,{labelReset:1,direction:2,min:19,max:20,base:3,value:0,valueLabel:4,valueMin:21,valueMax:22,oninputstart:23,oninputmove:24,oninputend:25,elasticity:26},[-1,-1]);return _this25;}return RangeInput;}(SvelteComponent);/* src/core/ui/components/Toolbar.svelte generated by Svelte v3.29.4 */function create_fragment$n(ctx){var div1;var div0;var measurable_action;var measurable_action_1;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[5][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[4],null);return{c:function c(){div1=element(\"div\");div0=element(\"div\");if(default_slot)default_slot.c();attr(div0,\"class\",\"DokaToolbarInner\");attr(div1,\"class\",\"DokaToolbar\");attr(div1,\"data-layout\",/*layout*/ctx[1]);attr(div1,\"data-overflow\",/*overflow*/ctx[0]);},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(default_slot){default_slot.m(div0,null);}current=true;if(!mounted){dispose=[listen(div0,\"measure\",/*handleChildResizeEvent*/ctx[3]),action_destroyer(measurable_action=measurable.call(null,div0)),listen(div1,\"measure\",/*handleParentResizeEvent*/ctx[2]),action_destroyer(measurable_action_1=measurable.call(null,div1))];mounted=true;}},p:function p(ctx,_ref209){var _ref210=_slicedToArray(_ref209,1),dirty=_ref210[0];if(default_slot){if(default_slot.p&&dirty&/*$$scope*/16){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[4],dirty,null,null);}}if(!current||dirty&/*layout*/2){attr(div1,\"data-layout\",/*layout*/ctx[1]);}if(!current||dirty&/*overflow*/1){attr(div1,\"data-overflow\",/*overflow*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$n($$self,$$props,$$invalidate){var _$$props$$$slots11=$$props.$$slots,slots=_$$props$$$slots11===void 0?{}:_$$props$$$slots11,$$scope=$$props.$$scope;var childWidth=0;var childMaxWidth=0;var parentWidth=0;var overflow;var testOverflow=function testOverflow(){$$invalidate(0,overflow=layout===\"compact\"&&childWidth>parentWidth?\"overflow\":undefined);};var handleParentResizeEvent=function handleParentResizeEvent(_ref211){var detail=_ref211.detail;var width=detail.width,height=detail.height;$$invalidate(8,parentWidth=width);testOverflow();};var handleChildResizeEvent=function handleChildResizeEvent(_ref212){var detail=_ref212.detail;var width=detail.width,height=detail.height;if(width>childMaxWidth){$$invalidate(7,childMaxWidth=width);}childWidth=width;if(!overflow)testOverflow();};$$self.$$set=function($$props){if(\"$$scope\"in $$props)$$invalidate(4,$$scope=$$props.$$scope);};var layout;$$self.$$.update=function(){if($$self.$$.dirty&/*childMaxWidth, parentWidth*/384){$$invalidate(1,layout=childMaxWidth>parentWidth?\"compact\":\"default\");}};return[overflow,layout,handleParentResizeEvent,handleChildResizeEvent,$$scope,slots];}var Toolbar=/*#__PURE__*/function(_SvelteComponent24){_inherits(Toolbar,_SvelteComponent24);var _super26=_createSuper(Toolbar);function Toolbar(options){var _this26;_classCallCheck(this,Toolbar);_this26=_super26.call(this);init(_assertThisInitialized(_this26),options,instance$n,create_fragment$n,safe_not_equal,{});return _this26;}return Toolbar;}(SvelteComponent);// enum Direction {\n//     Top = 't',\n//     Right = 'r',\n//     Bottom = 'b',\n//     Left = 'l',\n//     TopLeft = 'tl',\n//     TopRight = 'tr',\n//     BottomRight = 'br',\n//     BottomLeft = 'bl',\n// }\n// export const { Top, Right, Bottom, Left, TopLeft, TopRight, BottomRight, BottomLeft } = Direction;\n// export default Direction;\nvar Direction={Top:'t',Right:'r',Bottom:'b',Left:'l',TopLeft:'tl',TopRight:'tr',BottomRight:'br',BottomLeft:'bl'};var Top=Direction.Top,Right=Direction.Right,Bottom=Direction.Bottom,Left=Direction.Left,TopLeft=Direction.TopLeft,TopRight=Direction.TopRight,BottomRight=Direction.BottomRight,BottomLeft=Direction.BottomLeft;var DirectionRectMap=(_DirectionRectMap={},_defineProperty(_DirectionRectMap,Top,function(rect){return{x:rect.x,y:rect.y};}),_defineProperty(_DirectionRectMap,TopRight,function(rect){return{x:rect.x+rect.width,y:rect.y};}),_defineProperty(_DirectionRectMap,Right,function(rect){return{x:rect.x+rect.width,y:rect.y};}),_defineProperty(_DirectionRectMap,BottomRight,function(rect){return{x:rect.x+rect.width,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,Bottom,function(rect){return{x:rect.x,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,BottomLeft,function(rect){return{x:rect.x,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,Left,function(rect){return{x:rect.x,y:rect.y};}),_defineProperty(_DirectionRectMap,TopLeft,function(rect){return{x:rect.x,y:rect.y};}),_DirectionRectMap);/* src/core/ui/components/RectManipulator.svelte generated by Svelte v3.29.4 */function get_each_context$4(ctx,list,i){var child_ctx=ctx.slice();child_ctx[11]=list[i].key;child_ctx[12]=list[i].translate;child_ctx[13]=list[i].scale;child_ctx[14]=list[i].type;child_ctx[15]=list[i].opacity;return child_ctx;}// (210:0) {#each mappedDirections as { key, translate, scale, type, opacity }\nfunction create_each_block$4(key_1,ctx){var div;var div_tabindex_value;var div_data_direction_value;var div_data_shape_value;var div_style_value;var nudgeable_action;var interactable_action;var mounted;var dispose;return{key:key_1,first:null,c:function c(){div=element(\"div\");attr(div,\"role\",\"button\");attr(div,\"tabindex\",div_tabindex_value=/*type*/ctx[14]===\"edge\"?-1:0);attr(div,\"class\",\"DokaRectManipulator\");attr(div,\"data-direction\",div_data_direction_value=/*key*/ctx[11]);attr(div,\"data-shape\",div_data_shape_value=\"\".concat(/*type*/ctx[14]===\"edge\"?\"edge\":\"\".concat(/*style*/ctx[0])));attr(div,\"style\",div_style_value=\"transform: translate3d(\".concat(/*translate*/ctx[12].x,\"px, \").concat(/*translate*/ctx[12].y,\"px, 0) scale(\").concat(/*scale*/ctx[13].x,\", \").concat(/*scale*/ctx[13].y,\"); opacity: \").concat(/*opacity*/ctx[15]));this.first=div;},m:function m(target,anchor){insert(target,div,anchor);if(!mounted){dispose=[listen(div,\"nudge\",function(){if(is_function(/*nudge*/ctx[5](/*key*/ctx[11])))/*nudge*/ctx[5](/*key*/ctx[11]).apply(this,arguments);}),action_destroyer(nudgeable_action=nudgeable.call(null,div)),listen(div,\"interactionstart\",function(){if(is_function(/*route*/ctx[4](\"resizestart\",/*key*/ctx[11])))/*route*/ctx[4](\"resizestart\",/*key*/ctx[11]).apply(this,arguments);}),listen(div,\"interactionupdate\",function(){if(is_function(/*route*/ctx[4](\"resizemove\",/*key*/ctx[11])))/*route*/ctx[4](\"resizemove\",/*key*/ctx[11]).apply(this,arguments);}),listen(div,\"interactionend\",function(){if(is_function(/*route*/ctx[4](\"resizeend\",/*key*/ctx[11])))/*route*/ctx[4](\"resizeend\",/*key*/ctx[11]).apply(this,arguments);}),action_destroyer(interactable_action=interactable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty&/*mappedDirections*/2&&div_tabindex_value!==(div_tabindex_value=/*type*/ctx[14]===\"edge\"?-1:0)){attr(div,\"tabindex\",div_tabindex_value);}if(dirty&/*mappedDirections*/2&&div_data_direction_value!==(div_data_direction_value=/*key*/ctx[11])){attr(div,\"data-direction\",div_data_direction_value);}if(dirty&/*mappedDirections, style*/3&&div_data_shape_value!==(div_data_shape_value=\"\".concat(/*type*/ctx[14]===\"edge\"?\"edge\":\"\".concat(/*style*/ctx[0])))){attr(div,\"data-shape\",div_data_shape_value);}if(dirty&/*mappedDirections*/2&&div_style_value!==(div_style_value=\"transform: translate3d(\".concat(/*translate*/ctx[12].x,\"px, \").concat(/*translate*/ctx[12].y,\"px, 0) scale(\").concat(/*scale*/ctx[13].x,\", \").concat(/*scale*/ctx[13].y,\"); opacity: \").concat(/*opacity*/ctx[15]))){attr(div,\"style\",div_style_value);}},d:function d(detaching){if(detaching)detach(div);mounted=false;run_all(dispose);}};}function create_fragment$o(ctx){var each_blocks=[];var each_1_lookup=new Map();var each_1_anchor;var each_value=/*mappedDirections*/ctx[1];var get_key=function get_key(ctx){return(/*key*/ctx[11]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$4(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$4(key,child_ctx));}return{c:function c(){for(var _i28=0;_i28<each_blocks.length;_i28+=1){each_blocks[_i28].c();}each_1_anchor=empty();},m:function m(target,anchor){for(var _i29=0;_i29<each_blocks.length;_i29+=1){each_blocks[_i29].m(target,anchor);}insert(target,each_1_anchor,anchor);},p:function p(ctx,_ref213){var _ref214=_slicedToArray(_ref213,1),dirty=_ref214[0];if(dirty&/*mappedDirections, style, nudge, route*/51){var _each_value5=/*mappedDirections*/ctx[1];each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value5,each_1_lookup,each_1_anchor.parentNode,destroy_block,create_each_block$4,each_1_anchor,get_each_context$4);}},i:noop$1,o:noop$1,d:function d(detaching){for(var _i30=0;_i30<each_blocks.length;_i30+=1){each_blocks[_i30].d(detaching);}if(detaching)detach(each_1_anchor);}};}function instance$o($$self,$$props,$$invalidate){var $selectionScale;var $selectionOpacity;var _$$props$rect=$$props.rect,rect=_$$props$rect===void 0?null:_$$props$rect;var _$$props$visible3=$$props.visible,visible=_$$props$visible3===void 0?false:_$$props$visible3;var _$$props$style4=$$props.style,style=_$$props$style4===void 0?undefined:_$$props$style4;// is `undefined` to prevent bounce when first rendering view\nvar selectionScale=spring(undefined,{precision:0.0001,stiffness:0.2,damping:0.4});component_subscribe($$self,selectionScale,function(value){return $$invalidate(8,$selectionScale=value);});var selectionOpacity=spring(0,{precision:0.001});component_subscribe($$self,selectionOpacity,function(value){return $$invalidate(9,$selectionOpacity=value);});//\n// dragging\n//\nvar dispatch=createEventDispatcher();var route=function route(type,direction){return function(_ref215){var detail=_ref215.detail;return dispatch(type,{direction:direction,translation:detail&&detail.translation});};};var nudge=function nudge(direction){return function(_ref216){var detail=_ref216.detail;dispatch(\"resizestart\",{direction:direction,translation:{x:0,y:0}});dispatch(\"resizemove\",{direction:direction,translation:detail});dispatch(\"resizeend\",{direction:direction,translation:{x:0,y:0}});};};$$self.$$set=function($$props){if(\"rect\"in $$props)$$invalidate(6,rect=$$props.rect);if(\"visible\"in $$props)$$invalidate(7,visible=$$props.visible);if(\"style\"in $$props)$$invalidate(0,style=$$props.style);};var mappedDirections;$$self.$$.update=function(){if($$self.$$.dirty&/*visible*/128){selectionScale.set(visible?1:0.5);}if($$self.$$.dirty&/*visible*/128){selectionOpacity.set(visible?1:0);}if($$self.$$.dirty&/*rect, $selectionScale, $selectionOpacity*/832){//\n// rendering\n//\n$$invalidate(1,mappedDirections=Object.keys(Direction).map(function(key,i){// get direction enum\nvar direction=Direction[key];// get position from direction\nvar position=DirectionRectMap[direction](rect);// corner or edge\nvar type=direction.length===1?\"edge\":\"corner\";var isCorner=type===\"corner\";return{key:direction,type:type,scale:{x:/^(t|b)$/.test(direction)?rect.width:isCorner?clamp($selectionScale,0.5,1.25):1,y:/^(r|l)$/.test(direction)?rect.height:isCorner?clamp($selectionScale,0.5,1.25):1},translate:{x:position.x,y:position.y},opacity:$selectionOpacity};}));}};return[style,mappedDirections,selectionScale,selectionOpacity,route,nudge,rect,visible];}var RectManipulator=/*#__PURE__*/function(_SvelteComponent25){_inherits(RectManipulator,_SvelteComponent25);var _super27=_createSuper(RectManipulator);function RectManipulator(options){var _this27;_classCallCheck(this,RectManipulator);_this27=_super27.call(this);init(_assertThisInitialized(_this27),options,instance$o,create_fragment$o,safe_not_equal,{rect:6,visible:7,style:0});return _this27;}return RectManipulator;}(SvelteComponent);var getEventPositionInViewport=function getEventPositionInViewport(e){return vectorCreate(e.clientX,e.clientY);};var getEventPositionInStage=function getEventPositionInStage(e,viewOffset,stageOffset){var positionInViewport=getEventPositionInViewport(e);return vectorSubtract(vectorSubtract(positionInViewport,viewOffset),stageOffset);};var DirectionInversionTable=(_DirectionInversionTa={},_defineProperty(_DirectionInversionTa,Top,Bottom),_defineProperty(_DirectionInversionTa,Right,Left),_defineProperty(_DirectionInversionTa,Bottom,Top),_defineProperty(_DirectionInversionTa,Left,Right),_defineProperty(_DirectionInversionTa,TopLeft,BottomRight),_defineProperty(_DirectionInversionTa,TopRight,BottomLeft),_defineProperty(_DirectionInversionTa,BottomRight,TopLeft),_defineProperty(_DirectionInversionTa,BottomLeft,TopRight),_DirectionInversionTa);var DirectionCoordinateTable=(_DirectionCoordinateT={},_defineProperty(_DirectionCoordinateT,Top,[0.5,0]),_defineProperty(_DirectionCoordinateT,Right,[1,0.5]),_defineProperty(_DirectionCoordinateT,Bottom,[0.5,1]),_defineProperty(_DirectionCoordinateT,Left,[0,0.5]),_defineProperty(_DirectionCoordinateT,TopLeft,[0,0]),_defineProperty(_DirectionCoordinateT,TopRight,[1,0]),_defineProperty(_DirectionCoordinateT,BottomRight,[1,1]),_defineProperty(_DirectionCoordinateT,BottomLeft,[0,1]),_DirectionCoordinateT);var getTranslationInfo=function getTranslationInfo(target){var translateToRight=target===Right||target===TopRight||target===BottomRight;var translateToLeft=target===Left||target===BottomLeft||target===TopLeft;var translateToTop=target===Top||target===TopRight||target===TopLeft;var translateToBottom=target===Bottom||target===BottomRight||target===BottomLeft;var translateHorizontally=target===Left||target===Right;var translateVertically=target===Top||target===Bottom;var translateAxis=translateHorizontally||translateVertically;return[translateToRight,translateToLeft,translateToTop,translateToBottom,translateHorizontally,translateVertically,translateAxis];};var limitRectDirectionTranslation=function limitRectDirectionTranslation(rect,transform,bounds){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};// the transforms to apply\nvar target=transform.target,translate=transform.translate;// the transform requirements\nvar aspectRatio=options.aspectRatio,minSize=options.minSize,maxSize=options.maxSize;// get anchor coordinates and x,y position we need this for relative scaling of the view rectangle\nvar anchor=DirectionInversionTable[target];var anchorDirectionCoordinates=DirectionCoordinateTable[anchor];var anchorPosition=vectorAdd(vectorCreate(rect.x,rect.y),vectorCreate(anchorDirectionCoordinates[0]*rect.width,anchorDirectionCoordinates[1]*rect.height));// get coordinate of direction\nvar targetDirectionCoordinates=DirectionCoordinateTable[target];var targetPosition=vectorAdd(rectClone(rect),vectorCreate(targetDirectionCoordinates[0]*rect.width,targetDirectionCoordinates[1]*rect.height));// bools to determine which direction the interaction is moving in\nvar _getTranslationInfo=getTranslationInfo(target),_getTranslationInfo2=_slicedToArray(_getTranslationInfo,7),translateToRight=_getTranslationInfo2[0],translateToLeft=_getTranslationInfo2[1],translateToTop=_getTranslationInfo2[2],translateToBottom=_getTranslationInfo2[3],translateHorizontally=_getTranslationInfo2[4],translateVertically=_getTranslationInfo2[5],translateAxis=_getTranslationInfo2[6];var tx=translate.x;var ty=translate.y;if(translateHorizontally)ty=0;else if(translateVertically)tx=0;var interactionBounds=getInteractionBounds(anchorPosition,target,bounds,{aspectRatio:aspectRatio,minSize:minSize,maxSize:maxSize});// current bounds\nvar _rectToBounds=rectToBounds(rect),_rectToBounds2=_slicedToArray(_rectToBounds,4),t=_rectToBounds2[0],r=_rectToBounds2[1],b=_rectToBounds2[2],l=_rectToBounds2[3];// update view bounds with anchor based on translation direction (one side is always locked)\nif(translateToRight)l=anchorPosition.x;else if(translateToLeft)r=anchorPosition.x;if(translateToBottom)t=anchorPosition.y;else if(translateToTop)b=anchorPosition.y;// update view bounds with interaction limits\nif(translateToRight){var innerR=interactionBounds.inner.x+interactionBounds.inner.width;var outerR=interactionBounds.outer.x+interactionBounds.outer.width;r=clamp(targetPosition.x+tx,innerR,outerR);}else if(translateToLeft){var innerL=interactionBounds.outer.x;var outerL=interactionBounds.inner.x;l=clamp(targetPosition.x+tx,innerL,outerL);}if(translateToBottom){var innerB=interactionBounds.inner.y+interactionBounds.inner.height;var outerB=interactionBounds.outer.y+interactionBounds.outer.height;b=clamp(targetPosition.y+ty,innerB,outerB);}else if(translateToTop){var innerT=interactionBounds.outer.y;var outerT=interactionBounds.inner.y;t=clamp(targetPosition.y+ty,innerT,outerT);}// if aspect ratio is set we need to scale both axis\nif(aspectRatio){// if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well\nif(translateAxis){var dx=r-l;var dy=b-t;if(translateHorizontally){dy=dx/aspectRatio;t=anchorPosition.y-dy*0.5;b=anchorPosition.y+dy*0.5;}else if(translateVertically){dx=dy*aspectRatio;l=anchorPosition.x-dx*0.5;r=anchorPosition.x+dx*0.5;}}// we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio\nelse{var pointer=vectorCreate(targetPosition.x+tx-anchorPosition.x,targetPosition.y+ty-anchorPosition.y);// translations cannot be inverted, limited by anchor position\nif(target===TopRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.min(0,pointer.y);}else if(target===BottomRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===BottomLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===TopLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.min(0,pointer.y);}// calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length\nvar pointerLength=vectorLength(pointer);var pointerLengthMin=vectorLength(vectorCreate(interactionBounds.inner.width,interactionBounds.inner.height));var pointerLengthMax=vectorLength(vectorCreate(interactionBounds.outer.width,interactionBounds.outer.height));var pointerLengthLimited=clamp(pointerLength,pointerLengthMin,pointerLengthMax);var pointerAspectRatio=vectorCreate(aspectRatio,1);var pointerScaled=vectorMultiply(vectorNormalize(pointerAspectRatio),pointerLengthLimited);if(target===TopRight){r=anchorPosition.x+pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}else if(target===BottomRight){r=anchorPosition.x+pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===BottomLeft){l=anchorPosition.x-pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===TopLeft){l=anchorPosition.x-pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}}}return rectCreate(l,t,r-l,b-t);};var getInteractionBounds=function getInteractionBounds(anchor,dir,bounds,options){var aspectRatio=options.aspectRatio,minSize=options.minSize,maxSize=options.maxSize;var translateToRight=dir===Right||dir===TopRight||dir===BottomRight;var translateToLeft=dir===Left||dir===BottomLeft||dir===TopLeft;var translateToTop=dir===Top||dir===TopRight||dir===TopLeft;var translateToBottom=dir===Bottom||dir===BottomRight||dir===BottomLeft;var translateHorizontally=dir===Left||dir===Right;var translateVertically=dir===Top||dir===Bottom;// limit bounds based on anchor and direction\nvar limitedBounds=rectClone(bounds);if(translateToRight){limitedBounds.x=anchor.x;limitedBounds.width-=anchor.x;}else if(translateToLeft){limitedBounds.width=anchor.x;}if(translateToBottom){limitedBounds.y=anchor.y;limitedBounds.height-=anchor.y;}else if(translateToTop){limitedBounds.height=anchor.y;}// limit max size based on bounds\nvar maxSizeLimitedToBounds=rectCreateFromDimensions(Math.min(limitedBounds.width,maxSize.width),Math.min(limitedBounds.height,maxSize.height));if(aspectRatio){// limit height\nif(translateHorizontally){var verticalSpace=Math.min(anchor.y,bounds.height-anchor.y);maxSizeLimitedToBounds.height=Math.min(verticalSpace*2,maxSizeLimitedToBounds.height);}// limit width\nelse if(translateVertically){var horizontalSpace=Math.min(anchor.x,bounds.width-anchor.x);maxSizeLimitedToBounds.width=Math.min(horizontalSpace*2,maxSizeLimitedToBounds.width);}}var maxSizeLimited=aspectRatio?sizeCreateFromRect(rectContainRect(maxSizeLimitedToBounds,aspectRatio)):maxSizeLimitedToBounds;// limit min size\nvar minSizeLimited=aspectRatio?sizeCreateFromRect(rectCoverRect(rectCreateFromSize(minSize),aspectRatio)):minSize;var l,r,t,b;// set bounds\nif(translateToRight)l=anchor.x;else if(translateToLeft)r=anchor.x;if(translateToBottom)t=anchor.y;else if(translateToTop)b=anchor.y;// inner\nif(translateToRight){r=l+minSizeLimited.width;}else if(translateToLeft){l=r-minSizeLimited.width;}if(translateToBottom){b=t+minSizeLimited.height;}else if(translateToTop){t=b-minSizeLimited.height;}if(translateHorizontally){t=anchor.y-minSizeLimited.height*0.5;b=anchor.y+minSizeLimited.height*0.5;}else if(translateVertically){l=anchor.x-minSizeLimited.width*0.5;r=anchor.x+minSizeLimited.width*0.5;}var inner=rectCreateFromPoints(vectorCreate(l,t),vectorCreate(r,b));// outer\nif(translateToRight){r=l+maxSizeLimited.width;}else if(translateToLeft){l=r-maxSizeLimited.width;}if(translateToBottom){b=t+maxSizeLimited.height;}else if(translateToTop){t=b-maxSizeLimited.height;}if(translateHorizontally){t=anchor.y-maxSizeLimited.height*0.5;b=anchor.y+maxSizeLimited.height*0.5;}else if(translateVertically){l=anchor.x-maxSizeLimited.width*0.5;r=anchor.x+maxSizeLimited.width*0.5;}var outer=rectCreateFromPoints(vectorCreate(l,t),vectorCreate(r,b));return{inner:inner,outer:outer};};var applyRectDirectionTranslation=function applyRectDirectionTranslation(rect,transform){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// the transforms to apply\nvar target=transform.target,translate=transform.translate;// the transform requirements\nvar aspectRatio=options.aspectRatio;// get anchor coordinates and x,y position we need this for relative scaling of the view rectangle\nvar anchor=DirectionInversionTable[target];var anchorDirectionCoordinates=DirectionCoordinateTable[anchor];var anchorPosition=vectorAdd(rectClone(rect),vectorCreate(anchorDirectionCoordinates[0]*rect.width,anchorDirectionCoordinates[1]*rect.height));// get coordinate of direction\nvar targetDirectionCoordinates=DirectionCoordinateTable[target];var targetPosition=vectorAdd(rectClone(rect),vectorCreate(targetDirectionCoordinates[0]*rect.width,targetDirectionCoordinates[1]*rect.height));// bools to determine which direction the interaction is moving in\nvar _getTranslationInfo3=getTranslationInfo(target),_getTranslationInfo4=_slicedToArray(_getTranslationInfo3,7),translateToRight=_getTranslationInfo4[0],translateToLeft=_getTranslationInfo4[1],translateToTop=_getTranslationInfo4[2],translateToBottom=_getTranslationInfo4[3],translateHorizontally=_getTranslationInfo4[4],translateVertically=_getTranslationInfo4[5],translateAxis=_getTranslationInfo4[6];var tx=translate.x;var ty=translate.y;if(translateHorizontally)ty=0;else if(translateVertically)tx=0;// current bounds\nvar _rectToBounds3=rectToBounds(rect),_rectToBounds4=_slicedToArray(_rectToBounds3,4),t=_rectToBounds4[0],r=_rectToBounds4[1],b=_rectToBounds4[2],l=_rectToBounds4[3];// update view bounds with anchor based on translation direction (one side is always locked)\nif(translateToRight)l=anchorPosition.x;else if(translateToLeft)r=anchorPosition.x;if(translateToBottom)t=anchorPosition.y;else if(translateToTop)b=anchorPosition.y;// update view bounds with interaction limits\nif(translateToRight){r=targetPosition.x+tx;}else if(translateToLeft){l=targetPosition.x+tx;}if(translateToBottom){b=targetPosition.y+ty;}else if(translateToTop){t=targetPosition.y+ty;}// if aspect ratio is set we need to scale both axis\nif(aspectRatio){// if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well\nif(translateAxis){var dx=r-l;var dy=b-t;if(translateHorizontally){dy=dx/aspectRatio;t=anchorPosition.y-dy*0.5;b=anchorPosition.y+dy*0.5;}else if(translateVertically){dx=dy*aspectRatio;l=anchorPosition.x-dx*0.5;r=anchorPosition.x+dx*0.5;}}// we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio\nelse{var pointer=vectorCreate(targetPosition.x+tx-anchorPosition.x,targetPosition.y+ty-anchorPosition.y);// translations cannot be inverted, limited by anchor position\nif(target===TopRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.min(0,pointer.y);}else if(target===BottomRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===BottomLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===TopLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.min(0,pointer.y);}// calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length\nvar pointerLength=vectorLength(pointer);var pointerAspectRatio=vectorCreate(aspectRatio,1);var pointerScaled=vectorMultiply(vectorNormalize(pointerAspectRatio),pointerLength);if(target===TopRight){r=anchorPosition.x+pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}else if(target===BottomRight){r=anchorPosition.x+pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===BottomLeft){l=anchorPosition.x-pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===TopLeft){l=anchorPosition.x-pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}}}return rectCreate(l,t,r-l,b-t);};var radToDeg=function radToDeg(rad){return rad*180/Math.PI;};/* src/core/ui/plugins/crop/components/ImageRotator.svelte generated by Svelte v3.29.4 */function create_fragment$p(ctx){var div;var rangeinput;var current;rangeinput=new RangeInput({props:{elasticity:/*elasticity*/ctx[5],min:/*min*/ctx[7],max:/*max*/ctx[8],value:/*value*/ctx[12],valueMin:/*valueMin*/ctx[0],valueMax:/*valueMax*/ctx[1],labelReset:/*labelReset*/ctx[6],base:/*center*/ctx[9],valueLabel:\"\".concat(Math.round(radToDeg(/*value*/ctx[12])),\"\\xB0\"),oninputstart:/*oninputstart*/ctx[2],oninputmove:/*func*/ctx[14],oninputend:/*func_1*/ctx[15]}});return{c:function c(){div=element(\"div\");create_component(rangeinput.$$.fragment);attr(div,\"class\",\"DokaImageRotator\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(rangeinput,div,null);current=true;},p:function p(ctx,_ref217){var _ref218=_slicedToArray(_ref217,1),dirty=_ref218[0];var rangeinput_changes={};if(dirty&/*elasticity*/32)rangeinput_changes.elasticity=/*elasticity*/ctx[5];if(dirty&/*min*/128)rangeinput_changes.min=/*min*/ctx[7];if(dirty&/*max*/256)rangeinput_changes.max=/*max*/ctx[8];if(dirty&/*value*/4096)rangeinput_changes.value=/*value*/ctx[12];if(dirty&/*valueMin*/1)rangeinput_changes.valueMin=/*valueMin*/ctx[0];if(dirty&/*valueMax*/2)rangeinput_changes.valueMax=/*valueMax*/ctx[1];if(dirty&/*labelReset*/64)rangeinput_changes.labelReset=/*labelReset*/ctx[6];if(dirty&/*center*/512)rangeinput_changes.base=/*center*/ctx[9];if(dirty&/*value*/4096)rangeinput_changes.valueLabel=\"\".concat(Math.round(radToDeg(/*value*/ctx[12])),\"\\xB0\");if(dirty&/*oninputstart*/4)rangeinput_changes.oninputstart=/*oninputstart*/ctx[2];if(dirty&/*oninputmove, sign, turns*/3080)rangeinput_changes.oninputmove=/*func*/ctx[14];if(dirty&/*oninputend, sign, turns*/3088)rangeinput_changes.oninputend=/*func_1*/ctx[15];rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(rangeinput);}};}var MARGIN=1e-9;function instance$p($$self,$$props,$$invalidate){var HALF_PI=Math.PI/2;var QUARTER_PI=Math.PI/4;var rotation=$$props.rotation;var valueMin=$$props.valueMin;var valueMax=$$props.valueMax;var _$$props$oninputstart2=$$props.oninputstart,oninputstart=_$$props$oninputstart2===void 0?noop:_$$props$oninputstart2;var _$$props$oninputmove2=$$props.oninputmove,oninputmove=_$$props$oninputmove2===void 0?noop:_$$props$oninputmove2;var _$$props$oninputend2=$$props.oninputend,oninputend=_$$props$oninputend2===void 0?noop:_$$props$oninputend2;var _$$props$elasticity3=$$props.elasticity,elasticity=_$$props$elasticity3===void 0?0:_$$props$elasticity3;var _$$props$labelReset2=$$props.labelReset,labelReset=_$$props$labelReset2===void 0?undefined:_$$props$labelReset2;var func=function func(value){return oninputmove(sign*turns+value);};var func_1=function func_1(value){return oninputend(sign*turns+value);};$$self.$$set=function($$props){if(\"rotation\"in $$props)$$invalidate(13,rotation=$$props.rotation);if(\"valueMin\"in $$props)$$invalidate(0,valueMin=$$props.valueMin);if(\"valueMax\"in $$props)$$invalidate(1,valueMax=$$props.valueMax);if(\"oninputstart\"in $$props)$$invalidate(2,oninputstart=$$props.oninputstart);if(\"oninputmove\"in $$props)$$invalidate(3,oninputmove=$$props.oninputmove);if(\"oninputend\"in $$props)$$invalidate(4,oninputend=$$props.oninputend);if(\"elasticity\"in $$props)$$invalidate(5,elasticity=$$props.elasticity);if(\"labelReset\"in $$props)$$invalidate(6,labelReset=$$props.labelReset);};var min;var max;var center;var sign;var turns;var value;$$self.$$.update=function(){if($$self.$$.dirty&/*min, max*/384){$$invalidate(9,center=min+(max-min)*0.5);}if($$self.$$.dirty&/*rotation*/8192){$$invalidate(10,sign=Math.sign(rotation));}if($$self.$$.dirty&/*rotation*/8192){$$invalidate(11,turns=Math.round(Math.abs(rotation)/HALF_PI)*HALF_PI);}if($$self.$$.dirty&/*rotation, sign, turns*/11264){$$invalidate(12,value=rotation-sign*turns);}};$$invalidate(7,min=-QUARTER_PI+MARGIN);$$invalidate(8,max=QUARTER_PI-MARGIN);return[valueMin,valueMax,oninputstart,oninputmove,oninputend,elasticity,labelReset,min,max,center,sign,turns,value,rotation,func,func_1];}var ImageRotator=/*#__PURE__*/function(_SvelteComponent26){_inherits(ImageRotator,_SvelteComponent26);var _super28=_createSuper(ImageRotator);function ImageRotator(options){var _this28;_classCallCheck(this,ImageRotator);_this28=_super28.call(this);init(_assertThisInitialized(_this28),options,instance$p,create_fragment$p,safe_not_equal,{rotation:13,valueMin:0,valueMax:1,oninputstart:2,oninputmove:3,oninputend:4,elasticity:5,labelReset:6});return _this28;}return ImageRotator;}(SvelteComponent);/* src/core/ui/plugins/crop/components/ImageInfo.svelte generated by Svelte v3.29.4 */function create_fragment$q(ctx){var div;var p;var t0;var t1;var t2;return{c:function c(){div=element(\"div\");p=element(\"p\");t0=text(/*width*/ctx[0]);t1=text(\" × \");t2=text(/*height*/ctx[1]);attr(div,\"class\",\"DokaImageInfo\");},m:function m(target,anchor){insert(target,div,anchor);append(div,p);append(p,t0);append(p,t1);append(p,t2);},p:function p(ctx,_ref219){var _ref220=_slicedToArray(_ref219,1),dirty=_ref220[0];if(dirty&/*width*/1)set_data(t0,/*width*/ctx[0]);if(dirty&/*height*/2)set_data(t2,/*height*/ctx[1]);},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(div);}};}function instance$q($$self,$$props,$$invalidate){var width=$$props.width;var height=$$props.height;$$self.$$set=function($$props){if(\"width\"in $$props)$$invalidate(0,width=$$props.width);if(\"height\"in $$props)$$invalidate(1,height=$$props.height);};return[width,height];}var ImageInfo=/*#__PURE__*/function(_SvelteComponent27){_inherits(ImageInfo,_SvelteComponent27);var _super29=_createSuper(ImageInfo);function ImageInfo(options){var _this29;_classCallCheck(this,ImageInfo);_this29=_super29.call(this);init(_assertThisInitialized(_this29),options,instance$q,create_fragment$q,safe_not_equal,{width:0,height:1});return _this29;}return ImageInfo;}(SvelteComponent);var getSelectionPresetOptionIcon=function getSelectionPresetOptionIcon(value){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$width=options.width,width=_options$width===void 0?24:_options$width,_options$height=options.height,height=_options$height===void 0?24:_options$height,_options$bounds=options.bounds,bounds=_options$bounds===void 0?16:_options$bounds,_options$radius=options.radius,radius=_options$radius===void 0?3:_options$radius;var aspectRatio=isArray(value)?getAspectRatio(value[0],value[1]):value;var aspectRatioDefined=!!aspectRatio;aspectRatio=aspectRatioDefined?aspectRatio:1;var x;var y;var w;var h;w=aspectRatio>1?bounds:aspectRatio*bounds;h=w/aspectRatio;x=Math.round((width-w)*0.5);y=Math.round((height-h)*0.5);var fill=aspectRatioDefined?'currentColor':'none';var stroke=aspectRatioDefined?'none':'currentColor';var strokeWidth=width/16;var strokeDashArray=[width/12,width/6].join(' ');return\"<rect fill=\\\"\".concat(fill,\"\\\" stroke=\\\"\").concat(stroke,\"\\\" stroke-width=\\\"\").concat(strokeWidth,\"\\\" stroke-dasharray=\\\"\").concat(strokeDashArray,\"\\\" x=\\\"\").concat(x,\"\\\" y=\\\"\").concat(y,\"\\\" width=\\\"\").concat(w,\"\\\" height=\\\"\").concat(h,\"\\\" rx=\\\"\").concat(radius,\"\\\"/>\");};/* src/core/ui/plugins/crop/index.svelte generated by Svelte v3.29.4 */function create_default_slot_3$3(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*tools*/ctx[0]}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[0]&/*tools*/1)dynamiccomponenttree_changes.items=/*tools*/ctx[0];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (1208:4) <div slot=\"header\">\nfunction create_header_slot(ctx){var div;var toolbar;var current;toolbar=new Toolbar({props:{$$slots:{\"default\":[create_default_slot_3$3]},$$scope:{ctx:ctx}}});return{c:function c(){div=element(\"div\");create_component(toolbar.$$.fragment);attr(div,\"slot\",\"header\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(toolbar,div,null);current=true;},p:function p(ctx,dirty){var toolbar_changes={};if(dirty[0]&/*tools*/1|dirty[5]&/*$$scope*/16384){toolbar_changes.$$scope={dirty:dirty,ctx:ctx};}toolbar.$set(toolbar_changes);},i:function i(local){if(current)return;transition_in(toolbar.$$.fragment,local);current=true;},o:function o(local){transition_out(toolbar.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(toolbar);}};}// (1232:12) {#if shouldRenderImageSelection && shouldRenderImageSelectionRecenterButton}\nfunction create_if_block_6$2(ctx){var button;var current;button=new Button({props:{onclick:/*handleRecenterAction*/ctx[74],label:/*locale*/ctx[4].cropLabelButtonRecenter,icon:/*locale*/ctx[4].cropIconButtonRecenter,\"class\":\"DokaButtonCenter\",disabled:!/*canCenter*/ctx[11],hideLabel:true,style:\"opacity: \".concat(/*$recenterOpacity*/ctx[24],\"; transform: translate3d(\").concat(/*$recenterOffset*/ctx[25].x,\"px, \").concat(/*$recenterOffset*/ctx[25].y,\"px, 0)\")}});return{c:function c(){create_component(button.$$.fragment);},m:function m(target,anchor){mount_component(button,target,anchor);current=true;},p:function p(ctx,dirty){var button_changes={};if(dirty[0]&/*locale*/16)button_changes.label=/*locale*/ctx[4].cropLabelButtonRecenter;if(dirty[0]&/*locale*/16)button_changes.icon=/*locale*/ctx[4].cropIconButtonRecenter;if(dirty[0]&/*canCenter*/2048)button_changes.disabled=!/*canCenter*/ctx[11];if(dirty[0]&/*$recenterOpacity, $recenterOffset*/50331648)button_changes.style=\"opacity: \".concat(/*$recenterOpacity*/ctx[24],\"; transform: translate3d(\").concat(/*$recenterOffset*/ctx[25].x,\"px, \").concat(/*$recenterOffset*/ctx[25].y,\"px, 0)\");button.$set(button_changes);},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(button,detaching);}};}// (1244:12) {#if shouldRenderImageSelection}\nfunction create_if_block_5$2(ctx){var rectmanipulator;var current;rectmanipulator=new RectManipulator({props:{rect:/*imageSelectionRectOffset*/ctx[14],visible:/*$isActive*/ctx[16],style:/*cropImageSelectionCornerStyle*/ctx[2]}});rectmanipulator.$on(\"resizestart\",/*handleSelectionGrab*/ctx[57]);rectmanipulator.$on(\"resizemove\",/*handleSelectionDrag*/ctx[58]);rectmanipulator.$on(\"resizeend\",/*handleSelectionRelease*/ctx[59]);return{c:function c(){create_component(rectmanipulator.$$.fragment);},m:function m(target,anchor){mount_component(rectmanipulator,target,anchor);current=true;},p:function p(ctx,dirty){var rectmanipulator_changes={};if(dirty[0]&/*imageSelectionRectOffset*/16384)rectmanipulator_changes.rect=/*imageSelectionRectOffset*/ctx[14];if(dirty[0]&/*$isActive*/65536)rectmanipulator_changes.visible=/*$isActive*/ctx[16];if(dirty[0]&/*cropImageSelectionCornerStyle*/4)rectmanipulator_changes.style=/*cropImageSelectionCornerStyle*/ctx[2];rectmanipulator.$set(rectmanipulator_changes);},i:function i(local){if(current)return;transition_in(rectmanipulator.$$.fragment,local);current=true;},o:function o(local){transition_out(rectmanipulator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rectmanipulator,detaching);}};}// (1256:8) {#if shouldRenderInfoIndicator}\nfunction create_if_block_4$3(ctx){var imageinfo;var current;imageinfo=new ImageInfo({props:{width:Math.round(/*$imageCropRect*/ctx[7].width),height:Math.round(/*$imageCropRect*/ctx[7].height)}});return{c:function c(){create_component(imageinfo.$$.fragment);},m:function m(target,anchor){mount_component(imageinfo,target,anchor);current=true;},p:function p(ctx,dirty){var imageinfo_changes={};if(dirty[0]&/*$imageCropRect*/128)imageinfo_changes.width=Math.round(/*$imageCropRect*/ctx[7].width);if(dirty[0]&/*$imageCropRect*/128)imageinfo_changes.height=Math.round(/*$imageCropRect*/ctx[7].height);imageinfo.$set(imageinfo_changes);},i:function i(local){if(current)return;transition_in(imageinfo.$$.fragment,local);current=true;},o:function o(local){transition_out(imageinfo.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(imageinfo,detaching);}};}// (1214:4) <div slot=\"main\">\nfunction create_main_slot(ctx){var div0;var div1;var t0;var measurable_action;var interactable_action;var t1;var current;var mounted;var dispose;var if_block0=/*shouldRenderImageSelection*/ctx[13]&&/*shouldRenderImageSelectionRecenterButton*/ctx[15]&&create_if_block_6$2(ctx);var if_block1=/*shouldRenderImageSelection*/ctx[13]&&create_if_block_5$2(ctx);var if_block2=/*shouldRenderInfoIndicator*/ctx[12]&&create_if_block_4$3(ctx);return{c:function c(){div0=element(\"div\");div1=element(\"div\");if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();if(if_block2)if_block2.c();attr(div1,\"class\",\"DokaStage\");attr(div0,\"slot\",\"main\");},m:function m(target,anchor){insert(target,div0,anchor);append(div0,div1);if(if_block0)if_block0.m(div1,null);append(div1,t0);if(if_block1)if_block1.m(div1,null);append(div0,t1);if(if_block2)if_block2.m(div0,null);current=true;if(!mounted){dispose=[listen(div1,\"measure\",/*measure_handler_1*/ctx[98]),action_destroyer(measurable_action=measurable.call(null,div1)),listen(div1,\"wheel\",function(){if(is_function(/*cropEnableZoom*/ctx[3]&&/*handleWheel*/ctx[73]))(/*cropEnableZoom*/ctx[3]&&/*handleWheel*/ctx[73]).apply(this,arguments);}),listen(div1,\"interactionstart\",/*handleImageDragStart*/ctx[63]),listen(div1,\"interactionupdate\",/*handleImageDrag*/ctx[64]),listen(div1,\"interactionrelease\",/*handleImageDragRelease*/ctx[66]),listen(div1,\"interactionend\",/*handleImageDragEnd*/ctx[65]),action_destroyer(interactable_action=interactable.call(null,div1,{drag:true,pinch:/*cropEnableZoom*/ctx[3],inertia:true,matchTarget:true,getEventPosition:/*interactable_function*/ctx[99]}))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*shouldRenderImageSelection*/ctx[13]&&/*shouldRenderImageSelectionRecenterButton*/ctx[15]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*shouldRenderImageSelection, shouldRenderImageSelectionRecenterButton*/40960){transition_in(if_block0,1);}}else{if_block0=create_if_block_6$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div1,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderImageSelection*/ctx[13]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*shouldRenderImageSelection*/8192){transition_in(if_block1,1);}}else{if_block1=create_if_block_5$2(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div1,null);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}if(interactable_action&&is_function(interactable_action.update)&&dirty[0]&/*cropEnableZoom, $rootRect*/1032)interactable_action.update.call(null,{drag:true,pinch:/*cropEnableZoom*/ctx[3],inertia:true,matchTarget:true,getEventPosition:/*interactable_function*/ctx[99]});if(/*shouldRenderInfoIndicator*/ctx[12]){if(if_block2){if_block2.p(ctx,dirty);if(dirty[0]&/*shouldRenderInfoIndicator*/4096){transition_in(if_block2,1);}}else{if_block2=create_if_block_4$3(ctx);if_block2.c();transition_in(if_block2,1);if_block2.m(div0,null);}}else if(if_block2){group_outros();transition_out(if_block2,1,1,function(){if_block2=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(detaching)detach(div0);if(if_block0)if_block0.d();if(if_block1)if_block1.d();if(if_block2)if_block2.d();mounted=false;run_all(dispose);}};}// (1264:4) {#if shouldRenderFooter}\nfunction create_if_block$6(ctx){var t;var tabpanels;var current;var if_block=/*shouldRenderTabs*/ctx[19]&&create_if_block_3$3(ctx);var tabpanels_spread_levels=[{\"class\":\"DokaControlPanels\"},{panelClass:\"DokaControlPanel\"},{panels:/*panels*/ctx[22]},/*tabsConfig*/ctx[20]];var tabpanels_props={$$slots:{\"default\":[create_default_slot_1$4,function(_ref221){var panel=_ref221.panel;return{167:panel};},function(_ref222){var panel=_ref222.panel;return[0,0,0,0,0,panel?4096:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){if(if_block)if_block.c();t=space();create_component(tabpanels.$$.fragment);},m:function m(target,anchor){if(if_block)if_block.m(target,anchor);insert(target,t,anchor);mount_component(tabpanels,target,anchor);current=true;},p:function p(ctx,dirty){if(/*shouldRenderTabs*/ctx[19]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*shouldRenderTabs*/524288){transition_in(if_block,1);}}else{if_block=create_if_block_3$3(ctx);if_block.c();transition_in(if_block,1);if_block.m(t.parentNode,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}var tabpanels_changes=dirty[0]&/*panels, tabsConfig*/5242880?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty[0]&/*panels*/4194304&&{panels:/*panels*/ctx[22]},dirty[0]&/*tabsConfig*/1048576&&get_spread_object(/*tabsConfig*/ctx[20])]):{};if(dirty[0]&/*$imageRotation, locale, $imageRotationRange, tabs, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel*/471859984|dirty[5]&/*$$scope, panel*/20480){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){if(if_block)if_block.d(detaching);if(detaching)detach(t);destroy_component(tabpanels,detaching);}};}// (1266:8) {#if shouldRenderTabs}\nfunction create_if_block_3$3(ctx){var tablist;var current;var tablist_spread_levels=[{\"class\":\"DokaControlList\"},{tabs:/*tabs*/ctx[21]},/*tabsConfig*/ctx[20]];var tablist_props={$$slots:{\"default\":[create_default_slot_2$3,function(_ref223){var tab=_ref223.tab;return{168:tab};},function(_ref224){var tab=_ref224.tab;return[0,0,0,0,0,tab?8192:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on(\"select\",/*select_handler*/ctx[100]);return{c:function c(){create_component(tablist.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[0]&/*tabs, tabsConfig*/3145728?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty[0]&/*tabs*/2097152&&{tabs:/*tabs*/ctx[21]},dirty[0]&/*tabsConfig*/1048576&&get_spread_object(/*tabsConfig*/ctx[20])]):{};if(dirty[5]&/*$$scope, tab*/24576){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);}};}// (1267:8) <TabList class=\"DokaControlList\" {tabs} {...tabsConfig} on:select={({ detail }) => transformSelected = detail} let:tab={tab}>\nfunction create_default_slot_2$3(ctx){var span;var t_value=/*tab*/ctx[168].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[5]&/*tab*/8192&&t_value!==(t_value=/*tab*/ctx[168].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (1283:43) \nfunction create_if_block_2$5(ctx){var rangeinput;var current;rangeinput=new RangeInput({props:{elasticity:/*elasticityMultiplier*/ctx[34]*/*rangeInputElasticity*/ctx[35],base:imageZoomLevelBase,min:/*imageZoomLevelMin*/ctx[9],max:imageZoomLevelMax,valueMin:/*$imageZoomLevelRange*/ctx[27][0],valueMax:/*$imageZoomLevelRange*/ctx[27][1],value:/*$imageZoomLevel*/ctx[28],labelReset:/*locale*/ctx[4].labelReset,valueLabel:\"\".concat(Math.round(/*$imageZoomLevel*/ctx[28]*100),\"%\"),oninputstart:/*handleResizeStart*/ctx[70],oninputmove:/*handleResizeMove*/ctx[71],oninputend:/*handleResizeEnd*/ctx[72]}});return{c:function c(){create_component(rangeinput.$$.fragment);},m:function m(target,anchor){mount_component(rangeinput,target,anchor);current=true;},p:function p(ctx,dirty){var rangeinput_changes={};if(dirty[0]&/*imageZoomLevelMin*/512)rangeinput_changes.min=/*imageZoomLevelMin*/ctx[9];if(dirty[0]&/*$imageZoomLevelRange*/134217728)rangeinput_changes.valueMin=/*$imageZoomLevelRange*/ctx[27][0];if(dirty[0]&/*$imageZoomLevelRange*/134217728)rangeinput_changes.valueMax=/*$imageZoomLevelRange*/ctx[27][1];if(dirty[0]&/*$imageZoomLevel*/268435456)rangeinput_changes.value=/*$imageZoomLevel*/ctx[28];if(dirty[0]&/*locale*/16)rangeinput_changes.labelReset=/*locale*/ctx[4].labelReset;if(dirty[0]&/*$imageZoomLevel*/268435456)rangeinput_changes.valueLabel=\"\".concat(Math.round(/*$imageZoomLevel*/ctx[28]*100),\"%\");rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rangeinput,detaching);}};}// (1273:12) {#if panel === tabs[0].id }\nfunction create_if_block_1$7(ctx){var imagerotator;var current;imagerotator=new ImageRotator({props:{elasticity:/*elasticityMultiplier*/ctx[34]*/*rangeInputElasticity*/ctx[35],rotation:/*$imageRotation*/ctx[8],labelReset:/*locale*/ctx[4].labelReset,valueMin:/*$imageRotationRange*/ctx[26][0],valueMax:/*$imageRotationRange*/ctx[26][1],oninputstart:/*handleRotateStart*/ctx[60],oninputmove:/*handleRotateMove*/ctx[61],oninputend:/*handleRotateEnd*/ctx[62]}});return{c:function c(){create_component(imagerotator.$$.fragment);},m:function m(target,anchor){mount_component(imagerotator,target,anchor);current=true;},p:function p(ctx,dirty){var imagerotator_changes={};if(dirty[0]&/*$imageRotation*/256)imagerotator_changes.rotation=/*$imageRotation*/ctx[8];if(dirty[0]&/*locale*/16)imagerotator_changes.labelReset=/*locale*/ctx[4].labelReset;if(dirty[0]&/*$imageRotationRange*/67108864)imagerotator_changes.valueMin=/*$imageRotationRange*/ctx[26][0];if(dirty[0]&/*$imageRotationRange*/67108864)imagerotator_changes.valueMax=/*$imageRotationRange*/ctx[26][1];imagerotator.$set(imagerotator_changes);},i:function i(local){if(current)return;transition_in(imagerotator.$$.fragment,local);current=true;},o:function o(local){transition_out(imagerotator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(imagerotator,detaching);}};}// (1272:8) <TabPanels class=\"DokaControlPanels\" panelClass=\"DokaControlPanel\" {panels} {...tabsConfig} let:panel>\nfunction create_default_slot_1$4(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_1$7,create_if_block_2$5];var if_blocks=[];function select_block_type(ctx,dirty){if(/*panel*/ctx[167]===/*tabs*/ctx[21][0].id)return 0;if(/*panel*/ctx[167]===/*tabs*/ctx[21][1].id)return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if(~current_block_type_index){if_blocks[current_block_type_index].m(target,anchor);}insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(~current_block_type_index){if_blocks[current_block_type_index].d(detaching);}if(detaching)detach(if_block_anchor);}};}// (1263:4) <div slot=\"footer\" style={footerStyle}>\nfunction create_footer_slot(ctx){var div;var current;var if_block=/*shouldRenderFooter*/ctx[18]&&create_if_block$6(ctx);return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"slot\",\"footer\");attr(div,\"style\",/*footerStyle*/ctx[23]);},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);current=true;},p:function p(ctx,dirty){if(/*shouldRenderFooter*/ctx[18]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*shouldRenderFooter*/262144){transition_in(if_block,1);}}else{if_block=create_if_block$6(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty[0]&/*footerStyle*/8388608){attr(div,\"style\",/*footerStyle*/ctx[23]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}// (1206:0) <Util hasHeader={shouldRenderToolbar} on:measure bind:root>\nfunction create_default_slot$6(ctx){var t0;var t1;return{c:function c(){t0=space();t1=space();},m:function m(target,anchor){insert(target,t0,anchor);insert(target,t1,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t0);if(detaching)detach(t1);}};}function create_fragment$r(ctx){var util;var updating_root;var current;function util_root_binding(value){/*util_root_binding*/ctx[101].call(null,value);}var util_props={hasHeader:/*shouldRenderToolbar*/ctx[17],$$slots:{\"default\":[create_default_slot$6],footer:[create_footer_slot],main:[create_main_slot],header:[create_header_slot]},$$scope:{ctx:ctx}};if(/*root*/ctx[6]!==void 0){util_props.root=/*root*/ctx[6];}util=new Util({props:util_props});binding_callbacks.push(function(){return bind(util,\"root\",util_root_binding);});util.$on(\"measure\",/*measure_handler*/ctx[102]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*shouldRenderToolbar*/131072)util_changes.hasHeader=/*shouldRenderToolbar*/ctx[17];if(dirty[0]&/*footerStyle, panels, tabsConfig, $imageRotation, locale, $imageRotationRange, tabs, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel, transformSelected, shouldRenderTabs, shouldRenderFooter, $imageCropRect, shouldRenderInfoIndicator, cropEnableZoom, $rootRect, imageSelectionRectOffset, $isActive, cropImageSelectionCornerStyle, shouldRenderImageSelection, canCenter, $recenterOpacity, $recenterOffset, shouldRenderImageSelectionRecenterButton, tools*/536739773|dirty[5]&/*$$scope*/16384){util_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_root&&dirty[0]&/*root*/64){updating_root=true;util_changes.root=/*root*/ctx[6];add_flush_callback(function(){return updating_root=false;});}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}var imageZoomLevelMax=1;var imageZoomLevelBase=0;function instance$r($$self,$$props,$$invalidate){var $imageCropAspectRatio;var $imageCropRect;var $imageSize;var $imageRotation;var $imageFlipY;var $imageFlipX;var $selectedPresetIndex;var $imageOutputSize;var $imageCropMinSize;var $imageCropLimitToImage;var $isInteracting;var $imageSelectionRectSnapshot;var $imageSelectionRect;var $presentationScalar;var $imageCropMaxSize;var $imageSelectionRectIntent;var $utilRect;var $imageCropRectOrigin;var $imageCropRectIntent;var $imageCropRange;var $rootRect;var $stageRect;var $imageCropRangeAspectRatio;var $imageSelectionRectPresentation;var $env;var $imageScalar;var $isActive,$$unsubscribe_isActive=noop$1,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(16,$isActive=$$value);}),isActive;};var $imagePreviewModifiers;var $footerOffset;var $recenterOpacity;var $recenterOffset;var $imageRotationRange;var $imageZoomLevelRange;var $imageZoomLevel;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name=\"crop\";var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$cropImageSel=$$props.cropImageSelectionCornerStyle,cropImageSelectionCornerStyle=_$$props$cropImageSel===void 0?\"circle\":_$$props$cropImageSel;// 'circle', 'hook'\nvar _$$props$cropAutoCent=$$props.cropAutoCenterImageSelectionTimeout,cropAutoCenterImageSelectionTimeout=_$$props$cropAutoCent===void 0?undefined:_$$props$cropAutoCent;var _$$props$cropEnableZo=$$props.cropEnableZoomMatchImageAspectRatio,cropEnableZoomMatchImageAspectRatio=_$$props$cropEnableZo===void 0?true:_$$props$cropEnableZo;var _$$props$cropEnableRo=$$props.cropEnableRotateMatchImageAspectRatio,cropEnableRotateMatchImageAspectRatio=_$$props$cropEnableRo===void 0?\"never\":_$$props$cropEnableRo;// 'always' | 'custom' | 'never'\nvar _$$props$cropEnableRo2=$$props.cropEnableRotationInput,cropEnableRotationInput=_$$props$cropEnableRo2===void 0?true:_$$props$cropEnableRo2;var _$$props$cropEnableZo2=$$props.cropEnableZoom,cropEnableZoom=_$$props$cropEnableZo2===void 0?true:_$$props$cropEnableZo2;var _$$props$cropEnableZo3=$$props.cropEnableZoomInput,cropEnableZoomInput=_$$props$cropEnableZo3===void 0?true:_$$props$cropEnableZo3;var _$$props$cropEnableIm=$$props.cropEnableImageSelection,cropEnableImageSelection=_$$props$cropEnableIm===void 0?true:_$$props$cropEnableIm;var _$$props$cropEnableIn=$$props.cropEnableInfoIndicator,cropEnableInfoIndicator=_$$props$cropEnableIn===void 0?false:_$$props$cropEnableIn;var _$$props$cropEnableZo4=$$props.cropEnableZoomTowardsWheelPosition,cropEnableZoomTowardsWheelPosition=_$$props$cropEnableZo4===void 0?true:_$$props$cropEnableZo4;var _$$props$cropEnableLi=$$props.cropEnableLimitWheelInputToCropSelection,cropEnableLimitWheelInputToCropSelection=_$$props$cropEnableLi===void 0?true:_$$props$cropEnableLi;var _$$props$cropEnableCe=$$props.cropEnableCenterImageSelection,cropEnableCenterImageSelection=_$$props$cropEnableCe===void 0?true:_$$props$cropEnableCe;var _$$props$cropEnableBu=$$props.cropEnableButtonRotateLeft,cropEnableButtonRotateLeft=_$$props$cropEnableBu===void 0?true:_$$props$cropEnableBu;var _$$props$cropEnableBu2=$$props.cropEnableButtonRotateRight,cropEnableButtonRotateRight=_$$props$cropEnableBu2===void 0?false:_$$props$cropEnableBu2;var _$$props$cropEnableBu3=$$props.cropEnableButtonFlipHorizontal,cropEnableButtonFlipHorizontal=_$$props$cropEnableBu3===void 0?true:_$$props$cropEnableBu3;var _$$props$cropEnableBu4=$$props.cropEnableButtonFlipVertical,cropEnableButtonFlipVertical=_$$props$cropEnableBu4===void 0?false:_$$props$cropEnableBu4;var _$$props$cropSelectPr=$$props.cropSelectPresetOptions,cropSelectPresetOptions=_$$props$cropSelectPr===void 0?undefined:_$$props$cropSelectPr;var _$$props$cropEnableSe=$$props.cropEnableSelectPreset,cropEnableSelectPreset=_$$props$cropEnableSe===void 0?true:_$$props$cropEnableSe;var _$$props$cropEnableBu5=$$props.cropEnableButtonToggleCropLimit,cropEnableButtonToggleCropLimit=_$$props$cropEnableBu5===void 0?false:_$$props$cropEnableBu5;var _$$props$locale5=$$props.locale,locale=_$$props$locale5===void 0?{}:_$$props$locale5;var _$$props$tools=$$props.tools,tools=_$$props$tools===void 0?[]:_$$props$tools;var isCustomCrop=function isCustomCrop(){return $imageCropAspectRatio===undefined;};var turnAspectRatio=function turnAspectRatio(aspectRatio){return 1/aspectRatio;};var hasValidRotatedCropAspectRatio=function hasValidRotatedCropAspectRatio(){if($imageCropAspectRatio===1)return false;var rotatedImageCropAspectRatio=turnAspectRatio($imageCropAspectRatio);// no options available, forced crop aspect ratio\nif(!cropSelectPresetOptions)return false;// options available but no valid option in list\nif(!flattenOptions(cropSelectPresetOptions).find(function(_ref225){var _ref226=_slicedToArray(_ref225,1),aspectRatio=_ref226[0];return aspectRatio===rotatedImageCropAspectRatio;}))return false;return true;};var isCropMaxSize=function isCropMaxSize(imageCropRect,imageSize,imageRotation){return isRotatedSideways(imageRotation)?imageSize.width===Math.round(imageCropRect.height)||imageSize.height===Math.round(imageCropRect.width):imageSize.width===Math.round(imageCropRect.width)||imageSize.height===Math.round(imageCropRect.height);};var isCropCentered=function isCropCentered(imageCropRect,imageSize,imageRotation){var imageSizeRotated=sizeApply(sizeRotate(sizeClone(imageSize),imageRotation),function(v){return Math.abs(Math.round(v));});var imageCenter=sizeCenter(imageSizeRotated);var cropCenter=rectCenter(imageCropRect);return vectorEqual(imageCenter,cropCenter);};var canMatchCropAspectRatioToRotation=function canMatchCropAspectRatioToRotation(){return(// is custom crop mode\nisCustomCrop()||// can match preset crop and preset is available\ncropEnableRotateMatchImageAspectRatio===\"always\"&&hasValidRotatedCropAspectRatio())&&isCropCentered($imageCropRect,$imageSize,$imageRotation)&&isCropMaxSize($imageCropRect,$imageSize,$imageRotation);};var applyRotation=function applyRotation(value){if(cropEnableRotateMatchImageAspectRatio!==\"never\"&&canMatchCropAspectRatioToRotation()){set_store_value(imageRotation,$imageRotation+=value,$imageRotation);var isRotated=isRotatedSideways($imageRotation);var w=isRotated?$imageSize.height:$imageSize.width;var _h3=isRotated?$imageSize.width:$imageSize.height;set_store_value(imageCropRect,$imageCropRect=rectCreate(0,0,w,_h3),$imageCropRect);if(!isCustomCrop())set_store_value(imageCropAspectRatio,$imageCropAspectRatio=getAspectRatio(w,_h3),$imageCropAspectRatio);}else{set_store_value(imageRotation,$imageRotation+=value,$imageRotation);}};var _stores2=stores,history=_stores2.history,env=_stores2.env,isInteracting=_stores2.isInteracting,rootRect=_stores2.rootRect,stageRect=_stores2.stageRect,utilRect=_stores2.utilRect,elasticityMultiplier=_stores2.elasticityMultiplier,rangeInputElasticity=_stores2.rangeInputElasticity,presentationScalar=_stores2.presentationScalar,imagePreviewModifiers=_stores2.imagePreviewModifiers,imageFlipX=_stores2.imageFlipX,imageFlipY=_stores2.imageFlipY,imageRotation=_stores2.imageRotation,imageRotationRange=_stores2.imageRotationRange,imageOutputSize=_stores2.imageOutputSize,imageSelectionRect=_stores2.imageSelectionRect,imageSelectionRectSnapshot=_stores2.imageSelectionRectSnapshot,imageSelectionRectIntent=_stores2.imageSelectionRectIntent,imageSelectionRectPresentation=_stores2.imageSelectionRectPresentation,imageCropRectIntent=_stores2.imageCropRectIntent,imageCropRectOrigin=_stores2.imageCropRectOrigin,imageCropRect=_stores2.imageCropRect,imageCropMinSize=_stores2.imageCropMinSize,imageCropMaxSize=_stores2.imageCropMaxSize,imageCropRange=_stores2.imageCropRange,imageCropAspectRatio=_stores2.imageCropAspectRatio,imageCropRectAspectRatio=_stores2.imageCropRectAspectRatio,imageCropLimitToImage=_stores2.imageCropLimitToImage,imageSize=_stores2.imageSize,imageScalar=_stores2.imageScalar;// the actual limited rectangle\n// used to calculate rectangle while dragging\n// can be used to set set intended rectangle\n// readonly\ncomponent_subscribe($$self,env,function(value){return $$invalidate(140,$env=value);});component_subscribe($$self,isInteracting,function(value){return $$invalidate(120,$isInteracting=value);});component_subscribe($$self,rootRect,function(value){return $$invalidate(10,$rootRect=value);});component_subscribe($$self,stageRect,function(value){return $$invalidate(130,$stageRect=value);});component_subscribe($$self,utilRect,function(value){return $$invalidate(126,$utilRect=value);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(123,$presentationScalar=value);});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(143,$imagePreviewModifiers=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(113,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(112,$imageFlipY=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(8,$imageRotation=value);});component_subscribe($$self,imageRotationRange,function(value){return $$invalidate(26,$imageRotationRange=value);});component_subscribe($$self,imageOutputSize,function(value){return $$invalidate(116,$imageOutputSize=value);});component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(122,$imageSelectionRect=value);});component_subscribe($$self,imageSelectionRectSnapshot,function(value){return $$invalidate(121,$imageSelectionRectSnapshot=value);});component_subscribe($$self,imageSelectionRectIntent,function(value){return $$invalidate(125,$imageSelectionRectIntent=value);});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(134,$imageSelectionRectPresentation=value);});component_subscribe($$self,imageCropRectIntent,function(value){return $$invalidate(128,$imageCropRectIntent=value);});component_subscribe($$self,imageCropRectOrigin,function(value){return $$invalidate(127,$imageCropRectOrigin=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(7,$imageCropRect=value);});component_subscribe($$self,imageCropMinSize,function(value){return $$invalidate(118,$imageCropMinSize=value);});component_subscribe($$self,imageCropMaxSize,function(value){return $$invalidate(124,$imageCropMaxSize=value);});component_subscribe($$self,imageCropRange,function(value){return $$invalidate(129,$imageCropRange=value);});component_subscribe($$self,imageCropAspectRatio,function(value){return $$invalidate(110,$imageCropAspectRatio=value);});component_subscribe($$self,imageCropLimitToImage,function(value){return $$invalidate(119,$imageCropLimitToImage=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(111,$imageSize=value);});component_subscribe($$self,imageScalar,function(value){return $$invalidate(142,$imageScalar=value);});//\n// resizing crop\n//\nvar presentationScalarSnapshot;var imageSelectionRectMinSize;var imageSelectionRectMaxSize;var handleSelectionGrab=function handleSelectionGrab(){// now interacting\nset_store_value(isInteracting,$isInteracting=true,$isInteracting);// we remember the current view rect and crop rect, because that is the crop rect we use as a starting point to transform while dragging\nset_store_value(imageSelectionRectSnapshot,$imageSelectionRectSnapshot=rectClone($imageSelectionRect),$imageSelectionRectSnapshot);// remember current scalar so we can update min and max size correctly\npresentationScalarSnapshot=$presentationScalar;imageSelectionRectMinSize=sizeScale(sizeClone($imageCropMinSize),presentationScalarSnapshot);imageSelectionRectMaxSize=sizeScale(sizeClone($imageCropMaxSize),presentationScalarSnapshot);};var handleSelectionDrag=function handleSelectionDrag(_ref227){var detail=_ref227.detail;var _translateSelection=translateSelection(detail.direction,detail.translation),boundsLimited=_translateSelection.boundsLimited,boundsIntent=_translateSelection.boundsIntent;// update actual image selection rectangle\nset_store_value(imageSelectionRectIntent,$imageSelectionRectIntent=boundsIntent,$imageSelectionRectIntent);// intent needs to be updated first because has no listeners attached\nset_store_value(imageSelectionRect,$imageSelectionRect=boundsLimited,$imageSelectionRect);};var handleSelectionRelease=function handleSelectionRelease(_ref228){var detail=_ref228.detail;var _translateSelection2=translateSelection(detail.direction,detail.translation),boundsLimited=_translateSelection2.boundsLimited;// we're no longer interacting with the image selection, we need to set this here so the image selection presentation is animated when applying the new bounds below\nset_store_value(isInteracting,$isInteracting=false,$isInteracting);// no more intent as we're finalizing the selection, so before setting the final selection, we set this to undefined | intent needs to be updated first because has no listeners attached\nset_store_value(imageSelectionRectIntent,$imageSelectionRectIntent=undefined,$imageSelectionRectIntent);// confirm the limited rect if actually made a change\nif(vectorLength(detail.translation)){set_store_value(imageSelectionRect,$imageSelectionRect=boundsLimited,$imageSelectionRect);history.write();}// need to set this to undefined after setting the final rect, the snapshot is used to calculate the crop rect transform\nset_store_value(imageSelectionRectSnapshot,$imageSelectionRectSnapshot=undefined,$imageSelectionRectSnapshot);};var translateSelection=function translateSelection(target,translate){// - selection may grow to max bounds (util bounds)\n// - the image preview(!) is scaled to fit the selection, actual image size is not affected\n// - we need to make sure the selection adheres to the aspect ratio of the min size\nvar directionTranslation={target:target,translate:translate};var rectIntended=applyRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,{aspectRatio:$imageCropAspectRatio});var cropAspectRatioLimited;// size in crop rect\nvar cropSize=sizeCreateFromRect(rectDivide(rectClone(rectIntended),$presentationScalar));var imagePolygon=getImagePolygon($imageSize,$imageRotation);var imageCenter=quadCentroid(imagePolygon);// if one of the edges is small and not both are smaller we need to correct\nif(cropSize.width<$imageCropMinSize.width||cropSize.height<$imageCropMinSize.height){// if moving towards the center of the crop, it can't exceed bounds\nvar translateUp=translate.y<0;var translateRight=translate.x>0;var translateLeft=translate.x<0;var translateDown=translate.y>0;var couldExceedBounds=target===\"t\"&&translateUp||target===\"r\"&&translateRight||target===\"b\"&&translateDown||target===\"l\"&&translateLeft||target===\"tr\"&&(translateRight||translateUp)||target===\"tl\"&&(translateLeft||translateUp)||target===\"br\"&&(translateRight||translateDown)||target===\"bl\"&&(translateLeft||translateDown);// need the aspect ratio of the crop to determine if it violates min size\nvar cropAspectRatio=rectAspectRatio(cropSize);// find the maximum size for the current aspect ratio\nvar cropSizeMax=getMaxSizeInRect($imageSize,$imageRotation,cropAspectRatio);if(couldExceedBounds&&(cropSizeMax.width<$imageCropMinSize.width||cropSizeMax.height<$imageCropMinSize.height)){if($imageRotation!==0){var sign=Math.sign($imageRotation);var turns=Math.round(Math.abs($imageRotation)/HALF_PI)*HALF_PI;var value=$imageRotation-sign*turns;var imageIsRotated=turns/HALF_PI%2===1;var imageWidth=imageIsRotated?$imageSize.height:$imageSize.width;var imageHeight=imageIsRotated?$imageSize.width:$imageSize.height;var _r7=Math.abs(value);var sin=Math.sin(_r7);var cos=Math.cos(_r7);if(cropSize.width<$imageCropMinSize.width){// width doesn't fit, let's limit the width to the min size\ncropSize.width=$imageCropMinSize.width;// And now calculate the height\n//  - rotation = .15\n//  - image size = 384 x 288\n//  - crop size width = 200\n// height = 288 - (Math.sin(.15) * 200) / Math.cos(.15)\nvar w=cos*cropSize.width+sin*cropSize.height;var _h4=sin*cropSize.width+cos*cropSize.height;var dx=imageWidth-w;var dy=imageHeight-_h4;if(dx<dy){cropSize.height=(imageWidth-cos*cropSize.width)/sin;}else if(dy<dx){cropSize.height=(imageHeight-sin*cropSize.width)/cos;}}if(cropSize.height<$imageCropMinSize.height){// height doesn't fit, let's limit the height to the min size\ncropSize.height=$imageCropMinSize.height;// And now calculate the width\n//  - rotation = .15\n//  - image size = 384 x 288\n//  - crop size height = 200\nvar _w=cos*cropSize.width+sin*cropSize.height;var _h5=sin*cropSize.width+cos*cropSize.height;var _dx=imageWidth-_w;var _dy=imageHeight-_h5;if(_dx<_dy){// (384 - (Math.sin(.15) * 250)) / Math.cos(.15)\ncropSize.width=(imageWidth-sin*cropSize.height)/cos;}else if(_dy<_dx){// (288 - (Math.cos(.15) * 250)) / Math.sin(.15)\ncropSize.width=(imageHeight-cos*cropSize.height)/sin;}}}else{if(cropSize.width<$imageCropMinSize.width){cropSize.width=$imageCropMinSize.width;cropSize.height=$imageSize.height;}if(cropSize.height<$imageCropMinSize.height){cropSize.height=$imageCropMinSize.height;cropSize.width=$imageSize.width;}}// we now have a corrected size, let's calculate the new aspect ratio and use that to limit the translation\ncropAspectRatioLimited=rectAspectRatio(cropSize);}}if(cropAspectRatioLimited){rectIntended=applyRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,{aspectRatio:cropAspectRatioLimited||$imageCropAspectRatio});}var rectLimited=limitRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,$utilRect,{aspectRatio:$imageCropAspectRatio||cropAspectRatioLimited,minSize:imageSelectionRectMinSize,maxSize:imageSelectionRectMaxSize});return{boundsLimited:rectLimited,boundsIntent:rectIntended};};//\n// rotating\n//\nvar handleRotateStart=function handleRotateStart(){// now interacting with view\nset_store_value(isInteracting,$isInteracting=true,$isInteracting);// we need to know the origin of the crop so we can \"shrink\" the image to fit the crop rect while rotating\nset_store_value(imageCropRectOrigin,$imageCropRectOrigin=rectClone($imageCropRect),$imageCropRectOrigin);};var handleRotateMove=function handleRotateMove(value){set_store_value(imageRotation,$imageRotation=value,$imageRotation);// will auto validate\n};var handleRotateEnd=function handleRotateEnd(value){// we're done interacting\nset_store_value(isInteracting,$isInteracting=false,$isInteracting);// apply our final rotation value\nset_store_value(imageRotation,$imageRotation=value,$imageRotation);history.write();// done, so we no longer need to \"shrink\" the image\nset_store_value(imageCropRectOrigin,$imageCropRectOrigin=undefined,$imageCropRectOrigin);};//\n// moving\n//\nvar interactionCropRect=undefined;var interactionCropRectForce=undefined;var handleImageDragStart=function handleImageDragStart(){interactionCropRectForce=undefined;set_store_value(isInteracting,$isInteracting=true,$isInteracting);interactionCropRect=rectClone($imageCropRect);};var handleImageDrag=function handleImageDrag(_ref229){var detail=_ref229.detail;return manipulateImage(detail);};var handleImageDragEnd=function handleImageDragEnd(_ref230){var detail=_ref230.detail;// done interacting\nset_store_value(isInteracting,$isInteracting=false,$isInteracting);// apply translation to the crop rect only if did make changes\nif(vectorLength(detail.translation)>0||detail.scalar!==0){manipulateImage(detail);history.write();}// no intent (needs to be set before crop rect is updated)\nset_store_value(imageCropRectIntent,$imageCropRectIntent=undefined,$imageCropRectIntent);// now done\ninteractionCropRect=undefined;};var handleImageDragRelease=function handleImageDragRelease(_ref231){var detail=_ref231.detail;interactionCropRectForce=detail.translation;set_store_value(isInteracting,$isInteracting=false,$isInteracting);};var manipulateImage=function manipulateImage(_ref232){var translation=_ref232.translation,scalar=_ref232.scalar;var imageSelectionRectZoomFactor=Math.min($imageSelectionRect.width/$imageCropRect.width,$imageSelectionRect.height/$imageCropRect.height);var scaledTranslation=vectorMultiply(vectorClone(translation),1/imageSelectionRectZoomFactor);// while we're interacting we apply changes to the original crop rectangle, after we apply a force\nvar cropIntent;if(!interactionCropRectForce){cropIntent=rectTranslate(rectClone(interactionCropRect),vectorInvert(vectorClone(scaledTranslation)));if(scalar!==undefined){rectScale(cropIntent,1-scalar);}}else{// we apply the force to the existing crop rect so animation is not borked\nvar forceTranslation=vectorSubtract(vectorClone(interactionCropRectForce),translation);interactionCropRectForce=translation;cropIntent=rectTranslate(rectClone($imageCropRect),forceTranslation);}// update crop rect\nset_store_value(imageCropRectIntent,$imageCropRectIntent=cropIntent,$imageCropRectIntent);// auto calculates an elastic effect if bounds exceeded (needs to be set before crop rect is updated)\nset_store_value(imageCropRect,$imageCropRect=cropIntent,$imageCropRect);// auto limits to bounds if needed\n};//\n// resizing with range input\n//\nvar calculateZoomLevel=function calculateZoomLevel(imageSize,size,imageRotation){if(isRotatedSideways(imageRotation)){return 1-1/Math.min(imageSize.height/size.width,imageSize.width/size.height);}return 1-1/Math.min(imageSize.width/size.width,imageSize.height/size.height);};var imageCropRangeAspectRatio=derived([imageCropRange,imageCropRect],function(_ref233,set){var _ref234=_slicedToArray(_ref233,2),$imageCropRange=_ref234[0],$imageCropRect=_ref234[1];if(!$imageCropRect)return;var _$imageCropRange=_slicedToArray($imageCropRange,2),minSize=_$imageCropRange[0],maxSize=_$imageCropRange[1];var aspectRatio=rectAspectRatio($imageCropRect);set([sizeCreateFromRect(rectApply(rectCoverRect(minSize,aspectRatio),fixPrecision)),sizeCreateFromRect(rectApply(rectContainRect(maxSize,aspectRatio),fixPrecision))]);});component_subscribe($$self,imageCropRangeAspectRatio,function(value){return $$invalidate(131,$imageCropRangeAspectRatio=value);});// this is the max value range that can be set (triggers white range indicator bar)\nvar imageZoomLevelRange=derived([imageSize,imageCropLimitToImage,imageCropMinSize,imageCropMaxSize,imageCropRange,imageRotation],function(_ref235,set){var _ref236=_slicedToArray(_ref235,6),$imageSize=_ref236[0],$imageCropLimitToImage=_ref236[1],$imageCropMinSize=_ref236[2],$imageCropMaxSize=_ref236[3],$imageCropRange=_ref236[4],$imageRotation=_ref236[5];if(!$imageSize)return;var rangeMinSize=$imageCropRange[0];var rangeMaxSize=$imageCropRange[1];var minZoom;var maxZoom;// can't zoom out\nif($imageCropLimitToImage){minZoom=calculateZoomLevel($imageSize,rangeMaxSize,$imageRotation);maxZoom=Math.min(rangeMinSize.width/$imageCropMinSize.width,rangeMinSize.height/$imageCropMinSize.height);}else{maxZoom=1;minZoom=-1;}var range=[fixPrecision(minZoom),fixPrecision(maxZoom)];set(range);});component_subscribe($$self,imageZoomLevelRange,function(value){return $$invalidate(27,$imageZoomLevelRange=value);});var imageZoomLevel=derived([imageSize,imageCropRect,imageCropRange,imageRotation],function(_ref237,set){var _ref238=_slicedToArray(_ref237,4),$imageSize=_ref238[0],$imageCropRect=_ref238[1],$imageCropRange=_ref238[2],$imageRotation=_ref238[3];// need to check if this value is set, could be that it's empty while loading a new image\nif(!$imageSize||!$imageCropRect)return set(0);var z;var rangeMinSize=$imageCropRange[0];var rangeMaxSize=$imageCropRange[1];var currentCropWidth=$imageCropRect.width;var currentCropHeight=$imageCropRect.height;var currentCropAspectRatio=rectAspectRatio($imageCropRect);var imageRect=isRotatedSideways($imageRotation)?sizeCreate($imageSize.height,$imageSize.width):$imageSize;var imageCropMaxRect=rectContainRect(imageRect,currentCropAspectRatio);if(currentCropWidth<=imageCropMaxRect.width||currentCropHeight<=imageCropMaxRect.height){// zoomed in\nvar w=imageCropMaxRect.width-rangeMinSize.width;var _h6=imageCropMaxRect.height-rangeMinSize.height;// cannot zoom in\nif(w===0||_h6===0){z=1;}else{z=1-Math.min((currentCropWidth-rangeMinSize.width)/w,(currentCropHeight-rangeMinSize.height)/_h6);}}else{// zoomed out\nvar _w2=rangeMaxSize.width-imageCropMaxRect.width;var _h7=rangeMaxSize.height-imageCropMaxRect.height;var _r8=rectContainRect({width:_w2,height:_h7},currentCropAspectRatio);z=-Math.min((currentCropWidth-imageCropMaxRect.width)/_r8.width,(currentCropHeight-imageCropMaxRect.height)/_r8.height);}set(z);});component_subscribe($$self,imageZoomLevel,function(value){return $$invalidate(28,$imageZoomLevel=value);});var snapshotCropRect=function snapshotCropRect(){interactionCropRect=rectClone($imageCropRect);};var resizeImage=function resizeImage(zoom){var aspectRatio=rectAspectRatio(interactionCropRect);var targetWidth;var targetHeight;var r;var imageRect=isRotatedSideways($imageRotation)?sizeCreate($imageSize.height,$imageSize.width):$imageSize;var imageCropMaxRect=rectContainRect(imageRect,aspectRatio);if(zoom>=0){// zoom in\nvar rangeWidth=imageCropMaxRect.width-$imageCropRange[0].width;var rangeHeight=imageCropMaxRect.height-$imageCropRange[0].height;targetWidth=imageCropMaxRect.width-rangeWidth*zoom;targetHeight=imageCropMaxRect.height-rangeHeight*zoom;r=rectCoverRect({width:targetWidth,height:targetHeight},aspectRatio);}else{// zoom out\nvar _rangeWidth=$imageCropRange[1].width-imageCropMaxRect.width;var _rangeHeight=$imageCropRange[1].height-imageCropMaxRect.height;targetWidth=imageCropMaxRect.width+_rangeWidth*-zoom;targetHeight=imageCropMaxRect.height+_rangeHeight*-zoom;r=rectContainRect({width:targetWidth,height:targetHeight},aspectRatio);}targetWidth=r.width;targetHeight=r.height;var targetX=interactionCropRect.x+interactionCropRect.width*0.5-targetWidth*0.5;var targetY=interactionCropRect.y+interactionCropRect.height*0.5-targetHeight*0.5;set_store_value(imageCropRect,$imageCropRect={x:targetX,y:targetY,width:targetWidth,height:targetHeight},$imageCropRect);};var handleResizeStart=function handleResizeStart(){// now interacting with view\nset_store_value(isInteracting,$isInteracting=true,$isInteracting);snapshotCropRect();};var handleResizeMove=function handleResizeMove(value){// value range from 0 (no zoom) to 1 (100% zoom, 1x1 pixel)\nresizeImage(value);};var handleResizeEnd=function handleResizeEnd(value){resizeImage(value);history.write();// we're done interacting\nset_store_value(isInteracting,$isInteracting=false,$isInteracting);// now done\ninteractionCropRect=undefined;};//\n// resizing with wheel\n//\nvar zoomHistoryTimeoutId;var handleWheel=function handleWheel(e){var stageWheelPosition=getEventPositionInStage(e,$rootRect,$stageRect);// only block input if wheel is used within image rectangle\nif(cropEnableLimitWheelInputToCropSelection&&!rectContainsPoint($imageSelectionRect,stageWheelPosition))return;// now interacting\nset_store_value(isInteracting,$isInteracting=true,$isInteracting);// don't run default actions, prevent other actions from running\ne.preventDefault();e.stopPropagation();// get current crop rect\nvar currentCropRect=rectClone($imageCropRect);// convert wheel delta to scalar\nvar delta=getWheelDelta(e);var scalar=1+delta/100;// if already zoomed in, block further zoom in instructions\nvar isMinSize=Math.min($imageCropRect.width/$imageCropMinSize.width,$imageCropRect.height/$imageCropMinSize.height)===1;// if is fully zoomed out and trying to zoom out more and crop shape is free, fit image aspect ratio\nif(cropEnableZoomMatchImageAspectRatio&&$imageCropLimitToImage){var isAtMaxCropSize=isCropMaxSize($imageCropRect,$imageSize,$imageRotation);if(isCustomCrop()&&isAtMaxCropSize&&delta>0&&isImageSelectionCentered){set_store_value(isInteracting,$isInteracting=false,$isInteracting);var _newCropRect=isRotatedSideways($imageRotation)?rectCreateFromSize({height:$imageSize.width,width:$imageSize.height}):rectCreateFromSize($imageSize);// no change, exit\nif(rectEqual(currentCropRect,_newCropRect))return;// if we were previously zooming in we need to clear the timeout to prevent two history entries\nclearTimeout(zoomHistoryTimeoutId);// test if crop rect in history is same as new crop rect, this is possible when zooming in and out real quick\nif(rectEqual(history.state.crop,_newCropRect))return;// store new crop rect\nset_store_value(imageCropRect,$imageCropRect=_newCropRect,$imageCropRect);history.write();return;}}// by default when zooming, zoom from center of crop rectangle\nvar origin=rectCenter($imageCropRect);// when zooming in, zoom in on the part of the image below the mouse cursor\nif(cropEnableZoomTowardsWheelPosition&&delta<0&&!isMinSize){var selectionOffset=vectorSubtract(vectorClone(stageWheelPosition),$imageSelectionRect);var imageSelectionScale=Math.min($imageSelectionRect.width/$imageCropRect.width,$imageSelectionRect.height/$imageCropRect.height);// if wheel is inside image selection rectangle (slightly expanded version), we zoom based on position in the rectangle, if not, we use the selection center\nvar expandedImageSelection=rectScale(rectClone($imageSelectionRect),1.1);origin=rectContainsPoint(expandedImageSelection,stageWheelPosition)?vectorAdd(rectClone($imageCropRect),vectorMultiply(selectionOffset,1/imageSelectionScale)):origin;}var newCropRect=rectScale(rectClone($imageCropRect),scalar,origin);// determin if is new crop rect exceeds min or max size, if so, limit\nif(!sizeContains($imageCropRangeAspectRatio[1],newCropRect)){// exceeds max size, limit to max size and position at new crop rect center\nnewCropRect=rectCreateWithCenter(rectCenter(newCropRect),$imageCropRangeAspectRatio[1]);}if(!sizeContains(newCropRect,$imageCropRangeAspectRatio[0])){// exceeds min size, limit to min size and position at new crop rect center\nnewCropRect=rectCreateWithCenter(rectCenter(newCropRect),$imageCropRangeAspectRatio[0]);}// no change, exit\nif(rectEqual(currentCropRect,newCropRect,fixPrecision)){set_store_value(isInteracting,$isInteracting=false,$isInteracting);return;}// attempt to update the rectangle, we use fixPrecision so the width and height are nice integers when at max zoom (this makes sure the `isMinSize` variable is set to true at this point)\nset_store_value(imageCropRect,$imageCropRect=rectApply(newCropRect,function(v){return fixPrecision(v,5);}),$imageCropRect);// done!\nset_store_value(isInteracting,$isInteracting=false,$isInteracting);// write history timer\nclearTimeout(zoomHistoryTimeoutId);zoomHistoryTimeoutId=setTimeout(function(){history.write();},500);};//\n// recenter\n//\n// the 'measure' event triggers the editor to center and scale up the crop\nvar dispatch=createEventDispatcher();var handleRecenterAction=function handleRecenterAction(){dispatch(\"measure\",rectClone($utilRect));};// auto recenter after timeout\nvar cropAutoCenterImageSelectionTimeoutId;// animations\nvar recenterOpacity=spring(0,{precision:0.0001});component_subscribe($$self,recenterOpacity,function(value){return $$invalidate(24,$recenterOpacity=value);});var recenterOffset=spring();component_subscribe($$self,recenterOffset,function(value){return $$invalidate(25,$recenterOffset=value);});var footerOffset=spring(0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(146,$footerOffset=value);});//\n// crop selection presets\n//\nvar selectedPresetIndex=derived([imageCropAspectRatio,imageOutputSize],function(_ref239,set){var _ref240=_slicedToArray(_ref239,2),$cropAspectRatio=_ref240[0],$imageOutputSize=_ref240[1];if(!cropSelectPresetOptions)return;var options=flattenOptions(cropSelectPresetOptions);var matchedOptionValue=_toConsumableArray(options).// to value\nmap(function(option){return option[0];}).// sort sizes first\nsort(function(a,b){if(isArray(a[0])&&!isArray(b[0]))return 1;return-1;}).// match value\nfind(function(value){if(isArray(value)&&$imageOutputSize){// size + aspect ratio\nvar _value=_slicedToArray(value,2),width=_value[0],height=_value[1];var outputSizeMatches=$imageOutputSize.width===width&&$imageOutputSize.height===height;var aspectRatioMatches=$cropAspectRatio===getAspectRatio(width,height);return outputSizeMatches&&aspectRatioMatches;}// aspect ratio\nreturn value===$cropAspectRatio;});var index=options.// to value\nmap(function(option){return option[0];}).// find index of matching value\nfindIndex(function(value){return isArray(value)?arrayEqual(value,matchedOptionValue):value===matchedOptionValue;});set(index);});component_subscribe($$self,selectedPresetIndex,function(value){return $$invalidate(115,$selectedPresetIndex=value);});var getSelectionPresetLabelIcon=function getSelectionPresetLabelIcon(selectedIndex){if(!cropSelectPresetOptions)return;var selectedValue=flattenOptions(cropSelectPresetOptions)[selectedIndex][0];var aspectRatio=!selectedValue?undefined:isArray(selectedValue)?getAspectRatio(selectedValue[0],selectedValue[1]):selectedValue;var _ref241=!aspectRatio?[0.2,0.3,0.4]:[aspectRatio<1?1:0.3,aspectRatio===1?0.85:0.5,aspectRatio>1?1:0.3],_ref242=_slicedToArray(_ref241,3),a=_ref242[0],b=_ref242[1],c=_ref242[2];return\"<g fill=\\\"currentColor\\\">\\n        <rect opacity=\\\"\".concat(a,\"\\\" x=\\\"2\\\" y=\\\"4\\\" width=\\\"10\\\" height=\\\"18\\\" rx=\\\"1\\\"/>\\n        <rect opacity=\\\"\").concat(b,\"\\\" x=\\\"4\\\" y=\\\"8\\\" width=\\\"14\\\" height=\\\"14\\\" rx=\\\"1\\\"/>\\n        <rect opacity=\\\"\").concat(c,\"\\\" x=\\\"6\\\" y=\\\"12\\\" width=\\\"17\\\" height=\\\"10\\\" rx=\\\"1\\\"/>\\n    </g>\");};//\n// crop boundary\n//\nvar getCropBoundaryLabelIcon=function getCropBoundaryLabelIcon(isBoundToImage){var _ref243=isBoundToImage?[0.3,1,0,0]:[0,0,0.3,1],_ref244=_slicedToArray(_ref243,4),a=_ref244[0],b=_ref244[1],c=_ref244[2],d=_ref244[3];return\"<g fill=\\\"currentColor\\\">\\n        <rect opacity=\\\"\".concat(a,\"\\\" x=\\\"2\\\" y=\\\"3\\\" width=\\\"20\\\" height=\\\"20\\\" rx=\\\"1\\\"/>\\n        <rect opacity=\\\"\").concat(b,\"\\\" x=\\\"7\\\" y=\\\"8\\\" width=\\\"10\\\" height=\\\"10\\\" rx=\\\"1\\\"/>\\n        <rect opacity=\\\"\").concat(c,\"\\\" x=\\\"4\\\" y=\\\"8\\\" width=\\\"14\\\" height=\\\"14\\\" rx=\\\"1\\\"/>\\n        <rect opacity=\\\"\").concat(d,\"\\\" x=\\\"12\\\" y=\\\"4\\\" width=\\\"10\\\" height=\\\"10\\\" rx=\\\"1\\\"/>\\n    </g>\");};var cropUniqueId=\"crop-\".concat(getUniqueId());var transformInitial=cropEnableRotationInput?\"rotation\":\"zoom\";var transformToolInitial=cropUniqueId+\"-\"+transformInitial;var transformSelected=transformToolInitial;var root=undefined;function measure_handler_1(event){bubble($$self,event);}var interactable_function=function interactable_function(e){return getEventPositionInViewport(e);};var select_handler=function select_handler(_ref245){var detail=_ref245.detail;return $$invalidate(5,transformSelected=detail);};function util_root_binding(value){root=value;$$invalidate(6,root);}function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$subscribe_isActive($$invalidate(1,isActive=$$props.isActive));if(\"stores\"in $$props)$$invalidate(80,stores=$$props.stores);if(\"cropImageSelectionCornerStyle\"in $$props)$$invalidate(2,cropImageSelectionCornerStyle=$$props.cropImageSelectionCornerStyle);if(\"cropAutoCenterImageSelectionTimeout\"in $$props)$$invalidate(81,cropAutoCenterImageSelectionTimeout=$$props.cropAutoCenterImageSelectionTimeout);if(\"cropEnableZoomMatchImageAspectRatio\"in $$props)$$invalidate(82,cropEnableZoomMatchImageAspectRatio=$$props.cropEnableZoomMatchImageAspectRatio);if(\"cropEnableRotateMatchImageAspectRatio\"in $$props)$$invalidate(83,cropEnableRotateMatchImageAspectRatio=$$props.cropEnableRotateMatchImageAspectRatio);if(\"cropEnableRotationInput\"in $$props)$$invalidate(84,cropEnableRotationInput=$$props.cropEnableRotationInput);if(\"cropEnableZoom\"in $$props)$$invalidate(3,cropEnableZoom=$$props.cropEnableZoom);if(\"cropEnableZoomInput\"in $$props)$$invalidate(85,cropEnableZoomInput=$$props.cropEnableZoomInput);if(\"cropEnableImageSelection\"in $$props)$$invalidate(86,cropEnableImageSelection=$$props.cropEnableImageSelection);if(\"cropEnableInfoIndicator\"in $$props)$$invalidate(87,cropEnableInfoIndicator=$$props.cropEnableInfoIndicator);if(\"cropEnableZoomTowardsWheelPosition\"in $$props)$$invalidate(88,cropEnableZoomTowardsWheelPosition=$$props.cropEnableZoomTowardsWheelPosition);if(\"cropEnableLimitWheelInputToCropSelection\"in $$props)$$invalidate(89,cropEnableLimitWheelInputToCropSelection=$$props.cropEnableLimitWheelInputToCropSelection);if(\"cropEnableCenterImageSelection\"in $$props)$$invalidate(90,cropEnableCenterImageSelection=$$props.cropEnableCenterImageSelection);if(\"cropEnableButtonRotateLeft\"in $$props)$$invalidate(91,cropEnableButtonRotateLeft=$$props.cropEnableButtonRotateLeft);if(\"cropEnableButtonRotateRight\"in $$props)$$invalidate(92,cropEnableButtonRotateRight=$$props.cropEnableButtonRotateRight);if(\"cropEnableButtonFlipHorizontal\"in $$props)$$invalidate(93,cropEnableButtonFlipHorizontal=$$props.cropEnableButtonFlipHorizontal);if(\"cropEnableButtonFlipVertical\"in $$props)$$invalidate(94,cropEnableButtonFlipVertical=$$props.cropEnableButtonFlipVertical);if(\"cropSelectPresetOptions\"in $$props)$$invalidate(95,cropSelectPresetOptions=$$props.cropSelectPresetOptions);if(\"cropEnableSelectPreset\"in $$props)$$invalidate(96,cropEnableSelectPreset=$$props.cropEnableSelectPreset);if(\"cropEnableButtonToggleCropLimit\"in $$props)$$invalidate(97,cropEnableButtonToggleCropLimit=$$props.cropEnableButtonToggleCropLimit);if(\"locale\"in $$props)$$invalidate(4,locale=$$props.locale);if(\"tools\"in $$props)$$invalidate(0,tools=$$props.tools);};var imageZoomLevelMin;var imageSelectionOffset;var imageSelectionCenter;var imageSelectionCenteredRect;var isImageSelectionDisplayed;var isImageSelectionCentered;var isResizingSelection;var isMaxSelectionRect;var isOverlayMode;var canZoomToCenter;var canCenter;var shouldRenderInfoIndicator;var shouldRenderImageSelection;var shouldRenderImageSelectionRecenterButton;var imageSelectionRectOffset;var shouldRenderPresetSelect;var hasPlentyVerticalSpace;var shouldRenderToolbar;var shouldRenderZoomInput;var shouldRenderFooter;var shouldRenderTabs;var tabsConfig;var tabs;var panels;var footerStyle;$$self.$$.update=function(){if($$self.$$.dirty[4]&/*$env*/65536){$$invalidate(139,isOverlayMode=$env.layoutMode===\"overlay\");}if($$self.$$.dirty[3]&/*cropEnableSelectPreset*/8|$$self.$$.dirty[4]&/*isOverlayMode*/32768){//\n// Transform tabs\n//\n$$invalidate(114,shouldRenderPresetSelect=cropEnableSelectPreset&&!isOverlayMode);}if($$self.$$.dirty[3]&/*$imageSelectionRect*/536870912|$$self.$$.dirty[4]&/*$utilRect*/4){// determine if we can center the crop, if we can, show the crop center button\n$$invalidate(135,imageSelectionCenteredRect=$utilRect&&$imageSelectionRect&&rectCenterRect($utilRect,$imageSelectionRect));}if($$self.$$.dirty[3]&/*$imageSelectionRect*/536870912|$$self.$$.dirty[4]&/*imageSelectionCenteredRect*/2048){$$invalidate(136,isImageSelectionDisplayed=!!($imageSelectionRect&&imageSelectionCenteredRect));}if($$self.$$.dirty[3]&/*$imageSelectionRect*/536870912|$$self.$$.dirty[4]&/*isImageSelectionDisplayed, imageSelectionCenteredRect*/6144){$$invalidate(117,isImageSelectionCentered=isImageSelectionDisplayed&&rectEqual($imageSelectionRect,imageSelectionCenteredRect,function(value){return fixPrecision(value,5);}));}if($$self.$$.dirty[0]&/*locale, $imageRotation*/272|$$self.$$.dirty[2]&/*cropEnableButtonRotateLeft, cropEnableButtonRotateRight*/1610612736|$$self.$$.dirty[3]&/*cropEnableButtonFlipHorizontal, $imageFlipY, $imageFlipX, cropEnableButtonFlipVertical, shouldRenderPresetSelect, cropSelectPresetOptions, $selectedPresetIndex, isImageSelectionCentered, $imageSize, $imageCropMinSize, cropEnableButtonToggleCropLimit, $imageCropLimitToImage*/125566999){$$invalidate(0,tools=[cropEnableButtonRotateLeft&&[Button,\"rotate-left\",{label:locale.cropLabelButtonRotateLeft,labelClass:\"DokaToolbarContentWide\",icon:locale.cropIconButtonRotateLeft,onclick:function onclick(){applyRotation(-Math.PI/2);history.write();}}],cropEnableButtonRotateRight&&[Button,\"rotate-right\",{label:locale.cropLabelButtonRotateRight,labelClass:\"DokaToolbarContentWide\",icon:locale.cropIconButtonRotateRight,onclick:function onclick(){applyRotation(Math.PI/2);history.write();}}],cropEnableButtonFlipHorizontal&&[Button,\"flip-horizontal\",{label:locale.cropLabelButtonFlipHorizontal,labelClass:\"DokaToolbarContentWide\",icon:locale.cropIconButtonFlipHorizontal,onclick:function onclick(){if(isRotatedSideways($imageRotation)){set_store_value(imageFlipY,$imageFlipY=!$imageFlipY,$imageFlipY);}else{set_store_value(imageFlipX,$imageFlipX=!$imageFlipX,$imageFlipX);}history.write();}}],cropEnableButtonFlipVertical&&[Button,\"flip-vertical\",{label:locale.cropLabelButtonFlipVertical,labelClass:\"DokaToolbarContentWide\",icon:locale.cropIconButtonFlipVertical,onclick:function onclick(){if(isRotatedSideways($imageRotation)){set_store_value(imageFlipX,$imageFlipX=!$imageFlipX,$imageFlipX);}else{set_store_value(imageFlipY,$imageFlipY=!$imageFlipY,$imageFlipY);}history.write();}}],shouldRenderPresetSelect&&cropSelectPresetOptions&&[Dropdown,\"select-preset\",{icon:getSelectionPresetLabelIcon($selectedPresetIndex),label:locale.cropLabelSelectPreset,labelClass:\"DokaToolbarContentWide\",options:cropSelectPresetOptions,selectedIndex:$selectedPresetIndex,onchange:function onchange(_ref246){var value=_ref246.value;if(isArray(value)){set_store_value(imageCropAspectRatio,$imageCropAspectRatio=getAspectRatio(value[0],value[1]),$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=sizeCreateFromArray(value),$imageOutputSize);}else{set_store_value(imageCropAspectRatio,$imageCropAspectRatio=value,$imageCropAspectRatio);}if(isImageSelectionCentered){handleRecenterAction();}history.write();},optionMapper:function optionMapper(option){// if no aspect ratio found we enable the option by default\nvar disabled=false;// get aspect ratio for this option\nvar optionAspectRatio=isArray(option.value)?option.value[0]/option.value[1]:option.value;// can be undefined in which case we don't need to check anything\nif(optionAspectRatio){var maxCropSize=getMaxSizeInRect($imageSize,$imageRotation,optionAspectRatio);disabled=maxCropSize.width<$imageCropMinSize.width||maxCropSize.height<$imageCropMinSize.height;}// add icon for this option\noption.icon=getSelectionPresetOptionIcon(option.value,{bounds:14});return _objectSpread(_objectSpread({},option),{},{disabled:disabled});}}],cropEnableButtonToggleCropLimit&&[Dropdown,\"select-crop-limit\",{icon:getCropBoundaryLabelIcon($imageCropLimitToImage),label:locale.cropLabelCropBoundary,labelClass:\"DokaToolbarContentWide\",onchange:function onchange(_ref247){var value=_ref247.value;set_store_value(imageCropLimitToImage,$imageCropLimitToImage=value,$imageCropLimitToImage);history.write();},options:[[true,locale.cropLabelCropBoundaryEdge,{icon:getCropBoundaryLabelIcon(true)}],[false,locale.cropLabelCropBoundaryNone,{icon:getCropBoundaryLabelIcon(false)}]]}]]);}if($$self.$$.dirty[3]&/*$imageCropLimitToImage*/67108864){$$invalidate(9,imageZoomLevelMin=$imageCropLimitToImage?0:-1);}if($$self.$$.dirty[4]&/*$utilRect, $stageRect*/68){$$invalidate(132,imageSelectionOffset=$utilRect&&vectorCreate(-($stageRect.x-$utilRect.x),-($stageRect.y-$utilRect.y)));}if($$self.$$.dirty[4]&/*$imageSelectionRectPresentation, imageSelectionOffset*/1280){// normalized crop bounds, we use these to limit the crop interactions to the view\n$$invalidate(133,imageSelectionCenter=$imageSelectionRectPresentation&&vectorCreate(snapToPixel($imageSelectionRectPresentation.x+$imageSelectionRectPresentation.width*0.5+imageSelectionOffset.x),snapToPixel($imageSelectionRectPresentation.y+$imageSelectionRectPresentation.height*0.5+imageSelectionOffset.y)));}if($$self.$$.dirty[3]&/*$imageSelectionRectSnapshot*/268435456){$$invalidate(137,isResizingSelection=$imageSelectionRectSnapshot!=null);}if($$self.$$.dirty[4]&/*$utilRect, imageSelectionCenteredRect*/2052){$$invalidate(138,isMaxSelectionRect=$utilRect&&imageSelectionCenteredRect&&(imageSelectionCenteredRect.height===$utilRect.height||imageSelectionCenteredRect.width===$utilRect.width));}if($$self.$$.dirty[3]&/*$presentationScalar*/1073741824|$$self.$$.dirty[4]&/*isMaxSelectionRect, $imageScalar*/278528){$$invalidate(141,canZoomToCenter=!isMaxSelectionRect&&$presentationScalar<1&&$imageScalar<1);}if($$self.$$.dirty[3]&/*isImageSelectionCentered*/16777216|$$self.$$.dirty[4]&/*isImageSelectionDisplayed, isResizingSelection, canZoomToCenter*/143360){$$invalidate(11,canCenter=isImageSelectionDisplayed&&!isResizingSelection&&(!isImageSelectionCentered||canZoomToCenter));}if($$self.$$.dirty[0]&/*$imageCropRect*/128|$$self.$$.dirty[2]&/*cropEnableInfoIndicator*/33554432|$$self.$$.dirty[4]&/*isOverlayMode*/32768){$$invalidate(12,shouldRenderInfoIndicator=cropEnableInfoIndicator&&!!$imageCropRect&&!isOverlayMode);}if($$self.$$.dirty[4]&/*$imageSelectionRectPresentation, imageSelectionOffset*/1280){$$invalidate(14,imageSelectionRectOffset=$imageSelectionRectPresentation&&imageSelectionOffset&&{x:$imageSelectionRectPresentation.x+imageSelectionOffset.x,y:$imageSelectionRectPresentation.y+imageSelectionOffset.y,width:$imageSelectionRectPresentation.width,height:$imageSelectionRectPresentation.height});}if($$self.$$.dirty[0]&/*imageSelectionRectOffset*/16384|$$self.$$.dirty[2]&/*cropEnableImageSelection*/16777216|$$self.$$.dirty[4]&/*isOverlayMode*/32768){$$invalidate(13,shouldRenderImageSelection=cropEnableImageSelection&&!!imageSelectionRectOffset&&!isOverlayMode);}if($$self.$$.dirty[2]&/*cropEnableCenterImageSelection, cropAutoCenterImageSelectionTimeout*/268959744|$$self.$$.dirty[4]&/*imageSelectionCenter*/512){$$invalidate(15,shouldRenderImageSelectionRecenterButton=cropEnableCenterImageSelection&&!!imageSelectionCenter&&!cropAutoCenterImageSelectionTimeout);}if($$self.$$.dirty[0]&/*canCenter*/2048|$$self.$$.dirty[2]&/*cropAutoCenterImageSelectionTimeout*/524288|$$self.$$.dirty[3]&/*$isInteracting, cropAutoCenterImageSelectionTimeoutId*/134283264){if(canCenter&&cropAutoCenterImageSelectionTimeout&&!$isInteracting){clearTimeout(cropAutoCenterImageSelectionTimeoutId);$$invalidate(109,cropAutoCenterImageSelectionTimeoutId=setTimeout(handleRecenterAction,cropAutoCenterImageSelectionTimeout));}}if($$self.$$.dirty[3]&/*$isInteracting, cropAutoCenterImageSelectionTimeoutId*/134283264){if($isInteracting)clearTimeout(cropAutoCenterImageSelectionTimeoutId);}if($$self.$$.dirty[0]&/*canCenter*/2048){recenterOpacity.set(canCenter?1:0);}if($$self.$$.dirty[4]&/*imageSelectionCenter*/512){recenterOffset.set(imageSelectionCenter);}if($$self.$$.dirty[0]&/*$isActive*/65536){footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*$isActive*/65536|$$self.$$.dirty[4]&/*$imagePreviewModifiers*/524288){//\n// enable seeing the image outside of the crop area, and disable the vignette effect\n// \nif($isActive){set_store_value(imagePreviewModifiers,$imagePreviewModifiers[\"crop\"]={maskOpacity:0.85,maskMarkupOpacity:0.85},$imagePreviewModifiers);}else{delete $imagePreviewModifiers[\"crop\"];}}if($$self.$$.dirty[4]&/*isOverlayMode, $env*/98304){$$invalidate(144,hasPlentyVerticalSpace=isOverlayMode?false:$env.verticalSpace!==\"short\");}if($$self.$$.dirty[4]&/*hasPlentyVerticalSpace*/1048576){$$invalidate(17,shouldRenderToolbar=hasPlentyVerticalSpace);}if($$self.$$.dirty[0]&/*cropEnableZoom*/8|$$self.$$.dirty[2]&/*cropEnableZoomInput*/8388608|$$self.$$.dirty[4]&/*hasPlentyVerticalSpace*/1048576){$$invalidate(145,shouldRenderZoomInput=cropEnableZoom&&cropEnableZoomInput&&hasPlentyVerticalSpace);}if($$self.$$.dirty[2]&/*cropEnableRotationInput*/4194304|$$self.$$.dirty[4]&/*shouldRenderZoomInput*/2097152){$$invalidate(18,shouldRenderFooter=cropEnableRotationInput||shouldRenderZoomInput);}if($$self.$$.dirty[2]&/*cropEnableRotationInput*/4194304|$$self.$$.dirty[4]&/*shouldRenderZoomInput*/2097152){$$invalidate(19,shouldRenderTabs=cropEnableRotationInput&&shouldRenderZoomInput);}if($$self.$$.dirty[4]&/*shouldRenderZoomInput*/2097152){if(!shouldRenderZoomInput){$$invalidate(5,transformSelected=transformToolInitial);}}if($$self.$$.dirty[0]&/*transformSelected*/32){$$invalidate(20,tabsConfig={name:cropUniqueId,selected:transformSelected});}if($$self.$$.dirty[0]&/*locale*/16){$$invalidate(21,tabs=[{id:cropUniqueId+\"-rotation\",label:locale.cropLabelTabRotation},{id:cropUniqueId+\"-zoom\",label:locale.cropLabelTabZoom}]);}if($$self.$$.dirty[0]&/*tabs*/2097152){$$invalidate(22,panels=tabs.map(function(tab){return tab.id;}));}if($$self.$$.dirty[4]&/*$footerOffset*/4194304){$$invalidate(23,footerStyle=$footerOffset?\"transform: translateY(\".concat($footerOffset,\"px)\"):undefined);}};return[tools,isActive,cropImageSelectionCornerStyle,cropEnableZoom,locale,transformSelected,root,$imageCropRect,$imageRotation,imageZoomLevelMin,$rootRect,canCenter,shouldRenderInfoIndicator,shouldRenderImageSelection,imageSelectionRectOffset,shouldRenderImageSelectionRecenterButton,$isActive,shouldRenderToolbar,shouldRenderFooter,shouldRenderTabs,tabsConfig,tabs,panels,footerStyle,$recenterOpacity,$recenterOffset,$imageRotationRange,$imageZoomLevelRange,$imageZoomLevel,env,isInteracting,rootRect,stageRect,utilRect,elasticityMultiplier,rangeInputElasticity,presentationScalar,imagePreviewModifiers,imageFlipX,imageFlipY,imageRotation,imageRotationRange,imageOutputSize,imageSelectionRect,imageSelectionRectSnapshot,imageSelectionRectIntent,imageSelectionRectPresentation,imageCropRectIntent,imageCropRectOrigin,imageCropRect,imageCropMinSize,imageCropMaxSize,imageCropRange,imageCropAspectRatio,imageCropLimitToImage,imageSize,imageScalar,handleSelectionGrab,handleSelectionDrag,handleSelectionRelease,handleRotateStart,handleRotateMove,handleRotateEnd,handleImageDragStart,handleImageDrag,handleImageDragEnd,handleImageDragRelease,imageCropRangeAspectRatio,imageZoomLevelRange,imageZoomLevel,handleResizeStart,handleResizeMove,handleResizeEnd,handleWheel,handleRecenterAction,recenterOpacity,recenterOffset,footerOffset,selectedPresetIndex,name,stores,cropAutoCenterImageSelectionTimeout,cropEnableZoomMatchImageAspectRatio,cropEnableRotateMatchImageAspectRatio,cropEnableRotationInput,cropEnableZoomInput,cropEnableImageSelection,cropEnableInfoIndicator,cropEnableZoomTowardsWheelPosition,cropEnableLimitWheelInputToCropSelection,cropEnableCenterImageSelection,cropEnableButtonRotateLeft,cropEnableButtonRotateRight,cropEnableButtonFlipHorizontal,cropEnableButtonFlipVertical,cropSelectPresetOptions,cropEnableSelectPreset,cropEnableButtonToggleCropLimit,measure_handler_1,interactable_function,select_handler,util_root_binding,measure_handler];}var Crop=/*#__PURE__*/function(_SvelteComponent28){_inherits(Crop,_SvelteComponent28);var _super30=_createSuper(Crop);function Crop(options){var _this30;_classCallCheck(this,Crop);_this30=_super30.call(this);init(_assertThisInitialized(_this30),options,instance$r,create_fragment$r,safe_not_equal,{name:79,isActive:1,stores:80,cropImageSelectionCornerStyle:2,cropAutoCenterImageSelectionTimeout:81,cropEnableZoomMatchImageAspectRatio:82,cropEnableRotateMatchImageAspectRatio:83,cropEnableRotationInput:84,cropEnableZoom:3,cropEnableZoomInput:85,cropEnableImageSelection:86,cropEnableInfoIndicator:87,cropEnableZoomTowardsWheelPosition:88,cropEnableLimitWheelInputToCropSelection:89,cropEnableCenterImageSelection:90,cropEnableButtonRotateLeft:91,cropEnableButtonRotateRight:92,cropEnableButtonFlipHorizontal:93,cropEnableButtonFlipVertical:94,cropSelectPresetOptions:95,cropEnableSelectPreset:96,cropEnableButtonToggleCropLimit:97,locale:4,tools:0},[-1,-1,-1,-1,-1,-1]);return _this30;}_createClass(Crop,[{key:\"name\",get:function get(){return this.$$.ctx[79];}},{key:\"isActive\",get:function get(){return this.$$.ctx[1];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[80];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"cropImageSelectionCornerStyle\",get:function get(){return this.$$.ctx[2];},set:function set(cropImageSelectionCornerStyle){this.$set({cropImageSelectionCornerStyle:cropImageSelectionCornerStyle});flush();}},{key:\"cropAutoCenterImageSelectionTimeout\",get:function get(){return this.$$.ctx[81];},set:function set(cropAutoCenterImageSelectionTimeout){this.$set({cropAutoCenterImageSelectionTimeout:cropAutoCenterImageSelectionTimeout});flush();}},{key:\"cropEnableZoomMatchImageAspectRatio\",get:function get(){return this.$$.ctx[82];},set:function set(cropEnableZoomMatchImageAspectRatio){this.$set({cropEnableZoomMatchImageAspectRatio:cropEnableZoomMatchImageAspectRatio});flush();}},{key:\"cropEnableRotateMatchImageAspectRatio\",get:function get(){return this.$$.ctx[83];},set:function set(cropEnableRotateMatchImageAspectRatio){this.$set({cropEnableRotateMatchImageAspectRatio:cropEnableRotateMatchImageAspectRatio});flush();}},{key:\"cropEnableRotationInput\",get:function get(){return this.$$.ctx[84];},set:function set(cropEnableRotationInput){this.$set({cropEnableRotationInput:cropEnableRotationInput});flush();}},{key:\"cropEnableZoom\",get:function get(){return this.$$.ctx[3];},set:function set(cropEnableZoom){this.$set({cropEnableZoom:cropEnableZoom});flush();}},{key:\"cropEnableZoomInput\",get:function get(){return this.$$.ctx[85];},set:function set(cropEnableZoomInput){this.$set({cropEnableZoomInput:cropEnableZoomInput});flush();}},{key:\"cropEnableImageSelection\",get:function get(){return this.$$.ctx[86];},set:function set(cropEnableImageSelection){this.$set({cropEnableImageSelection:cropEnableImageSelection});flush();}},{key:\"cropEnableInfoIndicator\",get:function get(){return this.$$.ctx[87];},set:function set(cropEnableInfoIndicator){this.$set({cropEnableInfoIndicator:cropEnableInfoIndicator});flush();}},{key:\"cropEnableZoomTowardsWheelPosition\",get:function get(){return this.$$.ctx[88];},set:function set(cropEnableZoomTowardsWheelPosition){this.$set({cropEnableZoomTowardsWheelPosition:cropEnableZoomTowardsWheelPosition});flush();}},{key:\"cropEnableLimitWheelInputToCropSelection\",get:function get(){return this.$$.ctx[89];},set:function set(cropEnableLimitWheelInputToCropSelection){this.$set({cropEnableLimitWheelInputToCropSelection:cropEnableLimitWheelInputToCropSelection});flush();}},{key:\"cropEnableCenterImageSelection\",get:function get(){return this.$$.ctx[90];},set:function set(cropEnableCenterImageSelection){this.$set({cropEnableCenterImageSelection:cropEnableCenterImageSelection});flush();}},{key:\"cropEnableButtonRotateLeft\",get:function get(){return this.$$.ctx[91];},set:function set(cropEnableButtonRotateLeft){this.$set({cropEnableButtonRotateLeft:cropEnableButtonRotateLeft});flush();}},{key:\"cropEnableButtonRotateRight\",get:function get(){return this.$$.ctx[92];},set:function set(cropEnableButtonRotateRight){this.$set({cropEnableButtonRotateRight:cropEnableButtonRotateRight});flush();}},{key:\"cropEnableButtonFlipHorizontal\",get:function get(){return this.$$.ctx[93];},set:function set(cropEnableButtonFlipHorizontal){this.$set({cropEnableButtonFlipHorizontal:cropEnableButtonFlipHorizontal});flush();}},{key:\"cropEnableButtonFlipVertical\",get:function get(){return this.$$.ctx[94];},set:function set(cropEnableButtonFlipVertical){this.$set({cropEnableButtonFlipVertical:cropEnableButtonFlipVertical});flush();}},{key:\"cropSelectPresetOptions\",get:function get(){return this.$$.ctx[95];},set:function set(cropSelectPresetOptions){this.$set({cropSelectPresetOptions:cropSelectPresetOptions});flush();}},{key:\"cropEnableSelectPreset\",get:function get(){return this.$$.ctx[96];},set:function set(cropEnableSelectPreset){this.$set({cropEnableSelectPreset:cropEnableSelectPreset});flush();}},{key:\"cropEnableButtonToggleCropLimit\",get:function get(){return this.$$.ctx[97];},set:function set(cropEnableButtonToggleCropLimit){this.$set({cropEnableButtonToggleCropLimit:cropEnableButtonToggleCropLimit});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"tools\",get:function get(){return this.$$.ctx[0];},set:function set(tools){this.$set({tools:tools});flush();}}]);return Crop;}(SvelteComponent);// @ts-ignore\nvar index={util:['crop',Crop]};/* src/core/ui/plugins/filter/index.svelte generated by Svelte v3.29.4 */function create_option_slot$2(ctx){var div0;var div1;var measurable_action;var option=/*option*/ctx[61];var t0;var span;var t1_value=(isFunction(/*option*/ctx[61].label)?/*option*/ctx[61].label(/*locale*/ctx[2]):/*option*/ctx[61].label)+\"\";var t1;var mounted;var dispose;function measure_handler_1(){var _ctx11;for(var _len12=arguments.length,args=new Array(_len12),_key15=0;_key15<_len12;_key15++){args[_key15]=arguments[_key15];}return(/*measure_handler_1*/(_ctx11=ctx)[29].apply(_ctx11,[/*option*/ctx[61]].concat(args)));}var assign_div1=function assign_div1(){return(/*div1_binding*/ctx[30](div1,option));};var unassign_div1=function unassign_div1(){return(/*div1_binding*/ctx[30](null,option));};return{c:function c(){div0=element(\"div\");div1=element(\"div\");t0=space();span=element(\"span\");t1=text(t1_value);attr(div1,\"class\",FILTER_PREVIEW_CLASS_NAME);attr(div0,\"slot\",\"option\");attr(div0,\"class\",\"DokaFilterOption\");},m:function m(target,anchor){insert(target,div0,anchor);append(div0,div1);assign_div1();append(div0,t0);append(div0,span);append(span,t1);if(!mounted){dispose=[listen(div1,\"measure\",measure_handler_1),action_destroyer(measurable_action=measurable.call(null,div1))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(option!==/*option*/ctx[61]){unassign_div1();option=/*option*/ctx[61];assign_div1();}if(dirty[0]&/*locale*/4|dirty[1]&/*option*/1073741824&&t1_value!==(t1_value=(isFunction(/*option*/ctx[61].label)?/*option*/ctx[61].label(/*locale*/ctx[2]):/*option*/ctx[61].label)+\"\"))set_data(t1,t1_value);},d:function d(detaching){if(detaching)detach(div0);unassign_div1();mounted=false;run_all(dispose);}};}// (459:8) <Scrollable              elasticity={elasticityMultiplier * scrollElasticity}              onscroll={offset => tileScrollOffset = offset}              bind:maskFeatherStartOpacity={tileLeftOpacity}             bind:maskFeatherEndOpacity={tileRightOpacity}             bind:maskFeatherSize={tileMargin}             on:measure={e => tileScrollContainerRect = e.detail}>\nfunction create_default_slot_1$5(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[2],layout:\"row\",options:/*filterOptions*/ctx[3],selectedIndex:/*selectedFilterIndex*/ctx[10],onchange:/*handleChangeFilter*/ctx[25],$$slots:{option:[create_option_slot$2,function(_ref248){var option=_ref248.option;return{61:option};},function(_ref249){var option=_ref249.option;return[0,option?1073741824:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/4)radiogroup_changes.locale=/*locale*/ctx[2];if(dirty[0]&/*filterOptions*/8)radiogroup_changes.options=/*filterOptions*/ctx[3];if(dirty[0]&/*selectedFilterIndex*/1024)radiogroup_changes.selectedIndex=/*selectedFilterIndex*/ctx[10];if(dirty[0]&/*locale, tileElements*/20|dirty[1]&/*option*/1073741824|dirty[2]&/*$$scope*/1){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (458:4) <div slot=\"footer\" style={footerStyle} on:transitionend={handleTransitionEnd}>\nfunction create_footer_slot$1(ctx){var div;var scrollable;var updating_maskFeatherStartOpacity;var updating_maskFeatherEndOpacity;var updating_maskFeatherSize;var current;var mounted;var dispose;function scrollable_maskFeatherStartOpacity_binding(value){/*scrollable_maskFeatherStartOpacity_binding*/ctx[32].call(null,value);}function scrollable_maskFeatherEndOpacity_binding(value){/*scrollable_maskFeatherEndOpacity_binding*/ctx[33].call(null,value);}function scrollable_maskFeatherSize_binding(value){/*scrollable_maskFeatherSize_binding*/ctx[34].call(null,value);}var scrollable_props={elasticity:/*elasticityMultiplier*/ctx[14]*/*scrollElasticity*/ctx[15],onscroll:/*func*/ctx[31],$$slots:{\"default\":[create_default_slot_1$5]},$$scope:{ctx:ctx}};if(/*tileLeftOpacity*/ctx[5]!==void 0){scrollable_props.maskFeatherStartOpacity=/*tileLeftOpacity*/ctx[5];}if(/*tileRightOpacity*/ctx[6]!==void 0){scrollable_props.maskFeatherEndOpacity=/*tileRightOpacity*/ctx[6];}if(/*tileMargin*/ctx[7]!==void 0){scrollable_props.maskFeatherSize=/*tileMargin*/ctx[7];}scrollable=new Scrollable({props:scrollable_props});binding_callbacks.push(function(){return bind(scrollable,\"maskFeatherStartOpacity\",scrollable_maskFeatherStartOpacity_binding);});binding_callbacks.push(function(){return bind(scrollable,\"maskFeatherEndOpacity\",scrollable_maskFeatherEndOpacity_binding);});binding_callbacks.push(function(){return bind(scrollable,\"maskFeatherSize\",scrollable_maskFeatherSize_binding);});scrollable.$on(\"measure\",/*measure_handler_2*/ctx[35]);return{c:function c(){div=element(\"div\");create_component(scrollable.$$.fragment);attr(div,\"slot\",\"footer\");attr(div,\"style\",/*footerStyle*/ctx[11]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;if(!mounted){dispose=listen(div,\"transitionend\",/*handleTransitionEnd*/ctx[23]);mounted=true;}},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*tileScrollOffset*/256)scrollable_changes.onscroll=/*func*/ctx[31];if(dirty[0]&/*locale, filterOptions, selectedFilterIndex, tileElements*/1052|dirty[2]&/*$$scope*/1){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_maskFeatherStartOpacity&&dirty[0]&/*tileLeftOpacity*/32){updating_maskFeatherStartOpacity=true;scrollable_changes.maskFeatherStartOpacity=/*tileLeftOpacity*/ctx[5];add_flush_callback(function(){return updating_maskFeatherStartOpacity=false;});}if(!updating_maskFeatherEndOpacity&&dirty[0]&/*tileRightOpacity*/64){updating_maskFeatherEndOpacity=true;scrollable_changes.maskFeatherEndOpacity=/*tileRightOpacity*/ctx[6];add_flush_callback(function(){return updating_maskFeatherEndOpacity=false;});}if(!updating_maskFeatherSize&&dirty[0]&/*tileMargin*/128){updating_maskFeatherSize=true;scrollable_changes.maskFeatherSize=/*tileMargin*/ctx[7];add_flush_callback(function(){return updating_maskFeatherSize=false;});}scrollable.$set(scrollable_changes);if(!current||dirty[0]&/*footerStyle*/2048){attr(div,\"style\",/*footerStyle*/ctx[11]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);mounted=false;dispose();}};}function create_fragment$s(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$1]},$$scope:{ctx:ctx}}});util.$on(\"measure\",/*measure_handler*/ctx[36]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, tileScrollOffset, tileLeftOpacity, tileRightOpacity, tileMargin, tileScrollContainerRect, locale, filterOptions, selectedFilterIndex, tileElements*/4092|dirty[2]&/*$$scope*/1){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}var FILTER_PREVIEW_CLASS_NAME=\"DokaFilterPreview\";function instance$s($$self,$$props,$$invalidate){var $imageColorMatrix;var $tileRects;var $canvasSize;var $imageTransforms;var $isActive,$$unsubscribe_isActive=noop$1,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(44,$isActive=$$value);}),isActive;};var $utilRect;var $stageRect;var $imageGamma;var $isActiveFraction,$$unsubscribe_isActiveFraction=noop$1,$$subscribe_isActiveFraction=function $$subscribe_isActiveFraction(){return $$unsubscribe_isActiveFraction(),$$unsubscribe_isActiveFraction=subscribe(isActiveFraction,function($$value){return $$invalidate(48,$isActiveFraction=$$value);}),isActiveFraction;};var $footerOffset;var $imageTiles;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActiveFraction();});var name=\"filter\";var isActive=$$props.isActive;$$subscribe_isActive();var isActiveFraction=$$props.isActiveFraction;$$subscribe_isActiveFraction();var stores=$$props.stores;var locale=$$props.locale;var filterFunctions=$$props.filterFunctions;var filterOptions=$$props.filterOptions;// connect filter choice to stores\nvar _stores3=stores,history=_stores3.history,imagePreviews=_stores3.imagePreviews,stageRect=_stores3.stageRect,utilRect=_stores3.utilRect,elasticityMultiplier=_stores3.elasticityMultiplier,scrollElasticity=_stores3.scrollElasticity,imageCropRect=_stores3.imageCropRect,imageSize=_stores3.imageSize,imageRotation=_stores3.imageRotation,imageFlipX=_stores3.imageFlipX,imageFlipY=_stores3.imageFlipY,imageGamma=_stores3.imageGamma,imageColorMatrix=_stores3.imageColorMatrix;component_subscribe($$self,stageRect,function(value){return $$invalidate(46,$stageRect=value);});component_subscribe($$self,utilRect,function(value){return $$invalidate(45,$utilRect=value);});component_subscribe($$self,imageGamma,function(value){return $$invalidate(47,$imageGamma=value);});component_subscribe($$self,imageColorMatrix,function(value){return $$invalidate(40,$imageColorMatrix=value);});var getFilterIndex=function getFilterIndex(imageColorMatrix,filterOptionsFlattened){if(!imageColorMatrix||!imageColorMatrix[\"filter\"]||!filterOptionsFlattened)return 0;var filterColorMatrix=imageColorMatrix[\"filter\"];return filterOptionsFlattened.// get id and compare matrices\nfindIndex(function(_ref250){var _ref251=_slicedToArray(_ref250,1),id=_ref251[0];if(!filterFunctions[id])return false;var matrix=filterFunctions[id]();return arrayEqual(matrix,filterColorMatrix);});};var tileRects=writable({});component_subscribe($$self,tileRects,function(value){return $$invalidate(41,$tileRects=value);});var handleTileResize=function handleTileResize(item,rect){return set_store_value(tileRects,$tileRects[item.value]=rect,$tileRects);};var canvasSize=derived(tileRects,function($tileRects){if(!$tileRects[undefined])return;var tileRectFirst=$tileRects[undefined];if($canvasSize&&sizeEqual($canvasSize,tileRectFirst))return $canvasSize;return sizeClone(tileRectFirst);});component_subscribe($$self,canvasSize,function(value){return $$invalidate(42,$canvasSize=value);});var imageTransforms=derived([isActive,canvasSize,imageCropRect,imageSize,imageRotation,imageFlipX,imageFlipY],function(_ref252,set){var _ref253=_slicedToArray(_ref252,7),$isActive=_ref253[0],$canvasSize=_ref253[1],$imageCropRect=_ref253[2],$imageSize=_ref253[3],$imageRotation=_ref253[4],$imageFlipX=_ref253[5],$imageFlipY=_ref253[6];if(!$isActive||!$canvasSize||!$imageSize)return $imageTransforms;var imageRect=rectCreateFromSize($imageSize);var imageCenter=rectCenter(imageRect);// get base crop rect so we can correctly apply transforms\nvar cropRectBase=getBaseCropRect($imageSize,$imageCropRect,$imageRotation);var cropRectBaseCenter=rectCenter(cropRectBase);var imageTranslation=vectorSubtract(vectorClone(imageCenter),cropRectBaseCenter);var imageOrigin=vectorInvert(vectorClone(imageTranslation));// scalar\nvar imageScalar=Math.max($canvasSize.width/$imageCropRect.width,$canvasSize.height/$imageCropRect.height);// update preview transforms\nset({origin:imageOrigin,translation:imageTranslation,rotation:{x:$imageFlipY?Math.PI:0,y:$imageFlipX?Math.PI:0,z:$imageRotation},perspective:vectorCreateEmpty(),scale:imageScalar});});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(43,$imageTransforms=value);});var cloneImageTransforms=function cloneImageTransforms(imageTransforms){return{origin:vectorClone(imageTransforms.origin),translation:vectorClone(imageTransforms.translation),rotation:_objectSpread({},imageTransforms.rotation),perspective:vectorClone(imageTransforms.perspective),scale:imageTransforms.scale};};//\n// Footer\n//\nvar footerOffset=spring(0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(49,$footerOffset=value);});var tileCornerRadius;var tileElements={};var handleTransitionEnd=function handleTransitionEnd(e){if(e.target.className!==FILTER_PREVIEW_CLASS_NAME)return;$$invalidate(37,tileCornerRadius=Object.keys(tileElements).reduce(function(prev,curr){var element=tileElements[curr];var style=getComputedStyle(element);var corners=[\"top-left\",\"top-right\",\"bottom-left\",\"bottom-right\"].map(function(corner){return style.getPropertyValue(\"border-\".concat(corner,\"-radius\"));}).map(unitToPixels).// this better aligns WebGL rounded corner with css rounded corner\nmap(function(v){return v*1.25;});prev[curr]=corners;return prev;},{}));};var tileLeftOpacity;// set by Scrollable\nvar tileRightOpacity;// set by Scrollable\nvar tileMargin;// set by Scrollable\nvar tileScrollOffset={x:0,y:0};var tileScrollContainerRect;var tileWrapperOffset;var imageTiles=writable([]);component_subscribe($$self,imageTiles,function(value){return $$invalidate(50,$imageTiles=value);});// clones an image tile for use in canvas\nvar cloneImageTile=function cloneImageTile(tile){var clone=_objectSpread(_objectSpread({},tile),{},{offset:_objectSpread({},tile.offset),mask:_objectSpread({},tile.mask)});clone.opacity=$isActiveFraction;clone.offset.y+=$footerOffset;clone.mask.y+=$footerOffset;return clone;};var handleChangeFilter=function handleChangeFilter(_ref254){var value=_ref254.value;set_store_value(imageColorMatrix,$imageColorMatrix=_objectSpread(_objectSpread({},$imageColorMatrix),{},{\"filter\":isFunction(filterFunctions[value])?filterFunctions[value]():undefined}),$imageColorMatrix);history.write();};var measure_handler_1=function measure_handler_1(option,e){return handleTileResize(option,e.detail);};function div1_binding($$value,option){binding_callbacks[$$value?\"unshift\":\"push\"](function(){tileElements[option.value]=$$value;$$invalidate(4,tileElements);});}var func=function func(offset){return $$invalidate(8,tileScrollOffset=offset);};function scrollable_maskFeatherStartOpacity_binding(value){tileLeftOpacity=value;$$invalidate(5,tileLeftOpacity);}function scrollable_maskFeatherEndOpacity_binding(value){tileRightOpacity=value;$$invalidate(6,tileRightOpacity);}function scrollable_maskFeatherSize_binding(value){tileMargin=value;$$invalidate(7,tileMargin);}var measure_handler_2=function measure_handler_2(e){return $$invalidate(9,tileScrollContainerRect=e.detail);};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if(\"isActiveFraction\"in $$props)$$subscribe_isActiveFraction($$invalidate(1,isActiveFraction=$$props.isActiveFraction));if(\"stores\"in $$props)$$invalidate(27,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(2,locale=$$props.locale);if(\"filterFunctions\"in $$props)$$invalidate(28,filterFunctions=$$props.filterFunctions);if(\"filterOptions\"in $$props)$$invalidate(3,filterOptions=$$props.filterOptions);};var filterOptionsFlattened;var selectedFilterIndex;var footerStyle;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*filterOptions*/8){$$invalidate(39,filterOptionsFlattened=flattenOptions(filterOptions));}if($$self.$$.dirty[1]&/*$imageColorMatrix, filterOptionsFlattened*/768){$$invalidate(10,selectedFilterIndex=getFilterIndex($imageColorMatrix,filterOptionsFlattened));}if($$self.$$.dirty[1]&/*$isActive*/8192){footerOffset.set($isActive?0:20);}if($$self.$$.dirty[1]&/*$isActive, $utilRect, $stageRect*/57344){if($isActive&&$utilRect&&$stageRect){var tileTopOffset=$stageRect.y+$stageRect.height+$utilRect.y;$$invalidate(38,tileWrapperOffset={x:$stageRect.x-$utilRect.x,y:tileTopOffset});}}if($$self.$$.dirty[0]&/*tileScrollOffset, tileScrollContainerRect, tileMargin, tileLeftOpacity, tileRightOpacity, filterFunctions*/268436448|$$self.$$.dirty[1]&/*$imageTransforms, tileWrapperOffset, tileCornerRadius, filterOptionsFlattened, $tileRects, $imageColorMatrix, $imageGamma*/71616){if($imageTransforms&&tileWrapperOffset&&tileScrollOffset&&tileScrollContainerRect&&tileCornerRadius){var boundsX=tileWrapperOffset.x+tileScrollContainerRect.x;var offsetX=boundsX+tileScrollOffset.x;var offsetY=tileWrapperOffset.y;var containerLeft=tileScrollContainerRect.x+tileWrapperOffset.x;var containerRight=containerLeft+tileScrollContainerRect.width;imageTiles.set(filterOptionsFlattened.map(function(_ref255,i){var _ref256=_slicedToArray(_ref255,1),id=_ref256[0];var tileRect=$tileRects[id];// test if is outside of view\nvar tileLeft=tileScrollOffset.x+tileRect.x;var tileRight=tileLeft+tileRect.width;if(tileRight<0||tileLeft>tileScrollContainerRect.width)return false;var x=offsetX+tileRect.x;var y=offsetY+tileRect.y;var preview=cloneImageTransforms($imageTransforms);preview.offset=vectorCreate(tileRect.width*0.5+x,tileRect.height*0.5+y);var clipX=0;var clipWidth=0;preview.maskOpacity=1;preview.mask=rectCreate(x+clipX,y,tileRect.width+clipWidth,tileRect.height);preview.maskFeather=[1,0,1,0,1,containerRight,1,containerRight];if(tileLeft<tileMargin&&tileLeftOpacity<1){preview.maskFeather[0]=tileLeftOpacity;preview.maskFeather[1]=containerLeft;preview.maskFeather[2]=1;preview.maskFeather[3]=containerLeft+tileMargin;}if(tileRight>tileScrollContainerRect.width-tileMargin&&tileRightOpacity<1){preview.maskFeather[4]=tileRightOpacity;preview.maskFeather[5]=containerRight-tileMargin;preview.maskFeather[6]=1;preview.maskFeather[7]=containerRight;}preview.maskCornerRadius=tileCornerRadius[id];var colorMatrices=$imageColorMatrix&&Object.keys($imageColorMatrix).filter(function(name){return name!=\"filter\";}).map(function(name){return $imageColorMatrix[name];})||[];if(isFunction(filterFunctions[id])){colorMatrices.push(filterFunctions[id]());}preview.colorMatrix=colorMatrices.length?getColorMatrixFromColorMatrices(colorMatrices):undefined;preview.gamma=$imageGamma;return preview;}).filter(Boolean));}}if($$self.$$.dirty[1]&/*$isActive, $imageTiles, $footerOffset, $isActiveFraction*/925696){// Will update `imagePreviews` store when\n// - $isActiveFraction is updated\n// - $imageTiles is updated\n// - $footerOffset is updated\nif($isActive&&$imageTiles){// clone tiles\nimagePreviews.set($imageTiles.map(cloneImageTile));}else{imagePreviews.set([]);}}if($$self.$$.dirty[1]&/*$footerOffset*/262144){$$invalidate(11,footerStyle=$footerOffset?\"transform: translateY(\".concat($footerOffset,\"px)\"):undefined);}};return[isActive,isActiveFraction,locale,filterOptions,tileElements,tileLeftOpacity,tileRightOpacity,tileMargin,tileScrollOffset,tileScrollContainerRect,selectedFilterIndex,footerStyle,stageRect,utilRect,elasticityMultiplier,scrollElasticity,imageGamma,imageColorMatrix,tileRects,handleTileResize,canvasSize,imageTransforms,footerOffset,handleTransitionEnd,imageTiles,handleChangeFilter,name,stores,filterFunctions,measure_handler_1,div1_binding,func,scrollable_maskFeatherStartOpacity_binding,scrollable_maskFeatherEndOpacity_binding,scrollable_maskFeatherSize_binding,measure_handler_2,measure_handler];}var Filter=/*#__PURE__*/function(_SvelteComponent29){_inherits(Filter,_SvelteComponent29);var _super31=_createSuper(Filter);function Filter(options){var _this31;_classCallCheck(this,Filter);_this31=_super31.call(this);init(_assertThisInitialized(_this31),options,instance$s,create_fragment$s,safe_not_equal,{name:26,isActive:0,isActiveFraction:1,stores:27,locale:2,filterFunctions:28,filterOptions:3},[-1,-1,-1]);return _this31;}_createClass(Filter,[{key:\"name\",get:function get(){return this.$$.ctx[26];}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"isActiveFraction\",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$set({isActiveFraction:isActiveFraction});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[27];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[2];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"filterFunctions\",get:function get(){return this.$$.ctx[28];},set:function set(filterFunctions){this.$set({filterFunctions:filterFunctions});flush();}},{key:\"filterOptions\",get:function get(){return this.$$.ctx[3];},set:function set(filterOptions){this.$set({filterOptions:filterOptions});flush();}}]);return Filter;}(SvelteComponent);// @ts-ignore\nvar index$1={util:['filter',Filter]};/* src/core/ui/plugins/finetune/index.svelte generated by Svelte v3.29.4 */function create_default_slot_3$4(ctx){var span;var t_value=/*tab*/ctx[35].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*tab*/16&&t_value!==(t_value=/*tab*/ctx[35].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (152:8) <Scrollable elasticity={elasticityMultiplier * scrollElasticity} class=\"DokaControlListScroller\">\nfunction create_default_slot_2$4(ctx){var tablist;var current;var tablist_spread_levels=[{\"class\":\"DokaControlList\"},{tabs:/*tabs*/ctx[1]},/*tabsConfig*/ctx[3]];var tablist_props={$$slots:{\"default\":[create_default_slot_3$4,function(_ref257){var tab=_ref257.tab;return{35:tab};},function(_ref258){var tab=_ref258.tab;return[0,tab?16:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on(\"select\",/*select_handler*/ctx[17]);return{c:function c(){create_component(tablist.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[0]&/*tabs, tabsConfig*/10?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty[0]&/*tabs*/2&&{tabs:/*tabs*/ctx[1]},dirty[0]&/*tabsConfig*/8&&get_spread_object(/*tabsConfig*/ctx[3])]):{};if(dirty[1]&/*$$scope, tab*/48){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);}};}// (158:8) <TabPanels class=\"DokaControlPanels\" panelClass=\"DokaControlPanel\" {panels} {...tabsConfig} let:panel>\nfunction create_default_slot_1$6(ctx){var rangeinput;var current;var rangeinput_spread_levels=[/*$rangeInputConfig*/ctx[5][/*panel*/ctx[34]]];var rangeinput_props={};for(var i=0;i<rangeinput_spread_levels.length;i+=1){rangeinput_props=assign(rangeinput_props,rangeinput_spread_levels[i]);}rangeinput=new RangeInput({props:rangeinput_props});return{c:function c(){create_component(rangeinput.$$.fragment);},m:function m(target,anchor){mount_component(rangeinput,target,anchor);current=true;},p:function p(ctx,dirty){var rangeinput_changes=dirty[0]&/*$rangeInputConfig*/32|dirty[1]&/*panel*/8?get_spread_update(rangeinput_spread_levels,[get_spread_object(/*$rangeInputConfig*/ctx[5][/*panel*/ctx[34]])]):{};rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rangeinput,detaching);}};}// (150:4) <div slot=\"footer\" style={footerStyle}>\nfunction create_footer_slot$2(ctx){var div;var scrollable;var t;var tabpanels;var current;scrollable=new Scrollable({props:{elasticity:/*elasticityMultiplier*/ctx[8]*/*scrollElasticity*/ctx[7],\"class\":\"DokaControlListScroller\",$$slots:{\"default\":[create_default_slot_2$4]},$$scope:{ctx:ctx}}});var tabpanels_spread_levels=[{\"class\":\"DokaControlPanels\"},{panelClass:\"DokaControlPanel\"},{panels:/*panels*/ctx[4]},/*tabsConfig*/ctx[3]];var tabpanels_props={$$slots:{\"default\":[create_default_slot_1$6,function(_ref259){var panel=_ref259.panel;return{34:panel};},function(_ref260){var panel=_ref260.panel;return[0,panel?8:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){div=element(\"div\");create_component(scrollable.$$.fragment);t=space();create_component(tabpanels.$$.fragment);attr(div,\"slot\",\"footer\");attr(div,\"style\",/*footerStyle*/ctx[6]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);append(div,t);mount_component(tabpanels,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*tabs, tabsConfig, tabSelected*/14|dirty[1]&/*$$scope*/32){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);var tabpanels_changes=dirty[0]&/*panels, tabsConfig*/24?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty[0]&/*panels*/16&&{panels:/*panels*/ctx[4]},dirty[0]&/*tabsConfig*/8&&get_spread_object(/*tabsConfig*/ctx[3])]):{};if(dirty[0]&/*$rangeInputConfig*/32|dirty[1]&/*$$scope, panel*/40){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);if(!current||dirty[0]&/*footerStyle*/64){attr(div,\"style\",/*footerStyle*/ctx[6]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);destroy_component(tabpanels);}};}function create_fragment$t(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$2]},$$scope:{ctx:ctx}}});util.$on(\"measure\",/*measure_handler*/ctx[18]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, panels, tabsConfig, $rangeInputConfig, tabs, tabSelected*/126|dirty[1]&/*$$scope*/32){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$t($$self,$$props,$$invalidate){var $rangeInputConfig;var $panelValues;var $isActive,$$unsubscribe_isActive=noop$1,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(21,$isActive=$$value);}),isActive;};var $footerOffset;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name=\"finetune\";var stores=$$props.stores;var isActive=$$props.isActive;$$subscribe_isActive();var _$$props$locale6=$$props.locale,locale=_$$props$locale6===void 0?{}:_$$props$locale6;var finetuneControlConfiguration=$$props.finetuneControlConfiguration;var finetuneOptions=$$props.finetuneOptions;var _stores4=stores,history=_stores4.history,scrollElasticity=_stores4.scrollElasticity,elasticityMultiplier=_stores4.elasticityMultiplier,rangeInputElasticity=_stores4.rangeInputElasticity,imageColorMatrix=_stores4.imageColorMatrix,imageConvolutionMatrix=_stores4.imageConvolutionMatrix,imageGamma=_stores4.imageGamma,imageVignette=_stores4.imageVignette,imageNoise=_stores4.imageNoise;var imageEffectStores={imageColorMatrix:imageColorMatrix,imageConvolutionMatrix:imageConvolutionMatrix,imageGamma:imageGamma,imageVignette:imageVignette,imageNoise:imageNoise};//\n// Tabs\n//\nvar uid=\"doka-finetune-\".concat(getUniqueId());//\n// Range inputs\n//\nvar panelValues=writable({});component_subscribe($$self,panelValues,function(value){return $$invalidate(20,$panelValues=value);});var rangeInputConfig=writable({});component_subscribe($$self,rangeInputConfig,function(value){return $$invalidate(5,$rangeInputConfig=value);});var updateRangeInputState=function updateRangeInputState(){set_store_value(rangeInputConfig,$rangeInputConfig=Object.keys($panelValues).reduce(function(config,id){var _finetuneControlConfi=finetuneControlConfiguration[id],base=_finetuneControlConfi.base,min=_finetuneControlConfi.min,max=_finetuneControlConfi.max,getLabel=_finetuneControlConfi.getLabel,getStore=_finetuneControlConfi.getStore,_finetuneControlConfi2=_finetuneControlConfi.setValue,setValue=_finetuneControlConfi2===void 0?function(store,v){return store.set(v);}:_finetuneControlConfi2;var store=getStore(imageEffectStores);var value=$panelValues[id]!=null?$panelValues[id]:base;config[id]={base:base,min:min,max:max,value:value,valueLabel:getLabel?getLabel(value,min,max,max-min):Math.round(100*value),oninputmove:function oninputmove(v){setValue(store,v);},oninputend:function oninputend(v){setValue(store,v);history.write();},elasticity:elasticityMultiplier*rangeInputElasticity,labelReset:locale.labelReset};return config;},{}),$rangeInputConfig);};// need to unsubscribe when redrawing vie\nvar unsubs=[];var subscribePanelStores=function subscribePanelStores(config){if(unsubs)unsubs.forEach(function(unsub){return unsub();});unsubs=panels.map(function(id){var _config$id=config[id],getStore=_config$id.getStore,_config$id$getValue=_config$id.getValue,getValue=_config$id$getValue===void 0?passthrough:_config$id$getValue;var store=getStore(imageEffectStores);return store.subscribe(function(value){var currentValue=value!=null?getValue(value):value;set_store_value(panelValues,$panelValues=_objectSpread(_objectSpread({},$panelValues),{},_defineProperty({},id,currentValue)),$panelValues);});});};//\n// Footer\n//\nvar footerOffset=spring(0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(22,$footerOffset=value);});var select_handler=function select_handler(_ref261){var detail=_ref261.detail;return $$invalidate(2,tabSelected=detail);};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"stores\"in $$props)$$invalidate(13,stores=$$props.stores);if(\"isActive\"in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if(\"locale\"in $$props)$$invalidate(14,locale=$$props.locale);if(\"finetuneControlConfiguration\"in $$props)$$invalidate(15,finetuneControlConfiguration=$$props.finetuneControlConfiguration);if(\"finetuneOptions\"in $$props)$$invalidate(16,finetuneOptions=$$props.finetuneOptions);};var tabs;var tabSelected;var tabsConfig;var panels;var footerStyle;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*finetuneOptions, locale*/81920){$$invalidate(1,tabs=finetuneOptions?finetuneOptions.map(function(_ref262){var _ref263=_slicedToArray(_ref262,2),id=_ref263[0],label=_ref263[1];return{id:id,label:isFunction(label)?label(locale):label};}):[]);}if($$self.$$.dirty[0]&/*tabs*/2){$$invalidate(2,tabSelected=tabs.length&&tabs[0].id);}if($$self.$$.dirty[0]&/*tabSelected*/4){$$invalidate(3,tabsConfig={name:uid,selected:tabSelected});}if($$self.$$.dirty[0]&/*tabs*/2){$$invalidate(4,panels=tabs.map(function(tab){return tab.id;}));}if($$self.$$.dirty[0]&/*finetuneControlConfiguration*/32768){finetuneControlConfiguration&&subscribePanelStores(finetuneControlConfiguration);}if($$self.$$.dirty[0]&/*finetuneControlConfiguration, $panelValues*/1081344){finetuneControlConfiguration&&$panelValues&&updateRangeInputState();}if($$self.$$.dirty[0]&/*$isActive*/2097152){footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*$footerOffset*/4194304){$$invalidate(6,footerStyle=$footerOffset?\"transform: translateY(\".concat($footerOffset,\"px)\"):undefined);}};return[isActive,tabs,tabSelected,tabsConfig,panels,$rangeInputConfig,footerStyle,scrollElasticity,elasticityMultiplier,panelValues,rangeInputConfig,footerOffset,name,stores,locale,finetuneControlConfiguration,finetuneOptions,select_handler,measure_handler];}var Finetune=/*#__PURE__*/function(_SvelteComponent30){_inherits(Finetune,_SvelteComponent30);var _super32=_createSuper(Finetune);function Finetune(options){var _this32;_classCallCheck(this,Finetune);_this32=_super32.call(this);init(_assertThisInitialized(_this32),options,instance$t,create_fragment$t,safe_not_equal,{name:12,stores:13,isActive:0,locale:14,finetuneControlConfiguration:15,finetuneOptions:16},[-1,-1]);return _this32;}_createClass(Finetune,[{key:\"name\",get:function get(){return this.$$.ctx[12];}},{key:\"stores\",get:function get(){return this.$$.ctx[13];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[14];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"finetuneControlConfiguration\",get:function get(){return this.$$.ctx[15];},set:function set(finetuneControlConfiguration){this.$set({finetuneControlConfiguration:finetuneControlConfiguration});flush();}},{key:\"finetuneOptions\",get:function get(){return this.$$.ctx[16];},set:function set(finetuneOptions){this.$set({finetuneOptions:finetuneOptions});flush();}}]);return Finetune;}(SvelteComponent);// @ts-ignore\nvar index$2={util:['finetune',Finetune]};/* src/core/ui/components/ShapeManipulator.svelte generated by Svelte v3.29.4 */function get_each_context$5(ctx,list,i){var child_ctx=ctx.slice();child_ctx[47]=list[i].key;child_ctx[48]=list[i].index;child_ctx[49]=list[i].translate;child_ctx[50]=list[i].scale;child_ctx[14]=list[i].rotate;child_ctx[51]=list[i].dir;child_ctx[52]=list[i].center;child_ctx[53]=list[i].type;return child_ctx;}// (304:0) {#if type ==='edge' && resizeAxis !== 'both'}\nfunction create_if_block_1$8(ctx){var div;var div_style_value;return{c:function c(){div=element(\"div\");attr(div,\"class\",\"DokaShapeManipulator\");attr(div,\"data-control\",\"point\");attr(div,\"style\",div_style_value=\"pointer-events:none;transform: translate3d(\".concat(/*center*/ctx[52].x,\"px, \").concat(/*center*/ctx[52].y,\"px, 0) scale(\").concat(/*$selectionScale*/ctx[5],\", \").concat(/*$selectionScale*/ctx[5],\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]));},m:function m(target,anchor){insert(target,div,anchor);},p:function p(ctx,dirty){if(dirty[0]&/*resizeControls, $selectionScale, $selectionOpacity*/104&&div_style_value!==(div_style_value=\"pointer-events:none;transform: translate3d(\".concat(/*center*/ctx[52].x,\"px, \").concat(/*center*/ctx[52].y,\"px, 0) scale(\").concat(/*$selectionScale*/ctx[5],\", \").concat(/*$selectionScale*/ctx[5],\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]))){attr(div,\"style\",div_style_value);}},d:function d(detaching){if(detaching)detach(div);}};}// (289:0) {#each resizeControls as { key, index, translate, scale, rotate, dir, center, type }\nfunction create_each_block$5(key_1,ctx){var div;var div_tabindex_value;var div_data_control_value;var div_style_value;var nudgeable_action;var interactable_action;var t;var if_block_anchor;var mounted;var dispose;function nudge_handler(){var _ctx12;for(var _len13=arguments.length,args=new Array(_len13),_key16=0;_key16<_len13;_key16++){args[_key16]=arguments[_key16];}return(/*nudge_handler*/(_ctx12=ctx)[18].apply(_ctx12,[/*index*/ctx[48]].concat(args)));}var if_block=/*type*/ctx[53]===\"edge\"&&/*resizeAxis*/ctx[2]!==\"both\"&&create_if_block_1$8(ctx);return{key:key_1,first:null,c:function c(){div=element(\"div\");t=space();if(if_block)if_block.c();if_block_anchor=empty();attr(div,\"role\",\"button\");attr(div,\"tabindex\",div_tabindex_value=/*type*/ctx[53]===\"edge\"?-1:0);attr(div,\"class\",\"DokaShapeManipulator\");attr(div,\"data-control\",div_data_control_value=/*type*/ctx[53]);attr(div,\"style\",div_style_value=\"cursor: \".concat(/*dir*/ctx[51]?/*dir*/ctx[51]+\"-resize\":\"move\",\"; transform: translate3d(\").concat(/*translate*/ctx[49].x,\"px, \").concat(/*translate*/ctx[49].y,\"px, 0) rotate(\").concat(/*rotate*/ctx[14],\"rad) scale(\").concat(/*type*/ctx[53]===\"point\"?/*$selectionScale*/ctx[5]:/*scale*/ctx[50].x,\", \").concat(/*type*/ctx[53]===\"point\"?/*$selectionScale*/ctx[5]:/*scale*/ctx[50].y,\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]));this.first=div;},m:function m(target,anchor){insert(target,div,anchor);insert(target,t,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);if(!mounted){dispose=[listen(div,\"keydown\",/*handleKeyDown*/ctx[7]),listen(div,\"keyup\",/*handleKeyUp*/ctx[8]),listen(div,\"nudge\",nudge_handler),action_destroyer(nudgeable_action=nudgeable.call(null,div)),listen(div,\"interactionstart\",function(){if(is_function(/*resize*/ctx[11](\"start\",/*index*/ctx[48])))/*resize*/ctx[11](\"start\",/*index*/ctx[48]).apply(this,arguments);}),listen(div,\"interactionupdate\",function(){if(is_function(/*resize*/ctx[11](\"move\",/*index*/ctx[48])))/*resize*/ctx[11](\"move\",/*index*/ctx[48]).apply(this,arguments);}),listen(div,\"interactionend\",function(){if(is_function(/*resize*/ctx[11](\"end\",/*index*/ctx[48])))/*resize*/ctx[11](\"end\",/*index*/ctx[48]).apply(this,arguments);}),action_destroyer(interactable_action=interactable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty[0]&/*resizeControls*/8&&div_tabindex_value!==(div_tabindex_value=/*type*/ctx[53]===\"edge\"?-1:0)){attr(div,\"tabindex\",div_tabindex_value);}if(dirty[0]&/*resizeControls*/8&&div_data_control_value!==(div_data_control_value=/*type*/ctx[53])){attr(div,\"data-control\",div_data_control_value);}if(dirty[0]&/*resizeControls, $selectionScale, $selectionOpacity*/104&&div_style_value!==(div_style_value=\"cursor: \".concat(/*dir*/ctx[51]?/*dir*/ctx[51]+\"-resize\":\"move\",\"; transform: translate3d(\").concat(/*translate*/ctx[49].x,\"px, \").concat(/*translate*/ctx[49].y,\"px, 0) rotate(\").concat(/*rotate*/ctx[14],\"rad) scale(\").concat(/*type*/ctx[53]===\"point\"?/*$selectionScale*/ctx[5]:/*scale*/ctx[50].x,\", \").concat(/*type*/ctx[53]===\"point\"?/*$selectionScale*/ctx[5]:/*scale*/ctx[50].y,\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]))){attr(div,\"style\",div_style_value);}if(/*type*/ctx[53]===\"edge\"&&/*resizeAxis*/ctx[2]!==\"both\"){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_1$8(ctx);if_block.c();if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){if_block.d(1);if_block=null;}},d:function d(detaching){if(detaching)detach(div);if(detaching)detach(t);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);mounted=false;run_all(dispose);}};}// (308:0) {#if enableRotating && rotationControlActive}\nfunction create_if_block$7(ctx){var div;var div_style_value;var nudgeable_action;var interactable_action;var mounted;var dispose;return{c:function c(){div=element(\"div\");attr(div,\"role\",\"button\");attr(div,\"tabindex\",\"0\");attr(div,\"class\",\"DokaShapeManipulator\");attr(div,\"data-control\",\"rotate\");attr(div,\"style\",div_style_value=\"transform: translate3d(\".concat(/*rotatorPoint*/ctx[0].x,\"px, \").concat(/*rotatorPoint*/ctx[0].y,\"px, 0) scale(\").concat(/*$selectionScale*/ctx[5],\", \").concat(/*$selectionScale*/ctx[5],\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]));},m:function m(target,anchor){insert(target,div,anchor);if(!mounted){dispose=[listen(div,\"keydown\",/*handleKeyDown*/ctx[7]),listen(div,\"keyup\",/*handleKeyUp*/ctx[8]),listen(div,\"nudge\",/*handleRotateNudge*/ctx[13]),action_destroyer(nudgeable_action=nudgeable.call(null,div)),listen(div,\"interactionstart\",/*rotate*/ctx[14](\"start\")),listen(div,\"interactionupdate\",/*rotate*/ctx[14](\"move\")),listen(div,\"interactionend\",/*rotate*/ctx[14](\"end\")),action_destroyer(interactable_action=interactable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*rotatorPoint, $selectionScale, $selectionOpacity*/97&&div_style_value!==(div_style_value=\"transform: translate3d(\".concat(/*rotatorPoint*/ctx[0].x,\"px, \").concat(/*rotatorPoint*/ctx[0].y,\"px, 0) scale(\").concat(/*$selectionScale*/ctx[5],\", \").concat(/*$selectionScale*/ctx[5],\"); opacity: \").concat(/*$selectionOpacity*/ctx[6]))){attr(div,\"style\",div_style_value);}},d:function d(detaching){if(detaching)detach(div);mounted=false;run_all(dispose);}};}function create_fragment$u(ctx){var each_blocks=[];var each_1_lookup=new Map();var t;var if_block_anchor;var each_value=/*resizeControls*/ctx[3];var get_key=function get_key(ctx){return(/*key*/ctx[47]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$5(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$5(key,child_ctx));}var if_block=/*enableRotating*/ctx[1]&&/*rotationControlActive*/ctx[4]&&create_if_block$7(ctx);return{c:function c(){for(var _i31=0;_i31<each_blocks.length;_i31+=1){each_blocks[_i31].c();}t=space();if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){for(var _i32=0;_i32<each_blocks.length;_i32+=1){each_blocks[_i32].m(target,anchor);}insert(target,t,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);},p:function p(ctx,dirty){if(dirty[0]&/*resizeControls, $selectionScale, $selectionOpacity, resizeAxis, handleKeyDown, handleKeyUp, handleResizeNudge, resize*/6636){var _each_value6=/*resizeControls*/ctx[3];each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value6,each_1_lookup,t.parentNode,destroy_block,create_each_block$5,t,get_each_context$5);}if(/*enableRotating*/ctx[1]&&/*rotationControlActive*/ctx[4]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block$7(ctx);if_block.c();if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){if_block.d(1);if_block=null;}},i:noop$1,o:noop$1,d:function d(detaching){for(var _i33=0;_i33<each_blocks.length;_i33+=1){each_blocks[_i33].d(detaching);}if(detaching)detach(t);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}function instance$u($$self,$$props,$$invalidate){var $selectionScale;var $selectionOpacity;var dispatch=createEventDispatcher();// which cursor to render\nvar EIGTH_PI=QUART_PI*0.5;var N=HALF_PI;var N0=N-EIGTH_PI;var N1=N+EIGTH_PI;var S=-HALF_PI;var S0=S-EIGTH_PI;var S1=S+EIGTH_PI;var E=PI;var E0=E-EIGTH_PI;var E1=-PI+EIGTH_PI;var W0=EIGTH_PI;var W1=-EIGTH_PI;var NW=N-QUART_PI;var NW0=NW-EIGTH_PI;var NW1=NW+EIGTH_PI;var NE=PI-QUART_PI;var NE0=NE-EIGTH_PI;var NE1=NE+EIGTH_PI;var SE=S-QUART_PI;var SE0=SE+EIGTH_PI;var SE1=SE-EIGTH_PI;var SW=S+QUART_PI;var SW0=SW+EIGTH_PI;var SW1=SW-EIGTH_PI;var _$$props$points=$$props.points,points=_$$props$points===void 0?[]:_$$props$points;var _$$props$rotatorPoint=$$props.rotatorPoint,rotatorPoint=_$$props$rotatorPoint===void 0?undefined:_$$props$rotatorPoint;var _$$props$visible4=$$props.visible,visible=_$$props$visible4===void 0?false:_$$props$visible4;var _$$props$enableResizi=$$props.enableResizing,enableResizing=_$$props$enableResizi===void 0?true:_$$props$enableResizi;var _$$props$enableRotati=$$props.enableRotating,enableRotating=_$$props$enableRotati===void 0?true:_$$props$enableRotati;// // internal\nvar shiftKey=false;var handleKeyDown=function handleKeyDown(e){return shiftKey=e.shiftKey;};var handleKeyUp=function handleKeyUp(e){return shiftKey=false;};// state\nvar selectionScale=spring(0.5,{precision:0.0001,stiffness:0.3,damping:0.7});component_subscribe($$self,selectionScale,function(value){return $$invalidate(5,$selectionScale=value);});var selectionOpacity=spring(0,{precision:0.001});component_subscribe($$self,selectionOpacity,function(value){return $$invalidate(6,$selectionOpacity=value);});var rotate=function rotate(type){return function(_ref264){var detail=_ref264.detail;// always make sure we have a translation to work with\nvar translation=detail&&detail.translation?detail.translation:vectorCreate(0,0);dispatch(\"rotate\".concat(type),{translation:translation,shiftKey:shiftKey});};};var resize=function resize(type,indexes){return function(_ref265){var detail=_ref265.detail;// always make sure we have a translation to work with\nvar translation=detail&&detail.translation?detail.translation:vectorCreate(0,0);// done transforming the points\ndispatch(\"resize\".concat(type),{indexes:indexes,translation:translation,shiftKey:shiftKey});};};// https://en.wikipedia.org/wiki/Radian#/media/File:Degree-Radian_Conversion.svg\nvar getDirectionByAngle=function getDirectionByAngle(angle){var dir=\"\";var isNorth=angle<=N1&&angle>=N0;var isSouth=angle>=S0&&angle<=S1;var isEast=angle<=E1||angle>=E0;var isWest=angle>=W1&&angle<=W0;var isNorthEast=angle>=NE0&&angle<=NE1;var isNorthWest=angle>=NW0&&angle<=NW1;var isSouthEast=angle<=SE0&&angle>=SE1;var isSouthWest=angle<=SW0&&angle>=SW1;if(isNorth||isSouth)dir=\"ns\";if(isEast||isWest)dir=\"ew\";if(isNorthEast||isSouthWest)dir=\"nesw\";if(isNorthWest||isSouthEast)dir=\"nwse\";return dir;};// 2 points -> [corner, corner]\n// 3 points => [corner, edge, corner, edge, corner, edge],\n// 4 points => [corner, edge, corner, edge, corner, edge, corner, edge]\nvar mapPointsToControls=function mapPointsToControls(points,axis){var i=0;var center=vectorCenter(points);var out=[];var l=points.length;var isLine=l===2;var isAxisLimited=axis!==\"both\";for(;i<l;i++){var p0=points[i-1]||points[points.length-1];var p1=points[i];var p2=points[i+1]||points[0];var dir=Math.atan2(p2.y-p1.y,p2.x-p1.x);// create corner, only allowed if axis equal 'both'\nif(!isAxisLimited){var a=vectorNormalize(vectorCreate(p0.x-p1.x,p0.y-p1.y));var b=vectorNormalize(vectorCreate(p2.x-p1.x,p2.y-p1.y));var cornerVector=vectorCreate(a.x+b.x,a.y+b.y);out.push({index:[i],key:\"point-\".concat(i),type:\"point\",scale:{x:1,y:1},translate:{x:p1.x,y:p1.y},angle:undefined,rotate:isLine?0:dir,center:p1,dir:isLine?undefined:getDirectionByAngle(Math.atan2(cornerVector.y,cornerVector.x))});}// if only two points, skip edge\nif(isLine)continue;var mid=vectorCreate(p1.x+(p2.x-p1.x)*0.5,p1.y+(p2.y-p1.y)*0.5);// only allow horizontal controls\nif(axis===\"horizontal\"&&i%2===0)continue;// only allow vertical controls\nif(axis===\"vertical\"&&i%2!==0)continue;// create edge\nout.push({index:[i,i+1===l?0:i+1],key:\"edge-\".concat(i),type:\"edge\",scale:{x:vectorDistance(p1,p2),y:1},translate:{x:p1.x,y:p1.y},angle:dir,rotate:dir,center:mid,dir:getDirectionByAngle(Math.atan2(center.y-mid.y,center.x-mid.x))});}return out;};var handleResizeNudge=function handleResizeNudge(indexes,translation){dispatch(\"resizestart\",{indexes:indexes,translation:vectorCreateEmpty()});dispatch(\"resizemove\",{indexes:indexes,translation:translation});dispatch(\"resizeend\",{indexes:indexes,translation:vectorCreateEmpty()});};var handleRotateNudge=function handleRotateNudge(_ref266){var detail=_ref266.detail;dispatch(\"rotatestart\",{translation:vectorCreateEmpty()});dispatch(\"rotatemove\",{translation:detail});dispatch(\"rotateend\",{translation:vectorCreateEmpty()});};var nudge_handler=function nudge_handler(index,_ref267){var detail=_ref267.detail;return handleResizeNudge(index,detail);};$$self.$$set=function($$props){if(\"points\"in $$props)$$invalidate(15,points=$$props.points);if(\"rotatorPoint\"in $$props)$$invalidate(0,rotatorPoint=$$props.rotatorPoint);if(\"visible\"in $$props)$$invalidate(16,visible=$$props.visible);if(\"enableResizing\"in $$props)$$invalidate(17,enableResizing=$$props.enableResizing);if(\"enableRotating\"in $$props)$$invalidate(1,enableRotating=$$props.enableRotating);};var resizeAxis;var resizeControls;var rotationControlActive;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*visible*/65536){selectionScale.set(visible?1:0.5);}if($$self.$$.dirty[0]&/*visible*/65536){selectionOpacity.set(visible?1:0);}if($$self.$$.dirty[0]&/*enableResizing*/131072){$$invalidate(2,resizeAxis=!enableResizing?false:isString(enableResizing)?enableResizing:\"both\");}if($$self.$$.dirty[0]&/*resizeAxis, points*/32772){$$invalidate(3,resizeControls=resizeAxis&&mapPointsToControls(points,resizeAxis)||[]);}if($$self.$$.dirty[0]&/*points*/32768){$$invalidate(4,rotationControlActive=points.length>2);}};return[rotatorPoint,enableRotating,resizeAxis,resizeControls,rotationControlActive,$selectionScale,$selectionOpacity,handleKeyDown,handleKeyUp,selectionScale,selectionOpacity,resize,handleResizeNudge,handleRotateNudge,rotate,points,visible,enableResizing,nudge_handler];}var ShapeManipulator=/*#__PURE__*/function(_SvelteComponent31){_inherits(ShapeManipulator,_SvelteComponent31);var _super33=_createSuper(ShapeManipulator);function ShapeManipulator(options){var _this33;_classCallCheck(this,ShapeManipulator);_this33=_super33.call(this);init(_assertThisInitialized(_this33),options,instance$u,create_fragment$u,safe_not_equal,{points:15,rotatorPoint:0,visible:16,enableResizing:17,enableRotating:1},[-1,-1]);return _this33;}return ShapeManipulator;}(SvelteComponent);var getEventPositionInEditor=function getEventPositionInEditor(e,viewOffset){var positionInViewport=getEventPositionInViewport(e);return vectorSubtract(positionInViewport,viewOffset);};var cursorMoveToEnd=function cursorMoveToEnd(field){return field.selectionStart=field.selectionEnd=field.value.length;};var result$b=null;var supportsVisualViewport=function supportsVisualViewport(){if(result$b===null){result$b=isBrowser()&&'visualViewport'in window;}return result$b;};var createSoftKeyboardObserver=function createSoftKeyboardObserver(cb){if(!supportsVisualViewport())return false;var heightNormal=visualViewport.height;var testState=function testState(){cb(visualViewport.height<heightNormal?'visible':'hidden');};visualViewport.addEventListener('resize',testState);return function(){return visualViewport.removeEventListener('resize',testState);};};/* src/core/ui/components/InputForm.svelte generated by Svelte v3.29.4 */function create_fragment$v(ctx){var div2;var div1;var button0;var t0;var div0;var t1;var button1;var measurable_action;var current;var mounted;var dispose;button0=new Button({props:{onclick:/*oncancel*/ctx[1],label:/*labelCancel*/ctx[5],icon:/*iconCancel*/ctx[7],hideLabel:!/*labelCancelShow*/ctx[6]}});var default_slot_template=/*#slots*/ctx[17][\"default\"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[16],null);button1=new Button({props:{onclick:/*onconfirm*/ctx[0],label:/*labelConfirm*/ctx[2],icon:/*iconConfirm*/ctx[4],hideLabel:!/*labelConfirmShow*/ctx[3],\"class\":\"DokaInputFormButtonConfirm\"}});return{c:function c(){div2=element(\"div\");div1=element(\"div\");create_component(button0.$$.fragment);t0=space();div0=element(\"div\");if(default_slot)default_slot.c();t1=space();create_component(button1.$$.fragment);attr(div0,\"class\",\"DokaInputFormFields\");attr(div1,\"class\",\"DokaInputFormInner\");attr(div2,\"class\",\"DokaInputForm\");attr(div2,\"style\",/*style*/ctx[9]);},m:function m(target,anchor){insert(target,div2,anchor);append(div2,div1);mount_component(button0,div1,null);append(div1,t0);append(div1,div0);if(default_slot){default_slot.m(div0,null);}append(div1,t1);mount_component(button1,div1,null);/*div2_binding*/ctx[18](div2);current=true;if(!mounted){dispose=[listen(div2,\"focusin\",/*handleFocusIn*/ctx[10]),listen(div2,\"focusout\",/*handleFocusOut*/ctx[11]),listen(div2,\"measure\",/*handleMeasure*/ctx[12]),action_destroyer(measurable_action=measurable.call(null,div2))];mounted=true;}},p:function p(ctx,dirty){var button0_changes={};if(dirty[0]&/*oncancel*/2)button0_changes.onclick=/*oncancel*/ctx[1];if(dirty[0]&/*labelCancel*/32)button0_changes.label=/*labelCancel*/ctx[5];if(dirty[0]&/*iconCancel*/128)button0_changes.icon=/*iconCancel*/ctx[7];if(dirty[0]&/*labelCancelShow*/64)button0_changes.hideLabel=!/*labelCancelShow*/ctx[6];button0.$set(button0_changes);if(default_slot){if(default_slot.p&&dirty[0]&/*$$scope*/65536){update_slot(default_slot,default_slot_template,ctx,/*$$scope*/ctx[16],dirty,null,null);}}var button1_changes={};if(dirty[0]&/*onconfirm*/1)button1_changes.onclick=/*onconfirm*/ctx[0];if(dirty[0]&/*labelConfirm*/4)button1_changes.label=/*labelConfirm*/ctx[2];if(dirty[0]&/*iconConfirm*/16)button1_changes.icon=/*iconConfirm*/ctx[4];if(dirty[0]&/*labelConfirmShow*/8)button1_changes.hideLabel=!/*labelConfirmShow*/ctx[3];button1.$set(button1_changes);if(!current||dirty[0]&/*style*/512){attr(div2,\"style\",/*style*/ctx[9]);}},i:function i(local){if(current)return;transition_in(button0.$$.fragment,local);transition_in(default_slot,local);transition_in(button1.$$.fragment,local);current=true;},o:function o(local){transition_out(button0.$$.fragment,local);transition_out(default_slot,local);transition_out(button1.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div2);destroy_component(button0);if(default_slot)default_slot.d(detaching);destroy_component(button1);/*div2_binding*/ctx[18](null);mounted=false;run_all(dispose);}};}var panelDelay=200;function instance$v($$self,$$props,$$invalidate){var _$$props$$$slots12=$$props.$$slots,slots=_$$props$$$slots12===void 0?{}:_$$props$$$slots12,$$scope=$$props.$$scope;var onconfirm=$$props.onconfirm;var oncancel=$$props.oncancel;var _$$props$autoFocus=$$props.autoFocus,autoFocus=_$$props$autoFocus===void 0?true:_$$props$autoFocus;var _$$props$autoPosition=$$props.autoPositionCursor,autoPositionCursor=_$$props$autoPosition===void 0?true:_$$props$autoPosition;var labelConfirm=$$props.labelConfirm;var _$$props$labelConfirm=$$props.labelConfirmShow,labelConfirmShow=_$$props$labelConfirm===void 0?true:_$$props$labelConfirm;var iconConfirm=$$props.iconConfirm;var labelCancel=$$props.labelCancel;var _$$props$labelCancelS=$$props.labelCancelShow,labelCancelShow=_$$props$labelCancelS===void 0?false:_$$props$labelCancelS;var iconCancel=$$props.iconCancel;var _$$props$panelOffset=$$props.panelOffset,panelOffset=_$$props$panelOffset===void 0?vectorCreateEmpty():_$$props$panelOffset;var panelVisible=false;var panelHeight=undefined;var panelRevealTimeout=undefined;var panelPosition=\"\";var panelOpacity=0;var root;var preventTextAreaScrollingOnIOS=function preventTextAreaScrollingOnIOS(element){// preventsDefault on textarea events when can no longer scroll up or down in textarea\nvar lastScreenY;var handleTouchStart=function handleTouchStart(e){return lastScreenY=e.touches[0].screenY;};var handleTouchMove=function handleTouchMove(e){var currentScreenY=e.touches[0].screenY;var target=e.target;if(/textarea/i.test(target.nodeName)){// moving down\nif(currentScreenY>lastScreenY){if(target.scrollTop==0){e.preventDefault();}}else// moving up\nif(currentScreenY<lastScreenY){if(target.scrollTop+target.offsetHeight==target.scrollHeight){e.preventDefault();}}else{e.preventDefault();}lastScreenY=currentScreenY;}else{e.preventDefault();}};element.addEventListener(\"touchstart\",handleTouchStart);element.addEventListener(\"touchmove\",handleTouchMove);return function(){element.removeEventListener(\"touchstart\",handleTouchStart);element.removeEventListener(\"touchmove\",handleTouchMove);};};var focus=function focus(){var field=root.querySelector(\"input, textarea\");field.focus();};var show=function show(){panelVisible=true;// browser does not support keyboard listener, place modal at top of view\nif(!unsubSoftKeyboardListener&&(isIOS()||isAndroid())){$$invalidate(22,panelPosition=\"top:1em;bottom:auto;\");}// prevent interacting with the root element\nif(isIOS())preventTextAreaScrollingOnIOS(root);// reveal\n$$invalidate(23,panelOpacity=1);};var hide=function hide(){panelVisible=false;$$invalidate(23,panelOpacity=0);};var handleSoftKeyboard=function handleSoftKeyboard(keyboardState){if(!shouldStickToKeyboard)return;// no need to continue, already hidden\nif(keyboardState===\"hidden\"&&!panelVisible){focus();return;}// gonna update position here\nclearTimeout(panelRevealTimeout);panelRevealTimeout=undefined;// position\n$$invalidate(22,panelPosition=\"top:\".concat(visualViewport.height-panelHeight-panelOffset.y,\"px\"));// if a soft keyboard is detected, turn into modal mode\nif(keyboardState===\"visible\"){// stick to keyboard\n$$invalidate(8,root.dataset.layout=\"stick\",root);// need to refocus\nfocus();// place above keyboard\nshow();}else// keyboard is hidden\n{hide();}};var focusDateTime;var handleFocusIn=function handleFocusIn(e){// we need to remember focus time so we can detect unrealistic blur event caused by soft keyboard shenanigans\nfocusDateTime=Date.now();// move cursor\nif(autoPositionCursor)cursorMoveToEnd(e.target);// wait a couple milliseconds\npanelRevealTimeout=setTimeout(show,panelDelay);};var handleFocusOut=function handleFocusOut(e){var focusDuration=Date.now()-focusDateTime;if(focusDuration>50)return;// unrealistic blur, refocus\ne.stopPropagation();focus();};var unsubSoftKeyboardListener=createSoftKeyboardObserver(handleSoftKeyboard);var handleMeasure=function handleMeasure(_ref268){var detail=_ref268.detail;panelHeight=detail.height;};onMount(function(){if(!autoFocus)return;focus();});onDestroy(function(){unsubSoftKeyboardListener&&unsubSoftKeyboardListener();});function div2_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){root=$$value;$$invalidate(8,root);});}$$self.$$set=function($$props){if(\"onconfirm\"in $$props)$$invalidate(0,onconfirm=$$props.onconfirm);if(\"oncancel\"in $$props)$$invalidate(1,oncancel=$$props.oncancel);if(\"autoFocus\"in $$props)$$invalidate(13,autoFocus=$$props.autoFocus);if(\"autoPositionCursor\"in $$props)$$invalidate(14,autoPositionCursor=$$props.autoPositionCursor);if(\"labelConfirm\"in $$props)$$invalidate(2,labelConfirm=$$props.labelConfirm);if(\"labelConfirmShow\"in $$props)$$invalidate(3,labelConfirmShow=$$props.labelConfirmShow);if(\"iconConfirm\"in $$props)$$invalidate(4,iconConfirm=$$props.iconConfirm);if(\"labelCancel\"in $$props)$$invalidate(5,labelCancel=$$props.labelCancel);if(\"labelCancelShow\"in $$props)$$invalidate(6,labelCancelShow=$$props.labelCancelShow);if(\"iconCancel\"in $$props)$$invalidate(7,iconCancel=$$props.iconCancel);if(\"panelOffset\"in $$props)$$invalidate(15,panelOffset=$$props.panelOffset);if(\"$$scope\"in $$props)$$invalidate(16,$$scope=$$props.$$scope);};var computedStyle;var shouldStickToKeyboard;var style;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*root*/256){$$invalidate(25,computedStyle=root&&getComputedStyle(root));}if($$self.$$.dirty[0]&/*computedStyle*/33554432){shouldStickToKeyboard=computedStyle&&computedStyle.getPropertyValue(\"--editor-modal\")===\"1\";}if($$self.$$.dirty[0]&/*panelOpacity, panelPosition*/12582912){$$invalidate(9,style=\"opacity:\".concat(panelOpacity,\";\").concat(panelPosition));}};return[onconfirm,oncancel,labelConfirm,labelConfirmShow,iconConfirm,labelCancel,labelCancelShow,iconCancel,root,style,handleFocusIn,handleFocusOut,handleMeasure,autoFocus,autoPositionCursor,panelOffset,$$scope,slots,div2_binding];}var InputForm=/*#__PURE__*/function(_SvelteComponent32){_inherits(InputForm,_SvelteComponent32);var _super34=_createSuper(InputForm);function InputForm(options){var _this34;_classCallCheck(this,InputForm);_this34=_super34.call(this);init(_assertThisInitialized(_this34),options,instance$v,create_fragment$v,safe_not_equal,{onconfirm:0,oncancel:1,autoFocus:13,autoPositionCursor:14,labelConfirm:2,labelConfirmShow:3,iconConfirm:4,labelCancel:5,labelCancelShow:6,iconCancel:7,panelOffset:15},[-1,-1]);return _this34;}return InputForm;}(SvelteComponent);/* src/core/ui/components/ShapeLayoutEditor.svelte generated by Svelte v3.29.4 */function get_each_context$6(ctx,list,i){var child_ctx=ctx.slice();child_ctx[153]=list[i];child_ctx[155]=i;return child_ctx;}// (1887:8) {#each shapeNavList as item, index (item.id) }\nfunction create_each_block$6(key_1,ctx){var li;var button;var colorpreview;var t0;var span;var t1_value=/*item*/ctx[153].name+\"\";var t1;var button_aria_label_value;var t2;var current;var mounted;var dispose;colorpreview=new ColorPreview({props:{color:/*item*/ctx[153].color}});function click_handler(){var _ctx13;for(var _len14=arguments.length,args=new Array(_len14),_key17=0;_key17<_len14;_key17++){args[_key17]=arguments[_key17];}return(/*click_handler*/(_ctx13=ctx)[94].apply(_ctx13,[/*index*/ctx[155]].concat(args)));}return{key:key_1,first:null,c:function c(){li=element(\"li\");button=element(\"button\");create_component(colorpreview.$$.fragment);t0=space();span=element(\"span\");t1=text(t1_value);t2=space();attr(button,\"class\",\"DokaShapeListItem\");attr(button,\"type\",\"button\");attr(button,\"aria-label\",button_aria_label_value=\"Select shape \"+/*item*/ctx[153].name);this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,button);mount_component(colorpreview,button,null);append(button,t0);append(button,span);append(span,t1);append(li,t2);current=true;if(!mounted){dispose=listen(button,\"click\",click_handler);mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var colorpreview_changes={};if(dirty[0]&/*shapeNavList*/524288)colorpreview_changes.color=/*item*/ctx[153].color;colorpreview.$set(colorpreview_changes);if((!current||dirty[0]&/*shapeNavList*/524288)&&t1_value!==(t1_value=/*item*/ctx[153].name+\"\"))set_data(t1,t1_value);if(!current||dirty[0]&/*shapeNavList*/524288&&button_aria_label_value!==(button_aria_label_value=\"Select shape \"+/*item*/ctx[153].name)){attr(button,\"aria-label\",button_aria_label_value);}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);destroy_component(colorpreview);mounted=false;dispose();}};}// (1898:4) {#if shouldRenderShapeManipulator}\nfunction create_if_block_2$6(ctx){var shapemanipulator;var current;shapemanipulator=new ShapeManipulator({props:{visible:true,points:/*shapeManipulatorPoints*/ctx[11],rotatorPoint:/*shapeManipulatorRotationPointPosition*/ctx[12],enableResizing:/*allowedResizeControls*/ctx[9],enableRotating:/*allowRotateControls*/ctx[8]}});shapemanipulator.$on(\"resizestart\",/*handleManipulatorResizeGrab*/ctx[26]);shapemanipulator.$on(\"resizemove\",/*handleManipulatorResizeDrag*/ctx[27]);shapemanipulator.$on(\"resizeend\",/*handleManipulatorResizeEnd*/ctx[28]);shapemanipulator.$on(\"rotatestart\",/*handleManipulatorRotateGrab*/ctx[29]);shapemanipulator.$on(\"rotatemove\",/*handleManipulatorRotateDrag*/ctx[30]);shapemanipulator.$on(\"rotateend\",/*handleManipulatorRotateEnd*/ctx[31]);return{c:function c(){create_component(shapemanipulator.$$.fragment);},m:function m(target,anchor){mount_component(shapemanipulator,target,anchor);current=true;},p:function p(ctx,dirty){var shapemanipulator_changes={};if(dirty[0]&/*shapeManipulatorPoints*/2048)shapemanipulator_changes.points=/*shapeManipulatorPoints*/ctx[11];if(dirty[0]&/*shapeManipulatorRotationPointPosition*/4096)shapemanipulator_changes.rotatorPoint=/*shapeManipulatorRotationPointPosition*/ctx[12];if(dirty[0]&/*allowedResizeControls*/512)shapemanipulator_changes.enableResizing=/*allowedResizeControls*/ctx[9];if(dirty[0]&/*allowRotateControls*/256)shapemanipulator_changes.enableRotating=/*allowRotateControls*/ctx[8];shapemanipulator.$set(shapemanipulator_changes);},i:function i(local){if(current)return;transition_in(shapemanipulator.$$.fragment,local);current=true;},o:function o(local){transition_out(shapemanipulator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapemanipulator,detaching);}};}// (1913:4) {#if shouldRenderTextInput}\nfunction create_if_block_1$9(ctx){var inputform;var current;inputform=new InputForm({props:{panelOffset:/*offset*/ctx[1],onconfirm:/*handleTextConfirm*/ctx[37],oncancel:/*handleTextCancel*/ctx[38],labelCancel:/*locale*/ctx[3].shapeLabelInputCancel,iconCancel:/*locale*/ctx[3].shapeIconInputCancel,labelConfirm:/*locale*/ctx[3].shapeLabelInputConfirm,iconConfirm:/*locale*/ctx[3].shapeIconInputConfirm,$$slots:{\"default\":[create_default_slot$7]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(inputform.$$.fragment);},m:function m(target,anchor){mount_component(inputform,target,anchor);current=true;},p:function p(ctx,dirty){var inputform_changes={};if(dirty[0]&/*offset*/2)inputform_changes.panelOffset=/*offset*/ctx[1];if(dirty[0]&/*locale*/8)inputform_changes.labelCancel=/*locale*/ctx[3].shapeLabelInputCancel;if(dirty[0]&/*locale*/8)inputform_changes.iconCancel=/*locale*/ctx[3].shapeIconInputCancel;if(dirty[0]&/*locale*/8)inputform_changes.labelConfirm=/*locale*/ctx[3].shapeLabelInputConfirm;if(dirty[0]&/*locale*/8)inputform_changes.iconConfirm=/*locale*/ctx[3].shapeIconInputConfirm;if(dirty[0]&/*markupTextInputStyle, textInputText, textInput*/49184|dirty[5]&/*$$scope*/2){inputform_changes.$$scope={dirty:dirty,ctx:ctx};}inputform.$set(inputform_changes);},i:function i(local){if(current)return;transition_in(inputform.$$.fragment,local);current=true;},o:function o(local){transition_out(inputform.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(inputform,detaching);}};}// (1914:4) <InputForm          panelOffset={offset}         onconfirm={handleTextConfirm}          oncancel={handleTextCancel}         labelCancel={locale.shapeLabelInputCancel}         iconCancel={locale.shapeIconInputCancel}         labelConfirm={locale.shapeLabelInputConfirm}         iconConfirm={locale.shapeIconInputConfirm}>\nfunction create_default_slot$7(ctx){var textarea;var mounted;var dispose;return{c:function c(){textarea=element(\"textarea\");attr(textarea,\"style\",/*markupTextInputStyle*/ctx[15]);attr(textarea,\"spellcheck\",\"false\");attr(textarea,\"autocorrect\",\"off\");attr(textarea,\"autocapitalize\",\"off\");textarea.value=/*textInputText*/ctx[14];},m:function m(target,anchor){insert(target,textarea,anchor);/*textarea_binding*/ctx[95](textarea);if(!mounted){dispose=[listen(textarea,\"keydown\",/*handleTextInputKeyDown*/ctx[35]),listen(textarea,\"keypress\",/*handleTextInputAttempt*/ctx[34]),listen(textarea,\"keyup\",/*handleTextInputKeyUp*/ctx[36]),listen(textarea,\"input\",/*handleTextInput*/ctx[33])];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*markupTextInputStyle*/32768){attr(textarea,\"style\",/*markupTextInputStyle*/ctx[15]);}if(dirty[0]&/*textInputText*/16384){textarea.value=/*textInputText*/ctx[14];}},d:function d(detaching){if(detaching)detach(textarea);/*textarea_binding*/ctx[95](null);mounted=false;run_all(dispose);}};}// (1932:4) {#if $markupControlsOpacity > 0}\nfunction create_if_block$8(ctx){var div;var dynamiccomponenttree;var measurable_action;var current;var mounted;var dispose;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*shapeControls*/ctx[18]}});return{c:function c(){div=element(\"div\");create_component(dynamiccomponenttree.$$.fragment);attr(div,\"class\",\"DokaShapeControls\");attr(div,\"style\",/*markupControlsStyle*/ctx[16]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(dynamiccomponenttree,div,null);current=true;if(!mounted){dispose=[listen(div,\"measure\",/*measure_handler_1*/ctx[96]),action_destroyer(measurable_action=measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[0]&/*shapeControls*/262144)dynamiccomponenttree_changes.items=/*shapeControls*/ctx[18];dynamiccomponenttree.$set(dynamiccomponenttree_changes);if(!current||dirty[0]&/*markupControlsStyle*/65536){attr(div,\"style\",/*markupControlsStyle*/ctx[16]);}},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(dynamiccomponenttree);mounted=false;run_all(dispose);}};}function create_fragment$w(ctx){var div;var nav;var ul;var each_blocks=[];var each_1_lookup=new Map();var t0;var t1;var t2;var measurable_action;var nudgeable_action;var interactable_action;var current;var mounted;var dispose;var each_value=/*shapeNavList*/ctx[19];var get_key=function get_key(ctx){return(/*item*/ctx[153].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$6(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$6(key,child_ctx));}var if_block0=/*shouldRenderShapeManipulator*/ctx[10]&&create_if_block_2$6(ctx);var if_block1=/*shouldRenderTextInput*/ctx[13]&&create_if_block_1$9(ctx);var if_block2=/*$markupControlsOpacity*/ctx[17]>0&&create_if_block$8(ctx);return{c:function c(){div=element(\"div\");nav=element(\"nav\");ul=element(\"ul\");for(var _i34=0;_i34<each_blocks.length;_i34+=1){each_blocks[_i34].c();}t0=space();if(if_block0)if_block0.c();t1=space();if(if_block1)if_block1.c();t2=space();if(if_block2)if_block2.c();attr(nav,\"class\",\"DokaShapeList\");attr(nav,\"data-visible\",/*showShapeList*/ctx[7]);attr(div,\"class\",\"DokaShapeEditor\");attr(div,\"tabindex\",\"0\");},m:function m(target,anchor){insert(target,div,anchor);append(div,nav);append(nav,ul);for(var _i35=0;_i35<each_blocks.length;_i35+=1){each_blocks[_i35].m(ul,null);}append(div,t0);if(if_block0)if_block0.m(div,null);append(div,t1);if(if_block1)if_block1.m(div,null);append(div,t2);if(if_block2)if_block2.m(div,null);current=true;if(!mounted){dispose=[listen(nav,\"focusin\",/*handleFocusIn*/ctx[41]),listen(nav,\"focusout\",/*handleFocusOut*/ctx[42]),listen(div,\"keydown\",/*handleKey*/ctx[32]),listen(div,\"nudge\",/*handleNudge*/ctx[40]),listen(div,\"measure\",/*measure_handler*/ctx[93]),action_destroyer(measurable_action=measurable.call(null,div)),action_destroyer(nudgeable_action=nudgeable.call(null,div)),listen(div,\"wheel\",/*handleWheel*/ctx[21]),listen(div,\"interactionstart\",/*handleInteractionStart*/ctx[22]),listen(div,\"interactionupdate\",/*handleInteractionUpdate*/ctx[23]),listen(div,\"interactionrelease\",/*handleInteractionRelease*/ctx[24]),listen(div,\"interactionend\",/*handleInteractionEnd*/ctx[25]),action_destroyer(interactable_action=interactable.call(null,div,{drag:true,pinch:true,inertia:true,matchTarget:true,getEventPosition:/*interactable_function*/ctx[97]}))];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*shapeNavList, selectShape, markup*/524305){var _each_value7=/*shapeNavList*/ctx[19];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value7,each_1_lookup,ul,outro_and_destroy_block,create_each_block$6,null,get_each_context$6);check_outros();}if(!current||dirty[0]&/*showShapeList*/128){attr(nav,\"data-visible\",/*showShapeList*/ctx[7]);}if(/*shouldRenderShapeManipulator*/ctx[10]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*shouldRenderShapeManipulator*/1024){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$6(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div,t1);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderTextInput*/ctx[13]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*shouldRenderTextInput*/8192){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$9(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div,t2);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}if(/*$markupControlsOpacity*/ctx[17]>0){if(if_block2){if_block2.p(ctx,dirty);if(dirty[0]&/*$markupControlsOpacity*/131072){transition_in(if_block2,1);}}else{if_block2=create_if_block$8(ctx);if_block2.c();transition_in(if_block2,1);if_block2.m(div,null);}}else if(if_block2){group_outros();transition_out(if_block2,1,1,function(){if_block2=null;});check_outros();}if(interactable_action&&is_function(interactable_action.update)&&dirty[0]&/*rootRect*/4)interactable_action.update.call(null,{drag:true,pinch:true,inertia:true,matchTarget:true,getEventPosition:/*interactable_function*/ctx[97]});},i:function i(local){if(current)return;for(var _i36=0;_i36<each_value.length;_i36+=1){transition_in(each_blocks[_i36]);}transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){for(var _i37=0;_i37<each_blocks.length;_i37+=1){transition_out(each_blocks[_i37]);}transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(detaching)detach(div);for(var _i38=0;_i38<each_blocks.length;_i38+=1){each_blocks[_i38].d();}if(if_block0)if_block0.d();if(if_block1)if_block1.d();if(if_block2)if_block2.d();mounted=false;run_all(dispose);}};}var ROTATION_CONTROL_OFFSET=20;var MIN_TEXT_MARKUP_WIDTH=10;var shapeControlDist=16;function instance$w($$self,$$props,$$invalidate){var $keysPressedStored;var $markupControlsOpacity;var markup=$$props.markup;var offset=$$props.offset;var _$$props$rotation=$$props.rotation,rotation=_$$props$rotation===void 0?0:_$$props$rotation;var scale=$$props.scale;var ui=$$props.ui;var _$$props$opacity=$$props.opacity,opacity=_$$props$opacity===void 0?1:_$$props$opacity;var parentRect=$$props.parentRect;var rootRect=$$props.rootRect;var stageRect=$$props.stageRect;var utilRect=$$props.utilRect;var _$$props$oninteractio=$$props.oninteractionstart,oninteractionstart=_$$props$oninteractio===void 0?noop:_$$props$oninteractio;var _$$props$oninteractio2=$$props.oninteractionupdate,oninteractionupdate=_$$props$oninteractio2===void 0?noop:_$$props$oninteractio2;var _$$props$oninteractio3=$$props.oninteractionrelease,oninteractionrelease=_$$props$oninteractio3===void 0?noop:_$$props$oninteractio3;var _$$props$oninteractio4=$$props.oninteractionend,oninteractionend=_$$props$oninteractio4===void 0?noop:_$$props$oninteractio4;var _$$props$onaddshape=$$props.onaddshape,onaddshape=_$$props$onaddshape===void 0?noop:_$$props$onaddshape;var _$$props$onupdateshap=$$props.onupdateshape,onupdateshape=_$$props$onupdateshap===void 0?noop:_$$props$onupdateshap;var _$$props$onselectshap=$$props.onselectshape,onselectshape=_$$props$onselectshap===void 0?noop:_$$props$onselectshap;var _$$props$onremoveshap=$$props.onremoveshape,onremoveshape=_$$props$onremoveshap===void 0?noop:_$$props$onremoveshap;var _$$props$beforeSelect=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect===void 0?function(){return true;}:_$$props$beforeSelect;var _$$props$beforeDesele=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele===void 0?function(){return true;}:_$$props$beforeDesele;var _$$props$beforeAddSha=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha===void 0?function(){return true;}:_$$props$beforeAddSha;// unused for now\nvar _$$props$beforeRemove=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove===void 0?function(){return true;}:_$$props$beforeRemove;var _$$props$beforeUpdate=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate===void 0?function(shape,props){return props;}:_$$props$beforeUpdate;var _$$props$willRenderSh=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh===void 0?passthrough:_$$props$willRenderSh;var mapEditorPointToImagePoint=$$props.mapEditorPointToImagePoint;var mapImagePointToEditorPoint=$$props.mapImagePointToEditorPoint;var _$$props$enableButton4=$$props.enableButtonFlipVertical,enableButtonFlipVertical=_$$props$enableButton4===void 0?false:_$$props$enableButton4;var locale=$$props.locale;//\n// Cache\n//\nvar updateShape=function updateShape(shape,props,parentRect){var propsToUpdate=beforeUpdateShape(_objectSpread({},shape),props,_objectSpread({},parentRect));shapeUpdateProps(shape,propsToUpdate,parentRect);};//\n// Helpers\n//\nvar isPositionInRect=function isPositionInRect(position,rect,rotation,pivot){if(rotation)return!!polyPointIntersectionConvex(position,rectRotate(rect,rotation,pivot||rectCenter(rect)));var _rectToBounds5=rectToBounds(rect),_rectToBounds6=_slicedToArray(_rectToBounds5,4),t=_rectToBounds6[0],r=_rectToBounds6[1],b=_rectToBounds6[2],l=_rectToBounds6[3];return position.x>=l&&position.x<=r&&position.y>=t&&position.y<=b;};var isPositionInEllipse=function isPositionInEllipse(position,ellipse,rotation){var rx=ellipse.rx;var ry=ellipse.ry;var x=ellipse.x;var y=ellipse.y;var angle=rotation||0;var c=Math.cos(angle);var s=Math.sin(angle);var rx2=rx*rx;var ry2=ry*ry;var a=c*(position.x-x)+s*(position.y-y);var b=s*(position.x-x)-c*(position.y-y);var aa=a*a;var bb=b*b;return aa/rx2+bb/ry2<=1;};var isPositionNearLine=function isPositionNearLine(position,begin,end,treshold){var ba=Math.atan2(position.y-begin.y,position.x-begin.x);var ea=Math.atan2(position.y-end.y,position.x-end.x);if(ba>0&&ea>0||ba<0&&ea<0)return false;var r=treshold*treshold;var d=vectorCreate(end.x-begin.x,end.y-begin.y);var f=vectorCreate(begin.x-position.x,begin.y-position.y);var a=vectorDot(d,d);var b=2*vectorDot(f,d);var c=vectorDot(f,f)-r;var discriminant=b*b-4*a*c;return discriminant>=0;};//\n// Shape creator\n//\nvar keysPressedStored=getContext(\"keysPressed\");component_subscribe($$self,keysPressedStored,function(value){return $$invalidate(105,$keysPressedStored=value);});var createShape=function createShape(shapeDefault){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// state\nvar interactionOrigin;var interactionRadius;var interactionPosition;var isEllipse=shapeIsEllipse(shapeDefault);var isText=shapeIsText(shapeDefault);var isRelative=options.position===\"relative\";if(shapeIsPath(shapeDefault)){return{start:function start(e){var origin=e.detail.origin;interactionRadius=4;interactionOrigin=vectorClone(origin);interactionPosition=vectorClone(origin);var originPoint=mapEditorPointToImagePoint(origin);if(isRelative){originPoint.x=isRelative?toPercentage(originPoint.x,parentRect.width):originPoint.x;originPoint.y=isRelative?toPercentage(originPoint.y,parentRect.height):originPoint.y;}// add to markup so it's drawn\naddMarkupItemDraft(_objectSpread(_objectSpread({},shapeDefault),{},{points:[originPoint]}));},update:function update(e){var draft=getMarkupItemDraft();var translation=e.detail.translation;// position\nvar pointerPosition=vectorCreate(interactionOrigin.x+translation.x,interactionOrigin.y+translation.y);// distance between interaction and pointer if it's too close, we don't draw this point\nvar dist=vectorDistance(interactionPosition,pointerPosition);if(fixPrecision(dist,5)<=interactionRadius)return;// get angle between interaction and pointer\nvar angle=vectorAngleBetween(pointerPosition,interactionPosition);// move brush towards pointer at angle\nvar moveDist=interactionRadius-dist;interactionPosition.x+=moveDist*Math.cos(angle);interactionPosition.y+=moveDist*Math.sin(angle);// create point\nvar point=mapEditorPointToImagePoint(interactionPosition);if(point){point.x=isRelative?toPercentage(point.x,parentRect.width):point.x;point.y=isRelative?toPercentage(point.y,parentRect.height):point.y;}draft.points=draft.points.concat(point);syncShapes();},release:function release(e){return e.detail.preventInertia();},end:function end(e){var draft=getMarkupItemDraft();if(e.detail.isTap)return discardMarkupItemDraft();var shape=confirmMarkupItemDraft();onaddshape(shape);}};}else if(isEllipse||isText||shapeIsRect(shapeDefault)){return{start:function start(e){var origin=e.detail.origin;// need to remember origin so we can correctly apply interaction translation\ninteractionOrigin=vectorClone(origin);var mappedOriginPosition=mapEditorPointToImagePoint(interactionOrigin);// add to markup so it's drawn\nvar draft=_objectSpread(_objectSpread({},shapeDefault),{},{rotation:-rotation,x:isRelative?toPercentage(mappedOriginPosition.x,parentRect.width):mappedOriginPosition.x,y:isRelative?toPercentage(mappedOriginPosition.y,parentRect.height):mappedOriginPosition.y});// remove position\ndelete draft.position;// hide initially\ndraft.opacity=0;// \nif(isEllipse){draft.rx=isRelative?toPercentage(0):0;draft.ry=isRelative?toPercentage(0):0;}else{draft.width=isRelative?toPercentage(0):0;draft.height=isRelative?toPercentage(0):0;}addMarkupItemDraft(draft);},update:function update(e){var draft=getMarkupItemDraft();draft.opacity=1;var aspectRatio=draft.aspectRatio;var translation=e.detail.translation;// limit to aspect ratio\nif(aspectRatio){var _t=Math.abs(translation.x)*aspectRatio;translation.x=translation.x;translation.y=_t*Math.sign(translation.y);}// position\nvar pointerPosition=vectorCreate(interactionOrigin.x+translation.x,interactionOrigin.y+translation.y);var mappedOriginPosition=mapEditorPointToImagePoint(interactionOrigin);var mappedPointerPosition=mapEditorPointToImagePoint(pointerPosition);var pivot={x:mappedOriginPosition.x+(mappedPointerPosition.x-mappedOriginPosition.x)*0.5,y:mappedOriginPosition.y+(mappedPointerPosition.y-mappedOriginPosition.y)*0.5};vectorRotate(mappedOriginPosition,rotation,pivot);vectorRotate(mappedPointerPosition,rotation,pivot);var l=Math.min(mappedOriginPosition.x,mappedPointerPosition.x);var t=Math.min(mappedOriginPosition.y,mappedPointerPosition.y);var r=Math.max(mappedOriginPosition.x,mappedPointerPosition.x);var b=Math.max(mappedOriginPosition.y,mappedPointerPosition.y);var width=r-l;var height=b-t;var props={};if(isEllipse){props.x=l+width*0.5;props.y=t+height*0.5;props.rx=width*0.5;props.ry=height*0.5;}else{props.x=l;props.y=t;props.width=width;props.height=height;}updateShape(draft,props,parentRect);// shapeUpdateProps(draft, props, parentRect);\nsyncShapes();},release:function release(e){e.detail.preventInertia();},end:function end(e){var draft=getMarkupItemDraft();if(e.detail.isTap)return discardMarkupItemDraft();draft.opacity=1;// finish markup\nif(!shapeIsText(draft)){var shape=confirmMarkupItemDraft();onaddshape(shape);}// select the draft\nselectShape(draft);// also enable editing the text\nif(shapeIsText(draft))editMarkupItem(draft);}};}else if(shapeIsLine(shapeDefault)){return{start:function start(e){var origin=e.detail.origin;var originMapped=mapEditorPointToImagePoint(origin);var originSnapped=vectorApply(originMapped,snapToPixel);interactionOrigin=vectorClone(origin);// add to markup so it's drawn\naddMarkupItemDraft(_objectSpread(_objectSpread({},shapeDefault),{},{x1:isRelative?toPercentage(originSnapped.x,parentRect.width):originSnapped.x,y1:isRelative?toPercentage(originSnapped.y,parentRect.height):originSnapped.y,x2:isRelative?toPercentage(originSnapped.x,parentRect.width):originSnapped.x,y2:isRelative?toPercentage(originSnapped.y,parentRect.height):originSnapped.y,opacity:0}));},update:function update(e){var draft=getMarkupItemDraft();var translation=e.detail.translation;var interactionTarget=vectorAdd(vectorClone(interactionOrigin),translation);// shift pressed\nif($keysPressedStored.includes(16)){var length=vectorDistance(interactionOrigin,interactionTarget);var angle=vectorAngleBetween(interactionOrigin,interactionTarget);var angleSnapInterval=Math.PI/4;var angleSnapped=angleSnapInterval*Math.round(angle/angleSnapInterval);interactionTarget.x=interactionOrigin.x+length*Math.cos(angleSnapped);interactionTarget.y=interactionOrigin.y+length*Math.sin(angleSnapped);}// update line end position\nvar point=mapEditorPointToImagePoint(interactionTarget);updateMarkupShape(draft,{x2:isRelative?toPercentage(point.x,parentRect.width):point.x,y2:isRelative?toPercentage(point.y,parentRect.height):point.y,opacity:1});syncShapes();},release:function release(e){return e.detail.preventInertia();},end:function end(e){var draft=getMarkupItemDraft();if(e.detail.isTap)return discardMarkupItemDraft();// get draft\ndraft.opacity=1;// finish markup\nconfirmMarkupItemDraft();// select the draft\nselectShape(draft);}};}};var eraseShape=function eraseShape(){var origin;var positionPrevious;return{start:function start(e){origin=e.detail.origin;positionPrevious=origin;},update:function update(e){var translation=e.detail.translation;var positionCurrent=vectorCreate(origin.x+translation.x,origin.y+translation.y);var shapesFound=getMarkupBetweenPoints(mapEditorPointToImagePoint(positionPrevious),mapEditorPointToImagePoint(positionCurrent));var shapesRemoved=removeMarkupItems(shapesFound);shapesRemoved.forEach(onremoveshape);positionPrevious=vectorClone(positionCurrent);},release:function release(e){return e.detail.preventInertia();},end:function end(){}};};//\n// Mapping coordinates\n//\nvar getImagePointWithScreenTranslation=function getImagePointWithScreenTranslation(point,translation){var pointInScreenSpace=mapImagePointToEditorPoint(point);return mapEditorPointToImagePoint(vectorAdd(pointInScreenSpace,translation));};//\n// Interaction\n//\n// image zoom\nvar handleWheel=function handleWheel(e){};// TODO: ZOOM image\n// markup manipulate\nvar translateShape=function translateShape(shapeCurrent,shapeOriginComputed,translation){if(shapeIsLine(shapeCurrent)){var beginImageOffset=getImagePointWithScreenTranslation(shapeLineGetStartPoint(shapeOriginComputed),translation);var endImageOffset=getImagePointWithScreenTranslation(shapeLineGetEndPoint(shapeOriginComputed),translation);updateShape(shapeCurrent,{x1:beginImageOffset.x,y1:beginImageOffset.y,x2:endImageOffset.x,y2:endImageOffset.y},parentRect);}else if(shapeIsRect(shapeCurrent)||shapeIsText(shapeCurrent)||shapeIsEllipse(shapeCurrent)){var imagePoint=getImagePointWithScreenTranslation(shapeOriginComputed,translation);updateShape(shapeCurrent,imagePoint,parentRect);}syncShapes();};var resizeMarkup=function resizeMarkup(shapeCurrent,shapeOriginComputed,indexes,translation,options){if(shapeIsLine(shapeCurrent)){var _indexes=_slicedToArray(indexes,1),targetIndex=_indexes[0];var snap=$keysPressedStored.includes(16)?function(origin,target){var length=vectorDistance(origin,target);var angle=vectorAngleBetween(origin,target);var angleSnapInterval=Math.PI/4;var angleSnapped=angleSnapInterval*Math.round(angle/angleSnapInterval)-rotation%angleSnapInterval;target.x=origin.x+length*Math.cos(angleSnapped);target.y=origin.y+length*Math.sin(angleSnapped);}:function(origin,target){return target;};if(targetIndex===0){var point=getImagePointWithScreenTranslation(shapeLineGetStartPoint(shapeOriginComputed),translation);snap(vectorCreate(shapeOriginComputed.x2,shapeOriginComputed.y2),point);updateShape(shapeCurrent,{x1:point.x,y1:point.y},parentRect);}else if(targetIndex===1){var _point=getImagePointWithScreenTranslation(shapeLineGetEndPoint(shapeOriginComputed),translation);snap(vectorCreate(shapeOriginComputed.x1,shapeOriginComputed.y1),_point);updateShape(shapeCurrent,{x2:_point.x,y2:_point.y},parentRect);}}else if(shapeHasSize(shapeCurrent)||shapeIsEllipse(shapeCurrent)||shapeIsTextBox(shapeCurrent)){var hasAutoHeight=false;var shapeOriginRect;if(shapeIsEllipse(shapeCurrent)){shapeOriginRect=rectCreateFromEllipse(shapeOriginComputed);}else if(shapeHasSize(shapeCurrent)){shapeOriginRect=rectCreateFromAny(shapeOriginComputed);}else{// is text with 'width' only\nhasAutoHeight=true;shapeOriginRect=rectCreateFromAny(shapeOriginComputed);var size=textSize(shapeOriginComputed.text,shapeOriginComputed);shapeOriginRect.height=size.height;}var shapeAspectRatio;if(shapeCurrent.aspectRatio){shapeAspectRatio=shapeCurrent.aspectRatio;}else if(options.shiftKey&&!hasAutoHeight){shapeAspectRatio=shapeOriginRect.width/shapeOriginRect.height;}// current shape\nvar rectAligned=rectCreateFromAny(shapeOriginRect);var rectAlignedCenterPosition=rectCenter(rectAligned);var rectRotation=shapeCurrent.rotation;var rectAlignedCorners=rectGetCorners(rectAligned);var rectCorners=rectRotate(rectAligned,rectRotation);// is translating one corner\nif(indexes.length===1){// corner\nvar cornerIndex=indexes[0];var _rectAlignedCorners=_slicedToArray(rectAlignedCorners,4),tl=_rectAlignedCorners[0],tr=_rectAlignedCorners[1],br=_rectAlignedCorners[2],bl=_rectAlignedCorners[3];var screenTargetPosition=mapImagePointToEditorPoint(rectCorners[cornerIndex]);vectorAdd(screenTargetPosition,translation);var imageTargetPosition=mapEditorPointToImagePoint(screenTargetPosition);var imageTargetTranslation=vectorCreate(imageTargetPosition.x-rectCorners[cornerIndex].x,imageTargetPosition.y-rectCorners[cornerIndex].y);if(shapeCurrent.flipX)imageTargetTranslation.x=-imageTargetTranslation.x;if(shapeCurrent.flipY)imageTargetTranslation.y=-imageTargetTranslation.y;var imageTargetTranslationAligned=vectorRotate(vectorClone(imageTargetTranslation),-rectRotation);var imageTargetPositionAligned=vectorCreate(rectAlignedCorners[cornerIndex].x+imageTargetTranslationAligned.x,rectAlignedCorners[cornerIndex].y+imageTargetTranslationAligned.y);var anchor;if(cornerIndex===0)anchor=br;if(cornerIndex===1)anchor=bl;if(cornerIndex===2)anchor=tl;if(cornerIndex===3)anchor=tr;// create an aligned and updated rectangle\nvar rectAlignedResized=rectCreateFromPoints(anchor,imageTargetPositionAligned);// limit rect\nif(shapeAspectRatio){// get size that adheres to aspect ratio but still fits current rectangle\nvar _rectContainRect=rectContainRect(rectAlignedResized,shapeAspectRatio),width=_rectContainRect.width,height=_rectContainRect.height;var _rectToBounds7=rectToBounds(rectAlignedResized),_rectToBounds8=_slicedToArray(_rectToBounds7,4),t=_rectToBounds8[0],_r9=_rectToBounds8[1],b=_rectToBounds8[2],l=_rectToBounds8[3];// update size\nrectAlignedResized.width=width;rectAlignedResized.height=height;// align to anchor\nif(imageTargetPositionAligned.y<anchor.y){rectAlignedResized.y=b-height;}if(imageTargetPositionAligned.x<anchor.x){rectAlignedResized.x=_r9-width;}}// rotate the aligned rectangle around it's original pivot point\nvar rr=rectRotate(rectAlignedResized,rectRotation,rectAlignedCenterPosition);// now calculate the new center and then rotate the tl and br corners around that center to find their new positions\nvar rrc=vectorCenter(rr);var p1=vectorRotate(rr[0],-rectRotation,rrc);var p2=vectorRotate(rr[2],-rectRotation,rrc);if(shapeCurrent.flipX||shapeCurrent.flipY){vectorsFlip([p1,p2],shapeCurrent.flipX,shapeCurrent.flipY,rectAlignedCenterPosition.x,rectAlignedCenterPosition.y);}var rectUpdated=rectCreateFromPoints(p1,p2);updateShape(shapeCurrent,shapeIsEllipse(shapeCurrent)?ellipseCreateFromRect(rectUpdated):rectUpdated,parentRect);}else// is translating two corner points\n{// 0-1 -> 2-3\n// 1-2 -> 3-0\n// 2-3 -> 0-1\n// 3-0 -> 1-2\nvar _indexes$map=indexes.map(function(index){return rectCorners[index];}),_indexes$map2=_slicedToArray(_indexes$map,2),cornerA=_indexes$map2[0],cornerB=_indexes$map2[1];var mid={x:cornerA.x+(cornerB.x-cornerA.x)*0.5,y:cornerA.y+(cornerB.y-cornerA.y)*0.5};var _indexes$map3=indexes.map(function(index){return rectAlignedCorners[index];}),_indexes$map4=_slicedToArray(_indexes$map3,2),cornerAlignedA=_indexes$map4[0],cornerAlignedB=_indexes$map4[1];var _indexes$map5=indexes.map(function(index){var mappedIndex=index+2;if(mappedIndex<4)return rectAlignedCorners[mappedIndex];return rectAlignedCorners[mappedIndex-4];}),_indexes$map6=_slicedToArray(_indexes$map5,2),cornerAlignedC=_indexes$map6[0],cornerAlignedD=_indexes$map6[1];var midAligned={x:cornerAlignedA.x+(cornerAlignedB.x-cornerAlignedA.x)*0.5,y:cornerAlignedA.y+(cornerAlignedB.y-cornerAlignedA.y)*0.5};var midAnchorAligned={x:cornerAlignedC.x+(cornerAlignedD.x-cornerAlignedC.x)*0.5,y:cornerAlignedC.y+(cornerAlignedD.y-cornerAlignedC.y)*0.5};var _screenTargetPosition=mapImagePointToEditorPoint(mid);vectorAdd(_screenTargetPosition,translation);var _imageTargetPosition=mapEditorPointToImagePoint(_screenTargetPosition);var _imageTargetTranslation=vectorCreate(_imageTargetPosition.x-mid.x,_imageTargetPosition.y-mid.y);if(shapeCurrent.flipX)_imageTargetTranslation.x=-_imageTargetTranslation.x;if(shapeCurrent.flipY)_imageTargetTranslation.y=-_imageTargetTranslation.y;var _imageTargetTranslationAligned=vectorRotate(vectorClone(_imageTargetTranslation),-rectRotation);// const imageTargetPositionAligned = vectorCreate(\n//     midAligned.x + imageTargetTranslationAligned.x,\n//     midAligned.y + imageTargetTranslationAligned.y,\n// );\nvar d=vectorSubtract(vectorClone(cornerAlignedA),cornerAlignedB);var f=vectorApply(d,function(v){return 1-Math.abs(Math.sign(v));});var _t2=vectorCreate(_imageTargetTranslationAligned.x*f.x,_imageTargetTranslationAligned.y*f.y);vectorAdd(cornerAlignedA,_t2);vectorAdd(cornerAlignedB,_t2);var _rectAlignedResized=rectCreateFromPoints(rectAlignedCorners);// limit rect\nif(shapeAspectRatio){var _width=_rectAlignedResized.width;var _height=_rectAlignedResized.height;if(f.y===0){_height=_width/shapeAspectRatio;}else{_width=_height*shapeAspectRatio;}// update size\n_rectAlignedResized.width=_width;_rectAlignedResized.height=_height;// align to anchor\nif(f.y===0){_rectAlignedResized.y=midAnchorAligned.y-_height*0.5;}else{_rectAlignedResized.x=midAnchorAligned.x-_width*0.5;}}// rotate the aligned rectangle around it's original pivot point\nvar _rr=rectRotate(_rectAlignedResized,rectRotation,rectAlignedCenterPosition);// now calculate the new center and then rotate the tl and br corners around that center to find their new positions\nvar _rrc=vectorCenter(_rr);var _p2=vectorRotate(_rr[0],-rectRotation,_rrc);var _p3=vectorRotate(_rr[2],-rectRotation,_rrc);if(shapeCurrent.flipX||shapeCurrent.flipY){vectorsFlip([_p2,_p3],shapeCurrent.flipX,shapeCurrent.flipY,rectAlignedCenterPosition.x,rectAlignedCenterPosition.y);}var _rectUpdated=rectCreateFromPoints(_p2,_p3);var _props;if(shapeIsEllipse(shapeCurrent)){_props=ellipseCreateFromRect(_rectUpdated);}else if(shapeHasSize(shapeCurrent)){_props=_rectUpdated;}else if(hasAutoHeight){_props={x:_rectUpdated.x,y:_rectUpdated.y,width:_rectUpdated.width};}updateShape(shapeCurrent,_props,parentRect);}}syncShapes();};var rotatorInitialPosition;var rotateMarkup=function rotateMarkup(shapeCurrent,shapeOriginComputed,translation,options){// calculate angle between translated rotation control and origin\nvar shapeRect=getMarkupShapeRect(shapeComputeDisplay(shapeDeepCopy(shapeCurrent),parentRect));var shapeCenter=rectCenter(shapeRect);var p=getImagePointWithScreenTranslation(rotatorInitialPosition,translation);var shapeRotation=vectorAngleBetween(p,shapeCenter)+Math.PI/2;if(options.shiftKey){var rotatorSnapInterval=Math.PI/16;shapeRotation=rotatorSnapInterval*Math.round(shapeRotation/rotatorSnapInterval)-rotation%rotatorSnapInterval;}updateShape(shapeCurrent,{rotation:shapeRotation},parentRect);syncShapes();};var getMarkupItemDraft=function getMarkupItemDraft(){if(!markup.length)return;var lastMarkupItem=markup[markup.length-1];return lastMarkupItem.isDraft?lastMarkupItem:undefined;};var addMarkupItemDraft=function addMarkupItemDraft(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(getMarkupItemDraft())return;shape=Object.assign(shape,{isDraft:true});return addShape(shape,sync);};var confirmMarkupItemDraft=function confirmMarkupItemDraft(){var markupItem=getMarkupItemDraft();if(!markupItem)return;updateMarkupShapeProperty(markupItem,\"isDraft\",false);return markupItem;};var discardMarkupItemDraft=function discardMarkupItemDraft(){if(!getMarkupItemDraft())return;$$invalidate(0,markup=markup.slice(0,-1));};var createMarkupItem=function createMarkupItem(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return _objectSpread({id:getUniqueId()},props);};var syncShapes=function syncShapes(){return $$invalidate(0,markup);};var addShape=function addShape(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;markup.push(shape);// sync markup array\nif(sync)syncShapes();return shape;};var updateMarkupShape=function updateMarkupShape(shape,props){var sync=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;// update markup\nshape=Object.assign(shape,props);// sync markup array\nif(!sync)return;syncShapes();};var updateMarkupShapeProperty=function updateMarkupShapeProperty(shape,name,value){var sync=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;shape[name]=value;// sync markup array\nif(!sync)return;syncShapes();};var updateMarkupItemsShapeProperty=function updateMarkupItemsShapeProperty(name,value){var sync=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;markup.forEach(function(shape){return updateMarkupShapeProperty(shape,name,value,false);});// sync markup array\nif(!sync)return;syncShapes();};var updateMarkupShapeItems=function updateMarkupShapeItems(props){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;markup.forEach(function(markupItem){return updateMarkupShape(markupItem,props,false);});// sync markup array\nif(!sync)return;syncShapes();};var getActiveMarkupItem=function getActiveMarkupItem(){return _toConsumableArray(markup).reverse().find(shapeIsSelected);};var hasActiveMarkupItem=function hasActiveMarkupItem(){return!!getActiveMarkupItem();};var removeShape=function removeShape(shapeToRemove){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!beforeRemoveShape(shapeToRemove))return false;var markupWithoutShape=markup.filter(function(shape){return shape!==shapeToRemove;});onremoveshape(shapeToRemove);if(!sync)return;$$invalidate(0,markup=markupWithoutShape);};var removeActiveMarkupItem=function removeActiveMarkupItem(){var activeShape=getActiveMarkupItem();if(!activeShape)return;// get removable markup items, \nvar removableShapes=markup.filter(function(shape){return shapeCanRemove(shape)&&shapeCanSelect(shape);});// find index of active shape so we can select the next active shape on removal\nvar index=removableShapes.findIndex(function(shape){return shape===activeShape;});// remove the active ship from the shape array\nvar didRemove=removeShape(activeShape);if(didRemove===false)return;// remember selection\npreviousSelectedShape=activeShape;// if no more markup items, release active shape\nif(removableShapes.length-1===0)return blurShapes();// select next active markup item\nvar indexNext=index-1<0?removableShapes.length-1:index-1;selectShape(removableShapes[indexNext]);};var previousSelectedShape=undefined;var blurShapes=function blurShapes(){previousSelectedShape=getSelectedShape();updateMarkupShapeItems({isSelected:false,isEditing:false});};var getSelectedShape=function getSelectedShape(){return markup.find(shapeIsSelected);};var selectShape=function selectShape(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;// can't select draft\nif(shape.isDraft)return;// get currently selected shape\nvar selectedShape=getSelectedShape()||previousSelectedShape;// reset previous selected shape\npreviousSelectedShape=undefined;// if is returned false will cancel select operation\nif(!beforeSelectShape(selectedShape,shape))return;// remove selected state from other markup\nblurShapes();// select\nshapeSelect(shape);// selected this shape\nonselectshape(shape);// sync\nif(!sync)return;syncShapes();};var deselectMarkupItem=function deselectMarkupItem(markupItem){updateMarkupShape(markupItem,{isSelected:false,isEditing:false});};var editMarkupItem=function editMarkupItem(markupItem){updateMarkupShape(markupItem,{isSelected:true,isEditing:true});};var finishEditMarkupItem=function finishEditMarkupItem(markupItem){updateMarkupShape(markupItem,{isSelected:true,isEditing:false});};var removeMarkupItems=function removeMarkupItems(shapesToRemove){var shapesToRemoveFiltered=shapesToRemove.filter(beforeRemoveShape);$$invalidate(0,markup=markup.filter(function(shape){return!shapesToRemoveFiltered.includes(shape);}));return shapesToRemoveFiltered;};var getTextShapeRect=function getTextShapeRect(shape){var size=textSize(shape.text,shape);return rectCreate(shape.x,shape.y,shape.width?Math.min(shape.width,size.width):size.width,shape.height?Math.min(shape.height,size.height):size.height);};var getMarkupShapeRect=function getMarkupShapeRect(shape){// has own rect\nif(shapeHasSize(shape))return rectCreateFromAny(shape);if(shapeIsEllipse(shape))return rectCreateFromEllipse(shape);// calculate the size on canvas\nvar rect=getTextShapeRect(shape);rect.width=Math.max(MIN_TEXT_MARKUP_WIDTH,shape.width||rect.width);return rect;};var getShapesAtPosition=function getShapesAtPosition(position){return _toConsumableArray(markup).// reverse the array, want to select from top to bottom\nreverse().map(function(shape){return{shape:shape,priority:1};}).// can't select paths\nfilter(function(result){return shapeCanSelect(result.shape);}).// find markup near pointer\nfilter(function(result){// get shape\nvar shape=result.shape;// we need to know where the shape will end up\nvar computedShape=shapeComputeDisplay(shapeDeepCopy(shape),parentRect);// test if clicked in rect\nif(shapeIsRect(computedShape)){return isPositionInRect(position,computedShape,shape.rotation);}else if(shapeIsText(computedShape)){var shapeRect=getMarkupShapeRect(computedShape);var isPositionInBounds=isPositionInRect(position,shapeRect,shape.rotation);var isPositionInVisual=false;if(isPositionInBounds&&!shapeIsSelected(shape)){var visualRect=getTextShapeRect(computedShape);if(shape.textAlign===\"right\"&&!shape.flipX){visualRect.x=shapeRect.x+shapeRect.width-visualRect.width;}if(shape.textAlign===\"center\"){visualRect.x=shapeRect.x+shapeRect.width*0.5-visualRect.width*0.5;}isPositionInVisual=isPositionInRect(position,visualRect,shape.rotation,rectCenter(shapeRect));if(!isPositionInVisual)result.priority=-1;}return isPositionInBounds;}else// test if is ellipse\nif(shapeIsEllipse(computedShape)){return isPositionInEllipse(position,computedShape,shape.rotation);}else// test if clicked on line\nif(shapeIsLine(computedShape)){// radius around click position, test if line intersects\nreturn isPositionNearLine(position,shapeLineGetStartPoint(computedShape),shapeLineGetEndPoint(computedShape),16);}return false;}).sort(function(a,b){if(a.priority<b.priority){return 1;}if(a.priority>b.priority){return-1;}return 0;});};var getMarkupBetweenPoints=function getMarkupBetweenPoints(a,b){// eraseLine should be in image space\nvar eraseLine=lineCreate(a,b);// loop over shapes and find intersecting shapes\nreturn markup.filter(shapeCanErase).filter(function(shape){return!!linePointsIntersection(eraseLine,getMarkupShapePoints(shapeComputeDisplay(shapeDeepCopy(shape),parentRect)));});};//\n// Generic interaction\n//\nvar interactionTimer=undefined;var interactionTarget=undefined;var interactionShape=undefined;var interactionShapeOriginComputed=undefined;var isInteracting=false;var handleInteractionStart=function handleInteractionStart(e){var origin=e.detail.origin;interactionShape=undefined;interactionShapeOriginComputed=undefined;interactionTarget=undefined;clearTimeout(interactionTimer);interactionTimer=setTimeout(function(){return $$invalidate(104,isInteracting=true);},250);// test if target is a shape, if not, run interaction handler\nvar point=mapEditorPointToImagePoint(vectorClone(origin));var foundShapes=getShapesAtPosition(point);var targettedMarkupItem=foundShapes.length&&foundShapes.shift().shape;// check if markup was targetted\nif(targettedMarkupItem&&shapeIsSelected(targettedMarkupItem)){// clone shape we're interacting with so we can update it properly\ninteractionShape=targettedMarkupItem;interactionShapeOriginComputed=shapeComputeDisplay(shapeDeepCopy(interactionShape),parentRect);return;}// set target\ninteractionTarget=targettedMarkupItem;// started interacting\noninteractionstart(e);};var handleInteractionUpdate=function handleInteractionUpdate(e){// is interacting with shape\nif(interactionShape){// prevent moving if not allowed\nif(!shapeCanMove(interactionShape))return;// prevent moving if is editing text\nif(shapeIsTextEditing(interactionShape))return;return translateShape(interactionShape,interactionShapeOriginComputed,e.detail.translation);}oninteractionupdate(e);};var handleInteractionRelease=function handleInteractionRelease(e){clearTimeout(interactionTimer);$$invalidate(104,isInteracting=false);// test if is text and if we double tapped, if so, switch to text edit mode\nif(interactionShape){if(interactionShape.isEditing){handleTextCancel();}else if(e.detail.isDoubleTap&&shapeIsText(interactionShape)&&shapeCanInput(interactionShape)!==false){editMarkupItem(interactionShape);}return;}oninteractionrelease(e);};var handleInteractionEnd=function handleInteractionEnd(e){// shape remains active so user can resize, rotate\nif(interactionShape){onupdateshape(interactionShape);interactionShape=undefined;return;}// can we deselect the current shape?\nvar currentSelectedShape=getSelectedShape();var isSelectInteraction=interactionTarget&&e.detail.isTap;var allowDeselectShape=currentSelectedShape?beforeDeselectShape(currentSelectedShape,interactionTarget):true;if(allowDeselectShape){blurShapes();}oninteractionend(e);if(allowDeselectShape&&isSelectInteraction){selectShape(interactionTarget);}};//\n// Shape manipulation\n//\nvar getMarkupShapePoints=function getMarkupShapePoints(shape){var center;var points;if(shapeIsRect(shape)){center=rectCenter(shape);points=rectGetCorners(shape);if(shape.flipX||shape.flipY)vectorsFlip(points,shape.flipX,shape.flipY,center.x,center.y);points=vectorsRotate(points,shape.rotation,center.x,center.y);}else if(shapeIsEllipse(shape)){center=shape;points=rectGetCorners(rectCreateFromEllipse(shape));if(shape.flipX||shape.flipY)vectorsFlip(points,shape.flipX,shape.flipY,center.x,center.y);points=vectorsRotate(points,shape.rotation,center.x,center.y);}else if(shapeIsLine(shape)){points=[shapeLineGetStartPoint(shape),shapeLineGetEndPoint(shape)];center=vectorCenter(points);}else if(shapeIsPath(shape)){points=_toConsumableArray(shape.points);center=vectorCenter(points);}else if(shapeIsText(shape)){var rect=getMarkupShapeRect(shape);rect.width=Math.max(MIN_TEXT_MARKUP_WIDTH,rect.width);center=rectCenter(rect);points=rectGetCorners(rect);if(shape.flipX||shape.flipY)vectorsFlip(points,shape.flipX,shape.flipY,center.x,center.y);points=vectorsRotate(points,shape.rotation,center.x,center.y);}return points;};var getShapeRotationPoint=function getShapeRotationPoint(shape){var points=getMarkupShapePoints(shape);var origin;var dir;if(shape.flipY){origin=vectorCenter([points[0],points[1]]);dir=vectorNormalize(vectorCreate(points[1].x-points[2].x,points[1].y-points[2].y));}else{origin=vectorCenter([points[2],points[3]]);dir=vectorNormalize(vectorCreate(points[2].x-points[1].x,points[2].y-points[1].y));}vectorMultiply(dir,ROTATION_CONTROL_OFFSET/scale);return{origin:origin,dir:dir};};var getShapeRotationPointOnScreen=function getShapeRotationPointOnScreen(shape){var markupPoint=getShapeRotationPoint(shape);var screenPosition=mapImagePointToEditorPoint({x:markupPoint.origin.x+markupPoint.dir.x,y:markupPoint.origin.y+markupPoint.dir.y});var screenOrigin=mapImagePointToEditorPoint(markupPoint.origin);return{origin:screenOrigin,position:screenPosition};};// draw shape manipulator edges\nvar shapeManipulatorUid=\"markup-manipulator-segment\";onDestroy(function(){// clean up UI elements created by editor\n$$invalidate(43,ui=ui.filter(function(guide){return guide.id!==shapeManipulatorUid;}));});var handleManipulatorResizeGrab=function handleManipulatorResizeGrab(e){$$invalidate(104,isInteracting=true);interactionShape=activeMarkup;interactionShapeOriginComputed=activeMarkupComputed;};var handleManipulatorResizeDrag=function handleManipulatorResizeDrag(e){var _e$detail=e.detail,translation=_e$detail.translation,indexes=_e$detail.indexes,shiftKey=_e$detail.shiftKey;resizeMarkup(interactionShape,interactionShapeOriginComputed,indexes,translation,{shiftKey:shiftKey});};var handleManipulatorResizeEnd=function handleManipulatorResizeEnd(e){selectShape(interactionShape);interactionShape=undefined;$$invalidate(104,isInteracting=false);onupdateshape(activeMarkup);};var handleManipulatorRotateGrab=function handleManipulatorRotateGrab(e){rotatorInitialPosition=getShapeRotationPoint(activeMarkupComputed).origin;$$invalidate(104,isInteracting=true);interactionShape=activeMarkup;interactionShapeOriginComputed=activeMarkupComputed;};var handleManipulatorRotateDrag=function handleManipulatorRotateDrag(e){var _e$detail2=e.detail,translation=_e$detail2.translation,shiftKey=_e$detail2.shiftKey;rotateMarkup(interactionShape,interactionShapeOriginComputed,translation,{shiftKey:shiftKey});};var handleManipulatorRotateEnd=function handleManipulatorRotateEnd(){selectShape(interactionShape);interactionShape=undefined;$$invalidate(104,isInteracting=false);onupdateshape(activeMarkup);};//\n// Keyboard\n//\nvar handleKey=function handleKey(e){// only handle key input if a shape has been selected\nif(!hasActiveMarkupItem())return;// get key type\nvar key=e.key;// if is escape deselect active item\nif(/escape/i.test(key)){return deselectMarkupItem(activeMarkup);}// if is tab, select next markup item\n/*\nif (/arrow/i.test(key)) {\n    const success = e.shiftKey \n        ? selectPreviousMarkupItem(activeMarkup)\n        : selectNextMarkupItem(activeMarkup);\n    \n    if (success) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n}\n*/ // if is remove active\nif(/backspace/i.test(key)&&!/input|textarea/i.test(e.target.nodeName)){// prevent back navigation on Firefox\ne.preventDefault();// remove the item\nremoveActiveMarkupItem();}};//\n// Text input\n//\nvar textInput;var getTextShapeOriginSnapshot=function getTextShapeOriginSnapshot(){return _objectSpread({},activeMarkup);};var handleTextInput=function handleTextInput(){var value=shapeIsTextLine(activeMarkup)?filterNewlines(textInput.value):textInput.value;var canInput=shapeCanInput(activeMarkup,value);var text=canInput===true?value:canInput;var x=textShapeOrigin.x;var y=textShapeOrigin.y;// if does not have height we need to adjust offset if is rotated\nif(!activeMarkup.height&&activeMarkup.rotation!==0){var textSizeCurrent=textSize(text,activeMarkup);var textRectCurrent=rectCreate(textShapeOrigin.x,textShapeOrigin.y,textSizeCurrent.width,textSizeCurrent.height);var _rectRotate=rectRotate(textRectCurrent,textShapeOrigin.rotation),_rectRotate2=_slicedToArray(_rectRotate,1),currentTopLeft=_rectRotate2[0];var _rectRotate3=rectRotate(textRectOrigin,textShapeOrigin.rotation),_rectRotate4=_slicedToArray(_rectRotate3,1),originTopLeft=_rectRotate4[0];x+=originTopLeft.x-currentTopLeft.x;y+=originTopLeft.y-currentTopLeft.y;}updateMarkupShape(activeMarkup,{x:x,y:y,text:text});};var handleEditTextActiveMarkup=function handleEditTextActiveMarkup(){return editMarkupItem(activeMarkup);};var handleTextInputAttempt=function handleTextInputAttempt(e){var currentValue=e.target.value;var selectionStart=e.target.selectionStart;var selectionEnd=e.target.selectionEnd;var currentValueStart=currentValue.substring(0,selectionStart);var currentValueEnd=currentValue.substring(selectionEnd);var intendedValue=currentValueStart+e.key+currentValueEnd;var filteredValue=shapeCanInput(activeMarkup,intendedValue);if(filteredValue!==intendedValue)return e.preventDefault();};var filterNewlines=function filterNewlines(value){return value.// split on lines so we can create compressed normal line of text\nsplit(/[\\n\\r]/g).// rempve spaces around lines\nmap(function(str){return str.trim();}).// remove empty strings\nfilter(function(str){return str.length;}).// create new line\njoin(\" \");};// prevent moving shape when focusing text field, and close field if escape pressed\nvar handleTextInputKeyDown=function handleTextInputKeyDown(e){if(shapeIsTextLine(activeMarkup)&&/enter/i.test(e.code))return e.preventDefault();if(/arrow/i.test(e.code))return e.stopPropagation();if(/escape/i.test(e.key))return handleTextCancel();};// handle alt/ctrl/cmd + return\nvar handleTextInputKeyUp=function handleTextInputKeyUp(e){// get key type\nvar key=e.key,ctrlKey=e.ctrlKey,altKey=e.altKey;// confirm multi line text elements\nif(/enter/i.test(key)&&ctrlKey|altKey)return handleTextConfirm();};var handleTextConfirm=function handleTextConfirm(){// if was draft, now need to confirm\nvar wasDraft=activeMarkup.isDraft;if(activeMarkup.isDraft)confirmMarkupItemDraft();// final text input check\nhandleTextInput();// done\nfinishEditMarkupItem(activeMarkup);if(wasDraft)onaddshape(activeMarkup);else onupdateshape(activeMarkup);};var handleTextCancel=function handleTextCancel(){// revert text\nupdateMarkupShape(activeMarkup,{text:textShapeOrigin.text,x:textShapeOrigin.x,y:textShapeOrigin.y});if(activeMarkup.isDraft)discardMarkupItemDraft();finishEditMarkupItem(activeMarkup);};//\n// Controls\n//\nvar handleFlipX=function handleFlipX(e){e.stopPropagation();var flipX=activeMarkup.flipX||false;updateMarkupShapeProperty(activeMarkup,\"flipX\",!flipX);onupdateshape(activeMarkup);};var handleFlipY=function handleFlipY(e){e.stopPropagation();var flipY=activeMarkup.flipY||false;updateMarkupShapeProperty(activeMarkup,\"flipY\",!flipY);onupdateshape(activeMarkup);};var handleRemoveActiveMarkup=function handleRemoveActiveMarkup(e){e.stopPropagation();e.target.blur();// cancels focus of remove button\nremoveActiveMarkupItem();};var handleMoveToFrontActiveMarkup=function handleMoveToFrontActiveMarkup(e){e.stopPropagation();// test if is not already at top of stack, if so, exit\nvar index=markup.findIndex(function(shape){return shape===activeMarkup;});if(index===markup.length-1)return;// add to last index\n$$invalidate(0,markup=markup.filter(function(markupItem){return markupItem!==activeMarkup;}).concat([activeMarkup]));onupdateshape(activeMarkup);};var handleDuplicateActiveMarkup=function handleDuplicateActiveMarkup(e){e.stopPropagation();// create clone\nvar clone=shapeDeepCopy(activeMarkup);clone.id=getUniqueId();var duplicationOffset=vectorCreate(50,-50);// offset\nif(shapeIsLine(clone)){var linePosition=shapeGetPropsPixelValues(clone,[\"x1\",\"y1\",\"x2\",\"y2\"],parentRect);linePosition.x1+=duplicationOffset.x;linePosition.y1+=duplicationOffset.y;linePosition.x2+=duplicationOffset.x;linePosition.y2+=duplicationOffset.y;shapeUpdateProps(clone,linePosition,parentRect);}else{var currentPosition=shapeGetPropsPixelValues(clone,[\"x\",\"y\"],parentRect);currentPosition.x+=50;currentPosition.y-=50;shapeUpdateProps(clone,currentPosition,parentRect);}// add clone\nmarkup.push(clone);// added\nonaddshape(clone);// select clone\nselectShape(clone);};var getMarkupControlsAnchorPosition=function getMarkupControlsAnchorPosition(rect){return vectorApply(vectorCreate(rect.x+rect.width*0.5,rect.y),snapToPixel);};//\n// show & position markup controls panel\n//\nvar markupControlsOpacity=spring(0,{stiffness:0.2,damping:0.7});component_subscribe($$self,markupControlsOpacity,function(value){return $$invalidate(17,$markupControlsOpacity=value);});var shapeControlsSize;var getShapeControlPositionOnCanvas=function getShapeControlPositionOnCanvas(position){var left=utilRect.x;var top=utilRect.y;var right=left+utilRect.width;var x=Math.max(position.x-shapeControlsSize.width*0.5,left);var y=Math.max(position.y-shapeControlsSize.height-shapeControlDist,top);if(x+shapeControlsSize.width>right)x=right-shapeControlsSize.width;return vectorCreate(x,y);};var handleNudge=function handleNudge(e){var shape=getActiveMarkupItem();if(!shape)return;if(!shapeCanMove(shape))return;interactionShape=shape;interactionShapeOriginComputed=shapeComputeDisplay(shapeDeepCopy(interactionShape),parentRect);translateShape(interactionShape,interactionShapeOriginComputed,e.detail);};var handleViewResize=function handleViewResize(){if(isTextMarkupSelected)return;blurShapes();};// shape navigator\nvar showShapeList=false;var handleFocusIn=function handleFocusIn(e){$$invalidate(7,showShapeList=true);};var handleFocusOut=function handleFocusOut(_ref269){var relatedTarget=_ref269.relatedTarget;// still in list\nif(relatedTarget.classList.contains(\"shape-selector__button\"))return;$$invalidate(7,showShapeList=false);};function measure_handler(event){bubble($$self,event);}var click_handler=function click_handler(index,e){return selectShape(markup[index]);};function textarea_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){textInput=$$value;$$invalidate(5,textInput);});}var measure_handler_1=function measure_handler_1(e){return $$invalidate(6,shapeControlsSize=e.detail);};var interactable_function=function interactable_function(e){return getEventPositionInEditor(e,rootRect);};$$self.$$set=function($$props){if(\"markup\"in $$props)$$invalidate(0,markup=$$props.markup);if(\"offset\"in $$props)$$invalidate(1,offset=$$props.offset);if(\"rotation\"in $$props)$$invalidate(44,rotation=$$props.rotation);if(\"scale\"in $$props)$$invalidate(45,scale=$$props.scale);if(\"ui\"in $$props)$$invalidate(43,ui=$$props.ui);if(\"opacity\"in $$props)$$invalidate(46,opacity=$$props.opacity);if(\"parentRect\"in $$props)$$invalidate(47,parentRect=$$props.parentRect);if(\"rootRect\"in $$props)$$invalidate(2,rootRect=$$props.rootRect);if(\"stageRect\"in $$props)$$invalidate(48,stageRect=$$props.stageRect);if(\"utilRect\"in $$props)$$invalidate(49,utilRect=$$props.utilRect);if(\"oninteractionstart\"in $$props)$$invalidate(50,oninteractionstart=$$props.oninteractionstart);if(\"oninteractionupdate\"in $$props)$$invalidate(51,oninteractionupdate=$$props.oninteractionupdate);if(\"oninteractionrelease\"in $$props)$$invalidate(52,oninteractionrelease=$$props.oninteractionrelease);if(\"oninteractionend\"in $$props)$$invalidate(53,oninteractionend=$$props.oninteractionend);if(\"onaddshape\"in $$props)$$invalidate(54,onaddshape=$$props.onaddshape);if(\"onupdateshape\"in $$props)$$invalidate(55,onupdateshape=$$props.onupdateshape);if(\"onselectshape\"in $$props)$$invalidate(56,onselectshape=$$props.onselectshape);if(\"onremoveshape\"in $$props)$$invalidate(57,onremoveshape=$$props.onremoveshape);if(\"beforeSelectShape\"in $$props)$$invalidate(58,beforeSelectShape=$$props.beforeSelectShape);if(\"beforeDeselectShape\"in $$props)$$invalidate(59,beforeDeselectShape=$$props.beforeDeselectShape);if(\"beforeAddShape\"in $$props)$$invalidate(60,beforeAddShape=$$props.beforeAddShape);if(\"beforeRemoveShape\"in $$props)$$invalidate(61,beforeRemoveShape=$$props.beforeRemoveShape);if(\"beforeUpdateShape\"in $$props)$$invalidate(62,beforeUpdateShape=$$props.beforeUpdateShape);if(\"willRenderShapeControls\"in $$props)$$invalidate(63,willRenderShapeControls=$$props.willRenderShapeControls);if(\"mapEditorPointToImagePoint\"in $$props)$$invalidate(64,mapEditorPointToImagePoint=$$props.mapEditorPointToImagePoint);if(\"mapImagePointToEditorPoint\"in $$props)$$invalidate(65,mapImagePointToEditorPoint=$$props.mapImagePointToEditorPoint);if(\"enableButtonFlipVertical\"in $$props)$$invalidate(66,enableButtonFlipVertical=$$props.enableButtonFlipVertical);if(\"locale\"in $$props)$$invalidate(3,locale=$$props.locale);};var activeMarkup;var activeShapeId;var activeMarkupComputed;var activeMarkupItemIsDraft;var shapeProps;var shapeActivePoints;var allowResizeControls;var allowRotateControls;var allowedResizeControls;var shouldRenderShapeManipulator;var shapeActiveScreenPoints;var shapeManipulatorPoints;var shapeManipulatorRotationPoint;var shapeManipulatorRotationPointPosition;var shapeOpacity;var isTextMarkupSelected;var shouldRenderTextInput;var textShapeOrigin;var textSizeOrigin;var textRectOrigin;var textInputText;var markupTextInputStyle;var controlledMarkupItem;var allowShapeFlip;var allowShapeDuplicate;var allowShapeRemove;var allowShapeReorder;var allowShapeInput;var markupControlsAnchorPosition;var shapeControlsPosition;var markupControlsStyle;var shapeControls;var shapeNavList;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*markup*/1){$$invalidate(106,activeMarkup=markup&&(getMarkupItemDraft()||getActiveMarkupItem()));}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(107,activeShapeId=activeMarkup&&!shapeIsDraft(activeMarkup)?activeMarkup.id:undefined);}if($$self.$$.dirty[1]&/*parentRect*/65536|$$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(108,activeMarkupComputed=activeMarkup&&shapeComputeDisplay(shapeDeepCopy(activeMarkup),parentRect));}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(109,activeMarkupItemIsDraft=!!(activeMarkup&&shapeIsDraft(activeMarkup)));}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(110,shapeProps=activeMarkup||undefined);}if($$self.$$.dirty[3]&/*activeMarkup, activeMarkupComputed*/40960){$$invalidate(111,shapeActivePoints=activeMarkup&&!shapeIsPath(activeMarkupComputed)&&getMarkupShapePoints(activeMarkupComputed)||[]);}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(112,allowResizeControls=activeMarkup&&shapeCanResize(activeMarkup)&&!shapeIsTextEditing(activeMarkup));}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(8,allowRotateControls=activeMarkup&&shapeCanRotate(activeMarkup)&&!shapeIsTextEditing(activeMarkup));}if($$self.$$.dirty[3]&/*allowResizeControls, activeMarkup*/532480){$$invalidate(9,allowedResizeControls=allowResizeControls&&hasProp(activeMarkup,\"text\")&&!activeMarkup.height?\"horizontal\":allowResizeControls);}if($$self.$$.dirty[3]&/*activeMarkup, shapeActivePoints*/270336){$$invalidate(10,shouldRenderShapeManipulator=activeMarkup&&shapeActivePoints.length>1);}if($$self.$$.dirty[2]&/*mapImagePointToEditorPoint*/8|$$self.$$.dirty[3]&/*shapeActivePoints*/262144){$$invalidate(113,shapeActiveScreenPoints=shapeActivePoints.map(mapImagePointToEditorPoint));}if($$self.$$.dirty[0]&/*offset*/2|$$self.$$.dirty[3]&/*shapeActiveScreenPoints*/1048576){$$invalidate(11,shapeManipulatorPoints=shapeActiveScreenPoints.map(function(point){return vectorCreate(point.x-offset.x,point.y-offset.y);}));}if($$self.$$.dirty[0]&/*shouldRenderShapeManipulator, allowRotateControls*/1280|$$self.$$.dirty[3]&/*activeMarkupComputed*/32768){$$invalidate(114,shapeManipulatorRotationPoint=shouldRenderShapeManipulator&&allowRotateControls&&getShapeRotationPointOnScreen(activeMarkupComputed));}if($$self.$$.dirty[0]&/*offset*/2|$$self.$$.dirty[3]&/*shapeManipulatorRotationPoint*/2097152){$$invalidate(12,shapeManipulatorRotationPointPosition=shapeManipulatorRotationPoint&&vectorCreate(shapeManipulatorRotationPoint.position.x-offset.x,shapeManipulatorRotationPoint.position.y-offset.y));}if($$self.$$.dirty[1]&/*opacity*/32768){$$invalidate(115,shapeOpacity=opacity);// 1.0; // shapeManipulatorOpacity * opacity;\n}if($$self.$$.dirty[0]&/*shapeManipulatorPoints*/2048|$$self.$$.dirty[1]&/*opacity, ui*/36864|$$self.$$.dirty[3]&/*shapeActiveScreenPoints, shapeOpacity, shapeManipulatorRotationPoint*/7340032){if(opacity>0&&shapeManipulatorPoints.length>2){// create manipulator outline segments\nvar points=[].concat(_toConsumableArray(shapeActiveScreenPoints),[shapeActiveScreenPoints[0]]);var l=points.length;var segments=[];var strokeColor=[1,1,1,shapeOpacity];var strokeWidth=1;for(var i=0;i<l-1;i++){segments[i]={id:shapeManipulatorUid,points:[points[i],points[i+1]],opacity:1,strokeColor:strokeColor,strokeWidth:strokeWidth};}if(shapeManipulatorRotationPoint){// add rotator line\nsegments[segments.length]={id:shapeManipulatorUid,opacity:1,points:[{x:shapeManipulatorRotationPoint.origin.x,y:shapeManipulatorRotationPoint.origin.y},{x:shapeManipulatorRotationPoint.position.x,y:shapeManipulatorRotationPoint.position.y}],strokeColor:strokeColor,strokeWidth:strokeWidth};}// remove existing segments, and set new ones\n$$invalidate(43,ui=[].concat(_toConsumableArray(ui.filter(function(guide){return guide.id!==shapeManipulatorUid;})),segments));}else{// remove the guides when shape manipulator is no longer visible\n$$invalidate(43,ui=ui.filter(function(guide){return guide.id!==shapeManipulatorUid;}));}}if($$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(116,isTextMarkupSelected=activeMarkup&&shapeIsText(activeMarkup));}if($$self.$$.dirty[3]&/*isTextMarkupSelected, activeMarkup*/8396800){$$invalidate(13,shouldRenderTextInput=isTextMarkupSelected&&shapeCanInput(activeMarkup)!==false&&activeMarkup.isEditing);}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/8192){$$invalidate(117,textShapeOrigin=shouldRenderTextInput?getTextShapeOriginSnapshot():undefined);}if($$self.$$.dirty[3]&/*textShapeOrigin*/16777216){$$invalidate(118,textSizeOrigin=textShapeOrigin&&textSize(textShapeOrigin.text,textShapeOrigin));}if($$self.$$.dirty[3]&/*textShapeOrigin, textSizeOrigin*/50331648){textRectOrigin=textShapeOrigin&&rectCreate(textShapeOrigin.x,textShapeOrigin.y,textSizeOrigin.width,textSizeOrigin.height);}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/8192|$$self.$$.dirty[3]&/*activeMarkup*/8192){$$invalidate(14,textInputText=shouldRenderTextInput?activeMarkup.text:\"\");}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/8192|$$self.$$.dirty[3]&/*shapeProps*/131072){$$invalidate(15,markupTextInputStyle=shouldRenderTextInput&&\"\\n    text-align: \".concat(shapeProps.textAlign||\"left\",\";\\n    font-family: \").concat(shapeProps.fontFamily||\"sans-serif\",\";\\n\"));}if($$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft, controlledMarkupItem*/134291456){$$invalidate(120,controlledMarkupItem=activeMarkup&&!activeMarkupItemIsDraft?activeMarkup:controlledMarkupItem);}if($$self.$$.dirty[3]&/*controlledMarkupItem*/134217728){$$invalidate(121,allowShapeFlip=controlledMarkupItem&&shapeCanFlip(controlledMarkupItem));}if($$self.$$.dirty[3]&/*controlledMarkupItem*/134217728){$$invalidate(122,allowShapeDuplicate=controlledMarkupItem&&shapeCanDuplicate(controlledMarkupItem));}if($$self.$$.dirty[3]&/*controlledMarkupItem*/134217728){$$invalidate(123,allowShapeRemove=controlledMarkupItem&&shapeCanRemove(controlledMarkupItem));}if($$self.$$.dirty[3]&/*controlledMarkupItem*/134217728){$$invalidate(124,allowShapeReorder=controlledMarkupItem&&shapeCanReorder(controlledMarkupItem));}if($$self.$$.dirty[3]&/*controlledMarkupItem*/134217728){$$invalidate(125,allowShapeInput=controlledMarkupItem&&shapeCanInput(controlledMarkupItem)!==false);}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/8192|$$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft, isInteracting*/75776){markupControlsOpacity.set(activeMarkup&&!activeMarkupItemIsDraft&&!isInteracting&&!shouldRenderTextInput?1:0);}if($$self.$$.dirty[0]&/*shapeManipulatorPoints*/2048|$$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft*/73728|$$self.$$.dirty[4]&/*markupControlsAnchorPosition*/4){$$invalidate(126,markupControlsAnchorPosition=activeMarkup&&!activeMarkupItemIsDraft?getMarkupControlsAnchorPosition(rectCreateFromPoints(shapeManipulatorPoints)):markupControlsAnchorPosition);}if($$self.$$.dirty[0]&/*shapeControlsSize*/64|$$self.$$.dirty[1]&/*utilRect*/262144|$$self.$$.dirty[4]&/*markupControlsAnchorPosition*/4){$$invalidate(127,shapeControlsPosition=markupControlsAnchorPosition&&shapeControlsSize&&utilRect&&getShapeControlPositionOnCanvas(markupControlsAnchorPosition));}if($$self.$$.dirty[0]&/*$markupControlsOpacity*/131072|$$self.$$.dirty[4]&/*shapeControlsPosition*/8){$$invalidate(16,markupControlsStyle=shapeControlsPosition&&\"transform: translate(\".concat(shapeControlsPosition.x,\"px, \").concat(shapeControlsPosition.y,\"px);opacity:\").concat($markupControlsOpacity));}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[2]&/*willRenderShapeControls, enableButtonFlipVertical*/18|$$self.$$.dirty[3]&/*activeShapeId, allowShapeFlip, allowShapeDuplicate, allowShapeRemove*/1879064576|$$self.$$.dirty[4]&/*allowShapeReorder, allowShapeInput*/3){$$invalidate(18,shapeControls=activeShapeId&&willRenderShapeControls([[\"div\",\"alpha\",{\"class\":\"DokaShapeControlsGroup\"},[allowShapeFlip&&[Button,\"flip-horizontal\",{onclick:handleFlipX,label:locale.shapeTitleButtonFlipHorizontal,icon:locale.shapeIconButtonFlipHorizontal,hideLabel:true}],allowShapeFlip&&enableButtonFlipVertical&&[Button,\"flip-vertical\",{onclick:handleFlipY,label:locale.shapeTitleButtonFlipVertical,icon:locale.shapeIconButtonFlipVertical,hideLabel:true}],allowShapeReorder&&[Button,\"to-front\",{onclick:handleMoveToFrontActiveMarkup,label:locale.shapeTitleButtonMoveToFront,icon:locale.shapeIconButtonMoveToFront,hideLabel:true}],allowShapeDuplicate&&[Button,\"duplicate\",{onclick:handleDuplicateActiveMarkup,label:locale.shapeTitleButtonDuplicate,icon:locale.shapeIconButtonDuplicate,hideLabel:true}],allowShapeRemove&&[Button,\"remove\",{onclick:handleRemoveActiveMarkup,label:locale.shapeTitleButtonRemove,icon:locale.shapeIconButtonRemove,hideLabel:true}]]],allowShapeInput&&[\"div\",\"beta\",{\"class\":\"DokaShapeControlsGroup\"},[[Button,\"edit-text\",{label:locale.shapeLabelInputText,onclick:handleEditTextActiveMarkup}]]]],activeShapeId));}if($$self.$$.dirty[0]&/*rootRect*/4){// if view is resized\nif(rootRect){handleViewResize();}}if($$self.$$.dirty[0]&/*markup, locale*/9){$$invalidate(19,shapeNavList=markup.filter(shapeCanSelect).filter(function(shape){return!shapeIsDraft(shape);}).map(function(shape){return{id:shape.id,color:shapeIsText(shape)?shape.color:shapeIsLine(shape)?shape.strokeColor:shape.backgroundColor,name:shape.name||locale[\"shapeLabelTool\".concat(capitalizeFirstLetter(shapeGetDescription(shape)))]};}));}};return[markup,offset,rootRect,locale,selectShape,textInput,shapeControlsSize,showShapeList,allowRotateControls,allowedResizeControls,shouldRenderShapeManipulator,shapeManipulatorPoints,shapeManipulatorRotationPointPosition,shouldRenderTextInput,textInputText,markupTextInputStyle,markupControlsStyle,$markupControlsOpacity,shapeControls,shapeNavList,keysPressedStored,handleWheel,handleInteractionStart,handleInteractionUpdate,handleInteractionRelease,handleInteractionEnd,handleManipulatorResizeGrab,handleManipulatorResizeDrag,handleManipulatorResizeEnd,handleManipulatorRotateGrab,handleManipulatorRotateDrag,handleManipulatorRotateEnd,handleKey,handleTextInput,handleTextInputAttempt,handleTextInputKeyDown,handleTextInputKeyUp,handleTextConfirm,handleTextCancel,markupControlsOpacity,handleNudge,handleFocusIn,handleFocusOut,ui,rotation,scale,opacity,parentRect,stageRect,utilRect,oninteractionstart,oninteractionupdate,oninteractionrelease,oninteractionend,onaddshape,onupdateshape,onselectshape,onremoveshape,beforeSelectShape,beforeDeselectShape,beforeAddShape,beforeRemoveShape,beforeUpdateShape,willRenderShapeControls,mapEditorPointToImagePoint,mapImagePointToEditorPoint,enableButtonFlipVertical,createShape,eraseShape,getMarkupItemDraft,addMarkupItemDraft,confirmMarkupItemDraft,discardMarkupItemDraft,createMarkupItem,syncShapes,addShape,updateMarkupShape,updateMarkupShapeProperty,updateMarkupItemsShapeProperty,updateMarkupShapeItems,getActiveMarkupItem,hasActiveMarkupItem,removeShape,removeActiveMarkupItem,blurShapes,deselectMarkupItem,editMarkupItem,finishEditMarkupItem,removeMarkupItems,getTextShapeRect,getMarkupShapeRect,getShapesAtPosition,getMarkupBetweenPoints,measure_handler,click_handler,textarea_binding,measure_handler_1,interactable_function];}var ShapeLayoutEditor=/*#__PURE__*/function(_SvelteComponent33){_inherits(ShapeLayoutEditor,_SvelteComponent33);var _super35=_createSuper(ShapeLayoutEditor);function ShapeLayoutEditor(options){var _this35;_classCallCheck(this,ShapeLayoutEditor);_this35=_super35.call(this);init(_assertThisInitialized(_this35),options,instance$w,create_fragment$w,safe_not_equal,{markup:0,offset:1,rotation:44,scale:45,ui:43,opacity:46,parentRect:47,rootRect:2,stageRect:48,utilRect:49,oninteractionstart:50,oninteractionupdate:51,oninteractionrelease:52,oninteractionend:53,onaddshape:54,onupdateshape:55,onselectshape:56,onremoveshape:57,beforeSelectShape:58,beforeDeselectShape:59,beforeAddShape:60,beforeRemoveShape:61,beforeUpdateShape:62,willRenderShapeControls:63,mapEditorPointToImagePoint:64,mapImagePointToEditorPoint:65,enableButtonFlipVertical:66,locale:3,createShape:67,eraseShape:68,getMarkupItemDraft:69,addMarkupItemDraft:70,confirmMarkupItemDraft:71,discardMarkupItemDraft:72,createMarkupItem:73,syncShapes:74,addShape:75,updateMarkupShape:76,updateMarkupShapeProperty:77,updateMarkupItemsShapeProperty:78,updateMarkupShapeItems:79,getActiveMarkupItem:80,hasActiveMarkupItem:81,removeShape:82,removeActiveMarkupItem:83,blurShapes:84,selectShape:4,deselectMarkupItem:85,editMarkupItem:86,finishEditMarkupItem:87,removeMarkupItems:88,getTextShapeRect:89,getMarkupShapeRect:90,getShapesAtPosition:91,getMarkupBetweenPoints:92},[-1,-1,-1,-1,-1,-1]);return _this35;}_createClass(ShapeLayoutEditor,[{key:\"createShape\",get:function get(){return this.$$.ctx[67];}},{key:\"eraseShape\",get:function get(){return this.$$.ctx[68];}},{key:\"getMarkupItemDraft\",get:function get(){return this.$$.ctx[69];}},{key:\"addMarkupItemDraft\",get:function get(){return this.$$.ctx[70];}},{key:\"confirmMarkupItemDraft\",get:function get(){return this.$$.ctx[71];}},{key:\"discardMarkupItemDraft\",get:function get(){return this.$$.ctx[72];}},{key:\"createMarkupItem\",get:function get(){return this.$$.ctx[73];}},{key:\"syncShapes\",get:function get(){return this.$$.ctx[74];}},{key:\"addShape\",get:function get(){return this.$$.ctx[75];}},{key:\"updateMarkupShape\",get:function get(){return this.$$.ctx[76];}},{key:\"updateMarkupShapeProperty\",get:function get(){return this.$$.ctx[77];}},{key:\"updateMarkupItemsShapeProperty\",get:function get(){return this.$$.ctx[78];}},{key:\"updateMarkupShapeItems\",get:function get(){return this.$$.ctx[79];}},{key:\"getActiveMarkupItem\",get:function get(){return this.$$.ctx[80];}},{key:\"hasActiveMarkupItem\",get:function get(){return this.$$.ctx[81];}},{key:\"removeShape\",get:function get(){return this.$$.ctx[82];}},{key:\"removeActiveMarkupItem\",get:function get(){return this.$$.ctx[83];}},{key:\"blurShapes\",get:function get(){return this.$$.ctx[84];}},{key:\"selectShape\",get:function get(){return this.$$.ctx[4];}},{key:\"deselectMarkupItem\",get:function get(){return this.$$.ctx[85];}},{key:\"editMarkupItem\",get:function get(){return this.$$.ctx[86];}},{key:\"finishEditMarkupItem\",get:function get(){return this.$$.ctx[87];}},{key:\"removeMarkupItems\",get:function get(){return this.$$.ctx[88];}},{key:\"getTextShapeRect\",get:function get(){return this.$$.ctx[89];}},{key:\"getMarkupShapeRect\",get:function get(){return this.$$.ctx[90];}},{key:\"getShapesAtPosition\",get:function get(){return this.$$.ctx[91];}},{key:\"getMarkupBetweenPoints\",get:function get(){return this.$$.ctx[92];}}]);return ShapeLayoutEditor;}(SvelteComponent);/* src/core/ui/components/ShapeStyleEditor.svelte generated by Svelte v3.29.4 */function get_each_context$7(ctx,list,i){var child_ctx=ctx.slice();child_ctx[10]=list[i];return child_ctx;}// (300:4) {#if activeShapeHash}\nfunction create_if_block$9(ctx){var previous_key=/*activeShapeHash*/ctx[2];var key_block_anchor;var current;var key_block=create_key_block(ctx);return{c:function c(){key_block.c();key_block_anchor=empty();},m:function m(target,anchor){key_block.m(target,anchor);insert(target,key_block_anchor,anchor);current=true;},p:function p(ctx,dirty){if(dirty&/*activeShapeHash*/4&&safe_not_equal(previous_key,previous_key=/*activeShapeHash*/ctx[2])){group_outros();transition_out(key_block,1,1,noop$1);check_outros();key_block=create_key_block(ctx);key_block.c();transition_in(key_block);key_block.m(key_block_anchor.parentNode,key_block_anchor);}else{key_block.p(ctx,dirty);}},i:function i(local){if(current)return;transition_in(key_block);current=true;},o:function o(local){transition_out(key_block);current=false;},d:function d(detaching){if(detaching)detach(key_block_anchor);key_block.d(detaching);}};}// (304:16) {#each activeControls as styleControl (styleControl.id) }\nfunction create_each_block$7(key_1,ctx){var li;var span;var t0_value=localize(/*styleControl*/ctx[10].componentProps.title,/*locale*/ctx[0])+\"\";var t0;var t1;var switch_instance;var t2;var current;var switch_instance_spread_levels=[/*styleControl*/ctx[10].componentProps];var switch_value=/*styleControl*/ctx[10].component;function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}return{props:switch_instance_props};}if(switch_value){switch_instance=new switch_value(switch_props());}return{key:key_1,first:null,c:function c(){li=element(\"li\");span=element(\"span\");t0=text(t0_value);t1=space();if(switch_instance)create_component(switch_instance.$$.fragment);t2=space();attr(span,\"class\",\"DokaShapeStyleLabel\");attr(li,\"class\",\"DokaShapeStyle\");this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,span);append(span,t0);append(li,t1);if(switch_instance){mount_component(switch_instance,li,null);}append(li,t2);current=true;},p:function p(ctx,dirty){if((!current||dirty&/*activeControls, locale*/9)&&t0_value!==(t0_value=localize(/*styleControl*/ctx[10].componentProps.title,/*locale*/ctx[0])+\"\"))set_data(t0,t0_value);var switch_instance_changes=dirty&/*activeControls*/8?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*styleControl*/ctx[10].componentProps)]):{};if(switch_value!==(switch_value=/*styleControl*/ctx[10].component)){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=new switch_value(switch_props());create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,li,t2);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(switch_instance)destroy_component(switch_instance);}};}// (302:8) <Scrollable class=\"DokaShapeStyles\" elasticity={scrollElasticity}>\nfunction create_default_slot$8(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var ul_transition;var current;var each_value=/*activeControls*/ctx[3];var get_key=function get_key(ctx){return(/*styleControl*/ctx[10].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$7(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$7(key,child_ctx));}return{c:function c(){ul=element(\"ul\");for(var _i39=0;_i39<each_blocks.length;_i39+=1){each_blocks[_i39].c();}attr(ul,\"class\",\"DokaShapeStyleList\");},m:function m(target,anchor){insert(target,ul,anchor);for(var _i40=0;_i40<each_blocks.length;_i40+=1){each_blocks[_i40].m(ul,null);}current=true;},p:function p(ctx,dirty){if(dirty&/*activeControls, localize, locale*/9){var _each_value8=/*activeControls*/ctx[3];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value8,each_1_lookup,ul,outro_and_destroy_block,create_each_block$7,null,get_each_context$7);check_outros();}},i:function i(local){if(current)return;for(var _i41=0;_i41<each_value.length;_i41+=1){transition_in(each_blocks[_i41]);}add_render_callback(function(){if(!ul_transition)ul_transition=create_bidirectional_transition(ul,fade,{duration:250},true);ul_transition.run(1);});current=true;},o:function o(local){for(var _i42=0;_i42<each_blocks.length;_i42+=1){transition_out(each_blocks[_i42]);}if(!ul_transition)ul_transition=create_bidirectional_transition(ul,fade,{duration:250},false);ul_transition.run(0);current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i43=0;_i43<each_blocks.length;_i43+=1){each_blocks[_i43].d();}if(detaching&&ul_transition)ul_transition.end();}};}// (301:8) {#key activeShapeHash}\nfunction create_key_block(ctx){var scrollable;var current;scrollable=new Scrollable({props:{\"class\":\"DokaShapeStyles\",elasticity:/*scrollElasticity*/ctx[1],$$slots:{\"default\":[create_default_slot$8]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(scrollable.$$.fragment);},m:function m(target,anchor){mount_component(scrollable,target,anchor);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty&/*scrollElasticity*/2)scrollable_changes.elasticity=/*scrollElasticity*/ctx[1];if(dirty&/*$$scope, activeControls, locale*/8201){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(scrollable,detaching);}};}function create_fragment$x(ctx){var div;var current;var if_block=/*activeShapeHash*/ctx[2]&&create_if_block$9(ctx);return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"class\",\"DokaShapeStyleEditor\");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);current=true;},p:function p(ctx,_ref270){var _ref271=_slicedToArray(_ref270,1),dirty=_ref271[0];if(/*activeShapeHash*/ctx[2]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*activeShapeHash*/4){transition_in(if_block,1);}}else{if_block=create_if_block$9(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}function instance$x($$self,$$props,$$invalidate){var _$$props$controls=$$props.controls,controls=_$$props$controls===void 0?{}:_$$props$controls;var _$$props$shape=$$props.shape,shape=_$$props$shape===void 0?undefined:_$$props$shape;var _onchange=$$props.onchange;var locale=$$props.locale;var scrollElasticity=$$props.scrollElasticity;var getShapeControls=function getShapeControls(shape){var shapeId=shape.id||\"tool\";var activeControls=controlKeys.filter(function(styleKey){return styleKey.split(\"_\").every(function(styleKey){return shape.hasOwnProperty(styleKey)&&shapeCanStyle(shape,styleKey);});}).map(function(styleKey){var styleKeys=styleKey.split(\"_\");var currentValue=styleKeys.length>1?styleKeys.map(function(key){return shape[key];}):shape[styleKey];var _controls$styleKey=_slicedToArray(controls[styleKey],2),component=_controls$styleKey[0],componentProps=_controls$styleKey[1];var options=isFunction(componentProps.options)?componentProps.options(shape):componentProps.options;return{id:\"\".concat(shapeId,\"_\").concat(styleKey),component:component,componentProps:_objectSpread(_objectSpread({},componentProps),{},{// set the options prop\noptions:options,// defaults\nlocale:locale,value:currentValue,optionLabelClass:\"DokaButtonLabel\",onchange:function onchange(detail){var value=isObject(detail)&&!isArray(detail)?detail.value:detail;// allow custom changes\nif(componentProps.onchange)componentProps.onchange(value,shape);// internal change                        \nvar props=styleKeys.length>1?styleKeys.reduce(function(prev,key,index){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},key,Array.isArray(value)?value[index]:value));},{}):_defineProperty({},styleKey,value);_onchange(props);}})};});return activeControls;};// animate\nvar activeShapeHash;var activeShapeHashPrev;$$self.$$set=function($$props){if(\"controls\"in $$props)$$invalidate(4,controls=$$props.controls);if(\"shape\"in $$props)$$invalidate(5,shape=$$props.shape);if(\"onchange\"in $$props)$$invalidate(6,_onchange=$$props.onchange);if(\"locale\"in $$props)$$invalidate(0,locale=$$props.locale);if(\"scrollElasticity\"in $$props)$$invalidate(1,scrollElasticity=$$props.scrollElasticity);};var controlKeys;var activeControls;$$self.$$.update=function(){if($$self.$$.dirty&/*controls*/16){// finds the controls needed to style the selected shape\n$$invalidate(8,controlKeys=Object.keys(controls).filter(function(key){return controls[key];}));}if($$self.$$.dirty&/*shape, controlKeys*/288){$$invalidate(3,activeControls=shape&&controlKeys&&shapeCanStyle(shape)?getShapeControls(shape):[]);}if($$self.$$.dirty&/*shape, activeShapeHashPrev*/160){if(shape){var _hash=Object.keys(shape).join(\"_\");if(_hash!=activeShapeHashPrev){$$invalidate(7,activeShapeHashPrev=_hash);$$invalidate(2,activeShapeHash=_hash);}}}};return[locale,scrollElasticity,activeShapeHash,activeControls,controls,shape,_onchange];}var ShapeStyleEditor=/*#__PURE__*/function(_SvelteComponent34){_inherits(ShapeStyleEditor,_SvelteComponent34);var _super36=_createSuper(ShapeStyleEditor);function ShapeStyleEditor(options){var _this36;_classCallCheck(this,ShapeStyleEditor);_this36=_super36.call(this);init(_assertThisInitialized(_this36),options,instance$x,create_fragment$x,safe_not_equal,{controls:4,shape:5,onchange:6,locale:0,scrollElasticity:1});return _this36;}return ShapeStyleEditor;}(SvelteComponent);/* src/core/ui/components/ShapePresetSelect.svelte generated by Svelte v3.29.4 */function create_if_block_1$a(ctx){var icon;var current;icon=new Icon({props:{width:16,height:16,$$slots:{\"default\":[create_default_slot$9]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty&/*$$scope, locale*/65){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (77:8) <Icon width={16} height={16}>\nfunction create_default_slot$9(ctx){var g;var raw_value=/*locale*/ctx[0].shapeIconButtonSelectSticker+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*locale*/1&&raw_value!==(raw_value=/*locale*/ctx[0].shapeIconButtonSelectSticker+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (79:8) {#if locale.shapeLabelButtonSelectSticker}\nfunction create_if_block$a(ctx){var span;var t_value=/*locale*/ctx[0].shapeLabelButtonSelectSticker+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*locale*/1&&t_value!==(t_value=/*locale*/ctx[0].shapeLabelButtonSelectSticker+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}function create_fragment$y(ctx){var form;var input;var t0;var label;var t1;var current;var mounted;var dispose;var if_block0=/*locale*/ctx[0].shapeIconButtonSelectSticker&&create_if_block_1$a(ctx);var if_block1=/*locale*/ctx[0].shapeLabelButtonSelectSticker&&create_if_block$a(ctx);return{c:function c(){form=element(\"form\");input=element(\"input\");t0=space();label=element(\"label\");if(if_block0)if_block0.c();t1=space();if(if_block1)if_block1.c();attr(input,\"id\",/*name*/ctx[2]);attr(input,\"type\",\"file\");attr(input,\"accept\",\"image/*\");attr(label,\"for\",/*name*/ctx[2]);attr(form,\"class\",\"DokaShapePresetSelect\");},m:function m(target,anchor){insert(target,form,anchor);append(form,input);append(form,t0);append(form,label);if(if_block0)if_block0.m(label,null);append(label,t1);if(if_block1)if_block1.m(label,null);/*form_binding*/ctx[5](form);current=true;if(!mounted){dispose=listen(input,\"input\",/*handleFileInput*/ctx[3]);mounted=true;}},p:function p(ctx,_ref273){var _ref274=_slicedToArray(_ref273,1),dirty=_ref274[0];if(/*locale*/ctx[0].shapeIconButtonSelectSticker){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*locale*/1){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$a(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(label,t1);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*locale*/ctx[0].shapeLabelButtonSelectSticker){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block$a(ctx);if_block1.c();if_block1.m(label,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(form);if(if_block0)if_block0.d();if(if_block1)if_block1.d();/*form_binding*/ctx[5](null);mounted=false;dispose();}};}function instance$y($$self,$$props,$$invalidate){var locale=$$props.locale;var oninput=$$props.oninput;var name=\"doka-preset-select-\".concat(getUniqueId());var formFileInput;var handleFileInput=function handleFileInput(e){// only deal with image files\nArray.from(e.target.files).filter(isImage).forEach(oninput);// reset input when done\nformFileInput.reset();};function form_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){formFileInput=$$value;$$invalidate(1,formFileInput);});}$$self.$$set=function($$props){if(\"locale\"in $$props)$$invalidate(0,locale=$$props.locale);if(\"oninput\"in $$props)$$invalidate(4,oninput=$$props.oninput);};return[locale,formFileInput,name,handleFileInput,oninput,form_binding];}var ShapePresetSelect=/*#__PURE__*/function(_SvelteComponent35){_inherits(ShapePresetSelect,_SvelteComponent35);var _super37=_createSuper(ShapePresetSelect);function ShapePresetSelect(options){var _this37;_classCallCheck(this,ShapePresetSelect);_this37=_super37.call(this);init(_assertThisInitialized(_this37),options,instance$y,create_fragment$y,safe_not_equal,{locale:0,oninput:4});return _this37;}return ShapePresetSelect;}(SvelteComponent);/* src/core/ui/components/DragButton.svelte generated by Svelte v3.29.4 */function create_fragment$z(ctx){var button;var mounted;var dispose;return{c:function c(){button=element(\"button\");attr(button,\"class\",\"DokaDragButton\");attr(button,\"title\",/*title*/ctx[1]);button.disabled=/*disabled*/ctx[2];},m:function m(target,anchor){insert(target,button,anchor);button.innerHTML=/*html*/ctx[0];/*button_binding*/ctx[9](button);if(!mounted){dispose=listen(button,\"pointerdown\",/*handleDown*/ctx[4]);mounted=true;}},p:function p(ctx,_ref275){var _ref276=_slicedToArray(_ref275,1),dirty=_ref276[0];if(dirty&/*html*/1)button.innerHTML=/*html*/ctx[0];if(dirty&/*title*/2){attr(button,\"title\",/*title*/ctx[1]);}if(dirty&/*disabled*/4){button.disabled=/*disabled*/ctx[2];}},i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(button);/*button_binding*/ctx[9](null);mounted=false;dispose();}};}function instance$z($$self,$$props,$$invalidate){var html=$$props.html;var title=$$props.title;var onclick=$$props.onclick;var _$$props$disabled3=$$props.disabled,disabled=_$$props$disabled3===void 0?false:_$$props$disabled3;var _$$props$ongrab=$$props.ongrab,ongrab=_$$props$ongrab===void 0?noop:_$$props$ongrab;var _$$props$ondrag=$$props.ondrag,ondrag=_$$props$ondrag===void 0?noop:_$$props$ondrag;var _$$props$ondrop=$$props.ondrop,ondrop=_$$props$ondrop===void 0?noop:_$$props$ondrop;var element;var isOverButton=function isOverButton(e){return vectorDistanceSquared(downPosition,vectorCreate(e.pageX,e.pageY))<256;};var downPosition;var handleDown=function handleDown(e){downPosition=vectorCreate(e.pageX,e.pageY);ongrab(e);document.documentElement.addEventListener(\"pointermove\",handleMove);document.documentElement.addEventListener(\"pointerup\",handleUp);};var handleUp=function handleUp(e){document.documentElement.removeEventListener(\"pointermove\",handleMove);document.documentElement.removeEventListener(\"pointerup\",handleUp);var upPosition=vectorCreate(e.pageX,e.pageY);// must have moved enough distance to drop\nif(vectorDistanceSquared(downPosition,upPosition)<32)return onclick(e);// cant drop in button\nif(isOverButton(e))return;// was dragging\nondrop(e);};var handleMove=function handleMove(e){// must have moved enough distance from button\nif(isOverButton(e))return;// dragging out of button\nondrag(e);};function button_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){element=$$value;$$invalidate(3,element);});}$$self.$$set=function($$props){if(\"html\"in $$props)$$invalidate(0,html=$$props.html);if(\"title\"in $$props)$$invalidate(1,title=$$props.title);if(\"onclick\"in $$props)$$invalidate(5,onclick=$$props.onclick);if(\"disabled\"in $$props)$$invalidate(2,disabled=$$props.disabled);if(\"ongrab\"in $$props)$$invalidate(6,ongrab=$$props.ongrab);if(\"ondrag\"in $$props)$$invalidate(7,ondrag=$$props.ondrag);if(\"ondrop\"in $$props)$$invalidate(8,ondrop=$$props.ondrop);};return[html,title,disabled,element,handleDown,onclick,ongrab,ondrag,ondrop,button_binding];}var DragButton=/*#__PURE__*/function(_SvelteComponent36){_inherits(DragButton,_SvelteComponent36);var _super38=_createSuper(DragButton);function DragButton(options){var _this38;_classCallCheck(this,DragButton);_this38=_super38.call(this);init(_assertThisInitialized(_this38),options,instance$z,create_fragment$z,safe_not_equal,{html:0,title:1,onclick:5,disabled:2,ongrab:6,ondrag:7,ondrop:8});return _this38;}return DragButton;}(SvelteComponent);/* src/core/ui/components/ShapePresetsList.svelte generated by Svelte v3.29.4 */function get_each_context$8(ctx,list,i){var child_ctx=ctx.slice();child_ctx[14]=list[i];return child_ctx;}// (56:4) {#each presets as preset (preset.id)}\nfunction create_each_block$8(key_1,ctx){var li;var dragbutton;var t;var didMountPresetThumb_action;var current;var mounted;var dispose;function func(){var _ctx14;for(var _len15=arguments.length,args=new Array(_len15),_key18=0;_key18<_len15;_key18++){args[_key18]=arguments[_key18];}return(/*func*/(_ctx14=ctx)[9].apply(_ctx14,[/*preset*/ctx[14]].concat(args)));}function func_1(){var _ctx15;for(var _len16=arguments.length,args=new Array(_len16),_key19=0;_key19<_len16;_key19++){args[_key19]=arguments[_key19];}return(/*func_1*/(_ctx15=ctx)[10].apply(_ctx15,[/*preset*/ctx[14]].concat(args)));}function func_2(){var _ctx16;for(var _len17=arguments.length,args=new Array(_len17),_key20=0;_key20<_len17;_key20++){args[_key20]=arguments[_key20];}return(/*func_2*/(_ctx16=ctx)[11].apply(_ctx16,[/*preset*/ctx[14]].concat(args)));}function func_3(){var _ctx17;for(var _len18=arguments.length,args=new Array(_len18),_key21=0;_key21<_len18;_key21++){args[_key21]=arguments[_key21];}return(/*func_3*/(_ctx17=ctx)[12].apply(_ctx17,[/*preset*/ctx[14]].concat(args)));}dragbutton=new DragButton({props:{onclick:func,ongrab:func_1,ondrag:func_2,ondrop:func_3,disabled:/*disabled*/ctx[1]||/*preset*/ctx[14].disabled,title:/*preset*/ctx[14].title,html:/*preset*/ctx[14].thumb}});return{key:key_1,first:null,c:function c(){li=element(\"li\");create_component(dragbutton.$$.fragment);t=space();attr(li,\"class\",\"DokaShapePreset\");attr(li,\"style\",/*style*/ctx[6]);this.first=li;},m:function m(target,anchor){insert(target,li,anchor);mount_component(dragbutton,li,null);append(li,t);current=true;if(!mounted){dispose=action_destroyer(didMountPresetThumb_action=/*didMountPresetThumb*/ctx[8].call(null,li,/*preset*/ctx[14]));mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var dragbutton_changes={};if(dirty&/*onclickpreset, presets*/5)dragbutton_changes.onclick=func;if(dirty&/*ongrabpreset, presets*/9)dragbutton_changes.ongrab=func_1;if(dirty&/*ondragpreset, presets*/17)dragbutton_changes.ondrag=func_2;if(dirty&/*ondroppreset, presets*/33)dragbutton_changes.ondrop=func_3;if(dirty&/*disabled, presets*/3)dragbutton_changes.disabled=/*disabled*/ctx[1]||/*preset*/ctx[14].disabled;if(dirty&/*presets*/1)dragbutton_changes.title=/*preset*/ctx[14].title;if(dirty&/*presets*/1)dragbutton_changes.html=/*preset*/ctx[14].thumb;dragbutton.$set(dragbutton_changes);if(!current||dirty&/*style*/64){attr(li,\"style\",/*style*/ctx[6]);}if(didMountPresetThumb_action&&is_function(didMountPresetThumb_action.update)&&dirty&/*presets*/1)didMountPresetThumb_action.update.call(null,/*preset*/ctx[14]);},i:function i(local){if(current)return;transition_in(dragbutton.$$.fragment,local);current=true;},o:function o(local){transition_out(dragbutton.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);destroy_component(dragbutton);mounted=false;dispose();}};}function create_fragment$A(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var current;var each_value=/*presets*/ctx[0];var get_key=function get_key(ctx){return(/*preset*/ctx[14].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$8(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$8(key,child_ctx));}return{c:function c(){ul=element(\"ul\");for(var _i44=0;_i44<each_blocks.length;_i44+=1){each_blocks[_i44].c();}attr(ul,\"class\",\"DokaShapePresetsList\");},m:function m(target,anchor){insert(target,ul,anchor);for(var _i45=0;_i45<each_blocks.length;_i45+=1){each_blocks[_i45].m(ul,null);}current=true;},p:function p(ctx,_ref277){var _ref278=_slicedToArray(_ref277,1),dirty=_ref278[0];if(dirty&/*style, presets, onclickpreset, ongrabpreset, ondragpreset, ondroppreset, disabled*/127){var _each_value9=/*presets*/ctx[0];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,_each_value9,each_1_lookup,ul,outro_and_destroy_block,create_each_block$8,null,get_each_context$8);check_outros();}},i:function i(local){if(current)return;for(var _i46=0;_i46<each_value.length;_i46+=1){transition_in(each_blocks[_i46]);}current=true;},o:function o(local){for(var _i47=0;_i47<each_blocks.length;_i47+=1){transition_out(each_blocks[_i47]);}current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i48=0;_i48<each_blocks.length;_i48+=1){each_blocks[_i48].d();}}};}function instance$A($$self,$$props,$$invalidate){var $anim;var presets=$$props.presets;var _$$props$disabled4=$$props.disabled,disabled=_$$props$disabled4===void 0?undefined:_$$props$disabled4;var onclickpreset=$$props.onclickpreset;var ongrabpreset=$$props.ongrabpreset;var ondragpreset=$$props.ondragpreset;var ondroppreset=$$props.ondroppreset;var anim=tweened(0,{duration:300});component_subscribe($$self,anim,function(value){return $$invalidate(13,$anim=value);});var didMountPresetThumb=function didMountPresetThumb(element,item){return item.mount&&item.mount(element.firstChild,item);};onMount(function(){return anim.set(1);});var func=function func(preset){return onclickpreset(preset.id);};var func_1=function func_1(preset,e){return ongrabpreset(preset.id,e);};var func_2=function func_2(preset,e){return ondragpreset(preset.id,e);};var func_3=function func_3(preset,e){return ondroppreset(preset.id,e);};$$self.$$set=function($$props){if(\"presets\"in $$props)$$invalidate(0,presets=$$props.presets);if(\"disabled\"in $$props)$$invalidate(1,disabled=$$props.disabled);if(\"onclickpreset\"in $$props)$$invalidate(2,onclickpreset=$$props.onclickpreset);if(\"ongrabpreset\"in $$props)$$invalidate(3,ongrabpreset=$$props.ongrabpreset);if(\"ondragpreset\"in $$props)$$invalidate(4,ondragpreset=$$props.ondragpreset);if(\"ondroppreset\"in $$props)$$invalidate(5,ondroppreset=$$props.ondroppreset);};var style;$$self.$$.update=function(){if($$self.$$.dirty&/*$anim*/8192){$$invalidate(6,style=\"opacity:\".concat($anim));}};return[presets,disabled,onclickpreset,ongrabpreset,ondragpreset,ondroppreset,style,anim,didMountPresetThumb,func,func_1,func_2,func_3];}var ShapePresetsList=/*#__PURE__*/function(_SvelteComponent37){_inherits(ShapePresetsList,_SvelteComponent37);var _super39=_createSuper(ShapePresetsList);function ShapePresetsList(options){var _this39;_classCallCheck(this,ShapePresetsList);_this39=_super39.call(this);init(_assertThisInitialized(_this39),options,instance$A,create_fragment$A,safe_not_equal,{presets:0,disabled:1,onclickpreset:2,ongrabpreset:3,ondragpreset:4,ondroppreset:5});return _this39;}return ShapePresetsList;}(SvelteComponent);var isSVGMarkup=function isSVGMarkup(str){return /<svg /.test(str);};/* src/core/ui/components/ShapePresetsPalette.svelte generated by Svelte v3.29.4 */function create_if_block_6$3(ctx){var shapepresetselect;var current;shapepresetselect=new ShapePresetSelect({props:{locale:/*locale*/ctx[0],oninput:/*onaddpreset*/ctx[3]}});return{c:function c(){create_component(shapepresetselect.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetselect,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetselect_changes={};if(dirty&/*locale*/1)shapepresetselect_changes.locale=/*locale*/ctx[0];if(dirty&/*onaddpreset*/8)shapepresetselect_changes.oninput=/*onaddpreset*/ctx[3];shapepresetselect.$set(shapepresetselect_changes);},i:function i(local){if(current)return;transition_in(shapepresetselect.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetselect.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetselect,detaching);}};}// (180:4) {#if shouldRenderPresets}\nfunction create_if_block$b(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_1$b,create_else_block$3];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldGroupPresets*/ctx[9])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{c:function c(){if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}// (234:8) {:else}\nfunction create_else_block$3(ctx){var div;var t;var scrollable;var current;var if_block=/*enableSelectImage*/ctx[2]&&create_if_block_5$3(ctx);scrollable=new Scrollable({props:{scrollAutoCancel:/*shouldRenderPresets*/ctx[8],elasticity:/*scrollElasticity*/ctx[1],$$slots:{\"default\":[create_default_slot_4$1]},$$scope:{ctx:ctx}}});return{c:function c(){div=element(\"div\");if(if_block)if_block.c();t=space();create_component(scrollable.$$.fragment);attr(div,\"class\",\"DokaShapePresetsFlat\");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);append(div,t);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){if(/*enableSelectImage*/ctx[2]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*enableSelectImage*/4){transition_in(if_block,1);}}else{if_block=create_if_block_5$3(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}var scrollable_changes={};if(dirty&/*shouldRenderPresets*/256)scrollable_changes.scrollAutoCancel=/*shouldRenderPresets*/ctx[8];if(dirty&/*scrollElasticity*/2)scrollable_changes.elasticity=/*scrollElasticity*/ctx[1];if(dirty&/*$$scope, presetsMapped, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/268435704){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();destroy_component(scrollable);}};}// (183:8) {#if shouldGroupPresets}\nfunction create_if_block_1$b(ctx){var div1;var div0;var t0;var tablist;var t1;var tabpanels;var current;var if_block=/*enableSelectImage*/ctx[2]&&create_if_block_4$4(ctx);var tablist_spread_levels=[{\"class\":\"DokaControlList\"},{tabs:/*tabs*/ctx[10]},/*tabsConfig*/ctx[13],{layout:\"compact\"}];var tablist_props={$$slots:{\"default\":[create_default_slot_2$5,function(_ref279){var tab=_ref279.tab;return{27:tab};},function(_ref280){var tab=_ref280.tab;return tab?134217728:0;}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on(\"select\",/*select_handler*/ctx[16]);var tabpanels_spread_levels=[{\"class\":\"DokaControlPanels\"},{panelClass:\"DokaControlPanel\"},{panels:/*panels*/ctx[14]},/*tabsConfig*/ctx[13]];var tabpanels_props={$$slots:{\"default\":[create_default_slot$a,function(_ref281){var panel=_ref281.panel,panelIsActive=_ref281.panelIsActive;return{25:panel,26:panelIsActive};},function(_ref282){var panel=_ref282.panel,panelIsActive=_ref282.panelIsActive;return(panel?33554432:0)|(panelIsActive?67108864:0);}]},$$scope:{ctx:ctx}};for(var _i49=0;_i49<tabpanels_spread_levels.length;_i49+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[_i49]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){div1=element(\"div\");div0=element(\"div\");if(if_block)if_block.c();t0=space();create_component(tablist.$$.fragment);t1=space();create_component(tabpanels.$$.fragment);attr(div0,\"class\",\"DokaShapePresetsGroups\");attr(div1,\"class\",\"DokaShapePresetsGrouped\");},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(if_block)if_block.m(div0,null);append(div0,t0);mount_component(tablist,div0,null);append(div1,t1);mount_component(tabpanels,div1,null);current=true;},p:function p(ctx,dirty){if(/*enableSelectImage*/ctx[2]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*enableSelectImage*/4){transition_in(if_block,1);}}else{if_block=create_if_block_4$4(ctx);if_block.c();transition_in(if_block,1);if_block.m(div0,t0);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}var tablist_changes=dirty&/*tabs, tabsConfig*/9216?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty&/*tabs*/1024&&{tabs:/*tabs*/ctx[10]},dirty&/*tabsConfig*/8192&&get_spread_object(/*tabsConfig*/ctx[13]),tablist_spread_levels[3]]):{};if(dirty&/*$$scope, tab*/402653184){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);var tabpanels_changes=dirty&/*panels, tabsConfig*/24576?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty&/*panels*/16384&&{panels:/*panels*/ctx[14]},dirty&/*tabsConfig*/8192&&get_spread_object(/*tabsConfig*/ctx[13])]):{};if(dirty&/*$$scope, panelIsActive, shouldRenderPresets, scrollElasticity, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/369101178){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(tablist.$$.fragment,local);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(tablist.$$.fragment,local);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(if_block)if_block.d();destroy_component(tablist);destroy_component(tabpanels);}};}// (238:12) {#if enableSelectImage}\nfunction create_if_block_5$3(ctx){var shapepresetselect;var current;shapepresetselect=new ShapePresetSelect({props:{locale:/*locale*/ctx[0],oninput:/*onaddpreset*/ctx[3]}});return{c:function c(){create_component(shapepresetselect.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetselect,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetselect_changes={};if(dirty&/*locale*/1)shapepresetselect_changes.locale=/*locale*/ctx[0];if(dirty&/*onaddpreset*/8)shapepresetselect_changes.oninput=/*onaddpreset*/ctx[3];shapepresetselect.$set(shapepresetselect_changes);},i:function i(local){if(current)return;transition_in(shapepresetselect.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetselect.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetselect,detaching);}};}// (241:12) <Scrollable scrollAutoCancel={shouldRenderPresets} elasticity={scrollElasticity}>\nfunction create_default_slot_4$1(ctx){var shapepresetslist;var current;shapepresetslist=new ShapePresetsList({props:{presets:/*presetsMapped*/ctx[7],onclickpreset:/*onaddpreset*/ctx[3],ongrabpreset:/*ongrabpreset*/ctx[4],ondragpreset:/*ondragpreset*/ctx[5],ondroppreset:/*ondroppreset*/ctx[6]}});return{c:function c(){create_component(shapepresetslist.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetslist,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetslist_changes={};if(dirty&/*presetsMapped*/128)shapepresetslist_changes.presets=/*presetsMapped*/ctx[7];if(dirty&/*onaddpreset*/8)shapepresetslist_changes.onclickpreset=/*onaddpreset*/ctx[3];if(dirty&/*ongrabpreset*/16)shapepresetslist_changes.ongrabpreset=/*ongrabpreset*/ctx[4];if(dirty&/*ondragpreset*/32)shapepresetslist_changes.ondragpreset=/*ondragpreset*/ctx[5];if(dirty&/*ondroppreset*/64)shapepresetslist_changes.ondroppreset=/*ondroppreset*/ctx[6];shapepresetslist.$set(shapepresetslist_changes);},i:function i(local){if(current)return;transition_in(shapepresetslist.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetslist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetslist,detaching);}};}// (188:20) {#if enableSelectImage}\nfunction create_if_block_4$4(ctx){var shapepresetselect;var current;shapepresetselect=new ShapePresetSelect({props:{locale:/*locale*/ctx[0],oninput:/*onaddpreset*/ctx[3]}});return{c:function c(){create_component(shapepresetselect.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetselect,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetselect_changes={};if(dirty&/*locale*/1)shapepresetselect_changes.locale=/*locale*/ctx[0];if(dirty&/*onaddpreset*/8)shapepresetselect_changes.oninput=/*onaddpreset*/ctx[3];shapepresetselect.$set(shapepresetselect_changes);},i:function i(local){if(current)return;transition_in(shapepresetselect.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetselect.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetselect,detaching);}};}// (196:24) {#if tab.icon }\nfunction create_if_block_3$4(ctx){var icon;var current;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_3$5]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty&/*$$scope, tab*/402653184){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (197:24) <Icon>\nfunction create_default_slot_3$5(ctx){var g;var raw_value=/*tab*/ctx[27].icon+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*tab*/134217728&&raw_value!==(raw_value=/*tab*/ctx[27].icon+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (199:24) {#if !tab.hideLabel}\nfunction create_if_block_2$7(ctx){var span;var t_value=/*tab*/ctx[27].label+\"\";var t;return{c:function c(){span=element(\"span\");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*tab*/134217728&&t_value!==(t_value=/*tab*/ctx[27].label+\"\"))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (192:20) <TabList class=\"DokaControlList\"                          {tabs} {...tabsConfig}                          layout=\"compact\"                         on:select={({ detail }) => tabSelected = detail} let:tab={tab}>\nfunction create_default_slot_2$5(ctx){var t;var if_block1_anchor;var current;var if_block0=/*tab*/ctx[27].icon&&create_if_block_3$4(ctx);var if_block1=!/*tab*/ctx[27].hideLabel&&create_if_block_2$7(ctx);return{c:function c(){if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*tab*/ctx[27].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*tab*/134217728){transition_in(if_block0,1);}}else{if_block0=create_if_block_3$4(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*tab*/ctx[27].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_2$7(ctx);if_block1.c();if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (214:16) <Scrollable                      scroll={panelIsActive ? { scrollOffset: 0, animate: false } : undefined}                     scrollAutoCancel={shouldRenderPresets}                      elasticity={scrollElasticity}>\nfunction create_default_slot_1$7(ctx){var shapepresetslist;var current;shapepresetslist=new ShapePresetsList({props:{presets:/*presetTabs*/ctx[11][/*panel*/ctx[25]].items,disabled:/*presetTabs*/ctx[11][/*panel*/ctx[25]].disabled,onclickpreset:/*onaddpreset*/ctx[3],ongrabpreset:/*ongrabpreset*/ctx[4],ondragpreset:/*ondragpreset*/ctx[5],ondroppreset:/*ondroppreset*/ctx[6]}});return{c:function c(){create_component(shapepresetslist.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetslist,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetslist_changes={};if(dirty&/*presetTabs, panel*/33556480)shapepresetslist_changes.presets=/*presetTabs*/ctx[11][/*panel*/ctx[25]].items;if(dirty&/*presetTabs, panel*/33556480)shapepresetslist_changes.disabled=/*presetTabs*/ctx[11][/*panel*/ctx[25]].disabled;if(dirty&/*onaddpreset*/8)shapepresetslist_changes.onclickpreset=/*onaddpreset*/ctx[3];if(dirty&/*ongrabpreset*/16)shapepresetslist_changes.ongrabpreset=/*ongrabpreset*/ctx[4];if(dirty&/*ondragpreset*/32)shapepresetslist_changes.ondragpreset=/*ondragpreset*/ctx[5];if(dirty&/*ondroppreset*/64)shapepresetslist_changes.ondroppreset=/*ondroppreset*/ctx[6];shapepresetslist.$set(shapepresetslist_changes);},i:function i(local){if(current)return;transition_in(shapepresetslist.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetslist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetslist,detaching);}};}// (206:12) <TabPanels                  class=\"DokaControlPanels\"                  panelClass=\"DokaControlPanel\"                  {panels}                  {...tabsConfig}                  let:panel                  let:panelIsActive>\nfunction create_default_slot$a(ctx){var scrollable;var current;scrollable=new Scrollable({props:{scroll:/*panelIsActive*/ctx[26]?{scrollOffset:0,animate:false}:undefined,scrollAutoCancel:/*shouldRenderPresets*/ctx[8],elasticity:/*scrollElasticity*/ctx[1],$$slots:{\"default\":[create_default_slot_1$7]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(scrollable.$$.fragment);},m:function m(target,anchor){mount_component(scrollable,target,anchor);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty&/*panelIsActive*/67108864)scrollable_changes.scroll=/*panelIsActive*/ctx[26]?{scrollOffset:0,animate:false}:undefined;if(dirty&/*shouldRenderPresets*/256)scrollable_changes.scrollAutoCancel=/*shouldRenderPresets*/ctx[8];if(dirty&/*scrollElasticity*/2)scrollable_changes.elasticity=/*scrollElasticity*/ctx[1];if(dirty&/*$$scope, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/301992056){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(scrollable,detaching);}};}function create_fragment$B(ctx){var div;var current_block_type_index;var if_block;var current;var if_block_creators=[create_if_block$b,create_if_block_6$3];var if_blocks=[];function select_block_type(ctx,dirty){if(/*shouldRenderPresets*/ctx[8])return 0;if(/*enableSelectImage*/ctx[2])return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"class\",\"DokaShapePresetsPalette\");},m:function m(target,anchor){insert(target,div,anchor);if(~current_block_type_index){if_blocks[current_block_type_index].m(div,null);}current=true;},p:function p(ctx,_ref283){var _ref284=_slicedToArray(_ref283,1),dirty=_ref284[0];var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(div,null);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}function instance$B($$self,$$props,$$invalidate){var locale=$$props.locale;var presets=$$props.presets;var scrollElasticity=$$props.scrollElasticity;var _$$props$enableSelect=$$props.enableSelectImage,enableSelectImage=_$$props$enableSelect===void 0?true:_$$props$enableSelect;var _$$props$onaddpreset=$$props.onaddpreset,onaddpreset=_$$props$onaddpreset===void 0?noop:_$$props$onaddpreset;var _$$props$ongrabpreset=$$props.ongrabpreset,ongrabpreset=_$$props$ongrabpreset===void 0?noop:_$$props$ongrabpreset;var _$$props$ondragpreset=$$props.ondragpreset,ondragpreset=_$$props$ondragpreset===void 0?noop:_$$props$ondragpreset;var _$$props$ondroppreset=$$props.ondroppreset,ondroppreset=_$$props$ondroppreset===void 0?noop:_$$props$ondroppreset;var uid=\"doka-presets-\".concat(getUniqueId());var isPresetGroup=function isPresetGroup(item){return isArray(item)&&isString(item[0])&&isArray(item[1]);};var getPresetThumb=function getPresetThumb(value){var alt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";// could be svg\nif(isSVGMarkup(value))return value;// test if is emoji\nif(isEmoji(value))return getEmojiSVG(value,alt);// must be URL\nreturn\"<img src=\\\"\".concat(value,\"\\\" alt=\\\"\").concat(alt,\"\\\"/>\");};var getAltFromSrc=function getAltFromSrc(src){return getFilenameWithoutExtension(getFilenameFromURL(src));};var excludedStickerItemProps=[\"src\",\"alt\",\"thumb\",\"shape\",\"id\",\"mount\",\"disabled\"];var mapPreset=function mapPreset(item){var id=item;var src;var shape;var shapeProps;var thumb;var alt;var mount;var disabled;// if item is a string, it's either an emoji or a URL\nif(isString(item)){// is emoji\nif(isEmoji(item)){src=item;alt=item;thumb=getPresetThumb(src,alt);}else// must be URL\n{src=item;alt=getAltFromSrc(src);thumb=getPresetThumb(src,alt);}}else{// set custom thumbnail if defined\nsrc=item.src;alt=item.alt||(isString(src)?getAltFromSrc(src):isString(item.thumb)?getAltFromSrc(item.thumb):undefined);thumb=getPresetThumb(item.thumb||src,alt);shape=item.shape;mount=item.mount;disabled=item.disabled;shapeProps=Object.keys(item).reduce(function(prev,curr){if(excludedStickerItemProps.includes(curr))return prev;prev[curr]=item[curr];return prev;},{});}return{id:id,src:src,thumb:thumb,shape:shape,shapeProps:shapeProps,alt:alt,title:alt,mount:mount,disabled:disabled};};var mapPresets=function mapPresets(items){return items.map(function(item){if(isPresetGroup(item)){return _objectSpread(_objectSpread({},item[2]),{},{id:\"\".concat(uid,\"-\").concat(item[0].toLowerCase()),label:item[0],items:mapPresets(item[1])});}return mapPreset(item);});};var select_handler=function select_handler(_ref285){var detail=_ref285.detail;return $$invalidate(12,tabSelected=detail);};$$self.$$set=function($$props){if(\"locale\"in $$props)$$invalidate(0,locale=$$props.locale);if(\"presets\"in $$props)$$invalidate(15,presets=$$props.presets);if(\"scrollElasticity\"in $$props)$$invalidate(1,scrollElasticity=$$props.scrollElasticity);if(\"enableSelectImage\"in $$props)$$invalidate(2,enableSelectImage=$$props.enableSelectImage);if(\"onaddpreset\"in $$props)$$invalidate(3,onaddpreset=$$props.onaddpreset);if(\"ongrabpreset\"in $$props)$$invalidate(4,ongrabpreset=$$props.ongrabpreset);if(\"ondragpreset\"in $$props)$$invalidate(5,ondragpreset=$$props.ondragpreset);if(\"ondroppreset\"in $$props)$$invalidate(6,ondroppreset=$$props.ondroppreset);};var presetsMapped;var shouldRenderPresets;var shouldGroupPresets;var tabs;var presetTabs;var tabSelected;var tabsConfig;var panels;$$self.$$.update=function(){if($$self.$$.dirty&/*presets*/32768){$$invalidate(7,presetsMapped=mapPresets(presets));}if($$self.$$.dirty&/*presetsMapped*/128){// const handlePresetClick = (preset, e) => onaddpreset(preset);\n// const handlePresetGrab = (preset, e) => ongrabpreset(preset, e);\n// const handlePresetDrag = (preset, e) => ondragpreset(preset, e);\n// const handlePresetDrop = (preset, e) => ondroppreset(preset, e);\n//\n// handle file input\n//\n$$invalidate(8,shouldRenderPresets=presetsMapped.length);}if($$self.$$.dirty&/*shouldRenderPresets, presetsMapped*/384){$$invalidate(9,shouldGroupPresets=shouldRenderPresets&&presetsMapped.some(function(preset){return!!preset.items;}));}if($$self.$$.dirty&/*shouldGroupPresets, presetsMapped*/640){$$invalidate(10,tabs=shouldGroupPresets&&presetsMapped);}if($$self.$$.dirty&/*shouldGroupPresets, presetsMapped*/640){$$invalidate(11,presetTabs=shouldGroupPresets&&presetsMapped.reduce(function(prev,curr){prev[curr.id]=curr;return prev;},{}));}if($$self.$$.dirty&/*tabSelected, tabs*/5120){$$invalidate(12,tabSelected=tabSelected||tabs&&(tabs.find(function(tab){return!tab.disabled;})||{}).id);}if($$self.$$.dirty&/*tabSelected*/4096){$$invalidate(13,tabsConfig={name:uid,selected:tabSelected});}if($$self.$$.dirty&/*tabs*/1024){$$invalidate(14,panels=tabs&&tabs.map(function(tab){return tab.id;}));}};return[locale,scrollElasticity,enableSelectImage,onaddpreset,ongrabpreset,ondragpreset,ondroppreset,presetsMapped,shouldRenderPresets,shouldGroupPresets,tabs,presetTabs,tabSelected,tabsConfig,panels,presets,select_handler];}var ShapePresetsPalette=/*#__PURE__*/function(_SvelteComponent38){_inherits(ShapePresetsPalette,_SvelteComponent38);var _super40=_createSuper(ShapePresetsPalette);function ShapePresetsPalette(options){var _this40;_classCallCheck(this,ShapePresetsPalette);_this40=_super40.call(this);init(_assertThisInitialized(_this40),options,instance$B,create_fragment$B,safe_not_equal,{locale:0,presets:15,scrollElasticity:1,enableSelectImage:2,onaddpreset:3,ongrabpreset:4,ondragpreset:5,ondroppreset:6});return _this40;}return ShapePresetsPalette;}(SvelteComponent);var createPingDispatcher=function createPingDispatcher(node){return function(type,data){node.dispatchEvent(new CustomEvent('ping',{detail:{type:type,data:data},cancelable:true,bubbles:true}));};};/* src/core/ui/components/ShapeUtil.svelte generated by Svelte v3.29.4 */function create_if_block_4$5(ctx){var shapelayouteditor;var updating_markup;var updating_ui;var current;var shapelayouteditor_spread_levels=[{locale:/*locale*/ctx[4]},{parentRect:/*$parentRect*/ctx[27]},{rootRect:/*$rootRect*/ctx[18]},{stageRect:/*$stageRect*/ctx[22]},{utilRect:/*$utilRect*/ctx[21]},{offset:/*markupOffset*/ctx[20]},{scale:/*$presentationScalar*/ctx[32]},{rotation:/*imageRotation*/ctx[12]},{opacity:/*$isActiveFraction*/ctx[26]},{enableButtonFlipVertical:/*enableButtonFlipVertical*/ctx[7]},{mapEditorPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[10]},{mapImagePointToEditorPoint:/*mapImagePointToScreenPoint*/ctx[11]},{oninteractionstart:/*handleInteractionStart*/ctx[41]},{oninteractionupdate:/*handleInteractionUpdate*/ctx[42]},{oninteractionrelease:/*handleInteractionRelease*/ctx[43]},{oninteractionend:/*handleInteractionEnd*/ctx[44]},{onaddshape:/*func*/ctx[59]},{onselectshape:/*func_1*/ctx[60]},{onupdateshape:/*func_2*/ctx[61]},{onremoveshape:/*func_3*/ctx[62]},/*hooks*/ctx[14]];function shapelayouteditor_markup_binding(value){/*shapelayouteditor_markup_binding*/ctx[64].call(null,value);}function shapelayouteditor_ui_binding(value){/*shapelayouteditor_ui_binding*/ctx[65].call(null,value);}var shapelayouteditor_props={};for(var i=0;i<shapelayouteditor_spread_levels.length;i+=1){shapelayouteditor_props=assign(shapelayouteditor_props,shapelayouteditor_spread_levels[i]);}if(/*$shapes*/ctx[23]!==void 0){shapelayouteditor_props.markup=/*$shapes*/ctx[23];}if(/*$imageOverlayMarkup*/ctx[31]!==void 0){shapelayouteditor_props.ui=/*$imageOverlayMarkup*/ctx[31];}shapelayouteditor=new ShapeLayoutEditor({props:shapelayouteditor_props});/*shapelayouteditor_binding*/ctx[63](shapelayouteditor);binding_callbacks.push(function(){return bind(shapelayouteditor,\"markup\",shapelayouteditor_markup_binding);});binding_callbacks.push(function(){return bind(shapelayouteditor,\"ui\",shapelayouteditor_ui_binding);});shapelayouteditor.$on(\"measure\",/*measure_handler_1*/ctx[66]);return{c:function c(){create_component(shapelayouteditor.$$.fragment);},m:function m(target,anchor){mount_component(shapelayouteditor,target,anchor);current=true;},p:function p(ctx,dirty){var shapelayouteditor_changes=dirty[0]&/*locale, $parentRect, $rootRect, $stageRect, $utilRect, markupOffset, imageRotation, $isActiveFraction, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, ping, hooks*/477387920|dirty[1]&/*$presentationScalar, handleInteractionStart, handleInteractionUpdate, handleInteractionRelease, handleInteractionEnd, handleMarkupUpdate*/1063938?get_spread_update(shapelayouteditor_spread_levels,[dirty[0]&/*locale*/16&&{locale:/*locale*/ctx[4]},dirty[0]&/*$parentRect*/134217728&&{parentRect:/*$parentRect*/ctx[27]},dirty[0]&/*$rootRect*/262144&&{rootRect:/*$rootRect*/ctx[18]},dirty[0]&/*$stageRect*/4194304&&{stageRect:/*$stageRect*/ctx[22]},dirty[0]&/*$utilRect*/2097152&&{utilRect:/*$utilRect*/ctx[21]},dirty[0]&/*markupOffset*/1048576&&{offset:/*markupOffset*/ctx[20]},dirty[1]&/*$presentationScalar*/2&&{scale:/*$presentationScalar*/ctx[32]},dirty[0]&/*imageRotation*/4096&&{rotation:/*imageRotation*/ctx[12]},dirty[0]&/*$isActiveFraction*/67108864&&{opacity:/*$isActiveFraction*/ctx[26]},dirty[0]&/*enableButtonFlipVertical*/128&&{enableButtonFlipVertical:/*enableButtonFlipVertical*/ctx[7]},dirty[0]&/*mapScreenPointToImagePoint*/1024&&{mapEditorPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[10]},dirty[0]&/*mapImagePointToScreenPoint*/2048&&{mapImagePointToEditorPoint:/*mapImagePointToScreenPoint*/ctx[11]},dirty[1]&/*handleInteractionStart*/1024&&{oninteractionstart:/*handleInteractionStart*/ctx[41]},dirty[1]&/*handleInteractionUpdate*/2048&&{oninteractionupdate:/*handleInteractionUpdate*/ctx[42]},dirty[1]&/*handleInteractionRelease*/4096&&{oninteractionrelease:/*handleInteractionRelease*/ctx[43]},dirty[1]&/*handleInteractionEnd*/8192&&{oninteractionend:/*handleInteractionEnd*/ctx[44]},dirty[0]&/*ping*/268435456|dirty[1]&/*handleMarkupUpdate*/1048576&&{onaddshape:/*func*/ctx[59]},dirty[0]&/*ping*/268435456&&{onselectshape:/*func_1*/ctx[60]},dirty[0]&/*ping*/268435456|dirty[1]&/*handleMarkupUpdate*/1048576&&{onupdateshape:/*func_2*/ctx[61]},dirty[0]&/*ping*/268435456|dirty[1]&/*handleMarkupUpdate*/1048576&&{onremoveshape:/*func_3*/ctx[62]},dirty[0]&/*hooks*/16384&&get_spread_object(/*hooks*/ctx[14])]):{};if(!updating_markup&&dirty[0]&/*$shapes*/8388608){updating_markup=true;shapelayouteditor_changes.markup=/*$shapes*/ctx[23];add_flush_callback(function(){return updating_markup=false;});}if(!updating_ui&&dirty[1]&/*$imageOverlayMarkup*/1){updating_ui=true;shapelayouteditor_changes.ui=/*$imageOverlayMarkup*/ctx[31];add_flush_callback(function(){return updating_ui=false;});}shapelayouteditor.$set(shapelayouteditor_changes);},i:function i(local){if(current)return;transition_in(shapelayouteditor.$$.fragment,local);current=true;},o:function o(local){transition_out(shapelayouteditor.$$.fragment,local);current=false;},d:function d(detaching){/*shapelayouteditor_binding*/ctx[63](null);destroy_component(shapelayouteditor,detaching);}};}// (376:4) <div bind:this={pingHub} slot=\"main\" style=\"cursor: crosshair\" use:dropable on:dropfiles={handleDropFiles}>\nfunction create_main_slot$1(ctx){var div;var dropable_action;var current;var mounted;var dispose;var if_block=/*shouldRenderShapeEditor*/ctx[19]&&create_if_block_4$5(ctx);return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"slot\",\"main\");set_style(div,\"cursor\",\"crosshair\");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);/*div_binding*/ctx[67](div);current=true;if(!mounted){dispose=[action_destroyer(dropable_action=dropable.call(null,div)),listen(div,\"dropfiles\",/*handleDropFiles*/ctx[50])];mounted=true;}},p:function p(ctx,dirty){if(/*shouldRenderShapeEditor*/ctx[19]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*shouldRenderShapeEditor*/524288){transition_in(if_block,1);}}else{if_block=create_if_block_4$5(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();/*div_binding*/ctx[67](null);mounted=false;run_all(dispose);}};}// (463:38) \nfunction create_if_block_3$5(ctx){var shapepresetspalette;var current;shapepresetspalette=new ShapePresetsPalette({props:{locale:/*locale*/ctx[4],presets:/*shapePresets*/ctx[9],enableSelectImage:/*enablePresetSelectImage*/ctx[8],onaddpreset:/*handleAddPreset*/ctx[49],ongrabpreset:/*handleGrabPreset*/ctx[46],ondragpreset:/*handleDragPreset*/ctx[47],ondroppreset:/*handleDropPreset*/ctx[48],scrollElasticity:/*computedScrollElasticity*/ctx[29]}});return{c:function c(){create_component(shapepresetspalette.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetspalette,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetspalette_changes={};if(dirty[0]&/*locale*/16)shapepresetspalette_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*shapePresets*/512)shapepresetspalette_changes.presets=/*shapePresets*/ctx[9];if(dirty[0]&/*enablePresetSelectImage*/256)shapepresetspalette_changes.enableSelectImage=/*enablePresetSelectImage*/ctx[8];if(dirty[0]&/*computedScrollElasticity*/536870912)shapepresetspalette_changes.scrollElasticity=/*computedScrollElasticity*/ctx[29];shapepresetspalette.$set(shapepresetspalette_changes);},i:function i(local){if(current)return;transition_in(shapepresetspalette.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetspalette.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetspalette,detaching);}};}// (419:8) {#if toolsFiltered.length}\nfunction create_if_block$c(ctx){var div;var current_block_type_index;var if_block;var t;var scrollable;var current;var if_block_creators=[create_if_block_2$8,create_else_block$4];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldRenderPresets*/ctx[25])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);scrollable=new Scrollable({props:{\"class\":\"DokaControlListScroller\",elasticity:/*computedScrollElasticity*/ctx[29],$$slots:{\"default\":[create_default_slot_1$8]},$$scope:{ctx:ctx}}});return{c:function c(){div=element(\"div\");if_block.c();t=space();create_component(scrollable.$$.fragment);attr(div,\"class\",\"DokaControlPanels\");},m:function m(target,anchor){insert(target,div,anchor);if_blocks[current_block_type_index].m(div,null);insert(target,t,anchor);mount_component(scrollable,target,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(div,null);}var scrollable_changes={};if(dirty[0]&/*computedScrollElasticity*/536870912)scrollable_changes.elasticity=/*computedScrollElasticity*/ctx[29];if(dirty[0]&/*locale, toolsFiltered, toolActive*/131089|dirty[2]&/*$$scope*/268435456){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);if_blocks[current_block_type_index].d();if(detaching)detach(t);destroy_component(scrollable,detaching);}};}// (433:16) {:else}\nfunction create_else_block$4(ctx){var div;var shapestyleeditor;var current;shapestyleeditor=new ShapeStyleEditor({props:{locale:/*locale*/ctx[4],shape:/*markupShapeSelected*/ctx[24],onchange:/*handleUpdateSelectedMarkupShape*/ctx[45],controls:/*shapeControls*/ctx[6],scrollElasticity:/*computedScrollElasticity*/ctx[29]}});return{c:function c(){div=element(\"div\");create_component(shapestyleeditor.$$.fragment);attr(div,\"class\",\"DokaControlPanel\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(shapestyleeditor,div,null);current=true;},p:function p(ctx,dirty){var shapestyleeditor_changes={};if(dirty[0]&/*locale*/16)shapestyleeditor_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*markupShapeSelected*/16777216)shapestyleeditor_changes.shape=/*markupShapeSelected*/ctx[24];if(dirty[0]&/*shapeControls*/64)shapestyleeditor_changes.controls=/*shapeControls*/ctx[6];if(dirty[0]&/*computedScrollElasticity*/536870912)shapestyleeditor_changes.scrollElasticity=/*computedScrollElasticity*/ctx[29];shapestyleeditor.$set(shapestyleeditor_changes);},i:function i(local){if(current)return;transition_in(shapestyleeditor.$$.fragment,local);current=true;},o:function o(local){transition_out(shapestyleeditor.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(shapestyleeditor);}};}// (422:16) {#if shouldRenderPresets}\nfunction create_if_block_2$8(ctx){var div;var shapepresetspalette;var current;shapepresetspalette=new ShapePresetsPalette({props:{locale:/*locale*/ctx[4],presets:/*shapePresets*/ctx[9],enableSelectImage:/*enablePresetSelectImage*/ctx[8],onaddpreset:/*handleAddPreset*/ctx[49],ongrabpreset:/*handleGrabPreset*/ctx[46],ondragpreset:/*handleDragPreset*/ctx[47],ondroppreset:/*handleDropPreset*/ctx[48],scrollElasticity:/*computedScrollElasticity*/ctx[29]}});return{c:function c(){div=element(\"div\");create_component(shapepresetspalette.$$.fragment);attr(div,\"class\",\"DokaControlPanel\");},m:function m(target,anchor){insert(target,div,anchor);mount_component(shapepresetspalette,div,null);current=true;},p:function p(ctx,dirty){var shapepresetspalette_changes={};if(dirty[0]&/*locale*/16)shapepresetspalette_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*shapePresets*/512)shapepresetspalette_changes.presets=/*shapePresets*/ctx[9];if(dirty[0]&/*enablePresetSelectImage*/256)shapepresetspalette_changes.enableSelectImage=/*enablePresetSelectImage*/ctx[8];if(dirty[0]&/*computedScrollElasticity*/536870912)shapepresetspalette_changes.scrollElasticity=/*computedScrollElasticity*/ctx[29];shapepresetspalette.$set(shapepresetspalette_changes);},i:function i(local){if(current)return;transition_in(shapepresetspalette.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetspalette.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(shapepresetspalette);}};}// (455:24) {#if option.icon}\nfunction create_if_block_1$c(ctx){var icon;var current;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_3$6]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*locale*/16|dirty[2]&/*$$scope, option*/402653184){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (456:24) <Icon>\nfunction create_default_slot_3$6(ctx){var g;var raw_value=(isFunction(/*option*/ctx[89].icon)?/*option*/ctx[89].icon(/*locale*/ctx[4]):/*option*/ctx[89].icon)+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*locale*/16|dirty[2]&/*option*/134217728&&raw_value!==(raw_value=(isFunction(/*option*/ctx[89].icon)?/*option*/ctx[89].icon(/*locale*/ctx[4]):/*option*/ctx[89].icon)+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (454:20) <div slot=\"option\">\nfunction create_option_slot$3(ctx){var div;var t0;var span;var t1_value=(isFunction(/*option*/ctx[89].label)?/*option*/ctx[89].label(/*locale*/ctx[4]):/*option*/ctx[89].label)+\"\";var t1;var current;var if_block=/*option*/ctx[89].icon&&create_if_block_1$c(ctx);return{c:function c(){div=element(\"div\");if(if_block)if_block.c();t0=space();span=element(\"span\");t1=text(t1_value);attr(div,\"slot\",\"option\");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);append(div,t0);append(div,span);append(span,t1);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[89].icon){if(if_block){if_block.p(ctx,dirty);if(dirty[2]&/*option*/134217728){transition_in(if_block,1);}}else{if_block=create_if_block_1$c(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,t0);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if((!current||dirty[0]&/*locale*/16|dirty[2]&/*option*/134217728)&&t1_value!==(t1_value=(isFunction(/*option*/ctx[89].label)?/*option*/ctx[89].label(/*locale*/ctx[4]):/*option*/ctx[89].label)+\"\"))set_data(t1,t1_value);},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}// (444:12) <Scrollable class=\"DokaControlListScroller\" elasticity={computedScrollElasticity}>\nfunction create_default_slot_1$8(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[4],\"class\":\"DokaControlList\",optionClass:\"DokaControlListOption\",layout:\"row\",options:/*toolsFiltered*/ctx[17],selectedIndex:/*toolsFiltered*/ctx[17].findIndex(/*func_4*/ctx[68]),onchange:/*updateActiveTool*/ctx[40],$$slots:{option:[create_option_slot$3,function(_ref286){var option=_ref286.option;return{89:option};},function(_ref287){var option=_ref287.option;return[0,0,option?134217728:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/16)radiogroup_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*toolsFiltered*/131072)radiogroup_changes.options=/*toolsFiltered*/ctx[17];if(dirty[0]&/*toolsFiltered, toolActive*/131073)radiogroup_changes.selectedIndex=/*toolsFiltered*/ctx[17].findIndex(/*func_4*/ctx[68]);if(dirty[0]&/*locale*/16|dirty[2]&/*$$scope, option*/402653184){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (417:4) <div slot=\"footer\" style={footerStyle}>\nfunction create_footer_slot$3(ctx){var div;var current_block_type_index;var if_block;var current;var if_block_creators=[create_if_block$c,create_if_block_3$5];var if_blocks=[];function select_block_type(ctx,dirty){if(/*toolsFiltered*/ctx[17].length)return 0;if(/*shouldRenderPresets*/ctx[25])return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element(\"div\");if(if_block)if_block.c();attr(div,\"slot\",\"footer\");attr(div,\"style\",/*footerStyle*/ctx[30]);},m:function m(target,anchor){insert(target,div,anchor);if(~current_block_type_index){if_blocks[current_block_type_index].m(div,null);}current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}transition_in(if_block,1);if_block.m(div,null);}else{if_block=null;}}if(!current||dirty[0]&/*footerStyle*/1073741824){attr(div,\"style\",/*footerStyle*/ctx[30]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}// (374:0) <Util on:measure>\nfunction create_default_slot$b(ctx){var t;return{c:function c(){t=space();},m:function m(target,anchor){insert(target,t,anchor);},p:noop$1,i:noop$1,o:noop$1,d:function d(detaching){if(detaching)detach(t);}};}function create_fragment$C(ctx){var util;var current;util=new Util({props:{$$slots:{\"default\":[create_default_slot$b],footer:[create_footer_slot$3],main:[create_main_slot$1]},$$scope:{ctx:ctx}}});util.$on(\"measure\",/*measure_handler*/ctx[69]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, computedScrollElasticity, locale, toolsFiltered, toolActive, shapePresets, enablePresetSelectImage, shouldRenderPresets, markupShapeSelected, shapeControls, pingHub, $parentRect, $rootRect, $stageRect, $utilRect, markupOffset, imageRotation, $isActiveFraction, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, ping, hooks, markupEditor, $shapes, shouldRenderShapeEditor*/2147475409|dirty[1]&/*$presentationScalar, $imageOverlayMarkup*/3|dirty[2]&/*$$scope*/268435456){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$C($$self,$$props,$$invalidate){var $rootRect;var $isActive,$$unsubscribe_isActive=noop$1,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(73,$isActive=$$value);}),isActive;};var $imagePreviewModifiers;var $isVisible,$$unsubscribe_isVisible=noop$1,$$subscribe_isVisible=function $$subscribe_isVisible(){return $$unsubscribe_isVisible(),$$unsubscribe_isVisible=subscribe(isVisible,function($$value){return $$invalidate(76,$isVisible=$$value);}),isVisible;};var $utilRect;var $stageRect;var $shapes,$$unsubscribe_shapes=noop$1,$$subscribe_shapes=function $$subscribe_shapes(){return $$unsubscribe_shapes(),$$unsubscribe_shapes=subscribe(shapes,function($$value){return $$invalidate(23,$shapes=$$value);}),shapes;};var $isActiveFraction,$$unsubscribe_isActiveFraction=noop$1,$$subscribe_isActiveFraction=function $$subscribe_isActiveFraction(){return $$unsubscribe_isActiveFraction(),$$unsubscribe_isActiveFraction=subscribe(isActiveFraction,function($$value){return $$invalidate(26,$isActiveFraction=$$value);}),isActiveFraction;};var $imageCropRect;var $parentRect,$$unsubscribe_parentRect=noop$1,$$subscribe_parentRect=function $$subscribe_parentRect(){return $$unsubscribe_parentRect(),$$unsubscribe_parentRect=subscribe(parentRect,function($$value){return $$invalidate(27,$parentRect=$$value);}),parentRect;};var $footerOffset;var $imageOverlayMarkup;var $presentationScalar;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isVisible();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_shapes();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActiveFraction();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_parentRect();});var isActive=$$props.isActive;$$subscribe_isActive();var isActiveFraction=$$props.isActiveFraction;$$subscribe_isActiveFraction();var isVisible=$$props.isVisible;$$subscribe_isVisible();var stores=$$props.stores;var _$$props$locale7=$$props.locale,locale=_$$props$locale7===void 0?{}:_$$props$locale7;var _$$props$shapes=$$props.shapes,shapes=_$$props$shapes===void 0?[]:_$$props$shapes;$$subscribe_shapes();var _$$props$tools2=$$props.tools,tools=_$$props$tools2===void 0?[]:_$$props$tools2;var _$$props$toolShapes=$$props.toolShapes,toolShapes=_$$props$toolShapes===void 0?[]:_$$props$toolShapes;var _$$props$toolActive=$$props.toolActive,toolActive=_$$props$toolActive===void 0?\"sharpie\":_$$props$toolActive;var _$$props$shapeControl=$$props.shapeControls,shapeControls=_$$props$shapeControl===void 0?[]:_$$props$shapeControl;var _$$props$enableButton5=$$props.enableButtonFlipVertical,enableButtonFlipVertical=_$$props$enableButton5===void 0?false:_$$props$enableButton5;var _$$props$enablePreset2=$$props.enablePresetSelectImage,enablePresetSelectImage=_$$props$enablePreset2===void 0?true:_$$props$enablePreset2;var _$$props$shapePresets=$$props.shapePresets,shapePresets=_$$props$shapePresets===void 0?[]:_$$props$shapePresets;var utilKey=$$props.utilKey;var mapScreenPointToImagePoint=$$props.mapScreenPointToImagePoint;var mapImagePointToScreenPoint=$$props.mapImagePointToScreenPoint;var _$$props$imageRotatio=$$props.imageRotation,imageRotation=_$$props$imageRotatio===void 0?0:_$$props$imageRotatio;var _$$props$imageFlipX=$$props.imageFlipX,imageFlipX=_$$props$imageFlipX===void 0?false:_$$props$imageFlipX;var _$$props$imageFlipY=$$props.imageFlipY,imageFlipY=_$$props$imageFlipY===void 0?false:_$$props$imageFlipY;var parentRect=$$props.parentRect;$$subscribe_parentRect();var _$$props$hooks=$$props.hooks,hooks=_$$props$hooks===void 0?{}:_$$props$hooks;var _stores5=stores,history=_stores5.history,rootRect=_stores5.rootRect,stageRect=_stores5.stageRect,utilRect=_stores5.utilRect,elasticityMultiplier=_stores5.elasticityMultiplier,scrollElasticity=_stores5.scrollElasticity,imageOverlayMarkup=_stores5.imageOverlayMarkup,imagePreviewModifiers=_stores5.imagePreviewModifiers,imageCropRect=_stores5.imageCropRect,presentationScalar=_stores5.presentationScalar;component_subscribe($$self,rootRect,function(value){return $$invalidate(18,$rootRect=value);});component_subscribe($$self,stageRect,function(value){return $$invalidate(22,$stageRect=value);});component_subscribe($$self,utilRect,function(value){return $$invalidate(21,$utilRect=value);});component_subscribe($$self,imageOverlayMarkup,function(value){return $$invalidate(31,$imageOverlayMarkup=value);});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(74,$imagePreviewModifiers=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(80,$imageCropRect=value);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(32,$presentationScalar=value);});var updateActiveTool=function updateActiveTool(_ref288){var value=_ref288.value;return $$invalidate(0,toolActive=value);};var mapScreenEventToImagePoint=function mapScreenEventToImagePoint(e){return mapScreenPointToImagePoint(getEventPositionInEditor(e,$rootRect));};// A reference to the markup editor, we need this so we can call exported functions\nvar markupEditor;// the current tool styles\nvar markupToolStyles={};//\n// Create new shape\n//\nvar interactionHandler;var handleInteractionStart=function handleInteractionStart(e){if(toolShapes[toolActive]){var _toolShapes$toolActiv=_slicedToArray(toolShapes[toolActive],2),shape=_toolShapes$toolActiv[0],options=_toolShapes$toolActiv[1];interactionHandler=markupEditor.createShape(_objectSpread(_objectSpread({},shape),markupToolStylesComputed),options);}else if(toolActive===\"eraser\"){interactionHandler=markupEditor.eraseShape();}else{interactionHandler=undefined;}if(!interactionHandler)return;interactionHandler.start(e);};var handleInteractionUpdate=function handleInteractionUpdate(e){if(!interactionHandler)return;interactionHandler.update(e);};var handleInteractionRelease=function handleInteractionRelease(e){if(!interactionHandler)return;interactionHandler.release(e);};var handleInteractionEnd=function handleInteractionEnd(e){if(!interactionHandler)return;interactionHandler.end(e);interactionHandler=undefined;};function handleUpdateSelectedMarkupShape(props){// remember style for when creating or styling other element\nObject.keys(props).forEach(function(key){return $$invalidate(70,markupToolStyles[key]=props[key],markupToolStyles);});// it's possible we're only updating default styles\nif(!markupSelected)return;// update element\nmarkupEditor.updateMarkupShape(markupSelected,props);// update markup style\nhandleMarkupUpdate();}var createPreset=function createPreset(preset,position){// position defaults to crop center\nvar positionIsCenter=false;if(!position){positionIsCenter=true;position=rectCenter($imageCropRect);}// adjust offset if parent rect is image crop rect\nposition.x-=$parentRect.x||0;position.y-=$parentRect.y||0;// calculate new center if image is rotated\nif(imageRotation!==0){var size={width:$parentRect.width,height:$parentRect.height};sizeRotate(size,imageRotation);var dx=($parentRect.width-Math.abs(size.width))*0.5;var dy=($parentRect.height-Math.abs(size.height))*0.5;position.x+=dx;position.y+=dy;}// create shape\nvar shape=shapeCreateFromPreset(preset,$imageCropRect,function(error,shape){// has shape not been added?\nif(!$shapes.find(function(s){return s.id===shape.id;}))return;// something went wrong, exit!\nif(error){markupEditor.removeShape(shape);return console.error(error);}// reposition shape\nshapeContain(shape,$imageCropRect);shapeCenter(shape,position);// select if is last shape\nif($shapes[$shapes.length-1]===shape){markupEditor.selectShape(shape);}});// de-flip shape\nshape.flipX=imageFlipX;shape.flipY=imageFlipY;// de-rotate shape\nshape.rotation=imageRotation!==0?-imageRotation:0;// reposition if there's already shapes at position and shape isn't full screen\nvar shapesAlreadyAtPosition=markupEditor.getShapesAtPosition(position);var cropWidth=$imageCropRect.width;var cropHeight=$imageCropRect.height;if(positionIsCenter&&shapesAlreadyAtPosition.length&&shape.width<cropWidth&&shape.height<cropHeight){var _size=Math.min(cropWidth,cropHeight)*0.1;position.x+=Math.round(-_size+Math.random()*_size*2);position.y+=Math.round(-_size+Math.random()*_size*2);}// shape update position\nif(shape.width&&shape.height){shapeContain(shape,$imageCropRect);shapeCenter(shape,position);}return shape;};var addPreset=function addPreset(preset,position){var _hooks=hooks,_hooks$beforeAddShape=_hooks.beforeAddShape,beforeAddShape=_hooks$beforeAddShape===void 0?function(){return true;}:_hooks$beforeAddShape;var shape=createPreset(preset,position);if(!beforeAddShape(shape))return;markupEditor.addShape(shape);history.write();return shape;};var dragCancelled=false;var handleGrabPreset=function handleGrabPreset(preset,e){dragCancelled=false;};var handleDragPreset=function handleDragPreset(preset,e){if(dragCancelled)return;var _hooks2=hooks,_hooks2$beforeAddShap=_hooks2.beforeAddShape,beforeAddShape=_hooks2$beforeAddShap===void 0?function(){return true;}:_hooks2$beforeAddShap;var position=mapScreenEventToImagePoint(e);// create or update if is inside image\nvar draft=markupEditor.getMarkupItemDraft();var inCropRect=rectContainsPoint($imageCropRect,{// adjust offset if parent rect is image crop rect\nx:position.x+($parentRect.x||0),y:position.y+($parentRect.y||0)});// remove draft if not dragging inside image\nif(draft&&!inCropRect)markupEditor.discardMarkupItemDraft();// stop here if we're not in the crop rect\nif(!inCropRect)return;// create draft shape\nif(!draft){var shape=createPreset(preset,position);if(!beforeAddShape(shape)){dragCancelled=true;e.preventDefault();return;}shapeMakeDraft(shape);markupEditor.addShape(shape);return;}// update existing draft\nmarkupEditor.updateMarkupShape(draft,{x:position.x-draft.width*0.5,y:position.y-draft.height*0.5});};var handleDropPreset=function handleDropPreset(preset,e){if(dragCancelled)return;var position=mapScreenEventToImagePoint(e);// adjust offset if parent rect is image crop rect\nif(!rectContainsPoint($imageCropRect,{x:position.x+($parentRect.x||0),y:position.y+($parentRect.y||0)})){markupEditor.discardMarkupItemDraft();}else{var shape=markupEditor.confirmMarkupItemDraft();markupEditor.selectShape(shape);// update history\nhistory.write();}};var handleAddPreset=function handleAddPreset(preset){return addPreset(preset);};var handleAddFiles=function handleAddFiles(files,position){return files.forEach(function(file){return addPreset(file,position);});};var handleDropFiles=function handleDropFiles(e){return handleAddFiles(e.detail.files,mapScreenEventToImagePoint(e.detail.event));};//\n// History\n//\nvar handleMarkupUpdate=function handleMarkupUpdate(){return history.write();};// used to fire ping events from\nvar pingHub;//\n// Footer style\n//\nvar footerOffset=spring(0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(81,$footerOffset=value);});var func=function func(shape){ping(\"addshape\",shape);handleMarkupUpdate();};var func_1=function func_1(shape){ping(\"selectshape\",shape);};var func_2=function func_2(shape){ping(\"updateshape\",shape);handleMarkupUpdate();};var func_3=function func_3(shape){ping(\"removeshape\",shape);handleMarkupUpdate();};function shapelayouteditor_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){markupEditor=$$value;$$invalidate(15,markupEditor);});}function shapelayouteditor_markup_binding(value){$shapes=value;shapes.set($shapes);}function shapelayouteditor_ui_binding(value){$imageOverlayMarkup=value;imageOverlayMarkup.set($imageOverlayMarkup);}function measure_handler_1(event){bubble($$self,event);}function div_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){pingHub=$$value;$$invalidate(16,pingHub);});}var func_4=function func_4(option){return option[0]===toolActive;};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$subscribe_isActive($$invalidate(1,isActive=$$props.isActive));if(\"isActiveFraction\"in $$props)$$subscribe_isActiveFraction($$invalidate(2,isActiveFraction=$$props.isActiveFraction));if(\"isVisible\"in $$props)$$subscribe_isVisible($$invalidate(3,isVisible=$$props.isVisible));if(\"stores\"in $$props)$$invalidate(53,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(4,locale=$$props.locale);if(\"shapes\"in $$props)$$subscribe_shapes($$invalidate(5,shapes=$$props.shapes));if(\"tools\"in $$props)$$invalidate(54,tools=$$props.tools);if(\"toolShapes\"in $$props)$$invalidate(55,toolShapes=$$props.toolShapes);if(\"toolActive\"in $$props)$$invalidate(0,toolActive=$$props.toolActive);if(\"shapeControls\"in $$props)$$invalidate(6,shapeControls=$$props.shapeControls);if(\"enableButtonFlipVertical\"in $$props)$$invalidate(7,enableButtonFlipVertical=$$props.enableButtonFlipVertical);if(\"enablePresetSelectImage\"in $$props)$$invalidate(8,enablePresetSelectImage=$$props.enablePresetSelectImage);if(\"shapePresets\"in $$props)$$invalidate(9,shapePresets=$$props.shapePresets);if(\"utilKey\"in $$props)$$invalidate(56,utilKey=$$props.utilKey);if(\"mapScreenPointToImagePoint\"in $$props)$$invalidate(10,mapScreenPointToImagePoint=$$props.mapScreenPointToImagePoint);if(\"mapImagePointToScreenPoint\"in $$props)$$invalidate(11,mapImagePointToScreenPoint=$$props.mapImagePointToScreenPoint);if(\"imageRotation\"in $$props)$$invalidate(12,imageRotation=$$props.imageRotation);if(\"imageFlipX\"in $$props)$$invalidate(57,imageFlipX=$$props.imageFlipX);if(\"imageFlipY\"in $$props)$$invalidate(58,imageFlipY=$$props.imageFlipY);if(\"parentRect\"in $$props)$$subscribe_parentRect($$invalidate(13,parentRect=$$props.parentRect));if(\"hooks\"in $$props)$$invalidate(14,hooks=$$props.hooks);};var toolsFiltered;var shouldRenderShapeEditor;var markupOffset;var markupShapeKeys;var markupSelected;var markupToolShape;var markupToolStylesComputed;var markupShapeSelected;var shouldRenderPresets;var ping;var computedScrollElasticity;var footerStyle;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*shapePresets*/512|$$self.$$.dirty[1]&/*tools*/8388608){// remove presets tool if no shape presets defined\n$$invalidate(17,toolsFiltered=shapePresets.length===0?tools.filter(function(tool){return tool[0]!==\"preset\";}):tools);}if($$self.$$.dirty[1]&/*utilKey*/33554432|$$self.$$.dirty[2]&/*$isActive, $imagePreviewModifiers*/6144){//\n// enable seeing the markup outlines outside of the crop area\n// \nif($isActive){set_store_value(imagePreviewModifiers,$imagePreviewModifiers[utilKey]={maskMarkupOpacity:0.85},$imagePreviewModifiers);}else{delete $imagePreviewModifiers[utilKey];}}if($$self.$$.dirty[2]&/*$isVisible*/16384){$$invalidate(19,shouldRenderShapeEditor=$isVisible);}if($$self.$$.dirty[0]&/*$utilRect, $stageRect*/6291456){$$invalidate(20,markupOffset=$utilRect&&vectorCreate($stageRect.x-$utilRect.x,$stageRect.y-$utilRect.y));}if($$self.$$.dirty[0]&/*toolActive, markupEditor*/32769){// if tool is changed, deselect markup items\nif(toolActive&&markupEditor)markupEditor.blurShapes();}if($$self.$$.dirty[0]&/*shapeControls*/64){$$invalidate(77,markupShapeKeys=Object.keys(shapeControls));}if($$self.$$.dirty[0]&/*$shapes*/8388608){$$invalidate(78,markupSelected=($shapes.filter(shapeIsSelected)||[])[0]);}if($$self.$$.dirty[0]&/*toolActive*/1|$$self.$$.dirty[1]&/*toolShapes*/16777216|$$self.$$.dirty[2]&/*$isActive*/2048){$$invalidate(79,markupToolShape=$isActive&&(toolShapes[toolActive]?shapeFormat(shapeDeepCopy(toolShapes[toolActive][0])):{}));}if($$self.$$.dirty[2]&/*markupToolShape, markupShapeKeys, markupToolStyles*/164096){$$invalidate(75,markupToolStylesComputed=markupToolShape&&Object.keys(markupToolShape).reduce(function(prev,key){var isDisableStyleProp=key===\"disableStyle\";var isStylableProp=markupShapeKeys.find(function(shapeKey){return shapeKey.split(\"_\").includes(key);});// skip props that can't be styled, but keep all `disable` props\nif(!isDisableStyleProp&&!isStylableProp)return prev;// apply this style\nprev[key]=markupToolStyles[key]||markupToolShape[key];return prev;},{}));}if($$self.$$.dirty[2]&/*markupSelected, markupToolStylesComputed*/73728){$$invalidate(24,markupShapeSelected=markupSelected||markupToolStylesComputed);}if($$self.$$.dirty[0]&/*$isActiveFraction, toolActive, shapePresets, enablePresetSelectImage*/67109633){//\n// presets\n//\n$$invalidate(25,shouldRenderPresets=$isActiveFraction>0&&toolActive===\"preset\"&&(shapePresets.length>0||enablePresetSelectImage));}if($$self.$$.dirty[0]&/*pingHub*/65536){$$invalidate(28,ping=pingHub&&createPingDispatcher(pingHub));}if($$self.$$.dirty[2]&/*$isActive*/2048){footerOffset.set($isActive?0:20);}if($$self.$$.dirty[2]&/*$footerOffset*/524288){$$invalidate(30,footerStyle=$footerOffset?\"transform: translateY(\".concat($footerOffset,\"px)\"):undefined);}};$$invalidate(29,computedScrollElasticity=elasticityMultiplier*scrollElasticity);return[toolActive,isActive,isActiveFraction,isVisible,locale,shapes,shapeControls,enableButtonFlipVertical,enablePresetSelectImage,shapePresets,mapScreenPointToImagePoint,mapImagePointToScreenPoint,imageRotation,parentRect,hooks,markupEditor,pingHub,toolsFiltered,$rootRect,shouldRenderShapeEditor,markupOffset,$utilRect,$stageRect,$shapes,markupShapeSelected,shouldRenderPresets,$isActiveFraction,$parentRect,ping,computedScrollElasticity,footerStyle,$imageOverlayMarkup,$presentationScalar,rootRect,stageRect,utilRect,imageOverlayMarkup,imagePreviewModifiers,imageCropRect,presentationScalar,updateActiveTool,handleInteractionStart,handleInteractionUpdate,handleInteractionRelease,handleInteractionEnd,handleUpdateSelectedMarkupShape,handleGrabPreset,handleDragPreset,handleDropPreset,handleAddPreset,handleDropFiles,handleMarkupUpdate,footerOffset,stores,tools,toolShapes,utilKey,imageFlipX,imageFlipY,func,func_1,func_2,func_3,shapelayouteditor_binding,shapelayouteditor_markup_binding,shapelayouteditor_ui_binding,measure_handler_1,div_binding,func_4,measure_handler];}var ShapeUtil=/*#__PURE__*/function(_SvelteComponent39){_inherits(ShapeUtil,_SvelteComponent39);var _super41=_createSuper(ShapeUtil);function ShapeUtil(options){var _this41;_classCallCheck(this,ShapeUtil);_this41=_super41.call(this);init(_assertThisInitialized(_this41),options,instance$C,create_fragment$C,safe_not_equal,{isActive:1,isActiveFraction:2,isVisible:3,stores:53,locale:4,shapes:5,tools:54,toolShapes:55,toolActive:0,shapeControls:6,enableButtonFlipVertical:7,enablePresetSelectImage:8,shapePresets:9,utilKey:56,mapScreenPointToImagePoint:10,mapImagePointToScreenPoint:11,imageRotation:12,imageFlipX:57,imageFlipY:58,parentRect:13,hooks:14},[-1,-1,-1]);return _this41;}_createClass(ShapeUtil,[{key:\"isActive\",get:function get(){return this.$$.ctx[1];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"isActiveFraction\",get:function get(){return this.$$.ctx[2];},set:function set(isActiveFraction){this.$set({isActiveFraction:isActiveFraction});flush();}},{key:\"isVisible\",get:function get(){return this.$$.ctx[3];},set:function set(isVisible){this.$set({isVisible:isVisible});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[53];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"shapes\",get:function get(){return this.$$.ctx[5];},set:function set(shapes){this.$set({shapes:shapes});flush();}},{key:\"tools\",get:function get(){return this.$$.ctx[54];},set:function set(tools){this.$set({tools:tools});flush();}},{key:\"toolShapes\",get:function get(){return this.$$.ctx[55];},set:function set(toolShapes){this.$set({toolShapes:toolShapes});flush();}},{key:\"toolActive\",get:function get(){return this.$$.ctx[0];},set:function set(toolActive){this.$set({toolActive:toolActive});flush();}},{key:\"shapeControls\",get:function get(){return this.$$.ctx[6];},set:function set(shapeControls){this.$set({shapeControls:shapeControls});flush();}},{key:\"enableButtonFlipVertical\",get:function get(){return this.$$.ctx[7];},set:function set(enableButtonFlipVertical){this.$set({enableButtonFlipVertical:enableButtonFlipVertical});flush();}},{key:\"enablePresetSelectImage\",get:function get(){return this.$$.ctx[8];},set:function set(enablePresetSelectImage){this.$set({enablePresetSelectImage:enablePresetSelectImage});flush();}},{key:\"shapePresets\",get:function get(){return this.$$.ctx[9];},set:function set(shapePresets){this.$set({shapePresets:shapePresets});flush();}},{key:\"utilKey\",get:function get(){return this.$$.ctx[56];},set:function set(utilKey){this.$set({utilKey:utilKey});flush();}},{key:\"mapScreenPointToImagePoint\",get:function get(){return this.$$.ctx[10];},set:function set(mapScreenPointToImagePoint){this.$set({mapScreenPointToImagePoint:mapScreenPointToImagePoint});flush();}},{key:\"mapImagePointToScreenPoint\",get:function get(){return this.$$.ctx[11];},set:function set(mapImagePointToScreenPoint){this.$set({mapImagePointToScreenPoint:mapImagePointToScreenPoint});flush();}},{key:\"imageRotation\",get:function get(){return this.$$.ctx[12];},set:function set(imageRotation){this.$set({imageRotation:imageRotation});flush();}},{key:\"imageFlipX\",get:function get(){return this.$$.ctx[57];},set:function set(imageFlipX){this.$set({imageFlipX:imageFlipX});flush();}},{key:\"imageFlipY\",get:function get(){return this.$$.ctx[58];},set:function set(imageFlipY){this.$set({imageFlipY:imageFlipY});flush();}},{key:\"parentRect\",get:function get(){return this.$$.ctx[13];},set:function set(parentRect){this.$set({parentRect:parentRect});flush();}},{key:\"hooks\",get:function get(){return this.$$.ctx[14];},set:function set(hooks){this.$set({hooks:hooks});flush();}}]);return ShapeUtil;}(SvelteComponent);var _mapImagePointToScreenPoint=function _mapImagePointToScreenPoint(imagePoint,canvasSize,imageSize,imageOrigin,imageTranslation,imageRotation,imageScalar,imageFlipX,imageFlipY){var mappedPoint=vectorClone(imagePoint);var imageCenterX=imageSize.width*0.5;var imageCenterY=imageSize.height*0.5;var canvasCenterX=canvasSize.width*0.5;var canvasCenterY=canvasSize.height*0.5;var imageOffsetX=imageTranslation.x+imageOrigin.x;var imageOffsetY=imageTranslation.y+imageOrigin.y;if(imageFlipX)mappedPoint.x=imageSize.width-mappedPoint.x;if(imageFlipY)mappedPoint.y=imageSize.height-mappedPoint.y;// rotate around image center based on if image is rotated\nvar c=Math.cos(imageRotation);var s=Math.sin(imageRotation);mappedPoint.x-=imageCenterX;mappedPoint.y-=imageCenterY;var rx=mappedPoint.x*c-mappedPoint.y*s;var ry=mappedPoint.x*s+mappedPoint.y*c;mappedPoint.x=imageCenterX+rx;mappedPoint.y=imageCenterY+ry;// position based on screen transforms\nmappedPoint.x*=imageScalar;mappedPoint.y*=imageScalar;mappedPoint.x+=canvasCenterX;mappedPoint.y+=canvasCenterY;mappedPoint.x+=imageOffsetX;mappedPoint.y+=imageOffsetY;mappedPoint.x-=imageCenterX*imageScalar;mappedPoint.y-=imageCenterY*imageScalar;var tx=(imageTranslation.x-imageOffsetX)*imageScalar;var ty=(imageTranslation.y-imageOffsetY)*imageScalar;var rtx=tx*c-ty*s;var rty=tx*s+ty*c;mappedPoint.x+=rtx;mappedPoint.y+=rty;return mappedPoint;};var _mapScreenPointToImagePoint=function _mapScreenPointToImagePoint(screenPoint,canvasSize,imageSize,imageOrigin,imageTranslation,imageRotation,imageScalar,imageFlipX,imageFlipY){var mappedPoint=vectorClone(screenPoint);var imageCenter=sizeCenter(imageSize);var canvasCenter=sizeCenter(canvasSize);var imageOffset=vectorCreate(imageTranslation.x+imageOrigin.x,imageTranslation.y+imageOrigin.y);var c=Math.cos(imageRotation);var s=Math.sin(imageRotation);mappedPoint.x-=canvasCenter.x;mappedPoint.y-=canvasCenter.y;var tx=(imageTranslation.x-imageOffset.x)*imageScalar;var ty=(imageTranslation.y-imageOffset.y)*imageScalar;var rtx=tx*c-ty*s;var rty=tx*s+ty*c;mappedPoint.x-=rtx;mappedPoint.y-=rty;mappedPoint.x-=imageOffset.x;mappedPoint.y-=imageOffset.y;mappedPoint.x/=imageScalar;mappedPoint.y/=imageScalar;var rx=mappedPoint.x*c+mappedPoint.y*s;var ry=mappedPoint.x*s-mappedPoint.y*c;mappedPoint.x=rx;mappedPoint.y=-ry;mappedPoint.x+=imageCenter.x;mappedPoint.y+=imageCenter.y;if(imageFlipX)mappedPoint.x=imageSize.width-mappedPoint.x;if(imageFlipY)mappedPoint.y=imageSize.height-mappedPoint.y;return mappedPoint;};/* src/core/ui/plugins/annotate/index.svelte generated by Svelte v3.29.4 */function create_fragment$D(ctx){var shapeutil;var current;shapeutil=new ShapeUtil({props:{stores:/*stores*/ctx[3],locale:/*locale*/ctx[4],isActive:/*isActive*/ctx[0],isActiveFraction:/*isActiveFraction*/ctx[1],isVisible:/*isVisible*/ctx[2],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[31],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[32],utilKey:\"annotate\",imageRotation:/*$imageRotation*/ctx[23],imageFlipX:/*$imageFlipX*/ctx[21],imageFlipY:/*$imageFlipY*/ctx[22],shapes:/*imageAnnotation*/ctx[25],tools:/*annotateTools*/ctx[8]||/*markupEditorToolbar*/ctx[5],toolShapes:/*annotateToolShapes*/ctx[9]||/*markupEditorToolStyles*/ctx[6],toolActive:/*annotateActiveTool*/ctx[11],shapeControls:/*annotateShapeControls*/ctx[10]||/*markupEditorShapeStyleControls*/ctx[7],shapePresets:/*annotatePresets*/ctx[14],enableButtonFlipVertical:/*annotateEnableButtonFlipVertical*/ctx[12],parentRect:/*imageSize*/ctx[26],enablePresetSelectImage:/*annotateEnableSelectImagePreset*/ctx[13],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[15],beforeAddShape:/*beforeAddShape*/ctx[16],beforeRemoveShape:/*beforeRemoveShape*/ctx[17],beforeDeselectShape:/*beforeDeselectShape*/ctx[18],beforeSelectShape:/*beforeSelectShape*/ctx[19],beforeUpdateShape:/*beforeUpdateShape*/ctx[20]}}});shapeutil.$on(\"measure\",/*measure_handler*/ctx[34]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,dirty){var shapeutil_changes={};if(dirty[0]&/*stores*/8)shapeutil_changes.stores=/*stores*/ctx[3];if(dirty[0]&/*locale*/16)shapeutil_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*isActive*/1)shapeutil_changes.isActive=/*isActive*/ctx[0];if(dirty[0]&/*isActiveFraction*/2)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[1];if(dirty[0]&/*isVisible*/4)shapeutil_changes.isVisible=/*isVisible*/ctx[2];if(dirty[0]&/*$imageRotation*/8388608)shapeutil_changes.imageRotation=/*$imageRotation*/ctx[23];if(dirty[0]&/*$imageFlipX*/2097152)shapeutil_changes.imageFlipX=/*$imageFlipX*/ctx[21];if(dirty[0]&/*$imageFlipY*/4194304)shapeutil_changes.imageFlipY=/*$imageFlipY*/ctx[22];if(dirty[0]&/*annotateTools, markupEditorToolbar*/288)shapeutil_changes.tools=/*annotateTools*/ctx[8]||/*markupEditorToolbar*/ctx[5];if(dirty[0]&/*annotateToolShapes, markupEditorToolStyles*/576)shapeutil_changes.toolShapes=/*annotateToolShapes*/ctx[9]||/*markupEditorToolStyles*/ctx[6];if(dirty[0]&/*annotateActiveTool*/2048)shapeutil_changes.toolActive=/*annotateActiveTool*/ctx[11];if(dirty[0]&/*annotateShapeControls, markupEditorShapeStyleControls*/1152)shapeutil_changes.shapeControls=/*annotateShapeControls*/ctx[10]||/*markupEditorShapeStyleControls*/ctx[7];if(dirty[0]&/*annotatePresets*/16384)shapeutil_changes.shapePresets=/*annotatePresets*/ctx[14];if(dirty[0]&/*annotateEnableButtonFlipVertical*/4096)shapeutil_changes.enableButtonFlipVertical=/*annotateEnableButtonFlipVertical*/ctx[12];if(dirty[0]&/*annotateEnableSelectImagePreset*/8192)shapeutil_changes.enablePresetSelectImage=/*annotateEnableSelectImagePreset*/ctx[13];if(dirty[0]&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape, beforeUpdateShape*/2064384)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[15],beforeAddShape:/*beforeAddShape*/ctx[16],beforeRemoveShape:/*beforeRemoveShape*/ctx[17],beforeDeselectShape:/*beforeDeselectShape*/ctx[18],beforeSelectShape:/*beforeSelectShape*/ctx[19],beforeUpdateShape:/*beforeUpdateShape*/ctx[20]};shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$D($$self,$$props,$$invalidate){var $rootRect;var $imageSize;var $imageTransforms;var $imageFlipX;var $imageFlipY;var $imageRotation;var name=\"annotate\";var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale8=$$props.locale,locale=_$$props$locale8===void 0?{}:_$$props$locale8;var _$$props$markupEditor=$$props.markupEditorToolbar,markupEditorToolbar=_$$props$markupEditor===void 0?undefined:_$$props$markupEditor;var _$$props$markupEditor2=$$props.markupEditorToolStyles,markupEditorToolStyles=_$$props$markupEditor2===void 0?undefined:_$$props$markupEditor2;var _$$props$markupEditor3=$$props.markupEditorShapeStyleControls,markupEditorShapeStyleControls=_$$props$markupEditor3===void 0?undefined:_$$props$markupEditor3;var _$$props$annotateTool=$$props.annotateTools,annotateTools=_$$props$annotateTool===void 0?undefined:_$$props$annotateTool;var _$$props$annotateTool2=$$props.annotateToolShapes,annotateToolShapes=_$$props$annotateTool2===void 0?undefined:_$$props$annotateTool2;var _$$props$annotateShap=$$props.annotateShapeControls,annotateShapeControls=_$$props$annotateShap===void 0?undefined:_$$props$annotateShap;var _$$props$annotateActi=$$props.annotateActiveTool,annotateActiveTool=_$$props$annotateActi===void 0?\"sharpie\":_$$props$annotateActi;var _$$props$annotateEnab=$$props.annotateEnableButtonFlipVertical,annotateEnableButtonFlipVertical=_$$props$annotateEnab===void 0?false:_$$props$annotateEnab;var _$$props$annotateEnab2=$$props.annotateEnableSelectImagePreset,annotateEnableSelectImagePreset=_$$props$annotateEnab2===void 0?false:_$$props$annotateEnab2;var _$$props$annotatePres=$$props.annotatePresets,annotatePresets=_$$props$annotatePres===void 0?[]:_$$props$annotatePres;var _$$props$willRenderSh2=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh2===void 0?undefined:_$$props$willRenderSh2;var _$$props$beforeAddSha2=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha2===void 0?undefined:_$$props$beforeAddSha2;var _$$props$beforeRemove2=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove2===void 0?undefined:_$$props$beforeRemove2;var _$$props$beforeDesele2=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele2===void 0?undefined:_$$props$beforeDesele2;var _$$props$beforeSelect2=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect2===void 0?undefined:_$$props$beforeSelect2;var _$$props$beforeUpdate2=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate2===void 0?undefined:_$$props$beforeUpdate2;// connect filter choice to stores\nvar _stores6=stores,rootRect=_stores6.rootRect,imageAnnotation=_stores6.imageAnnotation,imageSize=_stores6.imageSize,imageTransforms=_stores6.imageTransforms,imageRotation=_stores6.imageRotation,imageFlipX=_stores6.imageFlipX,imageFlipY=_stores6.imageFlipY;component_subscribe($$self,rootRect,function(value){return $$invalidate(35,$rootRect=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(36,$imageSize=value);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(37,$imageTransforms=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(23,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(21,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(22,$imageFlipY=value);});//\n// Mapping coordinates\n//\nvar mapScreenPointToImagePoint=function mapScreenPointToImagePoint(point){return _mapScreenPointToImagePoint(point,$rootRect,$imageSize,$imageTransforms.origin,$imageTransforms.translation,$imageTransforms.rotation.z,$imageTransforms.scale,$imageFlipX,$imageFlipY);};var mapImagePointToScreenPoint=function mapImagePointToScreenPoint(point){return _mapImagePointToScreenPoint(point,$rootRect,$imageSize,$imageTransforms.origin,$imageTransforms.translation,$imageTransforms.rotation.z,$imageTransforms.scale,$imageFlipX,$imageFlipY);};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$invalidate(0,isActive=$$props.isActive);if(\"isActiveFraction\"in $$props)$$invalidate(1,isActiveFraction=$$props.isActiveFraction);if(\"isVisible\"in $$props)$$invalidate(2,isVisible=$$props.isVisible);if(\"stores\"in $$props)$$invalidate(3,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(4,locale=$$props.locale);if(\"markupEditorToolbar\"in $$props)$$invalidate(5,markupEditorToolbar=$$props.markupEditorToolbar);if(\"markupEditorToolStyles\"in $$props)$$invalidate(6,markupEditorToolStyles=$$props.markupEditorToolStyles);if(\"markupEditorShapeStyleControls\"in $$props)$$invalidate(7,markupEditorShapeStyleControls=$$props.markupEditorShapeStyleControls);if(\"annotateTools\"in $$props)$$invalidate(8,annotateTools=$$props.annotateTools);if(\"annotateToolShapes\"in $$props)$$invalidate(9,annotateToolShapes=$$props.annotateToolShapes);if(\"annotateShapeControls\"in $$props)$$invalidate(10,annotateShapeControls=$$props.annotateShapeControls);if(\"annotateActiveTool\"in $$props)$$invalidate(11,annotateActiveTool=$$props.annotateActiveTool);if(\"annotateEnableButtonFlipVertical\"in $$props)$$invalidate(12,annotateEnableButtonFlipVertical=$$props.annotateEnableButtonFlipVertical);if(\"annotateEnableSelectImagePreset\"in $$props)$$invalidate(13,annotateEnableSelectImagePreset=$$props.annotateEnableSelectImagePreset);if(\"annotatePresets\"in $$props)$$invalidate(14,annotatePresets=$$props.annotatePresets);if(\"willRenderShapeControls\"in $$props)$$invalidate(15,willRenderShapeControls=$$props.willRenderShapeControls);if(\"beforeAddShape\"in $$props)$$invalidate(16,beforeAddShape=$$props.beforeAddShape);if(\"beforeRemoveShape\"in $$props)$$invalidate(17,beforeRemoveShape=$$props.beforeRemoveShape);if(\"beforeDeselectShape\"in $$props)$$invalidate(18,beforeDeselectShape=$$props.beforeDeselectShape);if(\"beforeSelectShape\"in $$props)$$invalidate(19,beforeSelectShape=$$props.beforeSelectShape);if(\"beforeUpdateShape\"in $$props)$$invalidate(20,beforeUpdateShape=$$props.beforeUpdateShape);};return[isActive,isActiveFraction,isVisible,stores,locale,markupEditorToolbar,markupEditorToolStyles,markupEditorShapeStyleControls,annotateTools,annotateToolShapes,annotateShapeControls,annotateActiveTool,annotateEnableButtonFlipVertical,annotateEnableSelectImagePreset,annotatePresets,willRenderShapeControls,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,$imageFlipX,$imageFlipY,$imageRotation,rootRect,imageAnnotation,imageSize,imageTransforms,imageRotation,imageFlipX,imageFlipY,mapScreenPointToImagePoint,mapImagePointToScreenPoint,name,measure_handler];}var Annotate=/*#__PURE__*/function(_SvelteComponent40){_inherits(Annotate,_SvelteComponent40);var _super42=_createSuper(Annotate);function Annotate(options){var _this42;_classCallCheck(this,Annotate);_this42=_super42.call(this);init(_assertThisInitialized(_this42),options,instance$D,create_fragment$D,safe_not_equal,{name:33,isActive:0,isActiveFraction:1,isVisible:2,stores:3,locale:4,markupEditorToolbar:5,markupEditorToolStyles:6,markupEditorShapeStyleControls:7,annotateTools:8,annotateToolShapes:9,annotateShapeControls:10,annotateActiveTool:11,annotateEnableButtonFlipVertical:12,annotateEnableSelectImagePreset:13,annotatePresets:14,willRenderShapeControls:15,beforeAddShape:16,beforeRemoveShape:17,beforeDeselectShape:18,beforeSelectShape:19,beforeUpdateShape:20},[-1,-1]);return _this42;}_createClass(Annotate,[{key:\"name\",get:function get(){return this.$$.ctx[33];}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"isActiveFraction\",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$set({isActiveFraction:isActiveFraction});flush();}},{key:\"isVisible\",get:function get(){return this.$$.ctx[2];},set:function set(isVisible){this.$set({isVisible:isVisible});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[3];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"markupEditorToolbar\",get:function get(){return this.$$.ctx[5];},set:function set(markupEditorToolbar){this.$set({markupEditorToolbar:markupEditorToolbar});flush();}},{key:\"markupEditorToolStyles\",get:function get(){return this.$$.ctx[6];},set:function set(markupEditorToolStyles){this.$set({markupEditorToolStyles:markupEditorToolStyles});flush();}},{key:\"markupEditorShapeStyleControls\",get:function get(){return this.$$.ctx[7];},set:function set(markupEditorShapeStyleControls){this.$set({markupEditorShapeStyleControls:markupEditorShapeStyleControls});flush();}},{key:\"annotateTools\",get:function get(){return this.$$.ctx[8];},set:function set(annotateTools){this.$set({annotateTools:annotateTools});flush();}},{key:\"annotateToolShapes\",get:function get(){return this.$$.ctx[9];},set:function set(annotateToolShapes){this.$set({annotateToolShapes:annotateToolShapes});flush();}},{key:\"annotateShapeControls\",get:function get(){return this.$$.ctx[10];},set:function set(annotateShapeControls){this.$set({annotateShapeControls:annotateShapeControls});flush();}},{key:\"annotateActiveTool\",get:function get(){return this.$$.ctx[11];},set:function set(annotateActiveTool){this.$set({annotateActiveTool:annotateActiveTool});flush();}},{key:\"annotateEnableButtonFlipVertical\",get:function get(){return this.$$.ctx[12];},set:function set(annotateEnableButtonFlipVertical){this.$set({annotateEnableButtonFlipVertical:annotateEnableButtonFlipVertical});flush();}},{key:\"annotateEnableSelectImagePreset\",get:function get(){return this.$$.ctx[13];},set:function set(annotateEnableSelectImagePreset){this.$set({annotateEnableSelectImagePreset:annotateEnableSelectImagePreset});flush();}},{key:\"annotatePresets\",get:function get(){return this.$$.ctx[14];},set:function set(annotatePresets){this.$set({annotatePresets:annotatePresets});flush();}},{key:\"willRenderShapeControls\",get:function get(){return this.$$.ctx[15];},set:function set(willRenderShapeControls){this.$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:\"beforeAddShape\",get:function get(){return this.$$.ctx[16];},set:function set(beforeAddShape){this.$set({beforeAddShape:beforeAddShape});flush();}},{key:\"beforeRemoveShape\",get:function get(){return this.$$.ctx[17];},set:function set(beforeRemoveShape){this.$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:\"beforeDeselectShape\",get:function get(){return this.$$.ctx[18];},set:function set(beforeDeselectShape){this.$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:\"beforeSelectShape\",get:function get(){return this.$$.ctx[19];},set:function set(beforeSelectShape){this.$set({beforeSelectShape:beforeSelectShape});flush();}},{key:\"beforeUpdateShape\",get:function get(){return this.$$.ctx[20];},set:function set(beforeUpdateShape){this.$set({beforeUpdateShape:beforeUpdateShape});flush();}}]);return Annotate;}(SvelteComponent);// @ts-ignore\nvar index$3={util:['annotate',Annotate]};/* src/core/ui/plugins/decorate/index.svelte generated by Svelte v3.29.4 */function create_fragment$E(ctx){var shapeutil;var current;shapeutil=new ShapeUtil({props:{stores:/*stores*/ctx[3],locale:/*locale*/ctx[4],isActive:/*isActive*/ctx[0],isActiveFraction:/*isActiveFraction*/ctx[1],isVisible:/*isVisible*/ctx[2],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[24],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[25],utilKey:\"decorate\",shapes:/*imageDecoration*/ctx[21],tools:/*decorateTools*/ctx[8]||/*markupEditorToolbar*/ctx[5],toolShapes:/*decorateToolShapes*/ctx[9]||/*markupEditorToolStyles*/ctx[6],toolActive:/*decorateActiveTool*/ctx[11],shapeControls:/*decorateShapeControls*/ctx[10]||/*markupEditorShapeStyleControls*/ctx[7],shapePresets:/*decoratePresets*/ctx[13],enableButtonFlipVertical:/*decorateEnableButtonFlipVertical*/ctx[12],parentRect:/*imageCropRect*/ctx[20],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[14],beforeAddShape:/*beforeAddShape*/ctx[15],beforeRemoveShape:/*beforeRemoveShape*/ctx[16],beforeDeselectShape:/*beforeDeselectShape*/ctx[17],beforeSelectShape:/*beforeSelectShape*/ctx[18],beforeUpdateShape:/*beforeUpdateShape*/ctx[19]}}});shapeutil.$on(\"measure\",/*measure_handler*/ctx[28]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,_ref289){var _ref290=_slicedToArray(_ref289,1),dirty=_ref290[0];var shapeutil_changes={};if(dirty&/*stores*/8)shapeutil_changes.stores=/*stores*/ctx[3];if(dirty&/*locale*/16)shapeutil_changes.locale=/*locale*/ctx[4];if(dirty&/*isActive*/1)shapeutil_changes.isActive=/*isActive*/ctx[0];if(dirty&/*isActiveFraction*/2)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[1];if(dirty&/*isVisible*/4)shapeutil_changes.isVisible=/*isVisible*/ctx[2];if(dirty&/*decorateTools, markupEditorToolbar*/288)shapeutil_changes.tools=/*decorateTools*/ctx[8]||/*markupEditorToolbar*/ctx[5];if(dirty&/*decorateToolShapes, markupEditorToolStyles*/576)shapeutil_changes.toolShapes=/*decorateToolShapes*/ctx[9]||/*markupEditorToolStyles*/ctx[6];if(dirty&/*decorateActiveTool*/2048)shapeutil_changes.toolActive=/*decorateActiveTool*/ctx[11];if(dirty&/*decorateShapeControls, markupEditorShapeStyleControls*/1152)shapeutil_changes.shapeControls=/*decorateShapeControls*/ctx[10]||/*markupEditorShapeStyleControls*/ctx[7];if(dirty&/*decoratePresets*/8192)shapeutil_changes.shapePresets=/*decoratePresets*/ctx[13];if(dirty&/*decorateEnableButtonFlipVertical*/4096)shapeutil_changes.enableButtonFlipVertical=/*decorateEnableButtonFlipVertical*/ctx[12];if(dirty&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape, beforeUpdateShape*/1032192)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[14],beforeAddShape:/*beforeAddShape*/ctx[15],beforeRemoveShape:/*beforeRemoveShape*/ctx[16],beforeDeselectShape:/*beforeDeselectShape*/ctx[17],beforeSelectShape:/*beforeSelectShape*/ctx[18],beforeUpdateShape:/*beforeUpdateShape*/ctx[19]};shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$E($$self,$$props,$$invalidate){var $imageSelectionRectPresentation;var $presentationScalar;var name=\"decorate\";var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale9=$$props.locale,locale=_$$props$locale9===void 0?{}:_$$props$locale9;var _$$props$markupEditor4=$$props.markupEditorToolbar,markupEditorToolbar=_$$props$markupEditor4===void 0?undefined:_$$props$markupEditor4;var _$$props$markupEditor5=$$props.markupEditorToolStyles,markupEditorToolStyles=_$$props$markupEditor5===void 0?undefined:_$$props$markupEditor5;var _$$props$markupEditor6=$$props.markupEditorShapeStyleControls,markupEditorShapeStyleControls=_$$props$markupEditor6===void 0?undefined:_$$props$markupEditor6;var _$$props$decorateTool=$$props.decorateTools,decorateTools=_$$props$decorateTool===void 0?undefined:_$$props$decorateTool;var _$$props$decorateTool2=$$props.decorateToolShapes,decorateToolShapes=_$$props$decorateTool2===void 0?undefined:_$$props$decorateTool2;var _$$props$decorateShap=$$props.decorateShapeControls,decorateShapeControls=_$$props$decorateShap===void 0?undefined:_$$props$decorateShap;var _$$props$decorateActi=$$props.decorateActiveTool,decorateActiveTool=_$$props$decorateActi===void 0?\"sharpie\":_$$props$decorateActi;var _$$props$decorateEnab=$$props.decorateEnableButtonFlipVertical,decorateEnableButtonFlipVertical=_$$props$decorateEnab===void 0?false:_$$props$decorateEnab;var _$$props$decorateEnab2=$$props.decorateEnableSelectImagePreset,decorateEnableSelectImagePreset=_$$props$decorateEnab2===void 0?false:_$$props$decorateEnab2;var _$$props$decoratePres=$$props.decoratePresets,decoratePresets=_$$props$decoratePres===void 0?[]:_$$props$decoratePres;var _$$props$willRenderSh3=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh3===void 0?undefined:_$$props$willRenderSh3;var _$$props$beforeAddSha3=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha3===void 0?undefined:_$$props$beforeAddSha3;var _$$props$beforeRemove3=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove3===void 0?undefined:_$$props$beforeRemove3;var _$$props$beforeDesele3=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele3===void 0?undefined:_$$props$beforeDesele3;var _$$props$beforeSelect3=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect3===void 0?undefined:_$$props$beforeSelect3;var _$$props$beforeUpdate3=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate3===void 0?undefined:_$$props$beforeUpdate3;var _stores7=stores,imageCropRect=_stores7.imageCropRect,imageDecoration=_stores7.imageDecoration,imageSelectionRectPresentation=_stores7.imageSelectionRectPresentation,presentationScalar=_stores7.presentationScalar;component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(29,$imageSelectionRectPresentation=value);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(30,$presentationScalar=value);});var mapScreenPointToImagePoint=function mapScreenPointToImagePoint(screenPoint){var mappedPoint=vectorClone(screenPoint);mappedPoint.x-=$imageSelectionRectPresentation.x;mappedPoint.y-=$imageSelectionRectPresentation.y;mappedPoint.x/=$presentationScalar;mappedPoint.y/=$presentationScalar;return mappedPoint;};var mapImagePointToScreenPoint=function mapImagePointToScreenPoint(imagePoint){var mappedPoint=vectorClone(imagePoint);mappedPoint.x*=$presentationScalar;mappedPoint.y*=$presentationScalar;mappedPoint.x+=$imageSelectionRectPresentation.x;mappedPoint.y+=$imageSelectionRectPresentation.y;return mappedPoint;};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$invalidate(0,isActive=$$props.isActive);if(\"isActiveFraction\"in $$props)$$invalidate(1,isActiveFraction=$$props.isActiveFraction);if(\"isVisible\"in $$props)$$invalidate(2,isVisible=$$props.isVisible);if(\"stores\"in $$props)$$invalidate(3,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(4,locale=$$props.locale);if(\"markupEditorToolbar\"in $$props)$$invalidate(5,markupEditorToolbar=$$props.markupEditorToolbar);if(\"markupEditorToolStyles\"in $$props)$$invalidate(6,markupEditorToolStyles=$$props.markupEditorToolStyles);if(\"markupEditorShapeStyleControls\"in $$props)$$invalidate(7,markupEditorShapeStyleControls=$$props.markupEditorShapeStyleControls);if(\"decorateTools\"in $$props)$$invalidate(8,decorateTools=$$props.decorateTools);if(\"decorateToolShapes\"in $$props)$$invalidate(9,decorateToolShapes=$$props.decorateToolShapes);if(\"decorateShapeControls\"in $$props)$$invalidate(10,decorateShapeControls=$$props.decorateShapeControls);if(\"decorateActiveTool\"in $$props)$$invalidate(11,decorateActiveTool=$$props.decorateActiveTool);if(\"decorateEnableButtonFlipVertical\"in $$props)$$invalidate(12,decorateEnableButtonFlipVertical=$$props.decorateEnableButtonFlipVertical);if(\"decorateEnableSelectImagePreset\"in $$props)$$invalidate(27,decorateEnableSelectImagePreset=$$props.decorateEnableSelectImagePreset);if(\"decoratePresets\"in $$props)$$invalidate(13,decoratePresets=$$props.decoratePresets);if(\"willRenderShapeControls\"in $$props)$$invalidate(14,willRenderShapeControls=$$props.willRenderShapeControls);if(\"beforeAddShape\"in $$props)$$invalidate(15,beforeAddShape=$$props.beforeAddShape);if(\"beforeRemoveShape\"in $$props)$$invalidate(16,beforeRemoveShape=$$props.beforeRemoveShape);if(\"beforeDeselectShape\"in $$props)$$invalidate(17,beforeDeselectShape=$$props.beforeDeselectShape);if(\"beforeSelectShape\"in $$props)$$invalidate(18,beforeSelectShape=$$props.beforeSelectShape);if(\"beforeUpdateShape\"in $$props)$$invalidate(19,beforeUpdateShape=$$props.beforeUpdateShape);};return[isActive,isActiveFraction,isVisible,stores,locale,markupEditorToolbar,markupEditorToolStyles,markupEditorShapeStyleControls,decorateTools,decorateToolShapes,decorateShapeControls,decorateActiveTool,decorateEnableButtonFlipVertical,decoratePresets,willRenderShapeControls,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,imageCropRect,imageDecoration,imageSelectionRectPresentation,presentationScalar,mapScreenPointToImagePoint,mapImagePointToScreenPoint,name,decorateEnableSelectImagePreset,measure_handler];}var Decorate=/*#__PURE__*/function(_SvelteComponent41){_inherits(Decorate,_SvelteComponent41);var _super43=_createSuper(Decorate);function Decorate(options){var _this43;_classCallCheck(this,Decorate);_this43=_super43.call(this);init(_assertThisInitialized(_this43),options,instance$E,create_fragment$E,safe_not_equal,{name:26,isActive:0,isActiveFraction:1,isVisible:2,stores:3,locale:4,markupEditorToolbar:5,markupEditorToolStyles:6,markupEditorShapeStyleControls:7,decorateTools:8,decorateToolShapes:9,decorateShapeControls:10,decorateActiveTool:11,decorateEnableButtonFlipVertical:12,decorateEnableSelectImagePreset:27,decoratePresets:13,willRenderShapeControls:14,beforeAddShape:15,beforeRemoveShape:16,beforeDeselectShape:17,beforeSelectShape:18,beforeUpdateShape:19});return _this43;}_createClass(Decorate,[{key:\"name\",get:function get(){return this.$$.ctx[26];}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"isActiveFraction\",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$set({isActiveFraction:isActiveFraction});flush();}},{key:\"isVisible\",get:function get(){return this.$$.ctx[2];},set:function set(isVisible){this.$set({isVisible:isVisible});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[3];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"markupEditorToolbar\",get:function get(){return this.$$.ctx[5];},set:function set(markupEditorToolbar){this.$set({markupEditorToolbar:markupEditorToolbar});flush();}},{key:\"markupEditorToolStyles\",get:function get(){return this.$$.ctx[6];},set:function set(markupEditorToolStyles){this.$set({markupEditorToolStyles:markupEditorToolStyles});flush();}},{key:\"markupEditorShapeStyleControls\",get:function get(){return this.$$.ctx[7];},set:function set(markupEditorShapeStyleControls){this.$set({markupEditorShapeStyleControls:markupEditorShapeStyleControls});flush();}},{key:\"decorateTools\",get:function get(){return this.$$.ctx[8];},set:function set(decorateTools){this.$set({decorateTools:decorateTools});flush();}},{key:\"decorateToolShapes\",get:function get(){return this.$$.ctx[9];},set:function set(decorateToolShapes){this.$set({decorateToolShapes:decorateToolShapes});flush();}},{key:\"decorateShapeControls\",get:function get(){return this.$$.ctx[10];},set:function set(decorateShapeControls){this.$set({decorateShapeControls:decorateShapeControls});flush();}},{key:\"decorateActiveTool\",get:function get(){return this.$$.ctx[11];},set:function set(decorateActiveTool){this.$set({decorateActiveTool:decorateActiveTool});flush();}},{key:\"decorateEnableButtonFlipVertical\",get:function get(){return this.$$.ctx[12];},set:function set(decorateEnableButtonFlipVertical){this.$set({decorateEnableButtonFlipVertical:decorateEnableButtonFlipVertical});flush();}},{key:\"decorateEnableSelectImagePreset\",get:function get(){return this.$$.ctx[27];},set:function set(decorateEnableSelectImagePreset){this.$set({decorateEnableSelectImagePreset:decorateEnableSelectImagePreset});flush();}},{key:\"decoratePresets\",get:function get(){return this.$$.ctx[13];},set:function set(decoratePresets){this.$set({decoratePresets:decoratePresets});flush();}},{key:\"willRenderShapeControls\",get:function get(){return this.$$.ctx[14];},set:function set(willRenderShapeControls){this.$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:\"beforeAddShape\",get:function get(){return this.$$.ctx[15];},set:function set(beforeAddShape){this.$set({beforeAddShape:beforeAddShape});flush();}},{key:\"beforeRemoveShape\",get:function get(){return this.$$.ctx[16];},set:function set(beforeRemoveShape){this.$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:\"beforeDeselectShape\",get:function get(){return this.$$.ctx[17];},set:function set(beforeDeselectShape){this.$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:\"beforeSelectShape\",get:function get(){return this.$$.ctx[18];},set:function set(beforeSelectShape){this.$set({beforeSelectShape:beforeSelectShape});flush();}},{key:\"beforeUpdateShape\",get:function get(){return this.$$.ctx[19];},set:function set(beforeUpdateShape){this.$set({beforeUpdateShape:beforeUpdateShape});flush();}}]);return Decorate;}(SvelteComponent);// @ts-ignore\nvar index$4={util:['decorate',Decorate]};/* src/core/ui/plugins/sticker/index.svelte generated by Svelte v3.29.4 */function create_fragment$F(ctx){var shapeutil;var current;shapeutil=new ShapeUtil({props:{stores:/*stores*/ctx[3],locale:/*locale*/ctx[4],isActive:/*isActive*/ctx[0],isActiveFraction:/*isActiveFraction*/ctx[1],isVisible:/*isVisible*/ctx[2],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[29],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[30],utilKey:\"sticker\",shapePresets:/*stickers*/ctx[5],shapes:/*stickerStickToImage*/ctx[6]?/*imageAnnotation*/ctx[22]:/*imageDecoration*/ctx[23],toolActive:\"preset\",imageFlipX:/*stickerStickToImage*/ctx[6]?/*$imageFlipX*/ctx[15]:false,imageFlipY:/*stickerStickToImage*/ctx[6]?/*$imageFlipY*/ctx[16]:false,imageRotation:/*stickerStickToImage*/ctx[6]?/*$imageRotation*/ctx[17]:0,parentRect:/*stickerStickToImage*/ctx[6]?/*imageSize*/ctx[24]:/*imageCropRect*/ctx[20],enablePresetSelectImage:/*stickerEnableSelectImage*/ctx[7],enableButtonFlipVertical:/*stickersEnableButtonFlipVertical*/ctx[8],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[9],beforeAddShape:/*beforeAddShape*/ctx[10],beforeRemoveShape:/*beforeRemoveShape*/ctx[11],beforeDeselectShape:/*beforeDeselectShape*/ctx[12],beforeSelectShape:/*beforeSelectShape*/ctx[13],beforeUpdateShape:/*beforeUpdateShape*/ctx[14]}}});shapeutil.$on(\"measure\",/*measure_handler*/ctx[32]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,dirty){var shapeutil_changes={};if(dirty[0]&/*stores*/8)shapeutil_changes.stores=/*stores*/ctx[3];if(dirty[0]&/*locale*/16)shapeutil_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*isActive*/1)shapeutil_changes.isActive=/*isActive*/ctx[0];if(dirty[0]&/*isActiveFraction*/2)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[1];if(dirty[0]&/*isVisible*/4)shapeutil_changes.isVisible=/*isVisible*/ctx[2];if(dirty[0]&/*stickers*/32)shapeutil_changes.shapePresets=/*stickers*/ctx[5];if(dirty[0]&/*stickerStickToImage*/64)shapeutil_changes.shapes=/*stickerStickToImage*/ctx[6]?/*imageAnnotation*/ctx[22]:/*imageDecoration*/ctx[23];if(dirty[0]&/*stickerStickToImage, $imageFlipX*/32832)shapeutil_changes.imageFlipX=/*stickerStickToImage*/ctx[6]?/*$imageFlipX*/ctx[15]:false;if(dirty[0]&/*stickerStickToImage, $imageFlipY*/65600)shapeutil_changes.imageFlipY=/*stickerStickToImage*/ctx[6]?/*$imageFlipY*/ctx[16]:false;if(dirty[0]&/*stickerStickToImage, $imageRotation*/131136)shapeutil_changes.imageRotation=/*stickerStickToImage*/ctx[6]?/*$imageRotation*/ctx[17]:0;if(dirty[0]&/*stickerStickToImage*/64)shapeutil_changes.parentRect=/*stickerStickToImage*/ctx[6]?/*imageSize*/ctx[24]:/*imageCropRect*/ctx[20];if(dirty[0]&/*stickerEnableSelectImage*/128)shapeutil_changes.enablePresetSelectImage=/*stickerEnableSelectImage*/ctx[7];if(dirty[0]&/*stickersEnableButtonFlipVertical*/256)shapeutil_changes.enableButtonFlipVertical=/*stickersEnableButtonFlipVertical*/ctx[8];if(dirty[0]&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape, beforeUpdateShape*/32256)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[9],beforeAddShape:/*beforeAddShape*/ctx[10],beforeRemoveShape:/*beforeRemoveShape*/ctx[11],beforeDeselectShape:/*beforeDeselectShape*/ctx[12],beforeSelectShape:/*beforeSelectShape*/ctx[13],beforeUpdateShape:/*beforeUpdateShape*/ctx[14]};shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$F($$self,$$props,$$invalidate){var $rootRect;var $imageSize;var $imageTransforms;var $imageFlipX;var $imageFlipY;var $imageSelectionRectPresentation;var $presentationScalar;var $imageRotation;var name=\"sticker\";var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale10=$$props.locale,locale=_$$props$locale10===void 0?{}:_$$props$locale10;var _$$props$stickers=$$props.stickers,stickers=_$$props$stickers===void 0?[]:_$$props$stickers;var _$$props$stickerStick=$$props.stickerStickToImage,stickerStickToImage=_$$props$stickerStick===void 0?false:_$$props$stickerStick;var _$$props$stickerEnabl=$$props.stickerEnableSelectImage,stickerEnableSelectImage=_$$props$stickerEnabl===void 0?true:_$$props$stickerEnabl;var _$$props$stickersEnab=$$props.stickersEnableButtonFlipVertical,stickersEnableButtonFlipVertical=_$$props$stickersEnab===void 0?false:_$$props$stickersEnab;var _$$props$willRenderSh4=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh4===void 0?undefined:_$$props$willRenderSh4;var _$$props$beforeAddSha4=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha4===void 0?undefined:_$$props$beforeAddSha4;var _$$props$beforeRemove4=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove4===void 0?undefined:_$$props$beforeRemove4;var _$$props$beforeDesele4=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele4===void 0?undefined:_$$props$beforeDesele4;var _$$props$beforeSelect4=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect4===void 0?undefined:_$$props$beforeSelect4;var _$$props$beforeUpdate4=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate4===void 0?undefined:_$$props$beforeUpdate4;// connect filter choice to stores\nvar _stores8=stores,presentationScalar=_stores8.presentationScalar,rootRect=_stores8.rootRect,imageCropRect=_stores8.imageCropRect,imageSelectionRectPresentation=_stores8.imageSelectionRectPresentation,imageAnnotation=_stores8.imageAnnotation,imageDecoration=_stores8.imageDecoration,imageSize=_stores8.imageSize,imageTransforms=_stores8.imageTransforms,imageRotation=_stores8.imageRotation,imageFlipX=_stores8.imageFlipX,imageFlipY=_stores8.imageFlipY;component_subscribe($$self,presentationScalar,function(value){return $$invalidate(37,$presentationScalar=value);});component_subscribe($$self,rootRect,function(value){return $$invalidate(33,$rootRect=value);});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(36,$imageSelectionRectPresentation=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(34,$imageSize=value);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(35,$imageTransforms=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(17,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(15,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(16,$imageFlipY=value);});//\n// Mapping coordinates\n//\nvar mapScreenPointToImagePoint=stickerStickToImage?function(point){return _mapScreenPointToImagePoint(point,$rootRect,$imageSize,$imageTransforms.origin,$imageTransforms.translation,$imageTransforms.rotation.z,$imageTransforms.scale,$imageFlipX,$imageFlipY);}:function(point){var mappedPoint=vectorClone(point);mappedPoint.x-=$imageSelectionRectPresentation.x;mappedPoint.y-=$imageSelectionRectPresentation.y;mappedPoint.x/=$presentationScalar;mappedPoint.y/=$presentationScalar;return mappedPoint;};var mapImagePointToScreenPoint=stickerStickToImage?function(point){return _mapImagePointToScreenPoint(point,$rootRect,$imageSize,$imageTransforms.origin,$imageTransforms.translation,$imageTransforms.rotation.z,$imageTransforms.scale,$imageFlipX,$imageFlipY);}:function(point){var mappedPoint=vectorClone(point);mappedPoint.x*=$presentationScalar;mappedPoint.y*=$presentationScalar;mappedPoint.x+=$imageSelectionRectPresentation.x;mappedPoint.y+=$imageSelectionRectPresentation.y;return mappedPoint;};function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$invalidate(0,isActive=$$props.isActive);if(\"isActiveFraction\"in $$props)$$invalidate(1,isActiveFraction=$$props.isActiveFraction);if(\"isVisible\"in $$props)$$invalidate(2,isVisible=$$props.isVisible);if(\"stores\"in $$props)$$invalidate(3,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(4,locale=$$props.locale);if(\"stickers\"in $$props)$$invalidate(5,stickers=$$props.stickers);if(\"stickerStickToImage\"in $$props)$$invalidate(6,stickerStickToImage=$$props.stickerStickToImage);if(\"stickerEnableSelectImage\"in $$props)$$invalidate(7,stickerEnableSelectImage=$$props.stickerEnableSelectImage);if(\"stickersEnableButtonFlipVertical\"in $$props)$$invalidate(8,stickersEnableButtonFlipVertical=$$props.stickersEnableButtonFlipVertical);if(\"willRenderShapeControls\"in $$props)$$invalidate(9,willRenderShapeControls=$$props.willRenderShapeControls);if(\"beforeAddShape\"in $$props)$$invalidate(10,beforeAddShape=$$props.beforeAddShape);if(\"beforeRemoveShape\"in $$props)$$invalidate(11,beforeRemoveShape=$$props.beforeRemoveShape);if(\"beforeDeselectShape\"in $$props)$$invalidate(12,beforeDeselectShape=$$props.beforeDeselectShape);if(\"beforeSelectShape\"in $$props)$$invalidate(13,beforeSelectShape=$$props.beforeSelectShape);if(\"beforeUpdateShape\"in $$props)$$invalidate(14,beforeUpdateShape=$$props.beforeUpdateShape);};return[isActive,isActiveFraction,isVisible,stores,locale,stickers,stickerStickToImage,stickerEnableSelectImage,stickersEnableButtonFlipVertical,willRenderShapeControls,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,$imageFlipX,$imageFlipY,$imageRotation,presentationScalar,rootRect,imageCropRect,imageSelectionRectPresentation,imageAnnotation,imageDecoration,imageSize,imageTransforms,imageRotation,imageFlipX,imageFlipY,mapScreenPointToImagePoint,mapImagePointToScreenPoint,name,measure_handler];}var Sticker=/*#__PURE__*/function(_SvelteComponent42){_inherits(Sticker,_SvelteComponent42);var _super44=_createSuper(Sticker);function Sticker(options){var _this44;_classCallCheck(this,Sticker);_this44=_super44.call(this);init(_assertThisInitialized(_this44),options,instance$F,create_fragment$F,safe_not_equal,{name:31,isActive:0,isActiveFraction:1,isVisible:2,stores:3,locale:4,stickers:5,stickerStickToImage:6,stickerEnableSelectImage:7,stickersEnableButtonFlipVertical:8,willRenderShapeControls:9,beforeAddShape:10,beforeRemoveShape:11,beforeDeselectShape:12,beforeSelectShape:13,beforeUpdateShape:14},[-1,-1]);return _this44;}_createClass(Sticker,[{key:\"name\",get:function get(){return this.$$.ctx[31];}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"isActiveFraction\",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$set({isActiveFraction:isActiveFraction});flush();}},{key:\"isVisible\",get:function get(){return this.$$.ctx[2];},set:function set(isVisible){this.$set({isVisible:isVisible});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[3];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"stickers\",get:function get(){return this.$$.ctx[5];},set:function set(stickers){this.$set({stickers:stickers});flush();}},{key:\"stickerStickToImage\",get:function get(){return this.$$.ctx[6];},set:function set(stickerStickToImage){this.$set({stickerStickToImage:stickerStickToImage});flush();}},{key:\"stickerEnableSelectImage\",get:function get(){return this.$$.ctx[7];},set:function set(stickerEnableSelectImage){this.$set({stickerEnableSelectImage:stickerEnableSelectImage});flush();}},{key:\"stickersEnableButtonFlipVertical\",get:function get(){return this.$$.ctx[8];},set:function set(stickersEnableButtonFlipVertical){this.$set({stickersEnableButtonFlipVertical:stickersEnableButtonFlipVertical});flush();}},{key:\"willRenderShapeControls\",get:function get(){return this.$$.ctx[9];},set:function set(willRenderShapeControls){this.$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:\"beforeAddShape\",get:function get(){return this.$$.ctx[10];},set:function set(beforeAddShape){this.$set({beforeAddShape:beforeAddShape});flush();}},{key:\"beforeRemoveShape\",get:function get(){return this.$$.ctx[11];},set:function set(beforeRemoveShape){this.$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:\"beforeDeselectShape\",get:function get(){return this.$$.ctx[12];},set:function set(beforeDeselectShape){this.$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:\"beforeSelectShape\",get:function get(){return this.$$.ctx[13];},set:function set(beforeSelectShape){this.$set({beforeSelectShape:beforeSelectShape});flush();}},{key:\"beforeUpdateShape\",get:function get(){return this.$$.ctx[14];},set:function set(beforeUpdateShape){this.$set({beforeUpdateShape:beforeUpdateShape});flush();}}]);return Sticker;}(SvelteComponent);// @ts-ignore\nvar index$5={util:['sticker',Sticker]};/* src/core/ui/plugins/resize/index.svelte generated by Svelte v3.29.4 */function create_default_slot_2$6(ctx){var g;var raw_value=(isString(/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio)?/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio:/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio(/*maintainAspectRatio*/ctx[3],/*$iconActiveFraction*/ctx[11]))+\"\";return{c:function c(){g=svg_element(\"g\");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*locale, maintainAspectRatio, $iconActiveFraction*/2058&&raw_value!==(raw_value=(isString(/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio)?/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio:/*locale*/ctx[1].resizeIconButtonMaintainAspectRatio(/*maintainAspectRatio*/ctx[3],/*$iconActiveFraction*/ctx[11]))+\"\"))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (389:12) <Button type=\"submit\" class=\"implicit\">\nfunction create_default_slot_1$9(ctx){var t;return{c:function c(){t=text(\"Save\");},m:function m(target,anchor){insert(target,t,anchor);},d:function d(detaching){if(detaching)detach(t);}};}// (362:4) <form slot=\"footer\" style={footerStyle} on:submit|preventDefault={handleSubmit}>\nfunction create_footer_slot$4(ctx){var form;var div4;var fieldset;var legend;var t0_value=/*locale*/ctx[1].resizeLabelFormCaption+\"\";var t0;var t1;var div3;var div0;var label0;var t2_value=/*locale*/ctx[1].resizeLabelInputWidth+\"\";var t2;var label0_for_value;var label0_title_value;var label0_aria_label_value;var t3;var input0;var input0_id_value;var t4;var div1;var input1;var input1_id_value;var t5;var label1;var icon;var label1_for_value;var label1_title_value;var t6;var div2;var label2;var t7_value=/*locale*/ctx[1].resizeLabelInputHeight+\"\";var t7;var label2_for_value;var label2_title_value;var label2_aria_label_value;var t8;var input2;var input2_id_value;var t9;var button;var current;var mounted;var dispose;icon=new Icon({props:{$$slots:{\"default\":[create_default_slot_2$6]},$$scope:{ctx:ctx}}});button=new Button({props:{type:\"submit\",\"class\":\"implicit\",$$slots:{\"default\":[create_default_slot_1$9]},$$scope:{ctx:ctx}}});return{c:function c(){form=element(\"form\");div4=element(\"div\");fieldset=element(\"fieldset\");legend=element(\"legend\");t0=text(t0_value);t1=space();div3=element(\"div\");div0=element(\"div\");label0=element(\"label\");t2=text(t2_value);t3=space();input0=element(\"input\");t4=space();div1=element(\"div\");input1=element(\"input\");t5=space();label1=element(\"label\");create_component(icon.$$.fragment);t6=space();div2=element(\"div\");label2=element(\"label\");t7=text(t7_value);t8=space();input2=element(\"input\");t9=space();create_component(button.$$.fragment);attr(legend,\"class\",\"implicit\");attr(label0,\"for\",label0_for_value=\"doka-width-\"+/*formId*/ctx[18]);attr(label0,\"title\",label0_title_value=/*locale*/ctx[1].resizeTitleInputWidth);attr(label0,\"aria-label\",label0_aria_label_value=/*locale*/ctx[1].resizeTitleInputWidth);attr(input0,\"id\",input0_id_value=\"doka-width-\"+/*formId*/ctx[18]);attr(input0,\"type\",\"text\");attr(input0,\"inputmode\",\"numeric\");attr(input0,\"pattern\",\"[0-9]*\");attr(input0,\"data-state\",/*widthState*/ctx[8]);attr(input0,\"autocomplete\",\"off\");attr(input0,\"placeholder\",/*widthPlaceholder*/ctx[6]);attr(div0,\"class\",\"DokaInputDimension\");attr(input1,\"class\",\"implicit\");attr(input1,\"id\",input1_id_value=\"doka-maintainAspectRatio-\"+/*formId*/ctx[18]);attr(input1,\"type\",\"checkbox\");attr(label1,\"for\",label1_for_value=\"doka-maintainAspectRatio-\"+/*formId*/ctx[18]);attr(label1,\"title\",label1_title_value=/*locale*/ctx[1].resizeTitleButtonMaintainAspectRatio);attr(label2,\"for\",label2_for_value=\"doka-height-\"+/*formId*/ctx[18]);attr(label2,\"title\",label2_title_value=/*locale*/ctx[1].resizeTitleInputHeight);attr(label2,\"aria-label\",label2_aria_label_value=/*locale*/ctx[1].resizeTitleInputHeight);attr(input2,\"id\",input2_id_value=\"doka-height-\"+/*formId*/ctx[18]);attr(input2,\"type\",\"text\");attr(input2,\"inputmode\",\"numeric\");attr(input2,\"pattern\",\"[0-9]*\");attr(input2,\"autocomplete\",\"off\");attr(input2,\"data-state\",/*heightState*/ctx[9]);attr(input2,\"placeholder\",/*heightPlaceholder*/ctx[7]);attr(div2,\"class\",\"DokaInputDimension\");attr(div3,\"class\",\"DokaFieldsetInner\");attr(div4,\"class\",\"DokaFormInner\");attr(form,\"slot\",\"footer\");attr(form,\"style\",/*footerStyle*/ctx[10]);},m:function m(target,anchor){insert(target,form,anchor);append(form,div4);append(div4,fieldset);append(fieldset,legend);append(legend,t0);append(fieldset,t1);append(fieldset,div3);append(div3,div0);append(div0,label0);append(label0,t2);append(div0,t3);append(div0,input0);set_input_value(input0,/*width*/ctx[4]);append(div3,t4);append(div3,div1);append(div1,input1);input1.checked=/*maintainAspectRatio*/ctx[3];append(div1,t5);append(div1,label1);mount_component(icon,label1,null);append(div3,t6);append(div3,div2);append(div2,label2);append(label2,t7);append(div2,t8);append(div2,input2);set_input_value(input2,/*height*/ctx[5]);/*div3_binding*/ctx[30](div3);append(div4,t9);mount_component(button,div4,null);current=true;if(!mounted){dispose=[listen(input0,\"input\",/*input0_input_handler*/ctx[27]),listen(input1,\"change\",/*input1_change_handler*/ctx[28]),listen(input2,\"input\",/*input2_input_handler*/ctx[29]),listen(div3,\"focusin\",/*handleFocusIn*/ctx[19]),listen(div3,\"focusout\",/*handleFocusOut*/ctx[20]),listen(form,\"submit\",prevent_default(/*handleSubmit*/ctx[21]))];mounted=true;}},p:function p(ctx,dirty){if((!current||dirty[0]&/*locale*/2)&&t0_value!==(t0_value=/*locale*/ctx[1].resizeLabelFormCaption+\"\"))set_data(t0,t0_value);if((!current||dirty[0]&/*locale*/2)&&t2_value!==(t2_value=/*locale*/ctx[1].resizeLabelInputWidth+\"\"))set_data(t2,t2_value);if(!current||dirty[0]&/*locale*/2&&label0_title_value!==(label0_title_value=/*locale*/ctx[1].resizeTitleInputWidth)){attr(label0,\"title\",label0_title_value);}if(!current||dirty[0]&/*locale*/2&&label0_aria_label_value!==(label0_aria_label_value=/*locale*/ctx[1].resizeTitleInputWidth)){attr(label0,\"aria-label\",label0_aria_label_value);}if(!current||dirty[0]&/*widthState*/256){attr(input0,\"data-state\",/*widthState*/ctx[8]);}if(!current||dirty[0]&/*widthPlaceholder*/64){attr(input0,\"placeholder\",/*widthPlaceholder*/ctx[6]);}if(dirty[0]&/*width*/16&&input0.value!==/*width*/ctx[4]){set_input_value(input0,/*width*/ctx[4]);}if(dirty[0]&/*maintainAspectRatio*/8){input1.checked=/*maintainAspectRatio*/ctx[3];}var icon_changes={};if(dirty[0]&/*locale, maintainAspectRatio, $iconActiveFraction*/2058|dirty[1]&/*$$scope*/65536){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);if(!current||dirty[0]&/*locale*/2&&label1_title_value!==(label1_title_value=/*locale*/ctx[1].resizeTitleButtonMaintainAspectRatio)){attr(label1,\"title\",label1_title_value);}if((!current||dirty[0]&/*locale*/2)&&t7_value!==(t7_value=/*locale*/ctx[1].resizeLabelInputHeight+\"\"))set_data(t7,t7_value);if(!current||dirty[0]&/*locale*/2&&label2_title_value!==(label2_title_value=/*locale*/ctx[1].resizeTitleInputHeight)){attr(label2,\"title\",label2_title_value);}if(!current||dirty[0]&/*locale*/2&&label2_aria_label_value!==(label2_aria_label_value=/*locale*/ctx[1].resizeTitleInputHeight)){attr(label2,\"aria-label\",label2_aria_label_value);}if(!current||dirty[0]&/*heightState*/512){attr(input2,\"data-state\",/*heightState*/ctx[9]);}if(!current||dirty[0]&/*heightPlaceholder*/128){attr(input2,\"placeholder\",/*heightPlaceholder*/ctx[7]);}if(dirty[0]&/*height*/32&&input2.value!==/*height*/ctx[5]){set_input_value(input2,/*height*/ctx[5]);}var button_changes={};if(dirty[1]&/*$$scope*/65536){button_changes.$$scope={dirty:dirty,ctx:ctx};}button.$set(button_changes);if(!current||dirty[0]&/*footerStyle*/1024){attr(form,\"style\",/*footerStyle*/ctx[10]);}},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(form);destroy_component(icon);/*div3_binding*/ctx[30](null);destroy_component(button);mounted=false;run_all(dispose);}};}function create_fragment$G(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$4]},$$scope:{ctx:ctx}}});util.$on(\"measure\",/*measure_handler*/ctx[31]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, fieldsGroup, heightState, heightPlaceholder, height, locale, maintainAspectRatio, $iconActiveFraction, widthState, widthPlaceholder, width*/4094|dirty[1]&/*$$scope*/65536){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$G($$self,$$props,$$invalidate){var $imageCropRectAspectRatio;var $imageCropRect;var $imageOutputSize;var $imageCropAspectRatio;var $imageSize;var $isActive,$$unsubscribe_isActive=noop$1,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(41,$isActive=$$value);}),isActive;};var $footerOffset;var $iconActiveFraction;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var formatValue=function formatValue(value){var min=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:9999;if(isString(value)){value=value.replace(/\\D/g,\"\");if(!value.length)return;}var v=Math.round(value);if(Number.isNaN(v))return;return clamp(v,min,max);};var name=\"resize\";var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$locale11=$$props.locale,locale=_$$props$locale11===void 0?{}:_$$props$locale11;var _$$props$resizeMinSiz=$$props.resizeMinSize,resizeMinSize=_$$props$resizeMinSiz===void 0?sizeCreate(1,1):_$$props$resizeMinSiz;var _$$props$resizeMaxSiz=$$props.resizeMaxSize,resizeMaxSize=_$$props$resizeMaxSiz===void 0?sizeCreate(9999,9999):_$$props$resizeMaxSiz;// offset\nvar iconActiveFraction=spring(0,{stiffness:0.15,damping:0.3});component_subscribe($$self,iconActiveFraction,function(value){return $$invalidate(11,$iconActiveFraction=value);});var _stores9=stores,imageSize=_stores9.imageSize,imageCropRect=_stores9.imageCropRect,imageCropRectAspectRatio=_stores9.imageCropRectAspectRatio,imageCropAspectRatio=_stores9.imageCropAspectRatio,imageOutputSize=_stores9.imageOutputSize,history=_stores9.history;component_subscribe($$self,imageSize,function(value){return $$invalidate(40,$imageSize=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(37,$imageCropRect=value);});component_subscribe($$self,imageCropRectAspectRatio,function(value){return $$invalidate(36,$imageCropRectAspectRatio=value);});component_subscribe($$self,imageCropAspectRatio,function(value){return $$invalidate(39,$imageCropAspectRatio=value);});component_subscribe($$self,imageOutputSize,function(value){return $$invalidate(38,$imageOutputSize=value);});var formId=getUniqueId();var fieldsGroup;var maintainAspectRatio=false;var width;var height;var widthFormatted;var heightFormatted;var widthPlaceholder;var heightPlaceholder;var activeField;var lastActiveField;// populate active field\nvar handleFocusIn=function handleFocusIn(e){var id=e.target.id;if(/width/.test(id)){$$invalidate(34,activeField=\"width\");}else if(/height/.test(id)){$$invalidate(34,activeField=\"height\");}else if(/aspectRatio/i.test(id)){$$invalidate(34,activeField=\"lock\");}else{$$invalidate(34,activeField=undefined);}};var handleFocusOut=function handleFocusOut(e){if(!fieldsGroup.contains(e.relatedTarget))handleSubmit();$$invalidate(34,activeField=undefined);};// sync fields if one has a value and aspect ratio should be maintained\nvar syncFields=function syncFields(){if(activeField===\"width\"){// sync height field\n$$invalidate(5,height=Math.round(width/$imageCropRectAspectRatio));}else if(activeField===\"height\"){// sync width field\n$$invalidate(4,width=Math.round(height*$imageCropRectAspectRatio));}else{if(lastActiveField===\"width\"){$$invalidate(5,height=Math.round(width/$imageCropRectAspectRatio));}else if(lastActiveField===\"height\"){$$invalidate(4,width=Math.round(height*$imageCropRectAspectRatio));}consolidateSize();}};var consolidateSize=function consolidateSize(forcedAspectRatio){// first need to limit values\nvar inputWidth=formatValue(width);var inputHeight=formatValue(height);var currentWidth=inputWidth;var currentHeight=inputHeight;var bothAxisDefined=currentWidth&&currentHeight;var aspectRatio=forcedAspectRatio||$imageCropRectAspectRatio;// done, no consolidation needed\nif(!currentWidth&&!currentHeight)return;// need to fill in missing values\nif(currentWidth&&!currentHeight){currentHeight=Math.round(currentWidth/aspectRatio);}else if(currentHeight&&!currentWidth){currentWidth=Math.round(currentHeight*aspectRatio);}aspectRatio=forcedAspectRatio||bothAxisDefined?getAspectRatio(currentWidth,currentHeight):$imageCropRectAspectRatio;// now we have both width and height let's re-fit the min max size\nvar currentSize=sizeCreate(currentWidth,currentHeight);if(!sizeContains(resizeMaxSize,currentSize)){// too big\ncurrentSize=rectContainRect(resizeMaxSize,aspectRatio);}if(!sizeContains(currentSize,resizeMinSize)){// too small\ncurrentSize=rectCoverRect(resizeMinSize,aspectRatio);}$$invalidate(4,width=inputWidth!=null?Math.round(currentSize.width):undefined);$$invalidate(5,height=inputHeight!=null?Math.round(currentSize.height):undefined);};var handleSubmit=function handleSubmit(){// calculate correct values\nconsolidateSize();// get curent values so we can check if they were changed (if not, no need to write history or update)\nvar _ref291=$imageOutputSize||{},currentWidth=_ref291.width,currentHeight=_ref291.height;// no need to update\nif(currentWidth===width&&currentHeight===height)return;// update state\nif(!width&&!height){// reset image crop\nset_store_value(imageCropAspectRatio,$imageCropAspectRatio=$imageSize.width/$imageSize.height,$imageCropAspectRatio);set_store_value(imageCropAspectRatio,$imageCropAspectRatio=undefined,$imageCropAspectRatio);// reset output size\nset_store_value(imageOutputSize,$imageOutputSize=undefined,$imageOutputSize);}else{if(width&&height)set_store_value(imageCropAspectRatio,$imageCropAspectRatio=width/height,$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=sizeCreate(width,height),$imageOutputSize);}history.write();};// handle external updates to outputSize\nimageOutputSize.subscribe(function(size){if(!size){$$invalidate(4,width=undefined);$$invalidate(5,height=undefined);return;}$$invalidate(4,width=size.width);$$invalidate(5,height=size.height);// make sure the size conforms to min max\nconsolidateSize();});// if the crop aspect ratio is changed we need to align width/height\nimageCropAspectRatio.subscribe(function(cropAspectRatio){// exit if no dimensions supplied\nif(!width&&!height)return;// no crop aspect ratio has been selected, so all is fine\nif(!cropAspectRatio)return;// fix size to match new aspect ratio of the crop\nif(width&&height&&getAspectRatio(width,height)!==cropAspectRatio){$$invalidate(5,height=width/cropAspectRatio);consolidateSize(cropAspectRatio);}else{consolidateSize();}});//\n// Footer\n//\nvar footerOffset=spring(0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(42,$footerOffset=value);});function input0_input_handler(){width=this.value;$$invalidate(4,width);}function input1_change_handler(){maintainAspectRatio=this.checked;$$invalidate(3,maintainAspectRatio);}function input2_input_handler(){height=this.value;$$invalidate(5,height);}function div3_binding($$value){binding_callbacks[$$value?\"unshift\":\"push\"](function(){fieldsGroup=$$value;$$invalidate(2,fieldsGroup);});}function measure_handler(event){bubble($$self,event);}$$self.$$set=function($$props){if(\"isActive\"in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if(\"stores\"in $$props)$$invalidate(24,stores=$$props.stores);if(\"locale\"in $$props)$$invalidate(1,locale=$$props.locale);if(\"resizeMinSize\"in $$props)$$invalidate(25,resizeMinSize=$$props.resizeMinSize);if(\"resizeMaxSize\"in $$props)$$invalidate(26,resizeMaxSize=$$props.resizeMaxSize);};var widthState;var heightState;var footerStyle;$$self.$$.update=function(){if($$self.$$.dirty[0]&/*maintainAspectRatio*/8){iconActiveFraction.set(maintainAspectRatio?1:0);}if($$self.$$.dirty[1]&/*activeField*/8){if(activeField)lastActiveField=activeField;}if($$self.$$.dirty[0]&/*width*/16){$$invalidate(32,widthFormatted=formatValue(width));}if($$self.$$.dirty[0]&/*height*/32){$$invalidate(33,heightFormatted=formatValue(height));}if($$self.$$.dirty[0]&/*resizeMinSize, resizeMaxSize*/100663296|$$self.$$.dirty[1]&/*widthFormatted, activeField*/10){$$invalidate(8,widthState=widthFormatted!=null&&activeField!==\"width\"?widthFormatted>=resizeMinSize.width&&widthFormatted<=resizeMaxSize.width?\"valid\":\"invalid\":\"undetermined\");}if($$self.$$.dirty[0]&/*resizeMinSize, resizeMaxSize*/100663296|$$self.$$.dirty[1]&/*heightFormatted, activeField*/12){$$invalidate(9,heightState=heightFormatted!=null&&activeField!==\"height\"?heightFormatted>=resizeMinSize.height&&heightFormatted<=resizeMaxSize.height?\"valid\":\"invalid\":\"undetermined\");}if($$self.$$.dirty[1]&/*heightFormatted, $imageCropRectAspectRatio, $imageCropRect*/100){$$invalidate(6,widthPlaceholder=Math.round(heightFormatted!=null?heightFormatted*$imageCropRectAspectRatio:$imageCropRect.width));}if($$self.$$.dirty[1]&/*widthFormatted, $imageCropRectAspectRatio, $imageCropRect*/98){$$invalidate(7,heightPlaceholder=Math.round(widthFormatted!=null?widthFormatted/$imageCropRectAspectRatio:$imageCropRect.height));}if($$self.$$.dirty[0]&/*maintainAspectRatio, width, height*/56){if(maintainAspectRatio&&width&&height)syncFields();}if($$self.$$.dirty[1]&/*$isActive*/1024){footerOffset.set($isActive?0:20);}if($$self.$$.dirty[1]&/*$footerOffset*/2048){$$invalidate(10,footerStyle=$footerOffset?\"transform: translateY(\".concat($footerOffset,\"px)\"):undefined);}};return[isActive,locale,fieldsGroup,maintainAspectRatio,width,height,widthPlaceholder,heightPlaceholder,widthState,heightState,footerStyle,$iconActiveFraction,iconActiveFraction,imageSize,imageCropRect,imageCropRectAspectRatio,imageCropAspectRatio,imageOutputSize,formId,handleFocusIn,handleFocusOut,handleSubmit,footerOffset,name,stores,resizeMinSize,resizeMaxSize,input0_input_handler,input1_change_handler,input2_input_handler,div3_binding,measure_handler];}var Resize=/*#__PURE__*/function(_SvelteComponent43){_inherits(Resize,_SvelteComponent43);var _super45=_createSuper(Resize);function Resize(options){var _this45;_classCallCheck(this,Resize);_this45=_super45.call(this);init(_assertThisInitialized(_this45),options,instance$G,create_fragment$G,safe_not_equal,{name:23,isActive:0,stores:24,locale:1,resizeMinSize:25,resizeMaxSize:26},[-1,-1]);return _this45;}_createClass(Resize,[{key:\"name\",get:function get(){return this.$$.ctx[23];}},{key:\"isActive\",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$set({isActive:isActive});flush();}},{key:\"stores\",get:function get(){return this.$$.ctx[24];},set:function set(stores){this.$set({stores:stores});flush();}},{key:\"locale\",get:function get(){return this.$$.ctx[1];},set:function set(locale){this.$set({locale:locale});flush();}},{key:\"resizeMinSize\",get:function get(){return this.$$.ctx[25];},set:function set(resizeMinSize){this.$set({resizeMinSize:resizeMinSize});flush();}},{key:\"resizeMaxSize\",get:function get(){return this.$$.ctx[26];},set:function set(resizeMaxSize){this.$set({resizeMaxSize:resizeMaxSize});flush();}}]);return Resize;}(SvelteComponent);// @ts-ignore\nvar index$6={util:['resize',Resize]};var cropSelectPresetOptionsDefault=[['Crop',[[undefined,'Custom'],[1,'Square'],[4/3,'Landscape'],[3/4,'Portrait']]],['Size',[[[180,180],'Profile Picture'],[[1200,600],'Header Image'],[[800,400],'Timeline Photo']]]];var defaults$2={cropSelectPresetOptions:cropSelectPresetOptionsDefault};var IconCross='<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M18 6L6 18M6 6l12 12\"></path></path></g>';var en_gb={// generic\nlabelReset:'Reset',labelDefault:'Default',labelAuto:'Auto',labelNone:'None',labelEdit:'Edit',labelClose:'Close',labelSupportError:function labelSupportError(features){return\"\".concat(features.join(', '),\" not supported on this browser\");},// sizes\nlabelSizeExtraSmall:'Extra small',labelSizeSmall:'Small',labelSizeMediumSmall:'Medium small',labelSizeMedium:'Medium',labelSizeMediumLarge:'Medium large',labelSizeLarge:'Large',labelSizeExtraLarge:'Extra large',// unused?\nlabelButtonRevert:'Revert',labelButtonCancel:'Cancel',labelButtonUndo:'Undo',labelButtonRedo:'Redo',labelButtonExport:'Done',iconSupportError:\"<g fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\\\"/><g><line x1=\\\"12\\\" y1=\\\"9\\\" x2=\\\"12\\\" y2=\\\"13\\\"/><line x1=\\\"12\\\" y1=\\\"17\\\" x2=\\\"12.01\\\" y2=\\\"17\\\"/></g>\",iconButtonClose:IconCross,iconButtonRevert:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><path d=\\\"M7.388 18.538a8 8 0 10-2.992-9.03\\\"/><path fill=\\\"currentColor\\\" d=\\\"M2.794 11.696L2.37 6.714l5.088 3.18z\\\"/><path d=\\\"M12 8v4M12 12l4 2\\\"/></g>\",iconButtonUndo:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><path d=\\\"M10 8h4c2.485 0 5 2 5 5s-2.515 5-5 5h-4\\\"/><path fill=\\\"currentColor\\\" d=\\\"M5 8l4-3v6z\\\"/></g>\",iconButtonRedo:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><path d=\\\"M14 8h-4c-2.485 0-5 2-5 5s2.515 5 5 5h4\\\"/><path fill=\\\"currentColor\\\" d=\\\"M19 8l-4-3v6z\\\"/></g>\",iconButtonExport:\"<polyline points=\\\"20 6 9 17 4 12\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"></polyline>\",// status\nstatusLabelButtonClose:'Close',statusIconButtonClose:IconCross,statusLabelLoadImage:function statusLabelLoadImage(state){if(!state||!state.task)return'Waiting for image';if(state.error)return state.error.code==='IMAGE_TOO_SMALL'?'Minimum image size is {minWidth} × {minHeight}':'Error loading image';if(state.task==='blob-to-bitmap')return'Creating preview…';return'Loading image…';},// processing status message\nstatusLabelProcessImage:function statusLabelProcessImage(state){if(!state||!state.task)return undefined;if(state.task==='store'){if(state.error)return'Error uploading image';return'Uploading image…';}if(state.error)return'Error processing image';return'Processing image…';}};var MarkupEditor={shapeLabelButtonSelectSticker:'Select image',shapeIconButtonSelectSticker:\"<g><circle fill=\\\"currentColor\\\" cx=\\\"5\\\" cy=\\\"6\\\" r=\\\"1.333\\\"/><g fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"0.0625em\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"><rect x=\\\"1\\\" y=\\\"1\\\" width=\\\"14\\\" height=\\\"14\\\" rx=\\\"2\\\"/><path d=\\\"M15 13l-5-6-5 8\\\"/></g></g>\",shapeIconButtonFlipHorizontal:\"<svg width=\\\"24\\\" height=\\\"24\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g stroke=\\\"#FFF\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\"><path d=\\\"M6 6.5h5v11H6z\\\"/><path fill=\\\"#FFF\\\" d=\\\"M15 6.5h3v11h-3z\\\"/><path d=\\\"M11 4v16\\\" fill=\\\"#fff\\\"/></g></svg>\",shapeIconButtonFlipVertical:\"<g stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><rect x=\\\"7\\\" y=\\\"8\\\" width=\\\"11\\\" height=\\\"5\\\" fill=\\\"none\\\"/><rect x=\\\"7\\\" y=\\\"17\\\" width=\\\"11\\\" height=\\\"2\\\" fill=\\\"currentColor\\\"/><line x1=\\\"5\\\" y1=\\\"13\\\" x2=\\\"20\\\" y2=\\\"13\\\"/></g>\",shapeIconButtonRemove:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\"><path stroke=\\\"#FFF\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" d=\\\"M7.5 7h9z\\\"/><path d=\\\"M7.916 9h8.168a1 1 0 01.99 1.14l-.972 6.862a2 2 0 01-1.473 1.653c-.877.23-1.753.345-2.629.345-.876 0-1.752-.115-2.628-.345a2 2 0 01-1.473-1.653l-.973-6.862A1 1 0 017.916 9z\\\" fill=\\\"#FFF\\\"/><rect fill=\\\"#FFF\\\" x=\\\"10\\\" y=\\\"5\\\" width=\\\"4\\\" height=\\\"3\\\" rx=\\\"1\\\"/></g>\",shapeIconButtonDuplicate:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\"><path d=\\\"M15 13.994V16a2 2 0 01-2 2H8a2 2 0 01-2-2v-5a2 2 0 012-2h2.142\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"/><path d=\\\"M15 9V8a1 1 0 00-2 0v1h-1a1 1 0 000 2h1v1a1 1 0 002 0v-1h1a1 1 0 000-2h-1zm-4-4h6a2 2 0 012 2v6a2 2 0 01-2 2h-6a2 2 0 01-2-2V7a2 2 0 012-2z\\\" fill=\\\"currentColor\\\"/></g>\",shapeIconButtonMoveToFront:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\"><rect fill=\\\"currentColor\\\" x=\\\"11\\\" y=\\\"13\\\" width=\\\"8\\\" height=\\\"2\\\" rx=\\\"1\\\"/><rect fill=\\\"currentColor\\\" x=\\\"9\\\" y=\\\"17\\\" width=\\\"10\\\" height=\\\"2\\\" rx=\\\"1\\\"/><path d=\\\"M11.364 8H10a5 5 0 000 10M12 6.5L14.5 8 12 9.5z\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\" stroke-linecap=\\\"round\\\"/></g>\",shapeTitleButtonFlipHorizontal:'Flip Horizontal',shapeTitleButtonFlipVertical:'Flip Vertical',shapeTitleButtonRemove:'Remove',shapeTitleButtonDuplicate:'Duplicate',shapeTitleButtonMoveToFront:'Move to front',shapeLabelInputText:'Edit text',shapeIconInputCancel:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><path d=\\\"M18 6L6 18M6 6l12 12\\\"/></g>\",shapeIconInputConfirm:\"<g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><polyline points=\\\"20 6 9 17 4 12\\\"/></g>\",shapeLabelInputCancel:'Cancel',shapeLabelInputConfirm:'Confirm',shapeLabelStrokeNone:'No outline',shapeLabelFontStyleNormal:'Normal',shapeLabelFontStyleBold:'Bold',shapeLabelFontStyleItalic:'Italic',shapeLabelFontStyleItalicBold:'Italic Bold',shapeTitleBackgroundColor:'Fill color',shapeTitleFontFamily:'Font',shapeTitleFontSize:'Font size',shapeTitleFontStyle:'Font style',shapeTitleLineHeight:'Leading',shapeTitleLineStart:'Start',shapeTitleLineEnd:'End',shapeTitleStrokeWidth:'Line width',shapeTitleStrokeColor:'Line color',shapeTitleLineDecorationBar:'Bar',shapeTitleLineDecorationCircle:'Circle',shapeTitleLineDecorationSquare:'Square',shapeTitleLineDecorationArrow:'Arrow',shapeTitleLineDecorationCircleSolid:'Circle solid',shapeTitleLineDecorationSquareSolid:'Square solid',shapeTitleLineDecorationArrowSolid:'Arrow solid',shapeIconLineDecorationBar:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-width=\\\".125em\\\"><path d=\\\"M5,12 H16\\\"/><path d=\\\"M16,8 V16\\\"/></g>\",shapeIconLineDecorationCircle:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\"><path stroke-width=\\\".125em\\\" d=\\\"M5,12 H12\\\"/><circle fill=\\\"none\\\" stroke-width=\\\".125em\\\" cx=\\\"16\\\" cy=\\\"12\\\" r=\\\"4\\\"/></g>\",shapeIconLineDecorationSquare:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-width=\\\".125em\\\"><path d=\\\"M5,12 H16\\\"/><path d=\\\"M13,7 l6,5 l-6,5z\\\" fill=\\\"currentColor\\\"/></g>\",shapeIconLineDecorationArrow:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-width=\\\".125em\\\"><path d=\\\"M5,12 H16 M13,7 l6,5 l-6,5\\\" fill=\\\"none\\\"/></g>\",shapeIconLineDecorationCircleSolid:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\"><path stroke-width=\\\".125em\\\" d=\\\"M5,12 H12\\\"/><circle fill=\\\"currentColor\\\" cx=\\\"16\\\" cy=\\\"12\\\" r=\\\"4\\\"/></g>\",shapeIconLineDecorationSquareSolid:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\"><path stroke-width=\\\".125em\\\" d=\\\"M5,12 H12\\\"/><rect fill=\\\"currentColor\\\" x=\\\"12\\\" y=\\\"8\\\" width=\\\"8\\\" height=\\\"8\\\"/></g>\",shapeIconLineDecorationArrowSolid:\"<g stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" stroke-width=\\\".125em\\\"><path d=\\\"M5,12 H16\\\"/><path d=\\\"M13,7 l6,5 l-6,5z\\\" fill=\\\"currentColor\\\"/></g>\",shapeTitleColorTransparent:'Transparent',shapeTitleColorWhite:'White',shapeTitleColorSilver:'Silver',shapeTitleColorGray:'Gray',shapeTitleColorBlack:'Black',shapeTitleColorNavy:'Navy',shapeTitleColorBlue:'Blue',shapeTitleColorAqua:'Aqua',shapeTitleColorTeal:'Teal',shapeTitleColorOlive:'Olive',shapeTitleColorGreen:'Green',shapeTitleColorYellow:'Yellow',shapeTitleColorOrange:'Orange',shapeTitleColorRed:'Red',shapeTitleColorMaroon:'Maroon',shapeTitleColorFuchsia:'Fuchsia',shapeTitleColorPurple:'Purple',shapeTitleTextColor:'Font color',shapeTitleTextAlign:'Text align',shapeTitleTextAlignLeft:'Left align text',shapeTitleTextAlignCenter:'Center align text',shapeTitleTextAlignRight:'Right align text',shapeIconTextAlignLeft:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\"><line x1=\\\"5\\\" y1=\\\"8\\\" x2=\\\"15\\\" y2=\\\"8\\\"/><line x1=\\\"5\\\" y1=\\\"12\\\" x2=\\\"19\\\" y2=\\\"12\\\"/><line x1=\\\"5\\\" y1=\\\"16\\\" x2=\\\"14\\\" y2=\\\"16\\\"/></g>\",shapeIconTextAlignCenter:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\"><line x1=\\\"7\\\" y1=\\\"8\\\" x2=\\\"17\\\" y2=\\\"8\\\"/><line x1=\\\"5\\\" y1=\\\"12\\\" x2=\\\"19\\\" y2=\\\"12\\\"/><line x1=\\\"8\\\" y1=\\\"16\\\" x2=\\\"16\\\" y2=\\\"16\\\"/></g>\",shapeIconTextAlignRight:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\"><line x1=\\\"9\\\" y1=\\\"8\\\" x2=\\\"19\\\" y2=\\\"8\\\"/><line x1=\\\"5\\\" y1=\\\"12\\\" x2=\\\"19\\\" y2=\\\"12\\\"/><line x1=\\\"11\\\" y1=\\\"16\\\" x2=\\\"19\\\" y2=\\\"16\\\"/></g>\",shapeLabelToolSharpie:'Sharpie',shapeLabelToolEraser:'Eraser',shapeLabelToolRectangle:'Rectangle',shapeLabelToolEllipse:'Ellipse',shapeLabelToolArrow:'Arrow',shapeLabelToolLine:'Line',shapeLabelToolText:'Text',shapeLabelToolPreset:'Stickers',shapeIconToolSharpie:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\"><path d=\\\"M2.025 5c5.616-2.732 8.833-3.857 9.65-3.374C12.903 2.351.518 12.666 2.026 14 3.534 15.334 16.536.566 17.73 2.566 18.924 4.566 3.98 17.187 4.831 18c.851.813 9.848-6 11.643-6 1.087 0-2.53 5.11-2.92 7-.086.41 3.323-1.498 4.773-1 .494.17.64 2.317 1.319 3 .439.443 1.332.776 2.679 1\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" stroke-linejoin=\\\"round\\\"/></g>\",shapeIconToolEraser:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" stroke-linecap=\\\"round\\\" fill=\\\"none\\\"><g transform=\\\"translate(3, 15) rotate(-45)\\\"><rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"18\\\" height=\\\"10\\\" rx=\\\"3\\\"/></g><line x1=\\\"11\\\" y1=\\\"21\\\" x2=\\\"18\\\" y2=\\\"21\\\"/><line x1=\\\"20\\\" y1=\\\"21\\\" x2=\\\"22\\\" y2=\\\"21\\\"/></g>\",shapeIconToolRectangle:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\"><rect x=\\\"2\\\" y=\\\"2\\\" width=\\\"20\\\" height=\\\"20\\\" rx=\\\"3\\\"/></g>\",shapeIconToolEllipse:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\"><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"11\\\"/></g>\",shapeIconToolArrow:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\"><line x1=\\\"20\\\" y1=\\\"3\\\" x2=\\\"6\\\" y2=\\\"21\\\"/><path d=\\\"m10 5 L22 1 L21 13\\\" fill=\\\"currentColor\\\" stroke=\\\"none\\\"/></g>\",shapeIconToolLine:\"<g stroke-width=\\\".125em\\\" stroke=\\\"currentColor\\\" fill=\\\"none\\\"><line x1=\\\"20\\\" y1=\\\"3\\\" x2=\\\"6\\\" y2=\\\"21\\\"/></g>\",shapeIconToolText:\"<g stroke=\\\"none\\\" fill=\\\"currentColor\\\" transform=\\\"translate(6,0)\\\"><path d=\\\"M8.14 20.085c.459 0 .901-.034 1.329-.102a8.597 8.597 0 001.015-.21v1.984c-.281.135-.695.247-1.242.336a9.328 9.328 0 01-1.477.133c-3.312 0-4.968-1.745-4.968-5.235V6.804H.344v-1.25l2.453-1.078L3.89.819h1.5v3.97h4.97v2.015H5.39v10.078c0 1.031.245 1.823.735 2.375s1.161.828 2.015.828z\\\"/>\",shapeIconToolPreset:\"<g fill=\\\"none\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke=\\\"currentColor\\\" stroke-width=\\\".125em\\\"><path d=\\\"M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z\\\"></path><path d=\\\"M20 17c-3 3-5 5-8 5\\\"></path></g>\"};var en_gb$1={cropLabel:'Crop',cropIcon:'<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M23 17H9a2 2 0 0 1-2-2v-5m0-3V1\"/><path d=\"M1 7h14a2 2 0 0 1 2 2v7m0 4v3\"/></g>',cropIconButtonRecenter:\"<path stroke=\\\"currentColor\\\" fill=\\\"none\\\" stroke-width=\\\"2\\\" stroke-linejoin=\\\"bevel\\\" d=\\\"M1.5 7.5v-6h6M1.5 16.5v6h6M22.5 16.5v6h-6M22.5 7.5v-6h-6\\\"/><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3.5\\\" fill=\\\"currentColor\\\" stroke=\\\"none\\\"/>\",cropIconButtonRotateLeft:'<g stroke=\"none\" fill=\"currentColor\"><path fill=\"none\" d=\"M-1-1h582v402H-1z\"/><rect x=\"3\" rx=\"1\" height=\"12\" width=\"12\" y=\"9\"/><path d=\"M15 5h-1a5 5 0 015 5 1 1 0 002 0 7 7 0 00-7-7h-1.374l.747-.747A1 1 0 0011.958.84L9.603 3.194a1 1 0 000 1.415l2.355 2.355a1 1 0 001.415-1.414l-.55-.55H15z\"/></g>',cropIconButtonRotateRight:'<g stroke=\"none\" fill=\"currentColor\"><path fill=\"none\" d=\"M-1-1h582v402H-1z\"/><path d=\"M11.177 5H10a5 5 0 00-5 5 1 1 0 01-2 0 7 7 0 017-7h1.374l-.747-.747A1 1 0 0112.042.84l2.355 2.355a1 1 0 010 1.415l-2.355 2.354a1 1 0 01-1.415-1.414l.55-.55z\"/><rect rx=\"1\" height=\"12\" width=\"12\" y=\"9\" x=\"9\"/></g>',cropIconButtonFlipVertical:'<g stroke=\"none\" fill=\"currentColor\"><path d=\"M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z\"/><path d=\"M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z\" opacity=\".6\"/></g>',cropIconButtonFlipHorizontal:'<g stroke=\"none\" fill=\"currentColor\"><path d=\"M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z\"/><path d=\"M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z\" opacity=\".6\"/></g>',cropLabelButtonRecenter:'Recenter',cropLabelButtonRotateLeft:'Rotate left',cropLabelButtonRotateRight:'Rotate right',cropLabelButtonFlipHorizontal:'Flip horizontal',cropLabelButtonFlipVertical:'Flip vertical',cropLabelSelectPreset:'Crop shape',cropLabelCropBoundary:'Crop boundary',cropLabelCropBoundaryEdge:'Edge of image',cropLabelCropBoundaryNone:'None',cropLabelTabRotation:'Rotation',cropLabelTabZoom:'Zoom'};var en_gb$2={filterLabel:'Filter',filterIcon:'<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417\"/><path d=\"M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51\"/></g>',filterLabelChrome:'Chrome',filterLabelFade:'Fade',filterLabelCold:'Cold',filterLabelWarm:'Warm',filterLabelPastel:'Pastel',filterLabelMonoDefault:'Mono',filterLabelMonoNoir:'Noir',filterLabelMonoWash:'Wash',filterLabelMonoStark:'Stark',filterLabelSepiaDefault:'Sepia',filterLabelSepiaBlues:'Blues',filterLabelSepiaRust:'Rust',filterLabelSepiaColor:'Color'};var en_gb$3={finetuneLabel:'Finetune',finetuneIcon:'<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4\"/></g>',finetuneLabelBrightness:'Brightness',finetuneLabelContrast:'Contrast',finetuneLabelSaturation:'Saturation',finetuneLabelExposure:'Exposure',finetuneLabelTemperature:'Temperature',finetuneLabelGamma:'Gamma',finetuneLabelClarity:'Clarity',finetuneLabelVignette:'Vignette'};var en_gb$4={resizeLabel:'Resize',resizeIcon:'<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><rect x=\"2\" y=\"12\" width=\"10\" height=\"10\" rx=\"2\"/><path d=\"M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5\"/><path d=\"M14 10l3.365-3.365M14 6h4v4\"/></g>',resizeLabelFormCaption:'Image output size',resizeLabelInputWidth:'w',resizeTitleInputWidth:'Width',resizeLabelInputHeight:'h',resizeTitleInputHeight:'Height',resizeTitleButtonMaintainAspectRatio:'Maintain aspectratio',resizeIconButtonMaintainAspectRatio:function resizeIconButtonMaintainAspectRatio(active,activeFraction){return\"\\n        <defs>\\n            <mask id=\\\"mask1\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"24\\\" height=\\\"24\\\" >\\n                <rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"24\\\" height=\\\"10\\\" fill=\\\"#fff\\\" stroke=\\\"none\\\"/>\\n            </mask>\\n        </defs>\\n        <g fill=\\\"none\\\" fill-rule=\\\"evenodd\\\">\\n            <g  mask=\\\"url(#mask1)\\\">\\n                <path transform=\\\"translate(0 \".concat((activeFraction-1)*3,\")\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"1.5\\\" stroke-linecap=\\\"round\\\" d=\\\"M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V17\\\"/>\\n            </g>\\n            <rect fill=\\\"currentColor\\\" x=\\\"7\\\" y=\\\"10\\\" width=\\\"10\\\" height=\\\"7\\\" rx=\\\"1.5\\\"/>\\n        </g>\\n    \");}};var en_gb$5={decorateLabel:'Decorate',decorateIcon:'<g fill=\"none\" fill-rule=\"evenodd\"><path stroke=\"currentColor\" stroke-width=\".125em\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 18.5l-6.466 3.4 1.235-7.2-5.23-5.1 7.228-1.05L12 2l3.233 6.55 7.229 1.05-5.231 5.1 1.235 7.2z\"/></g>'};var en_gb$6={annotateLabel:'Annotate',annotateIcon:'<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z\"/></g>'};var en_gb$7={stickerLabel:'Sticker',stickerIcon:'<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z\"/><path d=\"M20 17c-3 3-5 5-8 5\"/></g>'};/* Deprecated, remove in v8, use `createDefaultImageOrienter` instead */var imageOrienter={read:getImageOrientationFromFile,apply:orientImageData};var createDefaultImageOrienter=function createDefaultImageOrienter(){return{read:getImageOrientationFromFile,apply:orientImageData};};var createEditor=createImageEditor;var getEditorProps$1=function getEditorProps$1(){return getEditorProps().concat(getEditorViewProps());};var processImage=function processImage(src,options){var _createImageEditor=createImageEditor(),processImage=_createImageEditor.processImage;return processImage(src,options);};var createMarkupEditorToolbar=createToolbar;var createMarkupEditorToolStyles=createToolStyles;// markup editor style controls\nvar createMarkupEditorShapeStyleControls=createShapeStyleControls;var markup_editor_defaults={markupEditorToolbar:createToolbar(),markupEditorToolStyles:createToolStyles(),markupEditorShapeStyleControls:createShapeStyleControls()};//\n// deprecated exports\n//\nvar plugin_annotate_defaults=_objectSpread(_objectSpread({},markup_editor_defaults),{},{annotateTools:createToolbar(),annotateToolShapes:createToolStyles(),annotateShapeControls:createShapeStyleControls()});var plugin_decorate_defaults=_objectSpread(_objectSpread({},markup_editor_defaults),{},{decorateTools:createToolbar(),decorateToolShapes:createToolStyles(),decorateShapeControls:createShapeStyleControls()});var plugin_resize_defaults={};var plugin_sticker_defaults={};export{appendEditor,appendEditors,appendNode,blobToFile,colorStringToColorArray,MarkupEditor as component_shape_editor_locale_en_gb,createDefaultColorOptions,createDefaultFontFamilyOptions,createDefaultFontScaleOptions,createDefaultFontSizeOptions,createDefaultFontStyleOptions,createDefaultImageOrienter,createDefaultImageReader,createDefaultImageWriter,createDefaultLineEndStyleOptions,createDefaultStrokeScaleOptions,createDefaultStrokeWidthOptions,createDefaultTextAlignOptions,createEditor,createBackgroundColorControl as createMarkupEditorBackgroundColorControl,createColorOptions as createMarkupEditorColorOptions,createFontColorControl as createMarkupEditorFontColorControl,createFontFamilyControl as createMarkupEditorFontFamilyControl,createFontFamilyOptions as createMarkupEditorFontFamilyOptions,createFontScaleOptions as createMarkupEditorFontScaleOptions,createFontSizeControl as createMarkupEditorFontSizeControl,createFontSizeOptions as createMarkupEditorFontSizeOptions,createFontStyleControl as createMarkupEditorFontStyleControl,createFontStyleOptions as createMarkupEditorFontStyleOptions,createLineEndStyleControl as createMarkupEditorLineEndStyleControl,createLineEndStyleOptions as createMarkupEditorLineEndStyleOptions,createLineHeightControl as createMarkupEditorLineHeightControl,createLineStartStyleControl as createMarkupEditorLineStartStyleControl,createMarkupEditorShapeStyleControls,createStrokeColorControl as createMarkupEditorStrokeColorControl,createStrokeScaleOptions as createMarkupEditorStrokeScaleOptions,createStrokeWidthControl as createMarkupEditorStrokeWidthControl,createStrokeWidthOptions as createMarkupEditorStrokeWidthOptions,createTextAlignControl as createMarkupEditorTextAlignControl,createToolStyle as createMarkupEditorToolStyle,createMarkupEditorToolStyles,createMarkupEditorToolbar,createNode,customElement as defineCustomElements,degToRad,dispatchEditorEvents,brightness as effectBrightness,clarity as effectClarity,contrast as effectContrast,exposure as effectExposure,gamma as effectGamma,saturation as effectSaturation,temperature as effectTemperature,vignette as effectVignette,chrome as filterChrome,cold as filterCold,fade$1 as filterFade,invert as filterInvert,monoDefault as filterMonoDefault,monoNoir as filterMonoNoir,monoStark as filterMonoStark,monoWash as filterMonoWash,pastel as filterPastel,sepiaBlues as filterSepiaBlues,sepiaColor as filterSepiaColor,sepiaDefault as filterSepiaDefault,sepiaRust as filterSepiaRust,warm as filterWarm,findNode,getEditorProps$1 as getEditorProps,imageOrienter,insertNodeAfter,insertNodeBefore,isModernBrowser as isSupported,legacyDataToImageState,en_gb as locale_en_gb,markup_editor_defaults,MarkupEditor as markup_editor_locale_en_gb,openEditor,overlayEditor,index$3 as plugin_annotate,plugin_annotate_defaults,en_gb$6 as plugin_annotate_locale_en_gb,index as plugin_crop,defaults$2 as plugin_crop_defaults,en_gb$1 as plugin_crop_locale_en_gb,index$4 as plugin_decorate,plugin_decorate_defaults,en_gb$5 as plugin_decorate_locale_en_gb,index$1 as plugin_filter,defaults$1 as plugin_filter_defaults,en_gb$2 as plugin_filter_locale_en_gb,index$2 as plugin_finetune,defaults as plugin_finetune_defaults,en_gb$3 as plugin_finetune_locale_en_gb,index$6 as plugin_resize,plugin_resize_defaults,en_gb$4 as plugin_resize_locale_en_gb,index$5 as plugin_sticker,plugin_sticker_defaults,en_gb$7 as plugin_sticker_locale_en_gb,processImage,removeNode,setEditorViewPlugins as setPlugins};","map":null,"metadata":{},"sourceType":"module"}