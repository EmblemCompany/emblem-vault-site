{"ast":null,"code":"var __jsx = React.createElement;\nimport { Box, Flex, Image, Text, Stack, Button, ButtonGroup, Input, useDisclosure } from '@chakra-ui/core';\nimport { useWeb3React } from '@web3-react/core';\nimport React, { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport Loader from 'react-loader';\nimport dynamic from 'next/dynamic';\nimport { validImage } from '../utils';\nimport { TransactionToast } from './TransactionToast';\nimport { EMBLEM_API, BURN_ADDRESS, contractAddresses } from '../constants';\nimport { useContract } from '../hooks';\nconst AddrModal = dynamic(() => import('./AddrModal'), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('./AddrModal')],\n    modules: ['./AddrModal']\n  }\n});\nexport default function Vault() {\n  const {\n    account,\n    chainId\n  } = useWeb3React();\n  const {\n    query,\n    pathname,\n    replace\n  } = useRouter();\n  const [tokenId, setTokenId] = React.useState(query.id);\n  const [vaultName, setVaultName] = React.useState('');\n  const [vaultDesc, setVaultDesc] = React.useState('');\n  const [vaultImage, setVaultImage] = React.useState('');\n  const [vaultValues, setVaultValues] = React.useState([]);\n  const [vaultAddresses, setVaultAddresses] = React.useState([]);\n  const [vaultPrivacy, setVaultPrivacy] = React.useState(false);\n  const [hash, setHash] = React.useState(null);\n  const [currCoin, setCurrCoin] = React.useState('');\n  const [currAddr, setCurrAddr] = React.useState('');\n  const [state, setState] = React.useState({\n    loaded: false\n  });\n  const [allowed, setAllowed] = React.useState(false);\n  const [mine, setMine] = React.useState(false);\n  const [claiming, setClaiming] = React.useState(false);\n  const handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true);\n  const emblemContract = useContract(contractAddresses.emblemVault[chainId], contractAddresses.emblemAbi, true);\n  const {\n    isOpen: isOpenAddrModal,\n    onOpen: onOpenAddrModal,\n    onClose: onCloseAddrModal\n  } = useDisclosure();\n\n  const getVault = async () => {\n    const responce = await fetch(EMBLEM_API + '/meta/' + tokenId, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        service: 'evmetadata',\n        chainId: chainId.toString()\n      }\n    });\n    const jsonData = await responce.json();\n    console.log(jsonData);\n    setVaultName(jsonData.name);\n    setVaultImage(jsonData.image);\n    setVaultDesc(jsonData.description);\n    setVaultValues(jsonData.values);\n    setVaultDesc(jsonData.description);\n    setVaultAddresses(jsonData.addresses);\n    setState({\n      loaded: true\n    });\n  };\n\n  const getContractStates = async () => {\n    let owner = await emblemContract.ownerOf(tokenId);\n    setMine(owner === account);\n\n    if (mine) {\n      setAllowed(true);\n    }\n  };\n\n  const handleApprove = async () => {\n    emblemContract.setApprovalForAll(contractAddresses.vaultHandler[chainId], true).then(({\n      hash\n    }) => {\n      setHash(hash);\n    });\n  };\n\n  const handleClaim = async () => {\n    // console.log(tokenId)\n    emblemContract.transferFrom(account, BURN_ADDRESS, tokenId).then(({\n      hash\n    }) => {\n      setHash(hash);\n      setClaiming(true);\n    });\n  };\n\n  useEffect(() => {\n    getVault();\n  }, []);\n  useEffect(() => {\n    getContractStates();\n  });\n\n  function splitDescription(words) {\n    var desc = words.split('Emblem Vault Basic');\n    return desc[0].trim();\n  }\n\n  function tryDecrypt(pass) {\n    console.log(pass);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(AddrModal, {\n    isOpen: isOpenAddrModal,\n    onClose: onCloseAddrModal,\n    addrCoin: currCoin,\n    addrAddr: currAddr\n  }), __jsx(Loader, {\n    loaded: state.loaded\n  }, __jsx(Flex, {\n    width: \"full\",\n    align: \"center\",\n    justifyContent: \"center\"\n  }, __jsx(Box, {\n    maxW: \"sm\",\n    borderWidth: \"1px\",\n    rounded: \"lg\",\n    overflow: \"hidden\",\n    alignItems: \"center\"\n  }, __jsx(Box, {\n    mt: \"1\",\n    fontWeight: \"semibold\",\n    as: \"h3\",\n    lineHeight: \"tight\",\n    p: 2,\n    textAlign: \"center\",\n    textTransform: \"uppercase\",\n    alignItems: \"center\"\n  }, vaultName), __jsx(Stack, {\n    align: \"center\"\n  }, __jsx(Image, {\n    src: validImage(vaultImage) ? vaultImage : 'https://circuitsofvalue.com/public/coval-logo.png',\n    size: \"250px\"\n  })), __jsx(Stack, {\n    align: \"center\"\n  }, __jsx(Box, {\n    mt: \"1\",\n    fontWeight: \"semibold\",\n    as: \"h4\",\n    lineHeight: \"tight\"\n  }, splitDescription(vaultDesc))), __jsx(Box, {\n    p: \"6\"\n  }, __jsx(Box, {\n    d: \"flex\",\n    alignItems: \"baseline\"\n  }, __jsx(Box, {\n    color: \"gray.500\",\n    fontWeight: \"semibold\",\n    letterSpacing: \"wide\",\n    fontSize: \"sm\",\n    ml: \"2\"\n  }, __jsx(\"h4\", null, \"Current Contents:\"), vaultPrivacy ? __jsx(React.Fragment, null, __jsx(Text, null, \"Contents hidden. Enter password to unlock.\"), __jsx(Input, {\n    type: \"password\",\n    id: \"vault-password\",\n    onChange: e => tryDecrypt(e.target.value),\n    \"aria-describedby\": \"password-helper-text\"\n  })) : vaultValues.length ? vaultValues.map(coin => {\n    return __jsx(Text, {\n      key: coin.name,\n      isTruncated: true\n    }, coin.name, \": \", coin.balance);\n  }) : __jsx(Text, null, \"Nothing in here! Fill 'er up!\"))), __jsx(Box, {\n    d: \"flex\",\n    alignItems: \"baseline\",\n    justifyContent: \"space-between\",\n    mt: \"4\"\n  }, __jsx(Stack, {\n    direction: \"row\",\n    align: \"center\",\n    spacing: \"1rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true\n  }, __jsx(ButtonGroup, {\n    spacing: 4\n  }, vaultAddresses.map(addr => {\n    return __jsx(Button, {\n      key: addr.address,\n      onClick: () => {\n        setCurrCoin(addr.coin);\n        setCurrAddr(addr.address);\n        onOpenAddrModal();\n      }\n    }, \"Put \", addr.coin == 'ETH' ? addr.coin + '/ERC20' : addr.coin, \" In\");\n  })))), __jsx(Box, {\n    d: \"flex\",\n    alignItems: \"baseline\",\n    justifyContent: \"space-between\",\n    mt: \"4\"\n  }, mine ? __jsx(Button, {\n    width: \"100%\",\n    onClick: () => {\n      if (allowed) {\n        handleClaim();\n      } else {\n        handleApprove();\n      }\n    }\n  }, allowed ? 'Claim' : 'Approve') : '')))), hash ? __jsx(TransactionToast, {\n    hash: hash,\n    onComplete: () => {\n      if (claiming) {\n        alert('Claim tx complete. Now ask server for keys');\n      }\n\n      setHash(null);\n    }\n  }) : null));\n}","map":null,"metadata":{},"sourceType":"module"}