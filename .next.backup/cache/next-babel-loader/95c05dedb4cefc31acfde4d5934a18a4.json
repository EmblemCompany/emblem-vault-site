{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { Contract } from '@ethersproject/contracts';\nimport { useWeb3React } from '@web3-react/core';\n\nconst getContract = (address, abi, library, account) => {\n  return new Contract(address, abi, library.getSigner(account).connectUnchecked());\n};\n\nexport default function Approval(props) {\n  const {\n    account\n  } = useWeb3React();\n  const {\n    0: approved,\n    1: setApproved\n  } = useState(false);\n  const {\n    0: decimals,\n    1: setDecimals\n  } = useState(null);\n  useEffect(() => {\n    console.log('--------------', account);\n    checkApproval(props.handler, props.spending, props.library, props.account, props.amount);\n    console.log('--------------', approved);\n  });\n  return account ? __jsx(React.Fragment, null, \"approved? \", approved.toString(), \" decimals? \", decimals.toString()) : null;\n\n  function checkApproval(handler, spending, library, account, amount) {\n    if (amount > 0) {\n      let spendingContract = getContract(spending.address, spending.abi, library, account);\n      spendingContract.decimals().then(decimals => {\n        setDecimals(decimals);\n        spendingContract.allowance(account, handler.address).then(allowance => {\n          setApproved(allowance >= amount * 10 ** decimals);\n        });\n      });\n    }\n  }\n} // export class Approval extends Component<AttributesProps> {\n//   render() {\n//     let handler = this.props.handler\n//     let spending = this.props.spending\n//     let amount = this.props.amount\n//     let label = this.props.label\n//     let library = this.props.library\n//     let account = this.props.account\n//     let approved = checkApproval(handler, spending, library, account, amount)\n//     return approved? (\n//       <></>\n//     ) : (\n//       <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n//         <Button backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n//           {label}\n//         </Button>\n//       </Flex>\n//     )\n//   }\n// }\n// export default Approval","map":{"version":3,"sources":["/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/partials/Approval.tsx"],"names":["React","useEffect","useState","Contract","useWeb3React","getContract","address","abi","library","account","getSigner","connectUnchecked","Approval","props","approved","setApproved","decimals","setDecimals","console","log","checkApproval","handler","spending","amount","toString","spendingContract","then","allowance"],"mappings":";AAAA,OAAOA,KAAP,IAA2BC,SAA3B,EAAsCC,QAAtC,QAAsD,OAAtD;AAaA,SAASC,QAAT,QAAyB,0BAAzB;AACA,SAASC,YAAT,QAA6B,kBAA7B;;AAEA,MAAMC,WAAW,GAAG,CAACC,OAAD,EAAUC,GAAV,EAAeC,OAAf,EAAwBC,OAAxB,KAAwC;AAC1D,SAAO,IAAIN,QAAJ,CAAaG,OAAb,EAAsBC,GAAtB,EAA2BC,OAAO,CAACE,SAAR,CAAkBD,OAAlB,EAA2BE,gBAA3B,EAA3B,CAAP;AACD,CAFD;;AAcA,eAAe,SAASC,QAAT,CAAkBC,KAAlB,EAA0C;AAEvD,QAAM;AAAEJ,IAAAA;AAAF,MAAcL,YAAY,EAAhC;AACA,QAAM;AAAA,OAACU,QAAD;AAAA,OAAWC;AAAX,MAA0Bb,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM;AAAA,OAACc,QAAD;AAAA,OAAWC;AAAX,MAA0Bf,QAAQ,CAAC,IAAD,CAAxC;AAEAD,EAAAA,SAAS,CAAC,MAAI;AACViB,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA6BV,OAA7B;AACEW,IAAAA,aAAa,CAACP,KAAK,CAACQ,OAAP,EAAgBR,KAAK,CAACS,QAAtB,EAAgCT,KAAK,CAACL,OAAtC,EAA+CK,KAAK,CAACJ,OAArD,EAA8DI,KAAK,CAACU,MAApE,CAAb;AACAL,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BL,QAA9B;AACL,GAJQ,CAAT;AAMA,SAAOL,OAAO,GACV,0CACeK,QAAQ,CAACU,QAAT,EADf,iBAC+CR,QAAQ,CAACQ,QAAT,EAD/C,CADU,GAIX,IAJH;;AAMA,WAASJ,aAAT,CAAuBC,OAAvB,EAA+DC,QAA/D,EAAwGd,OAAxG,EAAsHC,OAAtH,EAAoIc,MAApI,EAAoJ;AAClJ,QAAIA,MAAM,GAAG,CAAb,EAAgB;AACZ,UAAIE,gBAAgB,GAAGpB,WAAW,CAACiB,QAAQ,CAAChB,OAAV,EAAmBgB,QAAQ,CAACf,GAA5B,EAAiCC,OAAjC,EAA0CC,OAA1C,CAAlC;AACAgB,MAAAA,gBAAgB,CAACT,QAAjB,GAA4BU,IAA5B,CAAkCV,QAAD,IAAmB;AAClDC,QAAAA,WAAW,CAACD,QAAD,CAAX;AACAS,QAAAA,gBAAgB,CAACE,SAAjB,CAA2BlB,OAA3B,EAAoCY,OAAO,CAACf,OAA5C,EAAqDoB,IAArD,CAA2DC,SAAD,IAAoB;AAC5EZ,UAAAA,WAAW,CAACY,SAAS,IAAIJ,MAAM,GAAG,MAAMP,QAA7B,CAAX;AACD,SAFD;AAGD,OALD;AAMH;AACF;AACF,C,CACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA","sourcesContent":["import React, { Component, useEffect, useState } from 'react'\nimport {\n  Box,\n  Image,\n  Text,\n  Link,\n  useColorMode,\n  Button,\n  Flex,\n  PseudoBox\n} from '@chakra-ui/core'\n\nimport {HStack, VStack, Circle } from '@chakra-ui/react'\nimport { Contract } from '@ethersproject/contracts'\nimport { useWeb3React } from '@web3-react/core'\n\nconst getContract = (address, abi, library, account): any =>{\n  return new Contract(address, abi, library.getSigner(account).connectUnchecked())\n}\n\n\n\ntype AttributesProps = {\n  handler: {address: string, abi: any},\n  spending: {address: string, abi: any},\n  amount: number,\n  label: string,\n  library: any,\n  account: any,\n}\nexport default function Approval(props: AttributesProps) {\n  \n  const { account } = useWeb3React()\n  const [approved, setApproved] = useState(false)\n  const [decimals, setDecimals] = useState(null)\n\n  useEffect(()=>{\n      console.log('--------------',account)\n        checkApproval(props.handler, props.spending, props.library, props.account, props.amount)\n        console.log('--------------', approved)\n  })\n  \n  return account? (\n      <>\n          approved? {approved.toString()} decimals? {decimals.toString()}\n      </>\n  ): null\n\n  function checkApproval(handler: { address: string; abi: any }, spending: { address: string; abi: any }, library: any, account: any, amount: number) {\n    if (amount > 0) {\n        let spendingContract = getContract(spending.address, spending.abi, library, account)\n        spendingContract.decimals().then((decimals: any) => {\n          setDecimals(decimals)\n          spendingContract.allowance(account, handler.address).then((allowance: any) => {\n            setApproved(allowance >= amount * 10 ** decimals)\n          })\n        })                \n    }\n  }\n}\n// export class Approval extends Component<AttributesProps> {\n//   render() {\n//     let handler = this.props.handler\n//     let spending = this.props.spending\n//     let amount = this.props.amount\n//     let label = this.props.label\n//     let library = this.props.library\n//     let account = this.props.account\n//     let approved = checkApproval(handler, spending, library, account, amount)\n//     return approved? (\n//       <></>\n//     ) : (\n//       <Flex w=\"100%\" flexWrap=\"wrap\" mt={3} >\n//         <Button backgroundColor={\"#02b402\"} color={\"black !important\"} fontWeight={\"bold !important\"} width=\"100%\">\n//           {label}\n//         </Button>\n//       </Flex>\n//     )\n//   }\n// }\n\n// export default Approval\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}