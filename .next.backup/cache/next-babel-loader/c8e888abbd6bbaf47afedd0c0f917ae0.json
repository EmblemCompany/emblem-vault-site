{"ast":null,"code":"var _jsxFileName = \"/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/SwapChain.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { Box, Flex, Text, Image, Stack, Button, Input } from '@chakra-ui/core';\nimport Loader from 'react-loader';\nimport Refreshing from './Refreshing';\nimport { useRouter } from 'next/router';\nimport { useWeb3React } from '@web3-react/core';\nimport { useEffect, useState } from 'react';\nimport { useContract } from '../hooks';\nimport { EMBLEM_API, contractAddresses } from '../constants';\nimport { TransactionToast } from './TransactionToast';\nimport { parseUnits } from '@ethersproject/units';\nexport default function SwapChain() {\n  const {\n    query\n  } = useRouter();\n  const {\n    account,\n    chainId\n  } = useWeb3React(); // const [vaults, setVaults] = useState([])\n\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    loaded: false\n  });\n  const {\n    0: loadingApi,\n    1: setLoadingApi\n  } = useState(false);\n  const {\n    0: approving,\n    1: setApproving\n  } = useState(false);\n  const {\n    0: transfering,\n    1: setTransfering\n  } = useState(false);\n  const {\n    0: balance,\n    1: setBalance\n  } = useState(null);\n  const {\n    0: address,\n    1: setAddress\n  } = useState(query.address);\n  const {\n    0: experimental,\n    1: setExperimental\n  } = useState(query.experimental);\n  const {\n    0: decimals,\n    1: setDecimals\n  } = useState(null);\n  const {\n    0: allowance,\n    1: setAllowance\n  } = useState(null);\n  const {\n    0: covalApprovedFor,\n    1: setIsCovalApproved\n  } = useState(0);\n  const {\n    0: hash,\n    1: setHash\n  } = useState(null);\n  const {\n    0: swapAmount,\n    1: setSwapAmount\n  } = useState(0);\n  const {\n    0: isInvalid,\n    1: setIsInvalid\n  } = useState(false);\n  const handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true);\n  const covalContract = useContract(contractAddresses.coval[chainId], contractAddresses.covalAbi, true);\n\n  const transferToChain = async () => {\n    setTransfering(true);\n    handlerContract.transferToChain(chainId == 137 ? 1 : 137, swapAmount.toString()).then(({\n      hash\n    }) => {\n      setHash(hash);\n    }).catch(error => {\n      if ((error === null || error === void 0 ? void 0 : error.code) == 4001) {\n        setTransfering(false);\n      }\n    });\n  };\n\n  const getContractStates = async () => {\n    setHash(null);\n    setDecimals(await covalContract.decimals());\n    setAllowance(await covalContract.allowance(account, contractAddresses.vaultHandler[chainId]).then(balance => balance.toString()));\n    setBalance(await covalContract.balanceOf(account).then(balance => balance.toString()));\n\n    if (Number(allowance) >= Number(0)) {\n      setIsCovalApproved(allowance);\n    }\n\n    setState({\n      loaded: true\n    });\n  };\n\n  const approveCovalFlow = () => {\n    setApproving(true);\n    covalContract.approve(contractAddresses.vaultHandler[chainId], 1000000 * Math.pow(10, +decimals)).then(({\n      hash\n    }) => {\n      setHash(hash);\n    }).catch(error => {\n      if ((error === null || error === void 0 ? void 0 : error.code) == 4001) {\n        setApproving(false);\n      }\n    });\n  };\n\n  const getTransferLogs = async () => {\n    console.log(\"getting logs\");\n    fetch(EMBLEM_API + '/transfersOut', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        service: 'evmetadata',\n        chainid: chainId.toString()\n      }\n    }).then(async function (response) {\n      console.log(\"doing transfers\");\n      fetch(EMBLEM_API + '/doTransfers', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          service: 'evmetadata',\n          chainid: chainId.toString()\n        }\n      }).then(async function (response) {\n        getContractStates();\n      });\n    });\n  };\n\n  function SwapText(_ref) {\n    let {\n      children\n    } = _ref,\n        rest = _objectWithoutProperties(_ref, [\"children\"]);\n\n    return __jsx(Text, _extends({\n      fontSize: \"2xl\",\n      lineHeight: 1,\n      py: \"0.3rem\"\n    }, rest, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 7\n      }\n    }), children);\n  }\n\n  const {\n    0: acct,\n    1: setAcct\n  } = useState('');\n  useEffect(() => {\n    if (account && acct != account) {\n      setAcct(account);\n      setState({\n        loaded: false\n      });\n      getContractStates();\n    }\n  }, [account, acct]);\n  const {\n    0: chain,\n    1: setChain\n  } = useState(chainId);\n  useEffect(() => {\n    if (chainId && chain != chainId) {\n      setChain(chainId);\n      setState({\n        loaded: false\n      });\n      getContractStates();\n    }\n  }, [chainId, chain]);\n  useEffect(() => {\n    account && chainId ? setState({\n      loaded: true\n    }) : null;\n  }, []);\n  return __jsx(Loader, {\n    loaded: state.loaded,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, loadingApi ? __jsx(Refreshing, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  }) : '', __jsx(Flex, {\n    w: \"100%\",\n    justify: \"center\",\n    mt: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, __jsx(Stack, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }, true ? __jsx(React.Fragment, null, __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"1rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 15\n    }\n  }, __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 17\n    }\n  }, \"I want to transfer \"), __jsx(Input, {\n    variant: \"flushed\",\n    fontSize: \"1xl\",\n    textAlign: \"center\" // universal input options\n    ,\n    inputMode: \"decimal\",\n    title: \"Token Amount\",\n    autoComplete: \"off\",\n    autoCorrect: \"off\" // text-specific options\n    ,\n    type: \"text\",\n    placeholder: \"0\",\n    minLength: 1,\n    maxLength: 79,\n    isInvalid: isInvalid,\n    onChange: e => {\n      let calculatedAmount = Number(parseUnits(e.target.value, decimals).toString());\n\n      if (calculatedAmount > Number(balance) || calculatedAmount > Number(allowance)) {\n        setIsInvalid(true);\n      } else {\n        setIsInvalid(false);\n      }\n\n      setSwapAmount(Number(calculatedAmount));\n    },\n    spellCheck: \"false\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 17\n    }\n  }), __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 19\n    }\n  }, \"$Coval\")), __jsx(Stack, {\n    direction: \"row\",\n    align: \"flex-start\",\n    spacing: \"1rem\",\n    flexWrap: \"wrap\",\n    shouldWrapChildren: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 15\n    }\n  }, __jsx(SwapText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, \" \", __jsx(Text, {\n    float: 'left',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 28\n    }\n  }, \"from \", chainId == 137 ? \"Matic\" : \"Ethereum\", \" Network to \"), \" \", __jsx(Image, {\n    float: 'left',\n    w: 5,\n    src: \"./next.png\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 114\n    }\n  }), chainId == 137 ? \"Etherum\" : \"Matic\", \" Network \"), swapAmount > 0 ? __jsx(Button, {\n    isDisabled: isInvalid,\n    onClick: transferToChain,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 19\n    }\n  }, isInvalid ? \"Invalid Transfer Amount\" : \"Transfer Now\") : null)) : null, allowance == 0 && balance > 0 && !approving ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 15\n    }\n  }, __jsx(Button, {\n    onClick: approveCovalFlow,\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 17\n    }\n  }, \"Approve Transfer of up \", balance * Math.pow(10, -decimals), \" Coval\"))) : balance == 0 ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 15\n    }\n  }, \"You have no Coval to transfer\")) : !approving ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  }, \"Approved to transfer up to \", allowance * Math.pow(10, -decimals), \" Coval. Note: Swaps between networks can take up to 25 minutes.\")) : null, !approving && (Number(balance) > Number(allowance) || Number(allowance) * Math.pow(10, -decimals) < 1000000) ? __jsx(Box, {\n    mt: \"2\",\n    ml: \"4\",\n    lineHeight: \"tight\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, __jsx(Text, {\n    mt: 2,\n    as: \"h4\",\n    ml: \"4\",\n    mr: \"4\",\n    fontSize: \"s\",\n    fontStyle: \"italic\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, __jsx(Button, {\n    onClick: approveCovalFlow,\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 15\n    }\n  }, \"Approve Transfer 1,000,000 Coval\"))) : null)), hash ? __jsx(TransactionToast, {\n    hash: hash,\n    onComplete: () => {\n      if (transfering) {\n        setTransfering(false);\n        getTransferLogs();\n      } else {\n        setApproving(false);\n        getContractStates();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  }) : null);\n}","map":{"version":3,"sources":["/Users/shannoncode/repo/Emblem.Currentwork/emblem-vault-site/components/SwapChain.tsx"],"names":["Box","Flex","Text","Image","Stack","Button","Input","Loader","Refreshing","useRouter","useWeb3React","useEffect","useState","useContract","EMBLEM_API","contractAddresses","TransactionToast","parseUnits","SwapChain","query","account","chainId","state","setState","loaded","loadingApi","setLoadingApi","approving","setApproving","transfering","setTransfering","balance","setBalance","address","setAddress","experimental","setExperimental","decimals","setDecimals","allowance","setAllowance","covalApprovedFor","setIsCovalApproved","hash","setHash","swapAmount","setSwapAmount","isInvalid","setIsInvalid","handlerContract","vaultHandler","vaultHandlerAbi","covalContract","coval","covalAbi","transferToChain","toString","then","catch","error","code","getContractStates","balanceOf","Number","approveCovalFlow","approve","Math","pow","getTransferLogs","console","log","fetch","method","headers","service","chainid","response","SwapText","children","rest","acct","setAcct","chain","setChain","e","calculatedAmount","target","value"],"mappings":"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","sourcesContent":["import { Box, Flex, Text, Link, Image, Stack, Button, BoxProps, Input } from '@chakra-ui/core'\nimport Loader from 'react-loader'\nimport Refreshing from './Refreshing'\nimport { useRouter } from 'next/router'\nimport { useWeb3React } from '@web3-react/core'\nimport { useEffect, useState } from 'react'\nimport { validImage, toContractValue } from '../utils'\nimport { useContract } from '../hooks'\nimport { Contract } from '@ethersproject/contracts'\nimport { EMBLEM_API, contractAddresses } from '../constants'\nimport { TransactionToast } from './TransactionToast'\nimport { parseUnits } from '@ethersproject/units'\n\nexport default function SwapChain() {\n  const { query } = useRouter()\n  const { account, chainId } = useWeb3React()\n  // const [vaults, setVaults] = useState([])\n  const [state, setState] = useState({ loaded: false })\n  const [loadingApi, setLoadingApi] = useState(false)\n  const [approving, setApproving] = useState(false)\n  const [transfering, setTransfering] = useState(false)\n  const [balance, setBalance] = useState(null)\n  const [address, setAddress] = useState(query.address)\n  const [experimental, setExperimental] = useState(query.experimental)\n  const [decimals, setDecimals] = useState(null)\n  const [allowance, setAllowance] = useState(null)\n  const [covalApprovedFor, setIsCovalApproved] = useState(0)\n  const [hash, setHash] = useState(null)\n  const [swapAmount, setSwapAmount] = useState(0)\n  const [isInvalid, setIsInvalid] = useState(false)\n\n  const handlerContract = useContract(contractAddresses.vaultHandler[chainId], contractAddresses.vaultHandlerAbi, true)\n  const covalContract = useContract(contractAddresses.coval[chainId], contractAddresses.covalAbi, true)\n\n\n  interface ErrorWithCode extends Error {\n    code?: number\n  }\n\n  const transferToChain = async () => {\n    setTransfering(true)\n    ;(handlerContract as Contract)\n    .transferToChain(chainId == 137 ? 1: 137, swapAmount.toString())\n    .then(({ hash }: { hash: string }) => {\n      setHash(hash)\n    })\n    .catch((error: ErrorWithCode) => {\n      if (error?.code == 4001) {\n        setTransfering(false)\n      }\n    })\n  }\n\n  const getContractStates = async () => {\n    setHash(null)\n    setDecimals(await covalContract.decimals())\n    setAllowance(\n      await covalContract\n        .allowance(account, contractAddresses.vaultHandler[chainId])\n        .then((balance: { toString: () => string }) => balance.toString())\n    )\n    setBalance(await covalContract.balanceOf(account).then((balance: { toString: () => string }) => balance.toString()))\n    if (Number(allowance) >= Number(0)) {      \n      setIsCovalApproved(allowance)\n    }\n    setState({ loaded: true })\n  }\n\n  const approveCovalFlow = () => {\n    setApproving(true)\n    ;(covalContract as Contract)\n      .approve(contractAddresses.vaultHandler[chainId], 1000000 * Math.pow(10, +decimals) )\n      .then(({ hash }: { hash: string }) => {\n        setHash(hash)\n      })\n      .catch((error: ErrorWithCode) => {\n        if (error?.code == 4001) {\n          setApproving(false)\n        }\n      })\n  }\n\n  const getTransferLogs = async () =>{\n    console.log(\"getting logs\")\n    fetch(EMBLEM_API + '/transfersOut', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        service: 'evmetadata',\n        chainid: chainId.toString()\n      }\n    }).then(async function (response) {\n      console.log(\"doing transfers\")\n      fetch(EMBLEM_API + '/doTransfers', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          service: 'evmetadata',\n          chainid: chainId.toString()\n        }\n      }).then(async function (response) {\n        getContractStates()\n      })\n    })\n  }\n\n  function SwapText({ children, ...rest }: BoxProps): JSX.Element {\n    return (\n      <Text fontSize=\"2xl\" lineHeight={1} py=\"0.3rem\" {...rest}>\n        {children}\n      </Text>\n    )\n  }\n\n  const [acct, setAcct] = useState('')\n  useEffect(() => {\n    if (account && acct != account) {\n      setAcct(account)\n      setState({ loaded: false })\n      getContractStates()\n    }\n  }, [account, acct])\n\n  const [chain, setChain] = useState(chainId)\n  useEffect(() => {\n    if (chainId && chain != chainId) {\n      setChain(chainId)\n      setState({ loaded: false })\n      getContractStates()\n    }\n  }, [chainId, chain])\n\n  useEffect(() => {\n    account && chainId ? setState({ loaded: true }) : null\n  }, [])\n\n  return (\n    <Loader loaded={state.loaded}>\n      {loadingApi ? <Refreshing /> : ''}\n\n      <Flex w=\"100%\" justify=\"center\" mt={10}>\n        <Stack align=\"center\">\n          {true ? (\n            <>\n              {/* <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n                <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"\" >\n                  Transfer up to {allowance > balance ? balance * Math.pow(10, -decimals) : allowance * Math.pow(10, -decimals) } Coval from {chainId == 137 ? \"Matic\" : \"Ethereum\"} Network to {chainId == 137 ? \"Etherum\" : \"Matic\"} Network\n                </Text>              \n              </Box>\n              {balance > allowance ? (                 \n                <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n                  <Button onClick={approveCovalFlow} type=\"submit\">\n                    Increase transfer allowance to { balance * Math.pow(10, -decimals) } Coval\n                  </Button>\n                </Box>\n              ) : null } */}\n              <Stack direction=\"row\" align=\"flex-start\" spacing=\"1rem\" flexWrap=\"wrap\" shouldWrapChildren>\n                <SwapText>I want to transfer </SwapText>\n                <Input variant=\"flushed\"\n                  fontSize=\"1xl\"\n                  textAlign=\"center\"\n                  // universal input options\n                  inputMode=\"decimal\"\n                  title=\"Token Amount\"\n                  autoComplete=\"off\"\n                  autoCorrect=\"off\"\n                  // text-specific options\n                  type=\"text\"\n                  placeholder=\"0\"\n                  minLength={1}\n                  maxLength={79}\n                  isInvalid={isInvalid}\n                  onChange={(e) => {\n                    let calculatedAmount = Number(parseUnits(e.target.value, decimals).toString())\n                    \n                    if (calculatedAmount > Number(balance) || calculatedAmount > Number(allowance)) {\n                      setIsInvalid(true)\n                    } else {                      \n                      setIsInvalid(false)\n                    }\n                    setSwapAmount(Number(calculatedAmount))\n                  }}\n                  spellCheck=\"false\"/>\n                  <SwapText>$Coval</SwapText>                  \n              </Stack>\n              <Stack direction=\"row\" align=\"flex-start\" spacing=\"1rem\" flexWrap=\"wrap\" shouldWrapChildren>\n                <SwapText> <Text  float={'left'}>from {chainId == 137 ? \"Matic\" : \"Ethereum\"} Network to </Text> <Image float={'left'} w={5} src=\"./next.png\" />{chainId == 137 ? \"Etherum\" : \"Matic\"} Network </SwapText>\n                { swapAmount > 0 ? (\n                  <Button isDisabled={isInvalid} onClick={transferToChain}>\n                    { isInvalid ? \"Invalid Transfer Amount\" : \"Transfer Now\"}\n                  </Button>\n                ) : null }\n              </Stack>\n            </>    \n          ) : null }\n          {\n          allowance == 0 && balance > 0 && !approving ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                <Button onClick={approveCovalFlow} type=\"submit\">\n                  Approve Transfer of up {balance * Math.pow(10, -decimals)} Coval\n                </Button>\n              </Text>\n            </Box>\n          ) : balance == 0 ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                You have no Coval to transfer\n              </Text>\n            </Box>\n          ) : !approving ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n                Approved to transfer up to {allowance * Math.pow(10, -decimals)} Coval. Note: Swaps between networks can take up to 25 minutes.\n              </Text>\n            </Box>\n          ) : null }\n          { !approving && ((Number(balance) > Number(allowance)) || Number(allowance) * Math.pow(10, -decimals) < 1000000) ? (\n            <Box mt=\"2\" ml=\"4\" lineHeight=\"tight\">\n              <Text mt={2} as=\"h4\" ml=\"4\" mr=\"4\" fontSize=\"s\" fontStyle=\"italic\" >\n              <Button onClick={approveCovalFlow} type=\"submit\">\n                  Approve Transfer 1,000,000 Coval\n                </Button>\n              </Text>\n            </Box>\n          ) : null }\n        </Stack>\n      </Flex>\n      {hash ? (\n        <TransactionToast\n          hash={hash}\n          onComplete={() => {\n              if (transfering) {\n                setTransfering(false)\n                getTransferLogs()\n              } else {                \n                setApproving(false)\n                getContractStates()\n              }              \n          }}\n        />\n      ) : null}\n    </Loader>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}