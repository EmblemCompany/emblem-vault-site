graph LR
  subgraph User
    U((User))
  end
  subgraph Database
    D((Database))
  end
  subgraph Metamask
    M((Metamask))
  end
  subgraph Serverless
    S((Serverless))
  end
  subgraph Signer
    SI((Signer))
  end
  subgraph EmblemVault_Contract
    E((EmblemVault_Contract))
  end
  subgraph VaultHandler_Contract
    V((VaultHandler_Contract))
  end  
  subgraph Coval_Contract
    C((Coval_Contract))
  end

  U -- 1: Sign Request <--> M
  U -- 2: Mint Vault Request --> S 
  S -- 3: Get Vault Data <--> D
  S -- 4: ID Minted Before? <--> E <--> ownerOf
  S -- 5: ID Claimed Before? <--> C <--> claimedBy
  S -- 6: Mint Signature <--> SI
  S -- 7: Deliver Mint Signature --> U
  U -- 8: Approve Vaulting --> E
  U -- 9: Approve Spending Coval --> C
  U -- 10: Mint Vault --> V --> buyWithSignature
